/*!
 *  build: 杭州数蛙科技有限公司 
 *  copyright: dgiot-dashboard 
 *  author: h7ml(h7ml@qq.com) 
 *  time: Wed Nov 17 2021 04:11:42 GMT+0000 (Coordinated Universal Time)
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0fbadb5e"],{"0804":function(e,t,a){},"11ed":function(e,t,a){},"19cb":function(e,t,a){},"1f1b":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mycontainer"},[a("div",{staticClass:"ticker-dialog"},[a("div",{staticClass:"home_dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e.showdeviceFlag,width:"100vh"},on:{"update:visible":function(t){e.showdeviceFlag=t}}},[a("Change-Step",{ref:"ChangeStep",attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status,expression:"detail.status == 0"}],on:{click:function(t){return e.set_deviceStep(-1)}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status&&e.isfooter,expression:"detail.status == 0 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dispatch()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Dispatch"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status,expression:"detail.status == 1"}],on:{click:function(t){return e.backChange(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.back"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.Reassign(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reassign"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.check()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.check"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status&&e.isfooter,expression:"detail.status == 1 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dealwith()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("Maintenance.create Ticket"),visible:e.dialogFormVisible,width:"90vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project"),prop:"product"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("Maintenance.Please choose the product")},on:{change:e.prodChange},model:{value:e.form.product,callback:function(t){e.$set(e.form,"product",t)},expression:"form.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name"),prop:"name"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.Device.length,placeholder:0==e.Device.length?e.$translateTitle("Maintenance.Please choose the product"):e.$translateTitle("Maintenance.Please select a device")},on:{change:e.deviceChange},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},e._l(e.Device,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:e.objectId,expression:"item.objectId"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type"),prop:"type"}},[a("el-input",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")}},[a("el-upload",{attrs:{action:"#","auto-upload":!0,"http-request":e.myUpload,"list-type":"picture-card"}},[a("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"}),e._l(e.form.photo,(function(e,t){return a("div",{key:t},[a("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{alt:"",src:e.url}})])}))],2),a("el-dialog",{attrs:{"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{alt:"",src:e.dialogImageUrl,width:"100%"}})])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Create now"))+" ")]),a("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reset"))+" ")])],1)],1)],1)]),a("vab-query-form",{staticClass:"query-form"},[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.number")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.projects")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.project")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.type")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.fetchData}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")]),a("el-button",{attrs:{icon:"el-icon-circle-plus-outline",size:"mini",type:"primary"},on:{click:function(t){e.dialogFormVisible=!e.dialogFormVisible}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.create Ticket"))+" ")]),a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-s-promotion",size:"mini",type:"primary"},on:{click:function(t){return e.batchExport(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:"",data:e.list,height:e.height,stripe:""},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[a("vab-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortable:"",width:"120"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.getStatus(a.status,a))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.project"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.productname?a.info.productname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.devicename?a.info.devicename:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.createdname?a.info.createdname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$moment(a.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("Maintenance.operating"),width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showInfo(n,!0,!1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:3!=n.status,expression:"row.status != 3"}],attrs:{disabled:0!=n.status,size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(n,2)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.delete"))+" ")])]}}])})],1),a("vab-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},r=[],i=a("1da1"),s=a("5530"),o=(a("96cf"),a("d81d"),a("b0c0"),a("99af"),a("a4d3"),a("e01a"),a("d3b7"),a("159b"),a("ddb0"),a("0941")),l=a("dcc6"),c=a("1285"),u=a("5880"),d=a("2ec0"),m=a("1267"),p={name:"CreateTicket",components:{ChangeStep:d["default"]},data:function(){return{showdeviceFlag:!1,created:0,Assigned:0,form:{receiveuseid:"",productname:"",devicename:"",createdname:"",receiveusername:"",receiveuserphone:"",name:"",product:"",type:"",description:"",photo:[],objectId:""},dialogFormVisible:!1,fold:!1,step:1,ishard:!1,height:this.$baseTableHeight(0)-30,isfooter:!0,detail:{},AllDevice:[],selectedList:[],types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择所属项目",trigger:"change"}],name:[{required:!0,message:"请选择设备",trigger:"change"}],type:[{required:!0,message:"请输入工单类型",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,status:[{key:0,text:"Maintenance.To be assigned"},{key:1,text:"Maintenance.Assigned"},{key:2,text:"Maintenance.Processed"},{key:3,text:"Maintenance.Statement"}],queryForm:{devicename:"",statusFlag:!1,status:"",number:"",product:"",type:"",pageNo:1,pageSize:20,searchDate:[],limt:10,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:Object(s["a"])(Object(s["a"])({},Object(u["mapGetters"])({_Product:"user/_Product",objectid:"user/objectId",role:"acl/role",username:"user/username"})),{},{_deviceStep:{get:function(){return this.$store.state.global._deviceStep},set:function(e){this.set_deviceStep(e)}},aclObj:function(){var e={};return this.role.map((function(t){e["".concat("role:"+t.name)]={read:!0,write:!0}})),e}}),watch:{_deviceStep:function(e){-1==e&&this.fetchData()},"queryForm.status":function(e){this.queryForm.statusFlag=""!=e}},created:function(){},mounted:function(){this.handleCreated("created")},methods:Object(s["a"])(Object(s["a"])({myUpload:function(e){var t=this,a=e.file,n=a.name.substring(a.name.lastIndexOf(".")+1),r={file:a,path:"ticket",filename:"ticket"+"".concat(moment().format("x"),".").concat(n)};Object(m["UploadImg"])(r).then((function(e){e.data.url&&t.form.photo.push(e.data.url)})).catch((function(e){}))},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.createdTicket(t.form)}))},createdTicket:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n={},n[t.objectid]={read:!0,write:!0},r={number:moment(new Date).unix()+"",type:e.type,ACL:_.merge(n,t.aclObj),info:{photo:e.photo,timeline:[{timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"生成工单",p:"".concat(t.username,"新建工单")}],description:e.description,step1:{},step2:{},step3:{},step4:{},productid:e.product,productname:e.productname,devicename:e.devicename,deviceid:e.name,createdname:t.username,receiveusername:e.receiveusername,receiveuseid:e.receiveuseid,receiveuserphone:e.receiveuserphone},device:{objectId:e.name,__type:"Pointer",className:"Device"}},i=t.$baseColorfullLoading(),a.next=6,Object(o["create_object"])("Maintenance",r);case 6:a.sent,t.set_deviceStep(-1),i.close(),t.fetchData(),t.dialogFormVisible=!1;case 11:case"end":return a.stop()}}),a)})))()},resetForm:function(e){this.$refs[e].resetFields()},changeBox:function(e){var t=this;this.selectedList=[],e.forEach((function(e){t.selectedList.push(e)}))}},Object(u["mapMutations"])({set_deviceStep:"global/set_deviceStep"})),{},{handleFold:function(){this.fold=!this.fold,this.handleHeight()},batchExport:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,n={results:[]},n["results"]=e,a.next=5,Object(m["exlout"])(n);case 5:r=a.sent,t.$convertRes2Blob(r),t.$message.success(t.$translateTitle("node.export success")),a.next=13;break;case 10:a.prev=10,a.t0=a["catch"](0),t.$message.error(t.$translateTitle("node.export error")+"".concat(a.t0));case 13:case"end":return a.stop()}}),a,null,[[0,10]])})))()},handleDelete:function(e,t){var a=this,n=[];2==t?n.push({method:"DELETE",path:"/classes/Maintenance/".concat(e.objectId),body:{}}):e.forEach((function(e){n.push({method:"DELETE",path:"/classes/Maintenance/".concat(e.objectId),body:{}})})),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["batch"])(n);case 2:e.sent,a.$baseMessage(a.$translateTitle("Maintenance.successfully deleted"),"success","vab-hey-message-success"),setTimeout((function(){a.fetchData()}),1500);case 5:case"end":return e.stop()}}),e)}))))},handleHeight:function(){this.fold?this.height=this.$baseTableHeight(0)-20:this.height=this.$baseTableHeight(0)-30},getStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch(e){case 0:return this.$translateTitle("Maintenance.To be assigned");case 1:return this.$translateTitle("Maintenance.Assigned");case 2:return this.$translateTitle("Maintenance.Processed");case 3:return this.$translateTitle("Maintenance.Statement");default:return e}},showInfo:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.showdeviceFlag=!1,this.ishard=t,this.isfooter=a;var n=e.status,r=void 0===n?0:n;this.detail=e,this.step=r+1,this.set_deviceStep(r),this.showdeviceFlag=!0},handleCreated:function(e){"created"==e?this.created++:this.Assigned++,this.fetchData()},fetchData:function(){var e=arguments,t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.length>0&&void 0!==e[0]?e[0]:{},r.limit||(r=t.queryForm),t.listLoading=!1,i=t.$baseColorfullLoading(),s={limit:r.limit,order:r.order,skip:r.skip,keys:r.keys,where:{"info.receiveuseid":t.Assigned%2==0?{$ne:"99"}:t.objectid,number:t.queryForm.number.length?{$regex:t.queryForm.number}:{$ne:null},status:0,"info.productid":t.queryForm.product.length?t.queryForm.product:{$ne:"99"},type:t.queryForm.type.length?{$regex:t.queryForm.type}:{$ne:null}}},null!==(n=t.queryForm.searchDate)&&void 0!==n&&n.length&&(s.where["createdAt"]={$gt:{__type:"Date",iso:t.queryForm.searchDate[0]}},s.where["updatedAt"]={$lt:{__type:"Date",iso:t.queryForm.searchDate[1]}}),a.next=8,Object(o["query_object"])("Maintenance",s).then((function(e){var a=e.results,n=void 0===a?[]:a,r=e.count,s=void 0===r?0:r;t.list=n,t.list.forEach((function(e){if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(0)})),t.total=s,i.close()})).catch((function(e){t.$message.error("".concat(e)),i.close()}));case 8:case"end":return a.stop()}}),a)})))()},prodChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.Device=[],t._Product.map((function(a){a.objectId==e&&(t.form.productname=a.name)})),t.form.name="",n={where:{product:e}},a.next=6,Object(c["queryDevice"])(n);case 6:r=a.sent,i=r.results,t.Device=i;case 9:case"end":return a.stop()}}),a)})))()},deviceChange:function(e){var t=this;this.Device.map((function(a){a.objectId==e&&(t.form.devicename=a.name)}))},dispatch:function(){this.$refs.ChangeStep.$refs.step1.dispatchUser()},backChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.objectId,r=e.info,r.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已回退",p:"".concat(t.username," 回退了流程")}),i={status:0,info:r},a.next=5,Object(o["update_object"])("Maintenance",n,i);case 5:s=a.sent,s.updatedAt&&t.set_deviceStep(-1);case 7:case"end":return a.stop()}}),a)})))()},Reassign:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.objectId,r=e.info,r.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已改派",p:"".concat(t.username," 改派了工单")}),i={status:0,info:r},a.next=5,Object(o["update_object"])("Maintenance",n,i);case 5:s=a.sent,s.updatedAt&&t.set_deviceStep(-1);case 7:case"end":return a.stop()}}),a)})))()},dealwith:function(){this.$refs.ChangeStep.$refs.step2.dispatchUser()},check:function(){this.$refs.ChangeStep.$refs.step3.dispatchUser()}})},f=p,h=(a("cd37"),a("2877")),v=Object(h["a"])(f,n,r,!1,null,"64811a01",null);t["default"]=v.exports},2187:function(e,t,a){"use strict";a("11ed")},"251c":function(e,t,a){},"2c89":function(e,t,a){"use strict";a("3200")},"2ec0":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.detail?a("div",{staticClass:"changeInfo"},[a("el-row",{directives:[{name:"show",rawName:"v-show",value:1==e.showHard,expression:"showHard == true"}],staticClass:"row-bg",attrs:{justify:"space-around",type:"flex"}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v(" "+e._s(e.$translateTitle("Maintenance.Ticket number"))+" : "+e._s(e.detail.number)+" ")])]),a("el-col",{attrs:{span:5}},[a("div",{staticClass:"grid-content bg-purple-light"},[e._v(" "+e._s(e.$translateTitle("Maintenance.Ticket type"))+" : "+e._s(e.detail.type)+" ")])]),a("el-col",{attrs:{span:7}},[a("div",{staticClass:"grid-content bg-purple"},[e._v(" "+e._s(e.$translateTitle("Maintenance.the starting time"))+" : "+e._s(e.$moment(e.detail.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")])])],1),a("el-steps",{directives:[{name:"show",rawName:"v-show",value:1==e.showHard,expression:"showHard == true"}],staticClass:"steps",attrs:{active:e.step,"finish-status":"success",simple:""}},[a("el-step",{attrs:{title:e.$translateTitle("Maintenance.To be assigned")}}),a("el-step",{attrs:{title:e.$translateTitle("Maintenance.Assigned")}}),a("el-step",{attrs:{title:e.$translateTitle("Maintenance.Processed")}}),a("el-step",{attrs:{title:e.$translateTitle("Maintenance.Statement")}})],1),1===e.step?a("step1",{ref:"step1",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":e.showHard,step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),2===e.step?a("step2",{ref:"step2",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),3===e.step?a("step3",{ref:"step3",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),4===e.step?a("Step4",{ref:"step4",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e()],1):a("div",{staticClass:"empty"},[a("vab-empty")],1)},r=[],i=(a("a9e3"),a("c7e3")),s=a("f715"),o=a("926e"),l=a("4901"),c={name:"ChangeStep",components:{Step1:i["default"],Step2:s["default"],Step3:o["default"],Step4:l["default"]},props:{detail:{type:Object,default:function(){}},showFooter:{type:Boolean,default:!1},showHard:{type:Boolean,default:!1},step:{type:Number,default:1}},data:function(){return{isStep:0}},mounted:function(){4==this.step&&(this.isStep=4)},methods:{next:function(){this.isStep++>5&&(this.isStep=0)},handleSetStep:function(e,t){t&&(this.form=Object.assign(this.form,t))}}},u=c,d=(a("2f4c"),a("2877")),m=Object(d["a"])(u,n,r,!1,null,"3945c17e",null);t["default"]=m.exports},"2f4c":function(e,t,a){"use strict";a("83d5")},3200:function(e,t,a){},"3a95":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mycontainer"},[a("div",{staticClass:"ticker-dialog"},[a("div",{staticClass:"home_dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e._deviceFlag,width:"100vh"},on:{"update:visible":function(t){e._deviceFlag=t}}},[a("change-info",{ref:"changeinfo",attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status,expression:"detail.status == 0"}],on:{click:function(t){return e.set_deviceFlag(!1)}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status&&e.isfooter,expression:"detail.status == 0 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dispatch()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Dispatch"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status,expression:"detail.status == 1"}],on:{click:function(t){return e.backChange(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.back"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.Reassign(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reassign"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.check()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.check"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status&&e.isfooter,expression:"detail.status == 1 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dealwith()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("Maintenance.create Ticket"),visible:e.dialogFormVisible,width:"90vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project"),prop:"product"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("Maintenance.Please choose the product")},on:{change:e.prodChange},model:{value:e.form.product,callback:function(t){e.$set(e.form,"product",t)},expression:"form.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name"),prop:"name"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.Device.length,placeholder:0==e.Device.length?e.$translateTitle("Maintenance.Please choose the product"):e.$translateTitle("Maintenance.Please select a device")},on:{change:e.deviceChange},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},e._l(e.Device,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:e.objectId,expression:"item.objectId"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type"),prop:"type"}},[a("el-input",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")}},[a("el-upload",{attrs:{action:"#","auto-upload":!0,"http-request":e.myUpload,"list-type":"picture-card"}},[a("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"}),e._l(e.form.photo,(function(e,t){return a("div",{key:t},[a("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{alt:"",src:e.url}})])}))],2),a("el-dialog",{attrs:{"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{alt:"",src:e.dialogImageUrl,width:"100%"}})])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Create now"))+" ")]),a("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reset"))+" ")])],1)],1)],1)]),a("vab-query-form",{staticClass:"query-form"},[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.number")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.projects")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.project")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.type")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.status")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket status")},model:{value:e.queryForm.status,callback:function(t){e.$set(e.queryForm,"status",t)},expression:"queryForm.status"}},e._l(e.status,(function(t){return a("el-option",{key:t.key,attrs:{label:e.$translateTitle(t.text),value:t.key}})})),1),a("el-button",{attrs:{icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.fetchData}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")])],1),a("el-form-item",[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:e.handleFold}},[e.fold?a("span",[e._v(" "+e._s(e.$translateTitle("Maintenance.Unfold"))+" ")]):a("span",[e._v(e._s(e.$translateTitle("Maintenance.merge")))]),a("vab-icon",{staticClass:"vab-dropdown",class:{"vab-dropdown-active":e.fold},attrs:{icon:"arrow-up-s-line"}})],1)],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.fold,expression:"!fold"}]},[a("el-button",{attrs:{icon:"el-icon-circle-plus-outline",size:"mini",type:"primary"},on:{click:function(t){e.dialogFormVisible=!e.dialogFormVisible}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.create Ticket"))+" ")]),a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-s-promotion",size:"mini",type:"primary"},on:{click:function(t){return e.batchExport(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")]),a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-delete",size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(e.selectedList,1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.batch deletion"))+" ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:"",data:e.list,height:e.height,stripe:""},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[a("vab-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortable:"",width:"120"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.getStatus(a.status,a))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.project"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.productname?a.info.productname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.devicename?a.info.devicename:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.createdname?a.info.createdname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$moment(a.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("Maintenance.operating"),width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showInfo(n,!0,!1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==n.status,expression:"row.status == 1"}],attrs:{size:"mini",type:"success"},on:{click:function(t){return e.showInfo(n)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==n.status,expression:"row.status == 2"}],attrs:{size:"mini",type:"info"},on:{click:function(t){return e.showInfo(n)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Evaluation"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:3!=n.status,expression:"row.status != 3"}],attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(n,2)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.delete"))+" ")])]}}])})],1),a("vab-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},r=[],i=a("1da1"),s=a("5530"),o=(a("96cf"),a("d81d"),a("b0c0"),a("99af"),a("a4d3"),a("e01a"),a("d3b7"),a("159b"),a("ddb0"),a("0941")),l=a("dcc6"),c=a("1285"),u=a("5880"),d=a("5857"),m=a("1267"),p={name:"MyWork",components:{ChangeInfo:d["default"]},data:function(){return{created:0,Assigned:0,form:{receiveuseid:"",productname:"",devicename:"",createdname:"",receiveusername:"",receiveuserphone:"",name:"",product:"",type:"",description:"",photo:[],objectId:""},dialogFormVisible:!1,fold:!1,step:1,ishard:!1,height:this.$baseTableHeight(0)-30,isfooter:!0,detail:{},AllDevice:[],selectedList:[],types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择所属项目",trigger:"change"}],name:[{required:!0,message:"请选择设备",trigger:"change"}],type:[{required:!0,message:"请输入工单类型",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,status:[{key:0,text:"Maintenance.To be assigned"},{key:1,text:"Maintenance.Assigned"},{key:2,text:"Maintenance.Processed"},{key:3,text:"Maintenance.Statement"}],queryForm:{devicename:"",statusFlag:!1,status:"",number:"",product:"",type:"",pageNo:1,pageSize:20,searchDate:[],limt:10,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:Object(s["a"])(Object(s["a"])({},Object(u["mapGetters"])({_Product:"user/_Product",objectid:"user/objectId",role:"acl/role",username:"user/username"})),{},{_deviceFlag:{get:function(){return this.$store.state.global._deviceFlag},set:function(e){this.set_deviceFlag(e)}},aclObj:function(){var e={};return this.role.map((function(t){e["".concat("role:"+t.name)]={read:!0,write:!0}})),e}}),watch:{_deviceFlag:function(e){0==e&&this.fetchData()},"queryForm.status":function(e){this.queryForm.statusFlag=""!=e}},created:function(){},mounted:function(){this.handleCreated("created")},methods:Object(s["a"])(Object(s["a"])({myUpload:function(e){var t=this,a=e.file,n=a.name.substring(a.name.lastIndexOf(".")+1),r={file:a,path:"ticket",filename:"ticket"+"".concat(moment().format("x"),".").concat(n)};Object(m["UploadImg"])(r).then((function(e){e.data.url&&t.form.photo.push(e.data.url)})).catch((function(e){}))},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.createdTicket(t.form)}))},createdTicket:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n={},n[t.objectid]={read:!0,write:!0},r={number:moment(new Date).unix()+"",type:e.type,ACL:_.merge(n,t.aclObj),info:{photo:e.photo,timeline:[{timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"生成工单",p:"".concat(t.username,"新建工单")}],description:e.description,step1:{},step2:{},step3:{},step4:{},productid:e.product,productname:e.productname,devicename:e.devicename,deviceid:e.name,createdname:t.username,receiveusername:e.receiveusername,receiveuseid:e.receiveuseid,receiveuserphone:e.receiveuserphone},device:{objectId:e.name,__type:"Pointer",className:"Device"}},i=t.$baseColorfullLoading(),a.next=6,Object(o["create_object"])("Maintenance",r);case 6:a.sent,i.close(),t.fetchData(),t.dialogFormVisible=!1;case 10:case"end":return a.stop()}}),a)})))()},resetForm:function(e){this.$refs[e].resetFields()},changeBox:function(e){var t=this;this.selectedList=[],e.forEach((function(e){t.selectedList.push(e)}))}},Object(u["mapMutations"])({set_deviceFlag:"global/set_deviceFlag"})),{},{handleFold:function(){this.fold=!this.fold,this.handleHeight()},batchExport:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,n={results:[]},n["results"]=e,a.next=5,Object(m["exlout"])(n);case 5:r=a.sent,t.$convertRes2Blob(r),t.$message.success(t.$translateTitle("node.export success")),a.next=13;break;case 10:a.prev=10,a.t0=a["catch"](0),t.$message.error(t.$translateTitle("node.export error")+"".concat(a.t0));case 13:case"end":return a.stop()}}),a,null,[[0,10]])})))()},handleDelete:function(e,t){var a=this,n=[];2==t?n.push({method:"DELETE",path:"/classes/Maintenance/".concat(e.objectId),body:{}}):e.forEach((function(e){n.push({method:"DELETE",path:"/classes/Maintenance/".concat(e.objectId),body:{}})})),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["batch"])(n);case 2:e.sent,a.$baseMessage(a.$translateTitle("Maintenance.successfully deleted"),"success","vab-hey-message-success"),setTimeout((function(){a.fetchData()}),1500);case 5:case"end":return e.stop()}}),e)}))))},handleHeight:function(){this.fold?this.height=this.$baseTableHeight(0)-20:this.height=this.$baseTableHeight(0)-30},getStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch(e){case 0:return this.$translateTitle("Maintenance.To be assigned");case 1:return this.$translateTitle("Maintenance.Assigned");case 2:return this.$translateTitle("Maintenance.Processed");case 3:return this.$translateTitle("Maintenance.Statement");default:return e}},showInfo:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.ishard=t,this.isfooter=a;var n=e.status,r=void 0===n?0:n;this.detail=e,this.step=r+1,this.set_deviceFlag(!0)},handleCreated:function(e){"created"==e?this.created++:this.Assigned++,this.fetchData()},fetchData:function(){var e=arguments,t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.length>0&&void 0!==e[0]?e[0]:{},r.limit||(r=t.queryForm),t.listLoading=!1,i=t.$baseColorfullLoading(),s={limit:r.limit,order:r.order,skip:r.skip,keys:r.keys,where:{"info.receiveuseid":t.Assigned%2==0?{$ne:"99"}:t.objectid,number:t.queryForm.number.length?{$regex:t.queryForm.number}:{$ne:null},status:t.queryForm.statusFlag?t.queryForm.status:{$ne:9},"info.productid":t.queryForm.product.length?t.queryForm.product:{$ne:"99"},type:t.queryForm.type.length?{$regex:t.queryForm.type}:{$ne:null}}},null!==(n=t.queryForm.searchDate)&&void 0!==n&&n.length&&(s.where["createdAt"]={$gt:{__type:"Date",iso:t.queryForm.searchDate[0]}},s.where["updatedAt"]={$lt:{__type:"Date",iso:t.queryForm.searchDate[1]}}),a.next=8,Object(o["query_object"])("Maintenance",s).then((function(e){var a=e.results,n=void 0===a?[]:a,r=e.count,s=void 0===r?0:r;t.list=n,t.list.forEach((function(e){if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(0)})),t.total=s,i.close()})).catch((function(e){t.$message.error("".concat(e)),i.close()}));case 8:case"end":return a.stop()}}),a)})))()},prodChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.Device=[],t._Product.map((function(a){a.objectId==e&&(t.form.productname=a.name)})),t.form.name="",n={where:{product:e}},a.next=6,Object(c["queryDevice"])(n);case 6:r=a.sent,i=r.results,t.Device=i;case 9:case"end":return a.stop()}}),a)})))()},deviceChange:function(e){var t=this;this.Device.map((function(a){a.objectId==e&&(t.form.devicename=a.name)}))},dispatch:function(){this.$refs.changeinfo.$refs.step1.dispatchUser()},backChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.objectId,r=e.info,r.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已回退",p:"".concat(t.username," 回退了流程")}),i={status:0,info:r},a.next=5,Object(o["update_object"])("Maintenance",n,i);case 5:s=a.sent,s.updatedAt&&t.set_deviceFlag(!1);case 7:case"end":return a.stop()}}),a)})))()},Reassign:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.objectId,r=e.info,r.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已改派",p:"".concat(t.username," 改派了工单")}),i={status:0,info:r},a.next=5,Object(o["update_object"])("Maintenance",n,i);case 5:s=a.sent,s.updatedAt&&t.set_deviceFlag(!1);case 7:case"end":return a.stop()}}),a)})))()},dealwith:function(){this.$refs.changeinfo.$refs.step2.dispatchUser()},check:function(){this.$refs.changeinfo.$refs.step3.dispatchUser()}})},f=p,h=(a("2c89"),a("2877")),v=Object(h["a"])(f,n,r,!1,null,"5365c4c1",null);t["default"]=v.exports},"45e7":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mycontainer"},[a("div",{staticClass:"ticker-dialog"},[a("el-dialog",{directives:[{name:"drag",rawName:"v-drag"}],attrs:{"append-to-body":!0,visible:e.parserView},on:{"update:visible":function(t){e.parserView=t}}},[a("ele-form",e._b({attrs:{config:e.formConfig,pure:"","request-fn":e.handleSubmit},on:{"request-success":function(t){return e.handleSuccess(e.alertConfig)}},model:{value:e.alertConfig.config,callback:function(t){e.$set(e.alertConfig,"config",t)},expression:"alertConfig.config"}},"ele-form",e.alertConfig.config,!1))],1),a("el-dialog",{directives:[{name:"drag",rawName:"v-drag"}],attrs:{"append-to-body":!0,visible:e.dynamicformView,width:"50vh"},on:{"update:visible":function(t){e.dynamicformView=t}}},[a("el-form",[a("el-form-item",{attrs:{label:"设备名称","label-width":"200"}},[a("span",[e._v(e._s(e.devicename))])])],1),e._l(e.dynamicformInfo,(function(t){return a("el-form",{key:t.key,ref:"dynamicformInfo",refInFor:!0},[a("el-form-item",{attrs:{label:t.key}},[a("el-link",{attrs:{type:"success"}},[e._v(" "+e._s(t.value)+" ")])],1)],1)})),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-form",[a("el-form-item",{attrs:{label:e.$translateTitle("alert.Alarm status")}},[a("el-radio",{attrs:{label:"1"},model:{value:e.status,callback:function(t){e.status=t},expression:"status"}},[e._v("已处理")]),a("el-radio",{attrs:{label:"2"},model:{value:e.status,callback:function(t){e.status=t},expression:"status"}},[e._v("误报")])],1),a("el-form-item",{attrs:{label:e.$translateTitle("alert.Alarm handling"),"label-width":"200"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.process,callback:function(t){e.process=t},expression:"process"}})],1)],1),a("el-button",{on:{click:function(t){e.dynamicformView=!1}}},[e._v(" "+e._s(e.$translateTitle("button.cancel"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitAlert(e.alertId)}}},[e._v(" "+e._s(e.$translateTitle("button.submit"))+" ")])],1)],2)],1),a("vab-query-form",{staticClass:"query-form"},[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm,size:"mini"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("alert.productname")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("equipment.entername")},model:{value:e.queryForm.productName,callback:function(t){e.$set(e.queryForm,"productName",t)},expression:"queryForm.productName"}},e._l(e._Product,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("alert.isprocess")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("alert.isprocess")},model:{value:e.queryForm.isprocess,callback:function(t){e.$set(e.queryForm,"isprocess",t)},expression:"queryForm.isprocess"}},e._l(e.processAll,(function(e,t){return a("el-option",{key:t,attrs:{label:e.key,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search",type:"primary"},nativeOn:{click:function(t){return e.fetchData.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")])],1),a("el-form-item",[a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-delete",type:"danger"},on:{click:function(t){return e.fetchDelete(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.delete"))+" ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{data:e.list,height:e.height},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[a("vab-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("alert.alert number"),prop:"objectId","show-overflow-tooltip":"",sortablesortable:"",width:"120"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("alert.productname"),prop:"productname","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("alert.devicename"),prop:"devicename","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.createdAt"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$moment(a.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("alert.Alarm status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("el-tag",{attrs:{effect:"dark",type:n.alertstatus?"danger":"success"}},[e._v(" "+e._s(n.alertstatus?e.$translateTitle("alert.start"):e.$translateTitle("alert.stop"))+" ")])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("alert.Alarm handling"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("el-link",{attrs:{effect:"dark",type:1==n.status?"success":"info"}},[e._v(" "+e._s(1==n.status?e.$translateTitle("Maintenance.Processed"):0==n.status?e.$translateTitle("Maintenance.Untreated"):e.$translateTitle("Maintenance.Distort"))+" ")])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("alert.process"),prop:"process","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.operating"),prop:"name","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showdynamicform(n.objectId,n.Public,n.dynamicform,n.process,n.status,n.devicename)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(n.objectId)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.delete"))+" ")])]}}])})],1),a("VabPagination",{directives:[{name:"show",rawName:"v-show",value:e.total,expression:"total"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},r=[],i=a("3835"),s=a("1da1"),o=a("5530"),l=(a("96cf"),a("d3b7"),a("159b"),a("a9e3"),a("ac1f"),a("1276"),a("99af"),a("d81d"),a("ddb0"),a("b0c0"),a("a434"),a("4569")),c=a("dcc6"),u=a("7212"),d=a("5880"),m=a("4be7"),p={name:"Index",components:{},data:function(){return{selectedList:[],isDisable:!1,parserView:!1,dynamicformView:!1,formConfig:{},alertConfig:{},dynamicformInfo:{},alertId:"",step:1,detail:{},deviceFlag:!1,AllDevice:[],height:this.$baseTableHeight(0),dialogFormVisible:!1,types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",process:"",status:"",devicename:"",rules:{product:[{required:!0,message:"请选择活动区域",trigger:"change"}],name:[{required:!0,message:"请选择活动区域",trigger:"change"}],type:[{required:!0,message:"请选择活动资源",trigger:"change"}]},processAll:[{key:"未处理",value:0},{key:"已处理",value:1},{key:"误报",value:2}],list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,queryForm:{productName:"",isprocess:"",number:"",product:"",type:"",searchDate:[],limit:20,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:Object(o["a"])({},Object(d["mapGetters"])({_Product:"user/_Product",objectId:"user/objectId",role:"acl/role",username:"user/username"})),created:function(){},mounted:function(){this.fetchData()},methods:{fetchDelete:function(e){var t=this,a=[];e.forEach((function(e){a.push({method:"DELETE",path:"/classes/Notification/".concat(e.objectId),body:{}})})),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(c["batch"])(a);case 2:e.sent,t.$baseMessage(t.$translateTitle("Maintenance.successfully deleted"),"success","vab-hey-message-success"),setTimeout((function(){t.fetchData()}),1500);case 5:case"end":return e.stop()}}),e)}))))},handleSubmit:function(e){return m["Promise"].resolve()},handleSuccess:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var n,r,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n=e.table,r={public:!0},n){a.next=4;break}return a.abrupt("return");case 4:return i=t.$baseColorfullLoading(3),a.prev=5,a.next=8,t.$update_object(n,t.alertId,r);case 8:a.sent,i.close(),a.next=16;break;case 12:a.prev=12,a.t0=a["catch"](5),i.close(),t.$message.error("".concat(a.t0));case 16:t.$nextTick((function(){t.parserView=!1,t.fetchData()}));case 17:case"end":return a.stop()}}),a,null,[[5,12]])})))()},changeBox:function(e){var t=this;this.selectedList=[],e.forEach((function(e){t.selectedList.push(e)}))},submitAlert:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=t.$baseColorfullLoading(4),n.close(),r={process:t.process,status:Number(t.status)},a.prev=3,a.next=6,Object(l["putNotification"])(e,r);case 6:a.sent,t.$message.success("处理成功"),a.next=13;break;case 10:a.prev=10,a.t0=a["catch"](3),t.$message.error("处理失败");case 13:t.fetchData(),t.dynamicformView=!1;case 15:case"end":return a.stop()}}),a,null,[[3,10]])})))()},showdynamicform:function(e,t,a,n,r,i){this.alertId=e,this.isDisable=t,this.process=n,this.status=String(r),this.devicename=i;var s=[];for(var o in a)for(var l in a[o]){var c={key:l,value:a[o][l]};s.push(c)}this.dynamicformInfo=s,this.dynamicformView=!0},showInfo:function(e,t,a){var n=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var s,o,l,c,d,m,p,f,h,v,b,g,y;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return s=n.$baseColorfullLoading(4),o=e.split("_"),l=Object(i["a"])(o,2),c=l[0],d=l[1],n.alertId=a,r.prev=3,r.next=6,Object(u["getProduct"])(c);case 6:m=r.sent,p=m.config,s.close(),f=p.parser,h=void 0===f?[]:f,v=p.profile,b=void 0===v?[]:v,g=[].concat(b,h),y=g.map((function(e){if(e.uid==d)return e})),n.formConfig=y[0].config,n.alertConfig=y[0],r.next=20;break;case 16:r.prev=16,r.t0=r["catch"](3),s.close(),n.$message.error("".concat(r.t0));case 20:n.formConfig=_.merge(t,n.formConfig),n.$nextTick((function(){n.parserView=!0}));case 22:case"end":return r.stop()}}),r,null,[[3,16]])})))()},handleDelete:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(l["delNotification"])(e);case 2:n=a.sent,n=={}&&t.$message.success(t.$translateTitle("Maintenance.delete")+$translateTitle("message.success")),t.fetchData();case 5:case"end":return a.stop()}}),a)})))()},fetchData:function(){var e=arguments,t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var n,r,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.length>0&&void 0!==e[0]?e[0]:{},n.limit||(n=t.queryForm),t.listLoading=!1,r=t.$baseColorfullLoading(3),i={limit:n.limit,order:n.order,skip:n.skip,keys:n.keys,productid:t.queryForm.productName?t.queryForm.productName:"all",isprocess:t.queryForm.isprocess,include:"",where:{objectId:t.queryForm.number.length?{$regex:t.queryForm.number}:{$ne:null}}},t.queryForm.searchDate.length&&(i.where["createdAt"]={$gt:{__type:"Date",iso:t.queryForm.searchDate[0]}},i.where["updatedAt"]={$lt:{__type:"Date",iso:t.queryForm.searchDate[1]}}),a.next=8,Object(l["queryNotification"])(i).then((function(e){var a=e.results,n=void 0===a?[]:a,i=e.count,s=void 0===i?0:i;t.list=n,t.total=s,r.close()})).catch((function(e){t.$message.error("".concat(e)),r.close()}));case 8:case"end":return a.stop()}}),a)})))()},prodChange:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var n,r,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.Device=[],n={where:{product:e}},a.next=4,queryDevice(n);case 4:r=a.sent,i=r.results,t.Device=i;case 7:case"end":return a.stop()}}),a)})))()},handleRemove:function(e){var t=this;this.form.photo.forEach((function(a,n){a.split("/")["".concat(a.split("/").length-1)]==e.name&&t.form.photo.splice(n,1)}))},handleSizeChange:function(e){this.queryForm.limit=e,this.fetchData()},handleCurrentChange:function(e){this.queryForm.skip=(e-1)*this.queryForm.limit,this.fetchData()}}},f=p,h=(a("5f5e"),a("2877")),v=Object(h["a"])(f,n,r,!1,null,"9a3f9eea",null);t["default"]=v.exports},4901:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("Maintenance.Work order information"),name:"first"}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,size:"medium "}},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project")+": "}},[a("span",[e._v(e._s(e.form.info.productname))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name")+": "}},[a("span",[e._v(e._s(e.form.info.createdname))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Initiator")+": "}},[a("span",[e._v(e._s(e.form.info.createdname))])])],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")+": "}},[a("el-input",{attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),readonly:"",type:"textarea"},model:{value:e.form.info.description,callback:function(t){e.$set(e.form.info,"description",t)},expression:"form.info.description"}})],1)],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")+": "}},[a("el-carousel",{attrs:{height:"200px",interval:2e3,type:"card"}},e._l(e.form.info.photo,(function(e,t){return a("el-carousel-item",{key:t},[a("img",{staticStyle:{width:"100%",height:"100%"},attrs:{alt:e,src:e,title:e}})])})),1)],1)],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Processing records")+": "}},[a("el-input",{staticStyle:{margin:"0 0 10px"},attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),readonly:"",size:"1",type:"textarea"},model:{value:e.form.info.step2.Remarks,callback:function(t){e.$set(e.form.info.step2,"Remarks",t)},expression:"form.info.step2.Remarks"}})],1)],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Evaluation description")+": "}},[a("el-input",{attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),readonly:"",type:"textarea"},model:{value:e.form.info.step3.Remarks,callback:function(t){e.$set(e.form.info.step3,"Remarks",t)},expression:"form.info.step3.Remarks"}})],1)],1)],1)],1)],1),a("el-tab-pane",{staticStyle:{height:"90%","overflow-x":"hidden","overflow-y":"auto"},attrs:{label:e.$translateTitle("Maintenance.work process"),name:"second"}},[a("el-card",{attrs:{shadow:"hover"},scopedSlots:e._u([{key:"header",fn:function(){return[a("el-radio-group",{staticClass:"card-header-radio",model:{value:e.reverse,callback:function(t){e.reverse=t},expression:"reverse"}},[a("el-radio",{attrs:{label:!0}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Positive order"))+" ")]),a("el-radio",{attrs:{label:!1}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reverse order"))+" ")])],1)]},proxy:!0}])},[a("el-timeline",{attrs:{reverse:e.reverse}},e._l(e.form.info.timeline,(function(t){return a("el-timeline-item",{key:t.timestamp,attrs:{placement:"top",timestamp:t.timestamp}},[a("el-card",[a("h4",[e._v(e._s(t.h4))]),a("p",[e._v(e._s(t.p))])])],1)})),1)],1)],1)],1)],1)},r=[],i={props:{detail:{type:Object,default:function(){}}},data:function(){return{reverse:!0,activeName:"first",form:this.detail}}},s=i,o=(a("6e6c"),a("2877")),l=Object(o["a"])(s,n,r,!1,null,"320e87a6",null);t["default"]=l.exports},"4df8":function(e,t,a){"use strict";a("19cb")},5857:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.detail?a("div",{staticClass:"changeInfo"},[a("el-row",{directives:[{name:"show",rawName:"v-show",value:1==e.showHard,expression:"showHard == true"}],staticClass:"row-bg",attrs:{justify:"space-around",type:"flex"}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v(" "+e._s(e.$translateTitle("Maintenance.Ticket number"))+" : "+e._s(e.detail.number)+" ")])]),a("el-col",{attrs:{span:5}},[a("div",{staticClass:"grid-content bg-purple-light"},[e._v(" "+e._s(e.$translateTitle("Maintenance.Ticket type"))+" : "+e._s(e.detail.type)+" ")])]),a("el-col",{attrs:{span:7}},[a("div",{staticClass:"grid-content bg-purple"},[e._v(" "+e._s(e.$translateTitle("Maintenance.the starting time"))+" : "+e._s(e.$moment(e.detail.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")])])],1),a("el-steps",{directives:[{name:"show",rawName:"v-show",value:1==e.showHard,expression:"showHard == true"}],staticClass:"steps",attrs:{active:e.step,"finish-status":"success",simple:""}},[a("el-step",{attrs:{title:e.$translateTitle("Maintenance.To be assigned")}}),a("el-step",{attrs:{title:e.$translateTitle("Maintenance.Assigned")}}),a("el-step",{attrs:{title:e.$translateTitle("Maintenance.Processed")}}),a("el-step",{attrs:{title:e.$translateTitle("Maintenance.Statement")}})],1),1===e.step?a("step1",{ref:"step1",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":e.showHard,step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),2===e.step?a("step2",{ref:"step2",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),3===e.step?a("step3",{ref:"step3",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),4===e.step?a("Step4",{ref:"step4",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e()],1):a("div",{staticClass:"empty"},[a("vab-empty")],1)},r=[],i=(a("a9e3"),a("c7e3")),s=a("f715"),o=a("926e"),l=a("4901"),c={name:"ChangeInfo",components:{Step1:i["default"],Step2:s["default"],Step3:o["default"],Step4:l["default"]},props:{detail:{type:Object,default:function(){}},showFooter:{type:Boolean,default:!1},showHard:{type:Boolean,default:!1},step:{type:Number,default:1}},data:function(){return{isStep:0}},mounted:function(){4==this.step&&(this.isStep=4)},methods:{next:function(){this.isStep++>5&&(this.isStep=0)},handleSetStep:function(e,t){t&&(this.form=Object.assign(this.form,t))}}},u=c,d=(a("b30d"),a("2877")),m=Object(d["a"])(u,n,r,!1,null,"da9958fe",null);t["default"]=m.exports},"5f5e":function(e,t,a){"use strict";a("251c")},"61a4":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mycontainer"},[a("div",{staticClass:"ticker-dialog"},[a("div",{staticClass:"home_dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e.showdeviceFlag,width:"100vh"},on:{"update:visible":function(t){e.showdeviceFlag=t}}},[a("change-step",{ref:"ChangeStep",attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:3!=e.detail.status,expression:"detail.status != 3"}],attrs:{type:"primary"},on:{click:function(t){return e.check()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.check"))+" ")])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("Maintenance.create Ticket"),visible:e.dialogFormVisible,width:"90vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project"),prop:"product"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("Maintenance.Please choose the product")},on:{change:e.prodChange},model:{value:e.form.product,callback:function(t){e.$set(e.form,"product",t)},expression:"form.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name"),prop:"name"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.Device.length,placeholder:0==e.Device.length?e.$translateTitle("Maintenance.Please choose the product"):e.$translateTitle("Maintenance.Please select a device")},on:{change:e.deviceChange},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},e._l(e.Device,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:e.objectId,expression:"item.objectId"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type"),prop:"type"}},[a("el-input",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")}},[a("el-upload",{attrs:{action:"#","auto-upload":!0,"http-request":e.myUpload,"list-type":"picture-card"}},[a("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"}),e._l(e.form.photo,(function(e,t){return a("div",{key:t},[a("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{alt:"",src:e.url}})])}))],2),a("el-dialog",{attrs:{"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{alt:"",src:e.dialogImageUrl,width:"100%"}})])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Create now"))+" ")]),a("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reset"))+" ")])],1)],1)],1)]),a("vab-query-form",{staticClass:"query-form"},[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.number")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.projects")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.project")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.type")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.fetchData}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")]),a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-s-promotion",size:"mini",type:"primary"},on:{click:function(t){return e.batchExport(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:"",data:e.list,height:e.height,stripe:""},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[a("vab-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortable:"",width:"120"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.getStatus(a.status,a))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.project"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.productname?a.info.productname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.devicename?a.info.devicename:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.createdname?a.info.createdname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$moment(a.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("Maintenance.operating"),width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showInfo(n,!0,!1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==n.status,expression:"row.status == 2"}],attrs:{size:"mini",type:"info"},on:{click:function(t){return e.showInfo(n,!0)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Evaluation"))+" ")])]}}])})],1),a("vab-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},r=[],i=a("1da1"),s=a("5530"),o=(a("96cf"),a("d81d"),a("b0c0"),a("a4d3"),a("e01a"),a("d3b7"),a("159b"),a("ddb0"),a("0941")),l=a("dcc6"),c=a("1285"),u=a("5880"),d=a("2ec0"),m=a("1267"),p={name:"EvaluationTicket",components:{ChangeStep:d["default"]},data:function(){return{showdeviceFlag:!1,created:0,Assigned:0,form:{receiveuseid:"",productname:"",devicename:"",createdname:"",receiveusername:"",receiveuserphone:"",name:"",product:"",type:"",description:"",photo:[],objectId:""},dialogFormVisible:!1,fold:!1,step:1,ishard:!1,height:this.$baseTableHeight(0)-30,isfooter:!0,detail:{},AllDevice:[],selectedList:[],types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择所属项目",trigger:"change"}],name:[{required:!0,message:"请选择设备",trigger:"change"}],type:[{required:!0,message:"请输入工单类型",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,status:[{key:0,text:"Maintenance.To be assigned"},{key:1,text:"Maintenance.Assigned"},{key:2,text:"Maintenance.Processed"},{key:3,text:"Maintenance.Statement"}],queryForm:{devicename:"",statusFlag:!1,status:"",number:"",product:"",type:"",pageNo:1,pageSize:20,searchDate:[],limt:10,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:Object(s["a"])(Object(s["a"])({},Object(u["mapGetters"])({_Product:"user/_Product",objectid:"user/objectId",role:"acl/role",username:"user/username"})),{},{_deviceStep:{get:function(){return this.$store.state.global._deviceStep},set:function(e){this.set_deviceStep(e)}},aclObj:function(){var e={};return this.role.map((function(t){e["".concat("role:"+t.name)]={read:!0,write:!0}})),e}}),watch:{_deviceStep:function(e){-1==e&&(this.showdeviceFlag=!1,this.fetchData())},"queryForm.status":function(e){this.queryForm.statusFlag=""!=e}},created:function(){},mounted:function(){this.handleCreated("created")},methods:Object(s["a"])(Object(s["a"])({myUpload:function(e){var t=this,a={headers:{proxy:!0,produrl:"/",devurl:"iotapi/"}};Object(m["UploadImg"])(e.file,a).then((function(e){e.data.url&&t.form.photo.push(e.data.url)})).catch((function(e){}))},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.createdTicket(t.form)}))},createdTicket:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n={},n[t.objectid]={read:!0,write:!0},r={number:moment(new Date).unix()+"",type:e.type,ACL:_.merge(n,t.aclObj),info:{photo:e.photo,timeline:[{timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"生成工单",p:"".concat(t.username,"新建工单")}],description:e.description,step1:{},step2:{},step3:{},step4:{},productid:e.product,productname:e.productname,devicename:e.devicename,deviceid:e.name,createdname:t.username,receiveusername:e.receiveusername,receiveuseid:e.receiveuseid,receiveuserphone:e.receiveuserphone},device:{objectId:e.name,__type:"Pointer",className:"Device"}},i=t.$baseColorfullLoading(),a.next=6,Object(o["create_object"])("Maintenance",r);case 6:a.sent,i.close(),t.fetchData(),t.dialogFormVisible=!1;case 10:case"end":return a.stop()}}),a)})))()},resetForm:function(e){this.$refs[e].resetFields()},changeBox:function(e){var t=this;this.selectedList=[],e.forEach((function(e){t.selectedList.push(e)}))}},Object(u["mapMutations"])({set_deviceStep:"global/set_deviceStep"})),{},{handleFold:function(){this.fold=!this.fold,this.handleHeight()},batchExport:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,n={results:[]},n["results"]=e,a.next=5,Object(m["exlout"])(n);case 5:r=a.sent,t.$convertRes2Blob(r),t.$message.success(t.$translateTitle("node.export success")),a.next=13;break;case 10:a.prev=10,a.t0=a["catch"](0),t.$message.error(t.$translateTitle("node.export error")+"".concat(a.t0));case 13:case"end":return a.stop()}}),a,null,[[0,10]])})))()},handleDelete:function(e,t){var a=this,n=[];2==t?n.push({method:"DELETE",path:"/classes/Maintenance/".concat(e.objectId),body:{}}):e.forEach((function(e){n.push({method:"DELETE",path:"/classes/Maintenance/".concat(e.objectId),body:{}})})),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["batch"])(n);case 2:e.sent,a.$baseMessage(a.$translateTitle("Maintenance.successfully deleted"),"success","vab-hey-message-success"),setTimeout((function(){a.fetchData()}),1500);case 5:case"end":return e.stop()}}),e)}))))},handleHeight:function(){this.fold?this.height=this.$baseTableHeight(0)-20:this.height=this.$baseTableHeight(0)-30},getStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch(e){case 0:return this.$translateTitle("Maintenance.To be assigned");case 1:return this.$translateTitle("Maintenance.Assigned");case 2:return this.$translateTitle("Maintenance.Processed");case 3:return this.$translateTitle("Maintenance.Statement");default:return e}},showInfo:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.showdeviceFlag=!1,this.ishard=t,this.isfooter=a;var n=e.status,r=void 0===n?0:n;this.detail=e,this.step=r+1,this.showdeviceFlag=!0,this.set_deviceStep(r)},handleCreated:function(e){"created"==e?this.created++:this.Assigned++,this.fetchData()},fetchData:function(){var e=arguments,t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.length>0&&void 0!==e[0]?e[0]:{},r.limit||(r=t.queryForm),t.listLoading=!1,i=t.$baseColorfullLoading(),s={limit:r.limit,order:r.order,skip:r.skip,keys:r.keys,where:{"info.receiveuseid":t.Assigned%2==0?{$ne:"99"}:t.objectid,number:t.queryForm.number.length?{$regex:t.queryForm.number}:{$ne:null},status:{$gte:2},"info.productid":t.queryForm.product.length?t.queryForm.product:{$ne:"99"},type:t.queryForm.type.length?{$regex:t.queryForm.type}:{$ne:null}}},null!==(n=t.queryForm.searchDate)&&void 0!==n&&n.length&&(s.where["createdAt"]={$gt:{__type:"Date",iso:t.queryForm.searchDate[0]}},s.where["updatedAt"]={$lt:{__type:"Date",iso:t.queryForm.searchDate[1]}}),a.next=8,Object(o["query_object"])("Maintenance",s).then((function(e){var a=e.results,n=void 0===a?[]:a,r=e.count,s=void 0===r?0:r;t.list=n,t.list.forEach((function(e){if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(0)})),t.total=s,i.close()})).catch((function(e){t.$message.error("".concat(e)),i.close()}));case 8:case"end":return a.stop()}}),a)})))()},prodChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.Device=[],t._Product.map((function(a){a.objectId==e&&(t.form.productname=a.name)})),t.form.name="",n={where:{product:e}},a.next=6,Object(c["queryDevice"])(n);case 6:r=a.sent,i=r.results,t.Device=i;case 9:case"end":return a.stop()}}),a)})))()},deviceChange:function(e){var t=this;this.Device.map((function(a){a.objectId==e&&(t.form.devicename=a.name)}))},dispatch:function(){this.$refs.ChangeStep.$refs.step1.dispatchUser()},backChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.objectId,r=e.info,r.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已回退",p:"".concat(t.username," 回退了流程")}),i={status:0,info:r},a.next=5,Object(o["update_object"])("Maintenance",n,i);case 5:s=a.sent,s.updatedAt&&t.set_deviceStep(-1);case 7:case"end":return a.stop()}}),a)})))()},Reassign:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.objectId,r=e.info,r.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已改派",p:"".concat(t.username," 改派了工单")}),i={status:0,info:r},a.next=5,Object(o["update_object"])("Maintenance",n,i);case 5:s=a.sent,s.updatedAt&&t.set_deviceStep(-1);case 7:case"end":return a.stop()}}),a)})))()},dealwith:function(){this.$refs.ChangeStep.$refs.step2.dispatchUser()},check:function(){this.$refs.ChangeStep.$refs.step3.dispatchUser()}})},f=p,h=(a("be42"),a("2877")),v=Object(h["a"])(f,n,r,!1,null,"ab16e8a6",null);t["default"]=v.exports},"6e6c":function(e,t,a){"use strict";a("fcaf")},"773a":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mycontainer"},[a("div",{staticClass:"ticker-dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e.deviceFlag,width:"100vh"},on:{"update:visible":function(t){e.deviceFlag=t}}},[a("change-info",{attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}})],1)],1),a("vab-query-form",{staticClass:"query-form"},[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket number")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project")}},[a("el-select",{attrs:{placeholder:e.$translateTitle("Maintenance.project")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type")}},[a("el-input",{attrs:{placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.the starting time")}},[a("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search",type:"primary"},nativeOn:{click:function(t){return e.fetchData.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")]),a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-folder-checked",type:"primary"},on:{click:function(t){return e.Export(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{data:e.list,height:e.height},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[a("vab-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortablesortable:"",width:"120"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:"",width:"140"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.getStatus(a.status))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.project"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.productname?a.info.productname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.devicename?a.info.devicename:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.createdname?a.info.createdname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$moment(a.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.operating"),prop:"name","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){return e.showInfo(n)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")])]}}])})],1),a("VabPagination",{directives:[{name:"show",rawName:"v-show",value:e.total,expression:"total"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},r=[],i=a("1da1"),s=a("5530"),o=(a("96cf"),a("d81d"),a("b0c0"),a("d3b7"),a("159b"),a("ddb0"),a("ac1f"),a("1276"),a("a434"),a("0941")),l=a("1267"),c=a("1285"),u=a("5857"),d=a("5880"),m={name:"Index",components:{ChangeInfo:u["default"]},data:function(){return{selectedList:[],ishard:!0,isfooter:!1,step:1,detail:{},deviceFlag:!1,AllDevice:[],height:this.$baseTableHeight(0),dialogFormVisible:!1,types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择活动区域",trigger:"change"}],name:[{required:!0,message:"请选择活动区域",trigger:"change"}],type:[{required:!0,message:"请选择活动资源",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,queryForm:{number:"",product:"",type:"",searchDate:[],limit:20,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:Object(s["a"])(Object(s["a"])({},Object(d["mapGetters"])({_Product:"user/_Product",objectId:"user/objectId",role:"acl/role",username:"user/username"})),{},{aclObj:function(){var e={};return this.role.map((function(t){e["".concat("role:"+t.name)]={read:!0,write:!0}})),e}}),created:function(){},mounted:function(){this.fetchData()},methods:{changeBox:function(e){var t=this;this.selectedList=[],e.forEach((function(e){t.selectedList.push(e)}))},Export:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,n={results:[]},n["results"]=e,a.next=5,Object(l["exlout"])(n);case 5:r=a.sent,t.$convertRes2Blob(r),t.$message.success(t.$translateTitle("node.export success")),a.next=13;break;case 10:a.prev=10,a.t0=a["catch"](0),t.$message.error(t.$translateTitle("node.export error")+"".concat(a.t0));case 13:case"end":return a.stop()}}),a,null,[[0,10]])})))()},showInfo:function(e){this.ishard=!0,this.isfooter=!1;var t=e.status,a=void 0===t?0:t;this.detail=e,this.step=a+1,this.deviceFlag=!0},getStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch(e){case 0:return"待分配";case 1:return"已分配";case 2:return"已处理";case 3:return"已结单";default:return e}},fetchData:function(){var e=arguments,t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.length>0&&void 0!==e[0]?e[0]:{},r.limit||(r=t.queryForm),t.listLoading=!1,i=t.$baseColorfullLoading(),s={limit:r.limit,order:r.order,skip:r.skip,keys:r.keys,where:{number:t.queryForm.number.length?{$regex:t.queryForm.number}:{$ne:null},"info.productid":t.queryForm.product.length?t.queryForm.product:{$ne:"98"},type:t.queryForm.type.length?{$regex:t.queryForm.type}:{$ne:null}}},null!==(n=t.queryForm.searchDate)&&void 0!==n&&n.length&&(s.where["createdAt"]={$gt:{__type:"Date",iso:t.queryForm.searchDate[0]}},s.where["updatedAt"]={$lt:{__type:"Date",iso:t.queryForm.searchDate[1]}}),a.next=8,Object(o["query_object"])("Maintenance",s).then((function(e){var a=e.results,n=void 0===a?[]:a,r=e.count,s=void 0===r?0:r;t.list=n,t.list.forEach((function(e){if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(5)})),t.total=s,i.close()})).catch((function(e){t.$message.error("".concat(e)),i.close()}));case 8:case"end":return a.stop()}}),a)})))()},prodChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.Device=[],n={where:{product:e}},a.next=4,Object(c["queryDevice"])(n);case 4:r=a.sent,i=r.results,t.Device=i;case 7:case"end":return a.stop()}}),a)})))()},handleRemove:function(e){var t=this;this.form.photo.forEach((function(a,n){a.split("/")["".concat(a.split("/").length-1)]==e.name&&t.form.photo.splice(n,1)}))},handleSizeChange:function(e){this.queryForm.limit=e,this.fetchData()},handleCurrentChange:function(e){this.queryForm.skip=(e-1)*this.queryForm.limit,this.fetchData()}}},p=m,f=(a("b676"),a("2877")),h=Object(f["a"])(p,n,r,!1,null,"ff183c9a",null);t["default"]=h.exports},"7f5e":function(e,t,a){},"83d5":function(e,t,a){},"864f":function(e,t,a){},"926e":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("Maintenance.Work order information"),name:"first"}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,size:"medium "}},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project")+": "}},[a("span",[e._v(e._s(e.form.info.productname))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name")+": "}},[a("span",[e._v(e._s(e.form.info.devicename))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Initiator")+": "}},[a("span",[e._v(e._s(e.form.info.createdname))])])],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")+": "}},[e._v(" "+e._s(e.form.info.description)+" ")])],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")+": "}},[a("el-carousel",{attrs:{height:"200px",interval:2e3,type:"card"}},e._l(e.form.info.photo,(function(e,t){return a("el-carousel-item",{key:t},[a("img",{staticStyle:{width:"100%",height:"100%"},attrs:{alt:e,src:e,title:e}})])})),1)],1)],1),e.showFooter?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Evaluation description")+": "}},[a("el-input",{attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),type:"textarea"},model:{value:e.form.info.step3.Remarks,callback:function(t){e.$set(e.form.info.step3,"Remarks",t)},expression:"form.info.step3.Remarks"}})],1)],1):e._e()],1)],1)],1),a("el-tab-pane",{staticStyle:{height:"90%","overflow-x":"hidden","overflow-y":"auto"},attrs:{label:e.$translateTitle("Maintenance.work process"),name:"second"}},[a("el-card",{attrs:{shadow:"hover"},scopedSlots:e._u([{key:"header",fn:function(){return[a("el-radio-group",{staticClass:"card-header-radio",model:{value:e.reverse,callback:function(t){e.reverse=t},expression:"reverse"}},[a("el-radio",{attrs:{label:!0}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Positive order"))+" ")]),a("el-radio",{attrs:{label:!1}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reverse order"))+" ")])],1)]},proxy:!0}])},[a("el-timeline",{attrs:{reverse:e.reverse}},e._l(e.form.info.timeline,(function(t){return a("el-timeline-item",{key:t.timestamp,attrs:{placement:"top",timestamp:t.timestamp}},[a("el-card",[a("h4",[e._v(e._s(t.h4))]),a("p",[e._v(e._s(t.p))])])],1)})),1)],1)],1)],1)],1)},r=[],i=a("1da1"),s=a("5530"),o=(a("96cf"),a("0941")),l=a("8665"),c=a("5880"),u={props:{detail:{type:Object,default:function(){}},showFooter:{type:Boolean,default:!1}},data:function(){return{reverse:!0,activeName:"first",form:this.detail}},computed:Object(s["a"])({},Object(c["mapGetters"])({username:"user/username"})),mounted:function(){this.featUser()},methods:Object(s["a"])(Object(s["a"])({},Object(c["mapMutations"])({set_deviceFlag:"global/set_deviceFlag",set_deviceStep:"global/set_deviceStep"})),{},{featUser:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(l["queryUser"])({});case 2:a=t.sent,n=a.results,e.user=n;case 5:case"end":return t.stop()}}),t)})))()},dispatchUser:function(){var e=this;this.$refs["form"].validate(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(a){var n,r,i,s,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!a||!e.form.info.receiveusername){t.next=10;break}return n=e.form,r=n.objectId,i=n.info,i.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已结单",p:"".concat(e.username," 已结束这条工单")}),s={status:3,info:i},t.next=6,Object(o["update_object"])("Maintenance",r,s);case 6:l=t.sent,l.updatedAt&&(e.set_deviceFlag(!1),e.set_deviceStep(-1)),t.next=12;break;case 10:return e.$message.error("请选择分配人员"),t.abrupt("return",!1);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}})},d=u,m=(a("d030"),a("2877")),p=Object(m["a"])(d,n,r,!1,null,"9d9537fe",null);t["default"]=p.exports},"9b7f":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mycontainer"},[a("div",{staticClass:"ticker-dialog"},[a("div",{staticClass:"home_dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e.showdeviceFlag,width:"100vh"},on:{"update:visible":function(t){e.showdeviceFlag=t}}},[a("change-step",{ref:"ChangeStep",attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status,expression:"detail.status == 0"}],on:{click:function(t){return e.set_deviceStep(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status&&e.isfooter,expression:"detail.status == 0 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dispatch()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Dispatch"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status,expression:"detail.status == 1"}],on:{click:function(t){return e.backChange(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.back"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.Reassign(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reassign"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.check()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.check"))+" ")]),a("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){return e.dealwith()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("Maintenance.create Ticket"),visible:e.dialogFormVisible,width:"90vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project"),prop:"product"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("Maintenance.Please choose the product")},on:{change:e.prodChange},model:{value:e.form.product,callback:function(t){e.$set(e.form,"product",t)},expression:"form.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name"),prop:"name"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.Device.length,placeholder:0==e.Device.length?e.$translateTitle("Maintenance.Please choose the product"):e.$translateTitle("Maintenance.Please select a device")},on:{change:e.deviceChange},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},e._l(e.Device,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:e.objectId,expression:"item.objectId"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type"),prop:"type"}},[a("el-input",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")}},[a("el-upload",{attrs:{action:"#","auto-upload":!0,"http-request":e.myUpload,"list-type":"picture-card"}},[a("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"}),e._l(e.form.photo,(function(e,t){return a("div",{key:t},[a("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{alt:"",src:e.url}})])}))],2),a("el-dialog",{attrs:{"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{alt:"",src:e.dialogImageUrl,width:"100%"}})])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Create now"))+" ")]),a("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reset"))+" ")])],1)],1)],1)]),a("vab-query-form",{staticClass:"query-form"},[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.number")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.projects")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.project")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.type")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.fetchData}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")]),a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-s-promotion",size:"mini",type:"primary"},on:{click:function(t){return e.batchExport(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:"",data:e.list,height:e.height,stripe:""},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[a("vab-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortable:"",width:"120"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.getStatus(a.status,a))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.project"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.productname?a.info.productname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.devicename?a.info.devicename:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.createdname?a.info.createdname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$moment(a.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("Maintenance.operating"),width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showInfo(n,!0,!1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.showInfo(n,!0,!0)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")])]}}])})],1),a("vab-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},r=[],i=a("1da1"),s=a("5530"),o=(a("96cf"),a("d81d"),a("b0c0"),a("a4d3"),a("e01a"),a("d3b7"),a("159b"),a("ddb0"),a("0941")),l=a("dcc6"),c=a("1285"),u=a("5880"),d=a("2ec0"),m=a("1267"),p={name:"ProcessTicket",components:{ChangeStep:d["default"]},data:function(){return{showdeviceFlag:!1,created:0,Assigned:0,form:{receiveuseid:"",productname:"",devicename:"",createdname:"",receiveusername:"",receiveuserphone:"",name:"",product:"",type:"",description:"",photo:[],objectId:""},dialogFormVisible:!1,fold:!1,step:1,ishard:!1,height:this.$baseTableHeight(0)-30,isfooter:!0,detail:{},AllDevice:[],selectedList:[],types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择所属项目",trigger:"change"}],name:[{required:!0,message:"请选择设备",trigger:"change"}],type:[{required:!0,message:"请输入工单类型",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,status:[{key:0,text:"Maintenance.To be assigned"},{key:1,text:"Maintenance.Assigned"},{key:2,text:"Maintenance.Processed"},{key:3,text:"Maintenance.Statement"}],queryForm:{devicename:"",statusFlag:!1,status:"",number:"",product:"",type:"",pageNo:1,pageSize:20,searchDate:[],limt:10,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:Object(s["a"])(Object(s["a"])({},Object(u["mapGetters"])({_Product:"user/_Product",objectid:"user/objectId",role:"acl/role",username:"user/username"})),{},{_deviceStep:{get:function(){return this.$store.state.global._deviceStep},set:function(e){this.set_deviceStep(e)}},aclObj:function(){var e={};return this.role.map((function(t){e["".concat("role:"+t.name)]={read:!0,write:!0}})),e}}),watch:{_deviceStep:function(e){-1==e&&(this.fetchData(),this.showdeviceFlag=!1)},"queryForm.status":function(e){this.queryForm.statusFlag=""!=e}},created:function(){},mounted:function(){this.handleCreated("created")},methods:Object(s["a"])(Object(s["a"])({myUpload:function(e){var t=this,a={headers:{proxy:!0,produrl:"/",devurl:"iotapi/"}};Object(m["UploadImg"])(e.file,a).then((function(e){e.data.url&&t.form.photo.push(e.data.url)})).catch((function(e){}))},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.createdTicket(t.form)}))},createdTicket:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n={},n[t.objectid]={read:!0,write:!0},r={number:moment(new Date).unix()+"",type:e.type,ACL:_.merge(n,t.aclObj),info:{photo:e.photo,timeline:[{timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"生成工单",p:"".concat(t.username,"新建工单")}],description:e.description,step1:{},step2:{},step3:{},step4:{},productid:e.product,productname:e.productname,devicename:e.devicename,deviceid:e.name,createdname:t.username,receiveusername:e.receiveusername,receiveuseid:e.receiveuseid,receiveuserphone:e.receiveuserphone},device:{objectId:e.name,__type:"Pointer",className:"Device"}},i=t.$baseColorfullLoading(),a.next=6,Object(o["create_object"])("Maintenance",r);case 6:a.sent,i.close(),t.fetchData(),t.dialogFormVisible=!1;case 10:case"end":return a.stop()}}),a)})))()},resetForm:function(e){this.$refs[e].resetFields()},changeBox:function(e){var t=this;this.selectedList=[],e.forEach((function(e){t.selectedList.push(e)}))}},Object(u["mapMutations"])({set_deviceStep:"global/set_deviceStep"})),{},{handleFold:function(){this.fold=!this.fold,this.handleHeight()},batchExport:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,n={results:[]},n["results"]=e,a.next=5,Object(m["exlout"])(n);case 5:r=a.sent,t.$convertRes2Blob(r),t.$message.success(t.$translateTitle("node.export success")),a.next=13;break;case 10:a.prev=10,a.t0=a["catch"](0),t.$message.error(t.$translateTitle("node.export error")+"".concat(a.t0));case 13:case"end":return a.stop()}}),a,null,[[0,10]])})))()},handleDelete:function(e,t){var a=this,n=[];2==t?n.push({method:"DELETE",path:"/classes/Maintenance/".concat(e.objectId),body:{}}):e.forEach((function(e){n.push({method:"DELETE",path:"/classes/Maintenance/".concat(e.objectId),body:{}})})),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["batch"])(n);case 2:e.sent,a.$baseMessage(a.$translateTitle("Maintenance.successfully deleted"),"success","vab-hey-message-success"),setTimeout((function(){a.fetchData()}),1500);case 5:case"end":return e.stop()}}),e)}))))},handleHeight:function(){this.fold?this.height=this.$baseTableHeight(0)-20:this.height=this.$baseTableHeight(0)-30},getStatus:function(e){return this.$translateTitle("Maintenance.Assigned")},showInfo:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.showdeviceFlag=!1,this.ishard=t,this.isfooter=a;var n=e.status,r=void 0===n?0:n;this.detail=e,this.step=r+1,this.set_deviceStep(r),this.showdeviceFlag=!0},handleCreated:function(e){"created"==e?this.created++:this.Assigned++,this.fetchData()},fetchData:function(){var e=arguments,t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.length>0&&void 0!==e[0]?e[0]:{},r.limit||(r=t.queryForm),t.listLoading=!1,i=t.$baseColorfullLoading(),s={limit:r.limit,order:r.order,skip:r.skip,keys:r.keys,where:{"info.receiveuseid":t.Assigned%2==0?{$ne:"99"}:t.objectid,number:t.queryForm.number.length?{$regex:t.queryForm.number}:{$ne:null},status:1,"info.productid":t.queryForm.product.length?t.queryForm.product:{$ne:"99"},type:t.queryForm.type.length?{$regex:t.queryForm.type}:{$ne:null}}},null!==(n=t.queryForm.searchDate)&&void 0!==n&&n.length&&(s.where["createdAt"]={$gt:{__type:"Date",iso:t.queryForm.searchDate[0]}},s.where["updatedAt"]={$lt:{__type:"Date",iso:t.queryForm.searchDate[1]}}),a.next=8,Object(o["query_object"])("Maintenance",s).then((function(e){var a=e.results,n=void 0===a?[]:a,r=e.count,s=void 0===r?0:r;t.list=n,t.list.forEach((function(e){if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(0)})),t.total=s,i.close()})).catch((function(e){t.$message.error("".concat(e)),i.close()}));case 8:case"end":return a.stop()}}),a)})))()},prodChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.Device=[],t._Product.map((function(a){a.objectId==e&&(t.form.productname=a.name)})),t.form.name="",n={where:{product:e}},a.next=6,Object(c["queryDevice"])(n);case 6:r=a.sent,i=r.results,t.Device=i;case 9:case"end":return a.stop()}}),a)})))()},deviceChange:function(e){var t=this;this.Device.map((function(a){a.objectId==e&&(t.form.devicename=a.name)}))},dispatch:function(){this.$refs.ChangeStep.$refs.step1.dispatchUser()},backChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.objectId,r=e.info,r.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已回退",p:"".concat(t.username," 回退了流程")}),i={status:0,info:r},a.next=5,Object(o["update_object"])("Maintenance",n,i);case 5:s=a.sent,s.updatedAt&&(t.set_deviceStep(-1),t.showdeviceFlag=!1);case 7:case"end":return a.stop()}}),a)})))()},Reassign:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.objectId,r=e.info,r.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已改派",p:"".concat(t.username," 改派了工单")}),i={status:0,info:r},a.next=5,Object(o["update_object"])("Maintenance",n,i);case 5:s=a.sent,s.updatedAt&&(t.set_deviceStep(-1),t.showdeviceFlag=!1);case 7:case"end":return a.stop()}}),a)})))()},dealwith:function(){this.$refs.ChangeStep.$refs.step2.dispatchUser()},check:function(){this.$refs.ChangeStep.$refs.step3.dispatchUser()}})},f=p,h=(a("b5d6"),a("2877")),v=Object(h["a"])(f,n,r,!1,null,"105d9b64",null);t["default"]=v.exports},b30d:function(e,t,a){"use strict";a("0804")},b5d6:function(e,t,a){"use strict";a("b826")},b676:function(e,t,a){"use strict";a("e0fb")},b826:function(e,t,a){},be42:function(e,t,a){"use strict";a("7f5e")},c1bc:function(e,t,a){},c7e3:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("Maintenance.Work order information"),name:"first"}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project")+": "}},[a("span",[e._v(e._s(e.form.info.productname))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name")+": "}},[a("span",[e._v(e._s(e.form.info.devicename))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Initiator")+": "}},[a("span",[e._v(e._s(e.form.info.createdname))])])],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")+": "}},[e._v(" "+e._s(e.form.info.description)+" ")])],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")+": "}},[a("el-carousel",{attrs:{height:"200px",interval:2e3,type:"card"}},e._l(e.form.info.photo,(function(e,t){return a("el-carousel-item",{key:t},[a("img",{staticStyle:{width:"100%",height:"100%"},attrs:{alt:e,src:e,title:e}})])})),1)],1)],1),e.showFooter?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Remarks")}},[a("el-input",{staticStyle:{"margin-bottom":"20px"},attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),type:"textarea"},model:{value:e.form.info.step1.Remarks,callback:function(t){e.$set(e.form.info.step1,"Remarks",t)},expression:"form.info.step1.Remarks"}})],1)],1):e._e(),e.showFooter?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Maintenance staff"),prop:"info.receiveusername",required:""}},[a("el-tree",{ref:"workGroup",staticStyle:{float:"left",width:"50%"},attrs:{data:e.deptTreeData,"default-expand-all":"","expand-on-click-node":!1,"node-key":"index",props:e.roleProps},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node,r=t.data;return a("div",{staticClass:"custom-tree-node"},[a("span",{class:{selected:r.objectId==e.curDepartmentId},on:{click:function(t){return e.handleNodeClick(r,n)}}},[e._v(" "+e._s(n.label)+" ")])])}}],null,!1,2722443036)}),a("el-select",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"50%"},attrs:{disabled:!e.user.length,"element-loading-background":"rgba(0, 0, 0, 0.8)","element-loading-spinner":"el-icon-loading","element-loading-text":e.$translateTitle("developer.Data is loading"),placeholder:e.$translateTitle("product.selectdepartment")},model:{value:e.form.info.receiveusername,callback:function(t){e.$set(e.form.info,"receiveusername",t)},expression:"form.info.receiveusername"}},e._l(e.user,(function(t){return a("el-option",{key:t.objectId,attrs:{label:t.nick,value:t.objectId}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.nick))]),a("span",{staticStyle:{float:"right","font-size":"14px",color:"#8492a6"}},[e._v(" "+e._s(t.objectId)+" ")])])})),1)],1)],1):e._e()],1)],1)],1),a("el-tab-pane",{staticStyle:{height:"90%","overflow-x":"hidden","overflow-y":"auto"},attrs:{label:e.$translateTitle("Maintenance.work process"),name:"second"}},[a("el-card",{attrs:{shadow:"hover"},scopedSlots:e._u([{key:"header",fn:function(){return[a("el-radio-group",{staticClass:"card-header-radio",model:{value:e.reverse,callback:function(t){e.reverse=t},expression:"reverse"}},[a("el-radio",{attrs:{label:!0}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Positive order"))+" ")]),a("el-radio",{attrs:{label:!1}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reverse order"))+" ")])],1)]},proxy:!0}])},[a("el-timeline",{attrs:{reverse:e.reverse}},e._l(e.form.info.timeline,(function(t){return a("el-timeline-item",{key:t.timestamp,attrs:{placement:"top",timestamp:t.timestamp}},[a("el-card",[a("h4",[e._v(e._s(t.h4))]),a("p",[e._v(e._s(t.p))])])],1)})),1)],1)],1)],1)],1)},r=[],i=a("1da1"),s=a("5530"),o=(a("96cf"),a("a9e3"),a("b0c0"),a("4de4"),a("d3b7"),a("99af"),a("0941")),l=a("5da9"),c=a("bc35"),u=a("5880"),d={props:{detail:{type:Object,default:function(){}},step:{type:Number,default:1},showFooter:{type:Boolean,default:!1},showHard:{type:Boolean,default:!1}},data:function(){return{roleName:"",loading:!1,user:[],deptTreeData:[],reverse:!0,roleProps:{children:"children",label:"name"},rules:{reverse:!0,"info.receiveusername":[{required:!0,message:"请选择分配人员",trigger:"change"}]},curDepartmentId:"",activeName:"first",form:this.detail}},computed:Object(s["a"])({},Object(u["mapGetters"])({username:"user/username",token:"user/token",objectId:"user/objectId"})),mounted:function(){this.getRoletree()},methods:Object(s["a"])(Object(s["a"])({},Object(u["mapMutations"])({set_deviceFlag:"global/set_deviceFlag",set_deviceStep:"global/set_deviceStep"})),{},{getRoletree:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(c["Roletree"])().then((function(t){e.deptTreeData=t.results,e.handleNodeClick(t.results[0],0)})).catch((function(e){}));case 2:case"end":return t.stop()}}),t)})))()},handleNodeClick:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a.loading=!0,a.curDepartmentId=e.objectId,a.user=[],a.roleName=e.name,t.next=6,Object(l["queryRoledepartment"])({name:e.name});case 6:n=t.sent,r=n.users,a.user=r,a.loading=!1;case 10:case"end":return t.stop()}}),t)})))()},dispatchUser:function(){var e=this;this.$refs["form"].validate(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(a){var n,r,i,s,l,c,u,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.user.filter((function(t){return t.objectId==e.form.info.receiveusername})),!a||!e.form.info.receiveusername){t.next=17;break}return r={},i=e.form,s=i.objectId,l=i.info,c=i.ACL,i.user,l.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已分配",p:"".concat(e.username," 分配给 ").concat(n[0].nick)}),l.receiveusername=n[0].nick,l.receiveuseid=n[0].objectId,l.receiveuserphone=n[0].phone,r["".concat(n[0].objectId)]={read:!0,write:!0},r["role:".concat(e.roleName)]={read:!0,write:!0},u={status:1,info:l,ACL:_.merge(r,c),user:{objectId:n[0].objectId,__type:"Pointer",className:"_User"}},t.next=13,Object(o["update_object"])("Maintenance",s,u);case 13:d=t.sent,d.updatedAt&&(e.set_deviceFlag(!1),e.set_deviceStep(-1)),t.next=19;break;case 17:return e.$message.error("请选择分配人员"),t.abrupt("return",!1);case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}})},m=d,p=(a("2187"),a("2877")),f=Object(p["a"])(m,n,r,!1,null,"77b2ec3e",null);t["default"]=f.exports},cd37:function(e,t,a){"use strict";a("c1bc")},d030:function(e,t,a){"use strict";a("864f")},db62:function(e,t,a){},e0fb:function(e,t,a){},ef07:function(e,t,a){"use strict";a("db62")},f365:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mycontainer"},[a("div",{staticClass:"ticker-dialog"},[a("div",{staticClass:"home_dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e.showdeviceFlag,width:"100vh"},on:{"update:visible":function(t){e.showdeviceFlag=t}}},[a("change-Step",{ref:"ChangeStep",attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status&&e.isfooter,expression:"detail.status == 0 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dispatch()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Dispatch"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status,expression:"detail.status == 1"}],on:{click:function(t){return e.backChange(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.back"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.Reassign(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reassign"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.check()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.check"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status&&e.isfooter,expression:"detail.status == 1 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dealwith()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("Maintenance.create Ticket"),visible:e.dialogFormVisible,width:"90vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project"),prop:"product"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("Maintenance.Please choose the product")},on:{change:e.prodChange},model:{value:e.form.product,callback:function(t){e.$set(e.form,"product",t)},expression:"form.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name"),prop:"name"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.Device.length,placeholder:0==e.Device.length?e.$translateTitle("Maintenance.Please choose the product"):e.$translateTitle("Maintenance.Please select a device")},on:{change:e.deviceChange},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},e._l(e.Device,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:e.objectId,expression:"item.objectId"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type"),prop:"type"}},[a("el-input",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")}},[a("el-upload",{attrs:{action:"#","auto-upload":!0,"http-request":e.myUpload,"list-type":"picture-card"}},[a("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"}),e._l(e.form.photo,(function(e,t){return a("div",{key:t},[a("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{alt:"",src:e.url}})])}))],2),a("el-dialog",{attrs:{"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{alt:"",src:e.dialogImageUrl,width:"100%"}})])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Create now"))+" ")]),a("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reset"))+" ")])],1)],1)],1)]),a("vab-query-form",{staticClass:"query-form"},[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.number")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.projects")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.project")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.type")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.fetchData}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")]),a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-s-promotion",size:"mini",type:"primary"},on:{click:function(t){return e.batchExport(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:"",data:e.list,height:e.height,stripe:""},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[a("vab-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortable:"",width:"120"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.getStatus(a.status,a))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.project"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.productname?a.info.productname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.devicename?a.info.devicename:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.createdname?a.info.createdname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$moment(a.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("Maintenance.operating"),width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showInfo(n,!0,!1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),a("el-button",{attrs:{size:"mini",type:"success"},nativeOn:{click:function(t){return e.showInfo(n)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Dispatch"))+" ")])]}}])})],1),a("vab-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},r=[],i=a("1da1"),s=a("5530"),o=(a("96cf"),a("d81d"),a("b0c0"),a("a4d3"),a("e01a"),a("d3b7"),a("159b"),a("ddb0"),a("0941")),l=a("dcc6"),c=a("1285"),u=a("5880"),d=a("1267"),m=a("2ec0"),p={name:"DispatchTicket",components:{ChangeStep:m["default"]},data:function(){return{created:0,Assigned:0,showdeviceFlag:!1,form:{receiveuseid:"",productname:"",devicename:"",createdname:"",receiveusername:"",receiveuserphone:"",name:"",product:"",type:"",description:"",photo:[],objectId:""},dialogFormVisible:!1,fold:!1,step:1,ishard:!1,height:this.$baseTableHeight(0)-30,isfooter:!0,detail:{},AllDevice:[],selectedList:[],types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择所属项目",trigger:"change"}],name:[{required:!0,message:"请选择设备",trigger:"change"}],type:[{required:!0,message:"请输入工单类型",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,status:[{key:0,text:"Maintenance.To be assigned"},{key:1,text:"Maintenance.Assigned"},{key:2,text:"Maintenance.Processed"},{key:3,text:"Maintenance.Statement"}],queryForm:{devicename:"",statusFlag:!1,status:"",number:"",product:"",type:"",pageNo:1,pageSize:20,searchDate:[],limt:10,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:Object(s["a"])(Object(s["a"])({},Object(u["mapGetters"])({_Product:"user/_Product",objectid:"user/objectId",role:"acl/role",username:"user/username"})),{},{_deviceStep:{get:function(){return this.$store.state.global._deviceStep},set:function(e){this.set_deviceStepg(e)}},aclObj:function(){var e={};return this.role.map((function(t){e["".concat("role:"+t.name)]={read:!0,write:!0}})),e}}),watch:{_deviceStep:function(e){-1==e&&(this.showdeviceFlag=!1,this.fetchData())},"queryForm.status":function(e){this.queryForm.statusFlag=""!=e}},created:function(){},mounted:function(){this.fetchData(),this.handleCreated("created")},methods:Object(s["a"])(Object(s["a"])({myUpload:function(e){var t=this,a={headers:{proxy:!0,produrl:"/",devurl:"iotapi/"}};Object(d["UploadImg"])(e.file,a).then((function(e){e.data.url&&t.form.photo.push(e.data.url)})).catch((function(e){}))},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.createdTicket(t.form)}))},createdTicket:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n={},n["".concat(t.objectid)]={read:!0,write:!0},r={number:moment(new Date).unix()+"",type:e.type,ACL:_.merge(n,t.aclObj),info:{photo:e.photo,timeline:[{timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"生成工单",p:"".concat(t.username,"新建工单")}],description:e.description,step1:{},step2:{},step3:{},step4:{},productid:e.product,productname:e.productname,devicename:e.devicename,deviceid:e.name,createdname:t.username,receiveusername:e.receiveusername,receiveuseid:e.receiveuseid,receiveuserphone:e.receiveuserphone},device:{objectId:e.name,__type:"Pointer",className:"Device"}},i=t.$baseColorfullLoading(),a.next=6,Object(o["create_object"])("Maintenance",r);case 6:a.sent,i.close(),t.fetchData(),t.dialogFormVisible=!1;case 10:case"end":return a.stop()}}),a)})))()},resetForm:function(e){this.$refs[e].resetFields()},changeBox:function(e){var t=this;this.selectedList=[],e.forEach((function(e){t.selectedList.push(e)}))}},Object(u["mapMutations"])({set_deviceStep:"global/set_deviceStep"})),{},{handleFold:function(){this.fold=!this.fold,this.handleHeight()},batchExport:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,n={results:[]},n["results"]=e,a.next=5,Object(d["exlout"])(n);case 5:r=a.sent,t.$convertRes2Blob(r),t.$message.success(t.$translateTitle("node.export success")),a.next=13;break;case 10:a.prev=10,a.t0=a["catch"](0),t.$message.error(t.$translateTitle("node.export error")+"".concat(a.t0));case 13:case"end":return a.stop()}}),a,null,[[0,10]])})))()},handleDelete:function(e,t){var a=this,n=[];2==t?n.push({method:"DELETE",path:"/classes/Maintenance/".concat(e.objectId),body:{}}):e.forEach((function(e){n.push({method:"DELETE",path:"/classes/Maintenance/".concat(e.objectId),body:{}})})),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["batch"])(n);case 2:e.sent,a.$baseMessage(a.$translateTitle("Maintenance.successfully deleted"),"success","vab-hey-message-success"),setTimeout((function(){a.fetchData()}),1500);case 5:case"end":return e.stop()}}),e)}))))},handleHeight:function(){this.fold?this.height=this.$baseTableHeight(0)-20:this.height=this.$baseTableHeight(0)-30},getStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch(e){case 0:return this.$translateTitle("Maintenance.To be assigned");case 1:return this.$translateTitle("Maintenance.Assigned");case 2:return this.$translateTitle("Maintenance.Processed");case 3:return this.$translateTitle("Maintenance.Statement");default:return e}},showInfo:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.showdeviceFlag=!1,this.ishard=t,this.isfooter=a;var n=e.status;this.detail=e,this.set_deviceStep(n),this.step=n+1,this.showdeviceFlag=!0},handleCreated:function(e){"created"==e?this.created++:this.Assigned++,this.fetchData()},fetchData:function(){var e=arguments,t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.length>0&&void 0!==e[0]?e[0]:{},r.limit||(r=t.queryForm),t.listLoading=!1,i=t.$baseColorfullLoading(),s={limit:r.limit,order:r.order,skip:r.skip,keys:r.keys,where:{status:0,"info.receiveuseid":t.Assigned%2==0?{$ne:"99"}:t.objectid,number:t.queryForm.number.length?{$regex:t.queryForm.number}:{$ne:null},"info.productid":t.queryForm.product.length?t.queryForm.product:{$ne:"99"},type:t.queryForm.type.length?{$regex:t.queryForm.type}:{$ne:null}}},null!==(n=t.queryForm.searchDate)&&void 0!==n&&n.length&&(s.where["createdAt"]={$gt:{__type:"Date",iso:t.queryForm.searchDate[0]}},s.where["updatedAt"]={$lt:{__type:"Date",iso:t.queryForm.searchDate[1]}}),a.next=8,Object(o["query_object"])("Maintenance",s).then((function(e){var a=e.results,n=void 0===a?[]:a,r=e.count,s=void 0===r?0:r;t.list=n,t.list.forEach((function(e){if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(0)})),t.total=s,i.close()})).catch((function(e){t.$message.error("".concat(e)),i.close()}));case 8:case"end":return a.stop()}}),a)})))()},prodChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.Device=[],t._Product.map((function(a){a.objectId==e&&(t.form.productname=a.name)})),t.form.name="",n={where:{product:e}},a.next=6,Object(c["queryDevice"])(n);case 6:r=a.sent,i=r.results,t.Device=i;case 9:case"end":return a.stop()}}),a)})))()},deviceChange:function(e){var t=this;this.Device.map((function(a){a.objectId==e&&(t.form.devicename=a.name)}))},dispatch:function(){this.$refs.ChangeStep.$refs.step1.dispatchUser()},backChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.objectId,r=e.info,r.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已回退",p:"".concat(t.username," 回退了流程")}),i={status:0,info:r},a.next=5,Object(o["update_object"])("Maintenance",n,i);case 5:s=a.sent,s.updatedAt&&t.set_deviceStep(-1);case 7:case"end":return a.stop()}}),a)})))()},Reassign:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.objectId,r=e.info,r.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已改派",p:"".concat(t.username," 改派了工单")}),i={status:0,info:r},a.next=5,Object(o["update_object"])("Maintenance",n,i);case 5:s=a.sent,s.updatedAt&&t.set_deviceStep(-1);case 7:case"end":return a.stop()}}),a)})))()},dealwith:function(){this.$refs.ChangeStep.$refs.step2.dispatchUser()},check:function(){this.$refs.ChangeStep.$refs.step3.dispatchUser()}})},f=p,h=(a("4df8"),a("2877")),v=Object(h["a"])(f,n,r,!1,null,"22bfaa40",null);t["default"]=v.exports},f715:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("Maintenance.Work order information"),name:"first"}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,size:"medium "}},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project")+": "}},[a("span",[e._v(e._s(e.form.info.productname))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name")+": "}},[a("span",[e._v(e._s(e.form.info.devicename))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Initiator")+": "}},[a("span",[e._v(e._s(e.form.info.createdname))])])],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")+": "}},[e._v(" "+e._s(e.form.info.description)+" ")])],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")+": "}},[a("el-carousel",{attrs:{height:"200px",interval:2e3,type:"card"}},e._l(e.form.info.photo,(function(e,t){return a("el-carousel-item",{key:t},[a("img",{staticStyle:{width:"100%",height:"100%"},attrs:{alt:e,src:e,title:e}})])})),1)],1)],1),e.showFooter?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Processing records")+": "}},[a("el-input",{attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),type:"textarea"},model:{value:e.form.info.step2.Remarks,callback:function(t){e.$set(e.form.info.step2,"Remarks",t)},expression:"form.info.step2.Remarks"}})],1)],1):e._e()],1)],1)],1),a("el-tab-pane",{staticStyle:{height:"90%","overflow-x":"hidden","overflow-y":"auto"},attrs:{label:e.$translateTitle("Maintenance.work process"),name:"second"}},[a("el-card",{attrs:{shadow:"hover"},scopedSlots:e._u([{key:"header",fn:function(){return[a("el-radio-group",{staticClass:"card-header-radio",model:{value:e.reverse,callback:function(t){e.reverse=t},expression:"reverse"}},[a("el-radio",{attrs:{label:!0}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Positive order"))+" ")]),a("el-radio",{attrs:{label:!1}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reverse order"))+" ")])],1)]},proxy:!0}])},[a("el-timeline",{attrs:{reverse:e.reverse}},e._l(e.form.info.timeline,(function(t){return a("el-timeline-item",{key:t.timestamp,attrs:{placement:"top",timestamp:t.timestamp}},[a("el-card",[a("h4",[e._v(e._s(t.h4))]),a("p",[e._v(e._s(t.p))])])],1)})),1)],1)],1)],1)],1)},r=[],i=a("1da1"),s=a("5530"),o=(a("96cf"),a("a9e3"),a("0941")),l=a("8665"),c=a("5880"),u={props:{detail:{type:Object,default:function(){}},step:{type:Number,default:2},showFooter:{type:Boolean,default:!1}},data:function(){return{reverse:!0,activeName:"first",form:this.detail}},computed:Object(s["a"])({},Object(c["mapGetters"])({username:"user/username"})),mounted:function(){this.featUser()},methods:Object(s["a"])(Object(s["a"])({},Object(c["mapMutations"])({set_deviceFlag:"global/set_deviceFlag",set_deviceStep:"global/set_deviceStep"})),{},{featUser:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(l["queryUser"])({});case 2:a=t.sent,n=a.results,e.user=n;case 5:case"end":return t.stop()}}),t)})))()},dispatchUser:function(){var e=this;this.$refs["form"].validate(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(a){var n,r,i,s,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!a||!e.form.info.receiveusername){t.next=10;break}return n=e.form,r=n.objectId,i=n.info,i.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已处理",p:"".concat(e.username,"处理了这条工单")}),s={status:2,info:i},t.next=6,Object(o["update_object"])("Maintenance",r,s);case 6:l=t.sent,l.updatedAt&&(e.set_deviceFlag(!1),e.set_deviceStep(-1)),t.next=12;break;case 10:return e.$message.error("请选择分配人员"),t.abrupt("return",!1);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}})},d=u,m=(a("ef07"),a("2877")),p=Object(m["a"])(d,n,r,!1,null,"df24b6fa",null);t["default"]=p.exports},fcaf:function(e,t,a){}}]);