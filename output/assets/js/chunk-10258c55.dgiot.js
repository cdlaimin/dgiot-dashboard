/*!
 *  build: 杭州数蛙科技有限公司 
 *  copyright: dgiot-dashboard 
 *  author: h7ml(h7ml@qq.com) 
 *  time: Wed Nov 17 2021 04:11:42 GMT+0000 (Coordinated Universal Time)
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-10258c55"],{"028d":function(e,t,a){"use strict";a.r(t);var r,n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"equipment"},[a("div",{staticClass:"dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,top:"5vh",visible:e.popoverVisible,width:"40vh"},on:{"update:visible":function(t){e.popoverVisible=t}}},[a("div",{staticClass:"leftTree"},[a("p",{staticStyle:{"text-align":"center"}},[e._v(" "+e._s(e.$translateTitle("developer.Company"))+" : "+e._s(e.deciceCompany)+" ")]),a("el-tree",{attrs:{data:e.deptTreeData,"default-expand-all":"","expand-on-click-node":!1,"node-key":"index",props:e.roleProps},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,n=t.data;return a("div",{staticClass:"custom-tree-node"},[a("span",{class:{selected:n.objectId==e.curDepartmentId},on:{click:function(t){return e.transferAcl(n)}}},[e._v(" "+e._s(r.label)+" ")])])}}])})],1)]),a("el-dialog",{attrs:{"append-to-body":!0,top:"5vh",visible:e.mapDialog,width:"80vh"},on:{"update:visible":function(t){e.mapDialog=t}}},[a("baidu-map",{staticStyle:{height:"80vh"},attrs:{ak:"fnc5Z92jC7CwfBGz8Dk66E9sXEIYZ6TG",center:e.center,"map-click":!1,"scroll-wheel-zoom":!0,zoom:e.zoom},on:{click:e.mapClick,ready:e.handler}},[a("bm-marker",{attrs:{animation:"BMAP_ANIMATION_BOUNCE",dragging:!0,position:e.center}},[a("bm-label",{attrs:{content:e.deviceId,"label-style":{color:"red",fontSize:"12px"},offset:{width:-25,height:30}}})],1),a("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}})],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,title:e.devicedetail.name,top:"5vh",visible:e.InfoDialog,width:"80%"},on:{"update:visible":function(t){e.InfoDialog=t}}},[a("info",{attrs:{devicedetail:e.devicedetail}}),a("el-tabs",{attrs:{type:"card"},model:{value:e.activeparseTbas,callback:function(t){e.activeparseTbas=t},expression:"activeparseTbas"}},e._l(e.parseTbas,(function(t){return a("el-tab-pane",{key:t.name,attrs:{label:t.name,name:t.name}},[a("ele-form",e._b({model:{value:t.config,callback:function(a){e.$set(t,"config",a)},expression:"item.config"}},"ele-form",t.config,!1))],1)})),1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.InfoDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){e.InfoDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.CloseState,title:e.stateDialog.name,top:"5vh",visible:e.stateDialog,width:"80%"},on:{"update:visible":function(t){e.stateDialog=t}}},[a("deviceState",{attrs:{devicedetail:e.stateDetail},on:{ParserSave:e.ParserSave}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.stateDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){e.stateDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)],1)],1),a("div",{staticClass:"equtabs"},[a("div",{staticClass:"equ_header"},[a("el-row",[a("el-col",{attrs:{md:8,sm:24,xl:8,xs:24}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v(" "+e._s(e.$translateTitle("equipment.Equipment Overview"))+" ")]),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{icon:"el-icon-refresh",type:"text"}})],1),a("div",{staticClass:"text item"},[a("ve-ring",{attrs:{data:e.chartOnlone,"data-empty":!e.chartOnlone.rows,extend:e.chartExtend,height:"140px",settings:e.chartSettings}})],1)])],1),a("el-col",{attrs:{md:8,sm:24,xl:8,xs:24}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v(" "+e._s(e.$translateTitle("equipment.Warning today"))+" ")]),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{icon:"el-icon-refresh",type:"text"}})],1),a("div",{staticClass:"text item"},[a("ve-ring",{attrs:{data:e.chartwaring,"data-empty":!e.chartwaring.rows,height:"140px"}})],1)])],1),a("el-col",{attrs:{md:8,sm:24,xl:8,xs:24}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v(e._s(e.$translateTitle("equipment.Products")))]),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{icon:"el-icon-refresh",type:"text"}})],1),a("div",{staticClass:"text item"},[a("ve-ring",{attrs:{data:e.chartProduct,"data-empty":!e.chartProduct.rows,height:"140px"}})],1)])],1)],1)],1),a("div",{staticClass:"equdevices",staticStyle:{"margin-top":"20px"}},[a("vab-query-form",[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"100px",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.Department")}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},on:{"visible-change":function(t){return e.change(t)}},model:{value:e.queryForm.workGroupName,callback:function(t){e.$set(e.queryForm,"workGroupName",t)},expression:"queryForm.workGroupName"}},[a("el-option",{staticStyle:{height:"auto",padding:"0"},attrs:{value:e.treeDataValue}},[a("el-tree",{ref:"workGroup",attrs:{data:e.deptTreeData,"default-expand-all":"","expand-on-click-node":!1,"node-key":"index",props:e.roleProps},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,n=t.data;return a("div",{staticClass:"custom-tree-node"},[a("span",{class:{selected:n.objectId==e.curDepartmentId},on:{click:function(t){return e.handleNodeClick(n,r)}}},[e._v(" "+e._s(r.label)+" ")])])}}])})],1)],1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.Products")}},[a("el-select",{attrs:{disabled:!e.productenable},on:{change:e.selectProdChange},model:{value:e.equvalue,callback:function(t){e.equvalue=t},expression:"equvalue"}},e._l(e.proTableData,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.device status")}},[a("el-select",{staticStyle:{width:"100px"},model:{value:e.onlinedevices,callback:function(t){e.onlinedevices=t},expression:"onlinedevices"}},[a("el-option",{attrs:{value:e.$translateTitle("zetadevices.online")}}),a("el-option",{attrs:{value:e.$translateTitle("zetadevices.offline")}})],1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.condition")}},[e.selectdevice==e.$translateTitle("equipment.devicename")?a("el-input",{attrs:{placeholder:e.$translateTitle("equipment.enterproductname")},model:{value:e.deviceinput,callback:function(t){e.deviceinput=t},expression:"deviceinput"}},[a("el-select",{staticStyle:{width:"140px"},attrs:{slot:"prepend"},slot:"prepend",model:{value:e.selectdevice,callback:function(t){e.selectdevice=t},expression:"selectdevice"}},[a("el-option",{attrs:{value:e.$translateTitle("equipment.devicename")}}),a("el-option",{attrs:{value:e.$translateTitle("equipment.devicenumber")}})],1),a("el-button",{attrs:{slot:"append",icon:"el-icon-search",size:"mini"},on:{click:function(t){return e.getDevices(0)}},slot:"append"})],1):a("el-input",{attrs:{placeholder:e.$translateTitle("equipment.enterdevicenumber")},model:{value:e.deviceinput,callback:function(t){e.deviceinput=t},expression:"deviceinput"}},[a("el-select",{staticStyle:{width:"120px"},attrs:{slot:"prepend"},slot:"prepend",model:{value:e.selectdevice,callback:function(t){e.selectdevice=t},expression:"selectdevice"}},[a("el-option",{attrs:{value:e.$translateTitle("equipment.devicename")}}),a("el-option",{attrs:{value:e.$translateTitle("equipment.devicenumber")}})],1),a("el-button",{attrs:{slot:"append",icon:"el-icon-search",size:"mini"},on:{click:function(t){return e.getDevices(0)}},slot:"append"})],1)],1),a("el-form-item",[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.addDeviceForm}},[e._v(" "+e._s(e.$translateTitle("equipment.adddevice"))+" ")])],1),a("el-form-item",{staticStyle:{display:"none"}},[a("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:e.deleteDevcie}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")]),a("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:function(t){return e.unactiveDevice(!1)}}},[e._v(" "+e._s(e.$translateTitle("developer.prohibit"))+" ")]),a("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:function(t){return e.unactiveDevice(!0)}}},[e._v(" "+e._s(e.$translateTitle("developer.enable"))+" ")]),a("el-button",{attrs:{size:"small"}},[e._v(" "+e._s(e.$translateTitle("equipment.batchaddition"))+" ")])],1)],1)],1)],1)],1),a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.list"),name:"first"}},[a("div",{staticClass:"tabstable"},[a("el-table",{directives:[{name:"show",rawName:"v-show",value:e.isALL,expression:"isALL"},{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"filterTable",staticStyle:{width:"100%","margin-top":"20px","text-align":"center"},attrs:{data:e.tableData,"row-style":e.rowClass},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{align:"center",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.devicenumber"),width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.devaddr)+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.name")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{margin:"0",color:"green"}},[e._v(" "+e._s(t.row.name)+" ")])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.state"),width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return["ONLINE"==t.row.status?a("span",{class:t.row.status},[e._v(" "+e._s(e.$translateTitle("product.online"))+" ")]):e._e(),"ONLINE"==t.row.status?a("el-tooltip",{attrs:{content:e.$translateTitle("equipment.thedeviceisonline"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"==t.row.status?a("span",{class:t.row.status},[e._v(" "+e._s(e.$translateTitle("product.offline"))+" ")]):e._e(),"OFFLINE"==t.row.status?a("el-tooltip",{attrs:{content:e.$translateTitle("equipment.thedeviceisoffline"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"!=t.row.status&&"ONLINE"!=t.row.status?a("span",{class:t.row.status},[e._v(" "+e._s(e.$translateTitle("product.unregistered"))+" ")]):e._e()]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.product"),width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.product&&t.row.product.name?a("span",[e._v(" "+e._s(t.row.product.name||"")+" ")]):e._e()]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.Company"),width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(" "+e._s(t.row.Company)+" ")])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.enable")+"/"+e.$translateTitle("developer.prohibit"),width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-color":"#5eb058","inactive-color":"#cccccc"},on:{change:function(a){return e.handelUpdate(a,t.row,t.$index)}},model:{value:t.row.isEnable,callback:function(a){e.$set(t.row,"isEnable",a)},expression:"scope.row.isEnable"}})]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.createdAt"),width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.utc2beijing(t.row.createdAt)))])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.operation"),width:"500"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("vab-icon",{staticStyle:{color:"#1890ff"},attrs:{icon:"map-pin-range-line"}}),a("el-link",{attrs:{type:"primary",underline:!1},on:{click:function(a){return e.showInfo(t.row)}}},[e._v(" "+e._s(e.$translateTitle("equipment.info"))+" ")]),a("el-link",{staticStyle:{margin:"0 10px"},attrs:{icon:"el-icon-view",type:"primary",underline:!1},on:{click:function(a){return e.deviceToDetail(t.row)}}},[e._v(" "+e._s(e.$translateTitle("equipment.see"))+" ")]),a("vab-icon",{staticStyle:{color:"#1890ff"},attrs:{icon:"file-transfer-line"}}),a("el-link",{staticStyle:{margin:"0 10px"},attrs:{type:"primary",underline:!1},on:{click:function(a){return e.showTree(t.row.objectId,t.row.Company)}}},[e._v(" "+e._s(e.$translateTitle("equipment.move"))+" ")]),a("el-link",{staticStyle:{margin:"0 10px 0 0"},attrs:{icon:"el-icon-edit",type:"primary",underline:!1},on:{click:function(a){return e.editorDevice(t.row)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.edit"))+" ")]),a("el-link",{staticStyle:{margin:"0 10px 0 0"},attrs:{icon:"el-icon-s-flag                    ",type:"primary",underline:!1},on:{click:function(a){return e.konvaDevice(t.row)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.konva"))+" ")]),a("el-popover",{ref:"popover-"+t.$index,attrs:{placement:"top",width:"300"}},[a("p",[e._v(" "+e._s(e.$translateTitle("product.qdsczg"))+e._s(t.row.name)+e._s(e.$translateTitle("equipment.sbm"))+" ")]),a("div",{staticStyle:{margin:"0","text-align":"right"}},[a("el-button",{attrs:{size:"mini"},on:{click:function(e){t._self.$refs["popover-"+t.$index].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.makeSure(t)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),a("el-link",{attrs:{slot:"reference",icon:"el-icon-delete",type:"danger",underline:!1},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)]}}])})],1),a("el-table",{directives:[{name:"show",rawName:"v-show",value:!e.isALL,expression:"!isALL"},{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"filterTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-style":e.rowClass},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{align:"center",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.devicenumber"),width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.devaddr)+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.name")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{margin:"0",color:"green"}},[e._v(" "+e._s(t.row.name)+" ")])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.state"),width:"70"},scopedSlots:e._u([{key:"default",fn:function(t){return["ONLINE"==t.row.status?a("span",{class:t.row.status},[e._v(" "+e._s(e.$translateTitle("product.online"))+" ")]):e._e(),"ONLINE"==t.row.status?a("el-tooltip",{attrs:{content:e.$translateTitle("equipment.thedeviceisonline"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"==t.row.status?a("span",{class:t.row.status},[e._v(" "+e._s(e.$translateTitle("product.offline"))+" ")]):e._e(),"OFFLINE"==t.row.status?a("el-tooltip",{attrs:{content:e.$translateTitle("equipment.thedeviceisoffline"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"!=t.row.status&&"ONLINE"!=t.row.status?a("span",{class:t.row.status},[e._v(" "+e._s(e.$translateTitle("product.unregistered"))+" ")]):e._e()]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.product")},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.product&&t.row.product.name?a("span",[e._v(" "+e._s(t.row.product.name)+" ")]):e._e()]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.Company")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(" "+e._s(t.row.Company)+" ")])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.enable")+"/"+e.$translateTitle("developer.prohibit"),width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-color":"#5eb058","inactive-color":"#cccccc"},on:{change:function(a){return e.handelUpdate(a,t.row,t.$index)}},model:{value:t.row.isEnable,callback:function(a){e.$set(t.row,"isEnable",a)},expression:"scope.row.isEnable"}})]}}])}),e._l(e.dialogtempconfig,(function(t,r){return["bool"==t.type&&t.isshow?a("el-table-column",{key:r,attrs:{align:"center",label:t.name,prop:t.identifier},scopedSlots:e._u([{key:"default",fn:function(r){return[r.row[t.default]?a("span",[e._v(" "+e._s(e.$translateTitle("product.yes"))+" ")]):a("span",[e._v(" "+e._s(e.$translateTitle("product.no"))+" ")])]}}],null,!0)}):"enum"==t.type&&t.isshow?a("el-table-column",{key:r,attrs:{align:"center",label:t.name},scopedSlots:e._u([{key:"default",fn:function(r){return[a("span",[e._v(" "+e._s(t.struct[r.row[t.identifier]])+" ")])]}}],null,!0)}):t.isshow?a("el-table-column",{key:r,attrs:{align:"center",label:t.name,prop:t.identifier},scopedSlots:e._u([{key:"default",fn:function(r){return[a("span",[e._v(" "+e._s(r.row[t.identifier])+" "+e._s(t.unit)+" ")])]}}],null,!0)}):e._e()]})),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.createdAt"),width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.utc2beijing(t.row.createdAt)))])]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("developer.operation"),width:"400"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("vab-icon",{staticStyle:{color:"#1890ff"},attrs:{icon:"map-pin-range-line"}}),a("el-link",{attrs:{disabled:!t.row.location,type:"primary",underline:!1},on:{click:function(a){return e.showMap(t.row.location,t.row.objectId)}}},[e._v(" "+e._s(e.$translateTitle("equipment.location"))+" ")]),a("el-link",{staticStyle:{margin:"0 10px"},attrs:{icon:"el-icon-view",type:"primary",underline:!1},on:{click:function(a){return e.deviceToDetail(t.row)}}},[e._v(" "+e._s(e.$translateTitle("equipment.see"))+" ")]),a("vab-icon",{staticStyle:{color:"#1890ff"},attrs:{icon:"file-transfer-line"}}),a("el-link",{attrs:{type:"primary",underline:!1},on:{click:function(a){return e.showTree(t.row.objectId,t.row.Company)}}},[e._v(" "+e._s(e.$translateTitle("equipment.move"))+" ")]),a("el-link",{staticStyle:{margin:"0 10px 0 0"},attrs:{icon:"el-icon-edit",type:"primary",underline:!1},on:{click:function(a){return e.editorDevice(t.row)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.edit"))+" ")]),a("el-popover",{ref:"popover-"+t.$index,attrs:{placement:"top",width:"300"}},[a("p",[e._v(" "+e._s(e.$translateTitle("product.qdsczg"))+e._s(t.row.name)+e._s(e.$translateTitle("equipment.sbm"))+" ")]),a("div",{staticStyle:{margin:"0","text-align":"right"}},[a("el-button",{attrs:{size:"mini"},on:{click:function(e){t._self.$refs["popover-"+t.$index].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.makeSure(t)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),a("el-link",{attrs:{slot:"reference",icon:"el-icon-delete",type:"danger",underline:!1},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)]}}])})],2),a("div",{staticClass:"elpagination",staticStyle:{"margin-top":"30px"}},[a("el-pagination",{attrs:{layout:"total, sizes, prev, pager, next, jumper","page-size":e.devicelength,"page-sizes":[10,20,30,50],total:e.devicetotal},on:{"current-change":e.deviceCurrentChange,"size-change":e.deviceSizeChange}})],1)],1)]),a("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.map"),name:"second"}},[a("baidu-map",{staticClass:"map",staticStyle:{height:"57vh"},attrs:{ak:"fnc5Z92jC7CwfBGz8Dk66E9sXEIYZ6TG",center:{lng:116.404,lat:39.915},"scroll-wheel-zoom":!0,zoom:e.sizeZoom}},[a("bm-control",[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.sizeZoom=19}}},[e._v(" 缩放至最大 ")]),a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.sizeZoom=10}}},[e._v(" 还原 ")]),a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.sizeZoom=3}}},[e._v(" 缩放至最小 ")]),a("bm-panorama",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT",offset:{width:460,height:0}}}),a("bm-overview-map",{attrs:{"is-open":!0}}),a("bm-scale",{attrs:{offset:{width:200,height:0}}}),a("bm-city-list",{attrs:{offset:{width:280,height:0}}}),a("bm-map-type",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT","map-types":["BMAP_HYBRID_MAP","BMAP_NORMAL_MAP"],offset:{width:360,height:0}}})],1),e._l(e.tableData,(function(t){return a("bm-marker",{key:t.objectId,attrs:{animation:"BMAP_ANIMATION_BOUNCE",content:t.name,dragging:!0,position:{lng:t.location.longitude,lat:t.location.latitude}}},[a("bm-label",{attrs:{content:t.name,"label-style":{color:"red",fontSize:"24px"},offset:{width:-35,height:30}},on:{click:function(a){return e.deviceToDetail(t)}}})],1)})),a("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),a("bm-geolocation",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_RIGHT","auto-location":!0,"show-address-bar":!0}})],2)],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleClose,"close-on-click-modal":!1,title:e.$translateTitle("product.edit")+e.equipmentEditor,visible:e.devicedialogVisible,width:"50%"},on:{"update:visible":function(t){e.devicedialogVisible=t}}},[a("div",{staticClass:"header-title",attrs:{slot:"title"},slot:"title"},[a("span",{staticClass:"title-name"},[e._v(" "+e._s("设备"+e.equipmentEditor)+" "),a("el-tooltip",{staticStyle:{"margin-left":"5px"},attrs:{content:e.$translateTitle("equipment.text"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})])],1)]),a("div",{staticClass:"devicecontent"},[a("el-form",{ref:"deviceform",attrs:{"label-width":"150px",model:e.deviceform,rules:e.rules}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicename"),prop:"name"}},[a("el-input",{model:{value:e.deviceform.name,callback:function(t){e.$set(e.deviceform,"name",t)},expression:"deviceform.name"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicenumber"),prop:"devaddr"}},[a("el-input",{attrs:{disabled:"编辑"==e.equipmentEditor},model:{value:e.deviceform.devaddr,callback:function(t){e.$set(e.deviceform,"devaddr",t)},expression:"deviceform.devaddr"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"productName"}},[a("el-select",{attrs:{disabled:"编辑"==e.equipmentEditor,placeholder:e.$translateTitle("equipment.entername")},on:{change:e.selectChange},model:{value:e.deviceform.productName,callback:function(t){e.$set(e.deviceform,"productName",t)},expression:"deviceform.productName"}},e._l(e.proTableData1,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.assetnumber")}},[a("el-input",{model:{value:e.deviceform.assetNum,callback:function(t){e.$set(e.deviceform,"assetNum",t)},expression:"deviceform.assetNum"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.equipmenttype")}},[a("el-input",{model:{value:e.deviceform.devModel,callback:function(t){e.$set(e.deviceform,"devModel",t)},expression:"deviceform.devModel"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.equipmentbrand")}},[a("el-input",{model:{value:e.deviceform.brand,callback:function(t){e.$set(e.deviceform,"brand",t)},expression:"deviceform.brand"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.installationlocation")}},[a("el-input",{on:{focus:e.updateLocation},model:{value:e.deviceform.address,callback:function(t){e.$set(e.deviceform,"address",t)},expression:"deviceform.address"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.videoSrc")}},[a("el-input",{model:{value:e.deviceform.videoSrc,callback:function(t){e.$set(e.deviceform,"videoSrc",t)},expression:"deviceform.videoSrc"}})],1)],1),e._l(e.arrlist,(function(t,r){return a("el-col",{key:r,attrs:{span:12}},[a("el-form-item",{attrs:{label:t.name,prop:t.identifier,required:t.required}},["bool"==t.type?a("el-select",{staticClass:"notauto",staticStyle:{width:"100%"},attrs:{disabled:t.readonly},model:{value:e.deviceform[t.identifier],callback:function(a){e.$set(e.deviceform,t.identifier,a)},expression:"deviceform[item.identifier]"}},[a("el-option",{attrs:{label:e.$translateTitle("product.yes"),value:!0}}),a("el-option",{attrs:{label:e.$translateTitle("product.no"),value:!1}})],1):"enum"==t.type?a("el-select",{staticClass:"notauto",staticStyle:{width:"100%"},attrs:{disabled:t.readonly},model:{value:e.deviceform[t.identifier],callback:function(a){e.$set(e.deviceform,t.identifier,a)},expression:"deviceform[item.identifier]"}},e._l(t.specs,(function(e,t){return a("el-option",{key:t,attrs:{label:e.attributevalue,value:e.attribute}})})),1):t.readonly?a("el-input",{attrs:{disabled:t.readonly,value:e.deviceform[t.identifier]+t.unit}}):a("el-input",{attrs:{disabled:t.readonly},model:{value:e.deviceform[t.identifier],callback:function(a){e.$set(e.deviceform,t.identifier,a)},expression:"deviceform[item.identifier]"}})],1)],1)})),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("developer.describe")}},[a("el-input",{attrs:{autosize:{minRows:4,maxRows:4},type:"textarea"},model:{value:e.deviceform.desc,callback:function(t){e.$set(e.deviceform,"desc",t)},expression:"deviceform.desc"}})],1)],1)],2)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("deviceform")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),a("el-button",{on:{click:e.handleClose}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)]),a("el-dialog",{directives:[{name:"drag-dialog",rawName:"v-drag-dialog"}],attrs:{"append-to-body":!0,"before-close":e.handleClosebmap,"close-on-click-modal":!1,title:e.$translateTitle("developer.equipmentinstallationaddress"),visible:e.bmapdialogVisible,width:"50%"},on:{"update:visible":function(t){e.bmapdialogVisible=t}}},[a("div",[a("el-form",{attrs:{inline:!0,model:e.bmapform,size:"small"}},[a("el-form-item",{attrs:{label:e.$translateTitle("developer.addressname")}},[a("el-input",{model:{value:e.bmapform.keyword,callback:function(t){e.$set(e.bmapform,"keyword",t)},expression:"bmapform.keyword"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.selectaddress")}},[a("el-input",{attrs:{readonly:""},model:{value:e.bmapform.address,callback:function(t){e.$set(e.bmapform,"address",t)},expression:"bmapform.address"}})],1)],1),a("baidu-map",{staticStyle:{height:"300px"},attrs:{ak:"fnc5Z92jC7CwfBGz8Dk66E9sXEIYZ6TG",center:e.center,"map-click":!1,"scroll-wheel-zoom":!0,zoom:e.zoom},on:{click:e.mapClick,ready:e.handler}},[a("bm-local-search",{staticStyle:{display:"none"},attrs:{"auto-viewport":!0,keyword:e.bmapform.keyword,location:e.bmapform.location,zoom:"12.8"}}),a("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),a("bm-geolocation",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_RIGHT","auto-location":!0,"show-address-bar":!0}}),a("bm-city-list",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addressSure.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("product.preservation"))+" ")]),a("el-button",{on:{click:function(t){e.bmapdialogVisible=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)])],1)])},i=[],o=a("15fd"),s=a("1da1"),l=a("5530"),c=(a("96cf"),a("ac1f"),a("00b4"),a("d3b7"),a("159b"),a("4de4"),a("b0c0"),a("99af"),a("a9e3"),a("e9c4"),a("d81d"),a("841c"),a("b680"),a("5319"),a("b64b"),a("caad"),a("2532"),a("5880")),d=a("0941"),u=(a("a8be"),a("dcc6")),p=a("4be7"),m=a("7212"),v=a("a060"),f=a("c4e6"),b=a("2db0"),g=a("cb88"),h=a("926a"),w=a("1285"),y=a("bc35"),_=["createdAt"],T=["updatedAt"],k={components:{BmScale:g["BmScale"],BmMapType:g["BmMapType"],BmOverviewMap:g["BmOverviewMap"],BmPanorama:g["BmPanorama"],BmControl:g["BmControl"],BmLabel:g["BmLabel"],BaiduMap:g["BaiduMap"],BmLocalSearch:g["BmLocalSearch"],BmNavigation:g["BmNavigation"],BmGeolocation:g["BmGeolocation"],BmCityList:g["BmCityList"],BmMarker:g["BmMarker"],info:f["default"],deviceState:b["default"]},data:function(){this.chartSettings={radius:[5,40],offsetY:70},this.chartExtend={yAxisType:["percent"],tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"}};var e=function(e,t,a){var r=/[0-9A-Za-z]$/;""==t?a(new Error("设备地址不能为空")):r.test(t)?a():a(new Error("设备地址必须为大小写字母数字"))};return{formData:{},topicData:[],InfoDialog:!1,devicedetail:{},stateDialog:!1,stateDetail:{},chartOnlone:{columns:["状态","数量"],rows:[{"状态":"在线","数量":0},{"状态":"离线","数量":0}]},chartwaring:{},parseTbas:[],activeparseTbas:"",chartProduct:{},queryForm:{account:"",searchDate:"",pageNo:1,pageSize:20,workGroupName:"",workGroupTreeShow:!1,access_token:""},treeDataValue:"",isALL:!0,sizeZoom:10,activeName:"first",mapDialog:!1,dialogtempconfig:[],arrlist:[],deviceId:"",deciceCompany:"",gutter:24,leftRow:3,rightRow:21,popoverVisible:!1,vabicon:"ancient-gate-fill",Company:sessionStorage.getItem("title")||"",curDepartmentId:"",deptTreeData:[],roleProps:{children:"children",label:"name"},listLoading:!1,productimg:"",bmapdialogVisible:!1,onlineall:0,activeall:0,userId:"",batchid:"",pcdialogVisible:!0,devicedialogVisible:!1,equvalue:"0",cities:[],selectdevice:"",onlinedevices:"",deviceinput:"",devicenumber:"",multipleTable:[],selectRow:[],devicelength:10,devicestart:0,devicetotal:0,visible2:!1,deviceform:{videoSrc:"",name:"",devaddr:"",batchId:"",desc:"",nodeType:0,devType:"",netType:"",assetNum:"",devModel:"",address:"",productName:"",status:"",isEnable:"",brand:""},rules:{name:[{required:!0,message:"请输入设备名称",trigger:"blur"}],devaddr:[{required:!0,message:"请输入设备编号",trigger:"blur"},{validator:e}],batchId:[{required:!0,message:"请输入设备批次",trigger:"blur"}],nodeType:[{required:!0,message:"请输入设备类型",trigger:"blur"}],netType:[{required:!0,message:"请选择网络格式",trigger:"change"}],devType:[{required:!0,message:"请选择设备类型",trigger:"change"}],productName:[{required:!0,message:"请选择产品名称",trigger:"change"}]},pcformrule:{pcname:[{required:!0,message:"请输入批次名称",trigger:"blur"}],createdtime:[{type:"date",required:!0,message:"请选择创建时间",trigger:"change"}]},pcformInline:{pcnumber:"",pcname:"",createdtime:""},pctableData:[],equipmentEditor:"添加",tableData:[],options:[],proTableData:[],proTableData1:[],activelength:[],onlinelength:[],center:{lng:0,lat:0},zoom:13,bmapform:{keyword:"",location:"",address:""},deviceid:"",map:null,addresspointer:"",productenable:!0,changeproduct:!0,tagsid:"",productroleslist:[]}},computed:Object(l["a"])({},Object(c["mapGetters"])({_tableDict:"global/_tableDict",token:"user/token",roleTree:"user/roleTree",language:"settings/language"})),watch:{multipleTable:function(e){var t=this;this.selectRow=[],e.length>0&&e.forEach((function(e,a){t.selectRow.push(t.tableData.indexOf(e))}))}},mounted:function(){this.onlinedevices="dev_online"==this.$route.query.deciceType?"在线":"dev_unline"==this.$route.query.deciceType?"离线":"",this.getMenu(),this.selectdevice="zh"==this.language?"设备名称":"devicename",this.queryProduct(),this.queryTableDict()},methods:Object(l["a"])(Object(l["a"])({},Object(c["mapMutations"])({set_tableDict:"global/set_tableDict",set_tableParser:"global/set_tableParser"})),{},{ParserSave:function(e){},queryTableDict:function(){return Object(s["a"])(regeneratorRuntime.mark((function e(){var t,a,r,n,i,o,s,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={Parser:{},Dict:{}},e.prev=1,e.next=4,Object(v["tableDict"])("sinmahe_PeriodicInformation");case 4:a=e.sent,r=a.results,n=r[0].config,i=n.parser,o=void 0===i?{}:i,s=n.basedate,l=void 0===s?{}:s,t={Parser:o,Dict:l.params},e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](1),t={Parser:{},Dict:{}};case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,null,[[1,10]])})))()},queryProduct:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.proTableData=[],e.proTableData1=[],a={count:"objectId",order:"-updatedAt",keys:"name",where:{category:"IotHub"}},t.next=5,e.$query_object("Product",a);case 5:r=t.sent,n=r.results,e.proTableData=n,e.proTableData.unshift({name:"zh"==e.language?"全部产品":"All Products",objectId:"0"}),e.$route.query.product&&e.proTableData.forEach((function(t,a){t.objectId==e.$route.query.product&&(e.equvalue=e.proTableData[a].objectId,e.productenable=!0,e.access_token=e.token,e.$nextTick((function(){e.selectProdChange(e.$route.query.product)})))})),e.proTableData1=n.filter((function(e){return"0"!=e.objectId})),e.$route.query.productid&&(e.equvalue=e.$route.query.productid,e.productenable=!1);case 12:case"end":return t.stop()}}),t)})))()},change:function(e){e&&$(".el-tree").css({height:"100px",display:"block"})},selectProdChange:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r,n,i,o,s,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.listLoading=!0,"0"!=e){a.next=5;break}t.isALL=!0,a.next=26;break;case 5:return a.next=7,Object(m["getProduct"])(e).then((function(e){t.listLoading=!1;var a=e.config,r=void 0===a?{basedate:{}}:a,n=r.basedate,i=void 0===n?{params:[]}:n;t.dialogtempconfig=[],"undefined"!=i.params&&(t.dialogtempconfig=i.params)}));case 7:return t.isALL=!1,t.tableData=[],r={limit:t.devicelength,skip:t.devicestart,order:"-createdAt",count:"objectId",include:"product",where:{}},""!=t.deviceinput&&("设备名称"==t.selectdevice?r.where.name=t.deviceinput:r.where.devaddr=t.deviceinput),""!=t.onlinedevices&&("在线"==t.onlinedevices?r.where.status="ONLINE":r.where.status="OFFLINE"),""!=t.devicenumber&&(r.where.devaddr=t.devicenumber),r.where.product=e,t.devicestart=0,a.next=17,Object(w["querycompanyDevice"])(r,t.access_token);case 17:n=a.sent,i=n.results,o=void 0===i?[]:i,s=n.count,l=void 0===s?0:s,o.forEach((function(e){if(e.ACL)for(var t in e.ACL)e.Company=t.substr(5);else e.Company="";if(e.basedata)for(var t in e.basedata)e[t]=e.basedata[t]})),t.tableData=o,t.devicetotal=l,t.chartOnlone.rows[1]["数量"]=t.devicetotal;case 26:t.listLoading=!1;case 27:case"end":return a.stop()}}),a)})))()},showTree:function(e,t){this.deviceId=e,this.deciceCompany=t,this.popoverVisible=!this.popoverVisible},showState:function(e,t){var a=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,n,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=a.$baseColorfullLoading(3),t.next=3,a.queryTableDict();case 3:n=t.sent,i=n.Dict,o=n.Parser,a.set_tableDict(i),a.set_tableParser(o),a.stateDetail=e,setTimeout((function(){r.close(),a.stateDialog=!0}),1e3);case 10:case"end":return t.stop()}}),t)})))()},CloseState:function(){this.stateDialog=!1},showInfo:function(e){var t=this;this.devicedetail={};var a=e.product.objectId||"undefined";a&&Object(m["getProduct"])(a).then((function(e){var a=e.config;a.parser&&(t.parseTbas=e.config.parser,t.activeparseTbas=t.parseTbas[0].name)})).catch((function(e){}));var r=e.devaddr||"undefined",n=[{topic:"thing/".concat(a,"/").concat(r,"/post"),type:"pub",desc:"设备上报",isdef:!0},{topic:"thing/".concat(a,"/").concat(r),type:"sub",desc:"消息下发",isdef:!0}];e.product.topics?e.topicData=e.product.topics.concat(n):e.topicData=n,this.InfoDialog=!0,this.devicedetail=e},showMap:function(e,t){this.deviceId=t;var a=e.latitude,r=void 0===a?0:a,n=e.longitude,i=void 0===n?0:n;Number(r)&&Number(i)?(this.mapDialog=!0,this.center.lng=i,this.center.lat=r):this.$message.error("位置信息获取失败")},transferAcl:function(e){var t=this,a="role:"+e.name,r={};r[a]={read:!0,write:!0};var n={ACL:r,detail:{factory:e.depname}};this.$confirm(this.$translateTitle("确定要将设备迁移到"+e.name+"吗"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(w["putDevice"])(t.deviceId,n).then((function(e){e.updatedAt?(t.popoverVisible=!1,t.getMenu(),t.$message({type:"success",message:t.$translateTitle("迁移成功")})):t.$message({type:"error",message:t.$translateTitle("迁移失败")})}));case 2:case"end":return e.stop()}}),e)})))).catch((function(e){}))},getMenu:function(){this.deptTreeData=this.roleTree,this.handleNodeClick(this.deptTreeData[0],0)},handleNodeClick:function(e,t){var a=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var n,i,o,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if($(".el-tree").css({height:"0px",display:"none","overflow-x":"auto"}),$(".el-select-dropdown").css({display:"none"}),a.queryForm.workGroupName=e.label,1==t.level){r.next=12;break}return r.next=6,Object(y["getToken"])(e.name);case 6:n=r.sent,i=n.access_token,o=void 0===i?"":i,a.access_token=o,r.next=13;break;case 12:a.access_token=a.token;case 13:e.name,s=e.objectId,a.curDepartmentId=s,a.getDevices(0);case 16:case"end":return r.stop()}}),r)})))()},rolesSelect:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.productroleslist=[],a.next=3,t.$get_object("Product",e);case 3:r=a.sent,r.results;case 5:case"end":return a.stop()}}),a)})))()},goEdit:function(e){var t=window.location.origin+"/spa",a="production";t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var r="".concat(t,"/#?devaddr=").concat(e.devaddr,"&proudctid=").concat(e.productid);window.open(r,"__blank"),localStorage.setItem("topoData",JSON.stringify(e.config))},addressSure:function(){var e=new BMap.LocalSearch(this.map);e.enableAutoViewport();""==this.bmapform.address&&(this.deviceform.address=this.bmapform.keyword),e.search(this.bmapform.keyword),this.bmapdialogVisible=!1},handler:function(e){e.BMap;var t=e.map;this.center.lng=120.2,this.center.lat=30.26667,this.zoom=this.zoom,this.map=t},mapClick:function(e){var t=this;this.center.lng=e.point.lng,this.center.lat=e.point.lat,this.addresspointer=e.point.lng.toFixed(6)+","+e.point.lat.toFixed(6);var a=new BMap.Geocoder;a.getLocation(e.point,(function(e){t.bmapform.address=e.address,t.deviceform.address=e.address}))},updateLocation:function(){this.bmapdialogVisible=!0},handleClosebmap:function(){this.bmapdialogVisible=!1},getOnlineDevices:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.chartOnlone={columns:["状态","数量"],rows:[{"状态":"在线","数量":0},{"状态":"离线","数量":0}]},a={limit:1,count:"objectId",where:{status:"ONLINE"}},""!=e.deviceinput&&("设备名称"==e.selectdevice?a.where.name={$regex:e.deviceinput}:a.where.devaddr={$regex:e.deviceinput}),""!=e.devicenumber&&(a.where.devaddr=e.devicenumber),0!=e.equvalue&&e.selectProdChange(e.equvalue),t.next=7,Object(w["querycompanyDevice"])(a,e.access_token);case 7:r=t.sent,e.chartOnlone.rows[1]["数量"]=e.devicetotal-r.count,e.chartOnlone.rows[0]["数量"]=r.count;case 10:case"end":return t.stop()}}),t)})))()},getDevices:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r,n,i,o,s,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.listLoading=!0,t.tableData=[],r={limit:t.devicelength,skip:t.devicestart,order:"-createdAt",count:"objectId",include:"product",where:{}},""!=t.deviceinput&&("设备名称"==t.selectdevice?r.where.name={$regex:t.deviceinput}:r.where.devaddr={$regex:t.deviceinput}),""!=t.onlinedevices&&("在线"==t.onlinedevices?r.where.status="ONLINE":r.where.status="OFFLINE"),""!=t.devicenumber&&(r.where.devaddr={$regex:t.deviceinput}),0!=t.equvalue&&t.selectProdChange(t.equvalue),0==e&&(t.devicestart=0),a.next=10,Object(w["querycompanyDevice"])(r,t.access_token);case 10:n=a.sent,i=n.results,o=void 0===i?[]:i,s=n.count,l=void 0===s?0:s,o.forEach((function(e){if(e.ACL)for(var t in e.ACL)e.Company=t.substr(5);else e.Company=""})),t.listLoading=!1,o.forEach((function(e){e.location||(e.location={longitude:0,latitude:0})})),t.tableData=o,t.devicetotal=l,t.getOnlineDevices();case 21:case"end":return a.stop()}}),a)})))()},handelUpdate:function(e,t,a){var r=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(i in n={},r,t)n[i]=t[i];n.isEnable=1!=n.isEnable,r.tableData[a]=n,r.$confirm("是否修改此设备状态?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(s["a"])(regeneratorRuntime.mark((function e(){var a,n,i,s,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(d["get_object"])("Device",t.objectId);case 2:return a=e.sent,n=a.isEnable,n=void 0!=n&&!n,a.isEnable=n,a.createdAt,i=Object(o["a"])(a,_),i.updatedAt,s=Object(o["a"])(i,T),e.next=10,r.$update_object("Device",t.objectId,s);case 10:l=e.sent,void 0!=l?(r.$message({type:"success",message:"状态修改成功"}),r.getDevices()):Object(h["returnLogin"])(error);case 12:case"end":return e.stop()}}),e)})))).catch(Object(s["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r.$message({type:"info",message:"已取消修改"}),n=t,n.isEnable=1!=n.isEnable,r.tableData[a]=n;case 4:case"end":return e.stop()}}),e)}))));case 6:case"end":return e.stop()}}),e)})))()},timestampToTime:function(e){var t=new Date(1e3*e),a=t.getFullYear()+"-",r=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",n=(t.getDate()+1<=10?"0"+t.getDate():t.getDate())+" ",i=(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":",o=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",s=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return a+r+n+i+o+s},utc2beijing:function(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},filterTag:function(e,t){return t.tag===e},handleSelectionChange:function(e){this.multipleTable=e},deleteDevcie:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.multipleTable.map(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(a){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$del_object("Device",a.objectId);case 2:e.sent;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.$message({message:"删除成功",type:"success"}),t.getDevices();case 3:case"end":return e.stop()}}),e)})))()},editDevice:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$update_object("Device",item.objectId,params);case 2:a=t.sent,a.updatedAt?e.initQuery("设备修改成功","success"):e.$message({type:"error",message:a.error});case 4:case"end":return t.stop()}}),t)})))()},unactiveDevice:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r,n,i,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=[],n=[],t.multipleTable.map((function(e){r.push(e.objectId)})),i={isEnable:e},a.next=6,Object(u["Batchdelete"])("PUT","Device",r,i);case 6:o=a.sent,o&&(o.forEach((function(e,t){e.objectId=r[t],e.sortIndex=t+1,"success"==Object.keys(o[t])[0]?(e.msg="edit success",e.dangerouslyUseHTMLString=!1):(e.msg="<ol>\n            edit error <br>\n            message: ".concat(e.error.error," <br>\n            code: ").concat(e.error.code," <ol>"),e.dangerouslyUseHTMLString=!0),n.push({type:Object.keys(o[t])[0],message:e.msg,dangerouslyUseHTMLString:e.dangerouslyUseHTMLString})})),n.forEach((function(e,a){t.$baseNotify(e.message,"".concat(r[a]),e.type,"top-right",5e3*e.sortIndex,e.dangerouslyUseHTMLString)})),t.getDevices());case 8:case"end":return a.stop()}}),a)})))()},rowClass:function(e){e.row;var t=e.rowIndex;if(this.selectRow.includes(t))return{"background-color":"rgba(185, 221, 249, 0.3)"}},deviceSizeChange:function(e){this.devicelength=e,this.getDevices()},deviceCurrentChange:function(e){this.devicestart=(e-1)*this.devicelength,this.getDevices()},handleClose:function(){this.deviceid="",this.deviceform={name:"",devaddr:"",batchId:"",desc:"",nodeType:0,devType:"",netType:"",assetNum:"",devModel:"",address:"",videoSrc:"",productName:"",status:"",isEnable:"",brand:"",auth:"",yysId:""},this.$refs["deviceform"].resetFields(),this.devicedialogVisible=!1,this.equipmentEditor="添加"},addDeviceForm:function(){this.devicedialogVisible=!0,this.arrlist=[],this.equipmentEditor="添加",this.$route.query.productid?this.deviceform.productName=this.$route.query.productid:0!=this.equvalue?(this.changeproduct=!1,this.deviceform.productName=this.equvalue,this.selectChange(this.equvalue,"add")):this.deviceform.productName=""},handleClose1:function(){this.pcdialogVisible=!1,this.batchid="",this.pcformInline={pcname:"",createdtime:""}},makeSure:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$del_object("Device",e.row.objectId);case 2:r=a.sent,r.error?t.$message({type:"error",message:"删除失败"}):(t.$message({type:"success",message:"删除成功"}),t.getDevices()),e._self.$refs["popover-".concat(e.$index)].doClose();case 5:case"end":return a.stop()}}),a)})))()},editorDevice:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:for(r in t.selectChange(e.product.objectId,"edit"),t.deviceform={},t.deviceid=e.objectId,t.devicedialogVisible=!0,t.deviceform={devaddr:e.devaddr,name:e.name,assetNum:e.detail.assetNum,devModel:e.detail.devModel,desc:e.detail.desc,productid:e.product.objectId,brand:e.detail.brand,productName:e.product.objectId,status:e.status,isEnable:e.isEnable,videoSrc:e.detail.videoSrc,address:e.detail.address},e.basedata)t.$set(t.deviceform,r,e.basedata[r]);t.bmapform={address:e.detail.address},t.center={lat:location.latitude,lng:location.longitude},t.addresspointer=void 0==e.detail||void 0==location||location.latitude+e.detail==void 0?"":location.longitude,t.equipmentEditor="编辑";case 10:case"end":return a.stop()}}),a)})))()},getBatch:function(){return new p["Promise"]((function(e,t){r.length>0?e(r):t(!1)}))},initQuery:function(e,t){this.$message({type:t||"info",message:e}),this.dialogFormVisible=!1,this.getDevices()},updateDevice:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$update_object("Device",t.deviceid,e);case 2:r=a.sent,r.updatedAt||r.devaddr?t.initQuery("设备更新成功","success"):t.$message({type:"error",message:r.error});case 4:case"end":return a.stop()}}),a)})))()},createDevice:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$create_object("Device",e);case 2:r=a.sent,r.objectId?t.initQuery("设备创建成功","success"):t.$message({type:"error",message:r.error});case 4:case"end":return a.stop()}}),a)})))()},selectChange:function(e,t){var a=this;this.arrlist=[],Object(m["getProduct"])(e).then((function(e){var r=e.config,n=void 0===r?{basedate:{}}:r;n.basedate.params.length>0&&(a.arrlist=n.basedate.params,"add"==t&&a.arrlist.map((function(e){"bool"==e.type?a.$set(a.deviceform,e.identifier,e.default):"enum"==e.type?a.$set(a.deviceform,e.identifier,e.specs[0].attribute):e.default?a.$set(a.deviceform,e.identifier,e.default):a.$set(a.deviceform,e.identifier,""),e.required&&("bool"==e.type?a.rules[e.identifier]=[{required:!0,message:"请选择"+e.name,trigger:"change"}]:a.rules[e.identifier]=[{required:!0,message:"请输入"+e.name,trigger:"blur"}])})))}))},submitForm:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.$refs[e].validate(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(a){var r,n,i,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!a){e.next=23;break}for(o in r={__type:"GeoPoint",latitude:t.center.lat?t.center.lat:0,longitude:t.center.lng?t.center.lng:0},n={assetNum:t.deviceform.assetNum,devModel:t.deviceform.devModel,brand:t.deviceform.brand,address:t.bmapform.address,desc:t.deviceform.desc,videoSrc:t.deviceform.videoSrc},i={},t.deviceform)i[o]=t.deviceform[o];t.$delete(i,"address"),t.$delete(i,"assetNum"),t.$delete(i,"batchId"),t.$delete(i,"brand"),t.$delete(i,"desc"),t.$delete(i,"devModel"),t.$delete(i,"devType"),t.$delete(i,"devaddr"),t.$delete(i,"isEnable"),t.$delete(i,"name"),t.$delete(i,"netType"),t.$delete(i,"nodeType"),t.$delete(i,"productName"),t.$delete(i,"status"),t.$delete(i,"productid"),Object(m["getProduct"])(t.deviceform.productName).then((function(e){if(e)if(""!=t.deviceid){var a={name:t.deviceform.name,devaddr:t.deviceform.devaddr,product:{__type:"Pointer",className:"Product",objectId:e.objectId},detail:n,location:r,basedata:i};t.updateDevice(a),t.handleClose(),t.getDevices()}else{var o={count:"objectId",where:{name:{$in:[t.deviceform.name]},devaddr:{$in:[t.deviceform.devaddr]}}};t.$query_object("Device",o).then((function(a){if(a.count>0)t.$message("此设备已被创建");else{var o={product:{__type:"Pointer",className:"Product",objectId:t.deviceform.productName},status:"OFFLINE",isEnable:!1,ACL:e.ACL,name:t.deviceform.name,devaddr:t.deviceform.devaddr,objectId:t.deviceform.devaddr,lastOnlineTime:0,detail:n,location:r,basedata:i};t.createDevice(o),t.deviceform={},t.handleClose(),t.getDevices()}}))}})),e.next=25;break;case 23:return t.$message({type:"error",message:"请按照要求填写参数"}),e.abrupt("return",!1);case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return a.stop()}}),a)})))()},deviceToDetail:function(e){this.$router.push({path:"/roles/editdevices",query:{deviceid:e.objectId,nodeType:e.nodeType,productid:e.product.objectId,ischildren:"false"}})},konvaDevice:function(e){this.$router.push({path:"/Topo",query:{productid:e.product.objectId,devaddr:e.devaddr,deviceid:e.objectId,type:"device"}})}})},x=k,D=(a("e96e"),a("2877")),q=Object(D["a"])(x,n,i,!1,null,"f7f5dc7e",null);t["default"]=q.exports},"1a2a":function(e,t,a){},e96e:function(e,t,a){"use strict";a("1a2a")}}]);