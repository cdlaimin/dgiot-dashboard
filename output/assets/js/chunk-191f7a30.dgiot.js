/*!
 *  build: 杭州数蛙科技有限公司 
 *  copyright: dgiot-dashboard 
 *  author: h7ml(h7ml@qq.com) 
 *  time: Mon Nov 15 2021 07:39:36 GMT+0000 (Coordinated Universal Time)
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-191f7a30"],{"572b":function(e,t,a){},"591a":function(e,t,a){e.exports={"menu-color":"rgba(255,255,255,.95)","menu-color-active":"rgba(255,255,255,.95)","menu-background":"#282c34","column-second-menu-background":"#fff"}},d982:function(e,t,a){"use strict";a("572b")},edc4:function(e,t,a){"use strict";a("591a")},fcbb:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"resourcechannel resourcechannel-container"},[a("vab-input",{ref:"uploadFinish",on:{fileInfo:e.fileInfo}}),a("div",{staticClass:"firsttable"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.channelformsearch,size:"small"}},[a("el-form-item",[a("el-input",{attrs:{placeholder:e.$translateTitle("resource.name")},model:{value:e.channelformsearch.name,callback:function(t){e.$set(e.channelformsearch,"name",t)},expression:"channelformsearch.name"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.Get_Re_Channel(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addchanneltype.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("developer.selectchannel"))+" ")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableRef",staticStyle:{width:"100%"},attrs:{"cell-style":{"text-align":"center"},data:e.tableData,"header-cell-style":{"text-align":"center"},height:e.height,"row-class-name":e.getChannelEnable,"row-key":"objectId"}},[a("el-table-column",{attrs:{label:e.$translateTitle("developer.channelnumber"),prop:"objectId","show-overflow-tooltip":"",sortable:"",width:"150"}}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.channelname"),prop:"name","show-overflow-tooltip":"",sortable:"",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("span",[e._v(e._s(n.name))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.channeltype"),prop:"type","show-overflow-tooltip":"",sortable:"",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[1==n.type?a("span",[e._v(" "+e._s(e.$translateTitle("developer.collectionchannel"))+" ")]):2==n.type?a("span",[e._v(" "+e._s(e.$translateTitle("developer.resourcechannel"))+" ")]):a("span",[e._v(" "+e._s(e.$translateTitle("developer.missionchannel"))+" ")])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("websocket.port"),prop:"cType","show-overflow-tooltip":"",sortable:"",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("span",[e._v(e._s(n.config.port))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.servicetype"),prop:"cType","show-overflow-tooltip":"",sortable:"",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("span",[e._v(e._s(n.cType))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.channelstatus"),prop:"status","show-overflow-tooltip":"",sortable:"",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return["ONLINE"==n.status?a("span",{staticStyle:{color:"green"}},[e._v(" "+e._s(e.$translateTitle("product.online"))+" ")]):a("span",{staticStyle:{color:"red"}},[e._v(" "+e._s(e.$translateTitle("product.offline"))+" ")])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.enable")+"/"+e.$translateTitle("developer.disable"),prop:"isEnable","show-overflow-tooltip":"",sortable:"",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("el-tooltip",{attrs:{content:n.isEnable?e.$translateTitle("developer.enable"):e.$translateTitle("developer.disable"),placement:"top"}},[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:function(t){return e.switchEnable(n.objectId,n.isEnable)}},model:{value:n.isEnable,callback:function(t){e.$set(n,"isEnable",t)},expression:"row.isEnable"}})],1)]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.describe"),prop:"desc","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{fixed:"right",label:e.$translateTitle("developer.operation"),width:"240"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("el-button",{attrs:{disabled:"OFFLINE"==n.status,size:"mini",title:"ONLINE"==n.status?"":"请先启用通道",type:"success"},on:{click:function(t){return e.subProTopic(n)}}},[e._v(" "+e._s(e.$translateTitle("product.log"))+" ")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.editorChannel(n)}}},[e._v(" "+e._s(e.$translateTitle("task.Edit"))+" ")]),a("el-popover",{ref:"popover-"+n.$index,staticStyle:{"margin-left":"10px"},attrs:{placement:"top",width:"300"}},[a("p",[e._v(" "+e._s(e.$translateTitle("product.qdsczg"))+e._s(n.name)+e._s(e.$translateTitle("equipment.channel"))+" ")]),a("div",[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){n._self.$refs["popover-"+n.$index].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.deleteChannel(n)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),a("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)]}}])})],1),a("div",{staticClass:"elpagination"},[a("el-pagination",{key:e.length+"key"+e.total,attrs:{layout:"total, sizes, prev, pager, next, jumper","page-size":e.length,"page-sizes":[5,10,20,30,50],total:e.total},on:{"current-change":e.channelCurrentChange,"size-change":e.channelSizeChange}})],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleClose,title:e.channelupdated+"通道",top:"10vh",visible:e.channelForm,width:"50%"},on:{"update:visible":function(t){e.channelForm=t}}},[a("el-form",{ref:"addchannel",attrs:{"label-width":"auto",model:e.addchannel,rules:e.addrules}},[a("el-form-item",{attrs:{label:e.$translateTitle("developer.channeltype"),prop:"region"}},[a("el-select",{attrs:{disabled:"",placeholder:e.$translateTitle("developer.channeltype")},on:{change:e.removeauto},model:{value:e.addchannel.region,callback:function(t){e.$set(e.addchannel,"region",t)},expression:"addchannel.region"}},e._l(e.channelregion,(function(e,t){return a("el-option",{key:t,attrs:{label:e.title.zh,value:e.cType}})})),1),a("el-row",{staticStyle:{width:"100%","min-height":"0","max-height":"100px","margin-top":"20px","text-align":"center"},attrs:{gutter:24}},e._l(e.channelregion,(function(t,n){return a("el-col",{key:n,staticStyle:{cursor:"pointer"},attrs:{span:24}},[t.params.ico&&t.params.ico.default?a("el-card",{directives:[{name:"show",rawName:"v-show",value:e.addchannel.region==t.cType,expression:"addchannel.region == item.cType"}],staticClass:"box-card",style:{display:e.addchannel.region==t.cType?"block":"none",color:e.addchannel.region==t.cType?"#00bad0":"#c0c4cc"},attrs:{shadow:e.addchannel.region==t.cType?"always":"hover",size:"mini"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v(e._s(t.title.zh))]),a("el-button",{staticStyle:{float:"right"},attrs:{disabled:""!=e.resourceid,size:"mini",type:"success"},on:{click:function(a){return e.setCard(t.cType)}}},[e._v(" "+e._s(e.$translateTitle("product.selected"))+" ")])],1),a("div",{staticClass:"text item"},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("img",{staticClass:"image",staticStyle:{width:"50px",height:"50px"},attrs:{src:t.params.ico.default?t.params.ico.default:""}})]),a("el-col",{attrs:{span:12}},[a("el-tag",[e._v(e._s(t.cType))])],1)],1)],1)]):e._e()],1)})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.channelname"),prop:"name"}},[a("el-input",{attrs:{autocomplete:"off",placeholder:e.$translateTitle("developer.channelname")},model:{value:e.addchannel.name,callback:function(t){e.$set(e.addchannel,"name",t)},expression:"addchannel.name"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("application.applicationtype"),prop:"applicationtText"}},[a("el-input",{attrs:{placeholder:e.$translateTitle("product.pleaseselectyourapp"),readonly:""},on:{focus:function(t){e.showTree=!e.showTree}},model:{value:e.addchannel.applicationtText,callback:function(t){e.$set(e.addchannel,"applicationtText",t)},expression:"addchannel.applicationtText"}}),e.showTree?a("div",[a("el-tree",{attrs:{data:e.allApps,props:e.defaultProps},on:{"node-click":e.handleNodeClick}})],1):e._e()],1),e._l(e.arrlist,(function(t,n){return a("el-col",{key:n,attrs:{span:12}},[a("el-form-item",{attrs:{label:t.title.zh,prop:t.showname,required:t.required}},[a("el-tooltip",{attrs:{effect:"dark",placement:"right-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v(" "+e._s(t.description.zh)+" ")]),a("i",{staticClass:"el-icon-question",staticStyle:{float:"left"}})]),"string"==t.type?a("el-input",{directives:[{name:"show",rawName:"v-show",value:"通道ICO"!==t.title.zh,expression:"item.title.zh !== '通道ICO'"}],staticStyle:{width:"96%"},model:{value:e.addchannel[t.showname],callback:function(a){e.$set(e.addchannel,t.showname,a)},expression:"addchannel[item.showname]"}}):e._e(),"通道ICO"==t.title.zh?a("el-input",{directives:[{name:"show",rawName:"v-show",value:"通道ICO"==t.title.zh,expression:"item.title.zh == '通道ICO'"}],staticStyle:{width:"96%"},model:{value:e.addchannel[t.showname],callback:function(a){e.$set(e.addchannel,t.showname,e._n(a))},expression:"addchannel[item.showname]"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-upload"},on:{click:function(a){return e.uploadCkick(e.addchannel[t.showname],n,"arrlist")}},slot:"append"})],1):"integer"==t.type?a("el-input",{staticStyle:{width:"96%"},model:{value:e.addchannel[t.showname],callback:function(a){e.$set(e.addchannel,t.showname,e._n(a))},expression:"addchannel[item.showname]"}}):"boolean"==t.type?a("el-select",{staticClass:"notauto",staticStyle:{width:"96%"},model:{value:e.addchannel[t.showname],callback:function(a){e.$set(e.addchannel,t.showname,a)},expression:"addchannel[item.showname]"}},[a("el-option",{attrs:{label:e.$translateTitle("product.yes"),value:!0}}),a("el-option",{attrs:{label:e.$translateTitle("product.no"),value:!1}})],1):"enum"==t.type?a("el-select",{staticClass:"notauto",staticStyle:{width:"96%"},model:{value:e.addchannel[t.showname],callback:function(a){e.$set(e.addchannel,t.showname,a)},expression:"addchannel[item.showname]"}},e._l(t.enum,(function(e,n){return a("el-option",{key:n,attrs:{label:t.enum[n],value:t.enum[n]}})})),1):e._e()],1)],1)})),a("div",{staticClass:"row-bg"},[a("el-form-item",{attrs:{label:e.$translateTitle("developer.describe")}},[a("el-input",{attrs:{autocomplete:"off",placeholder:e.$translateTitle("developer.describe"),rows:3,type:"textarea"},on:{change:e.inputChange},model:{value:e.addchannel.desc,callback:function(t){e.$set(e.addchannel,"desc",t)},expression:"addchannel.desc"}})],1)],1)],2),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticStyle:{"margin-right":"20px"},on:{click:e.handleClose}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addchannelForm("addchannel")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("equipment.channeldetails"),visible:e.dialogVisible,width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",[a("el-row",[a("el-col",{attrs:{span:12}},[e._v("ID:")]),a("el-col",{attrs:{span:12}},[e._v(" "+e._s(e.resourceid)+" ")])],1),a("el-row",[a("el-col",{attrs:{span:12}},[e._v("Resource Type:")]),a("el-col",{attrs:{span:12}},[e._v(" "+e._s(e.resoucetype)+" ")])],1),a("el-row",[a("el-col",{attrs:{span:12}},[e._v("Description:")]),a("el-col",{attrs:{span:12}},[e._v(" "+e._s(e.description)+" ")])],1),e._l(e.detailchannel,(function(t,n){return a("el-row",{key:t},[a("el-col",{attrs:{span:12}},[e._v(" "+e._s(n)+" ")]),a("el-col",{attrs:{span:12}},[e._v(" "+e._s(t)+" ")])],1)}))],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){e.dialogVisible=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)]),a("a-drawer",{attrs:{"append-to-body":!0,placement:"right",title:e.channelname+"日志",visible:e.subdialog,width:"80%"},on:{close:function(t){return e.handleCloseSubdialog(e.pubtopic)}}},[a("mqtt-log",{attrs:{"channel-id":e.channelname,list:e.msgList,msg:e.submessage,product:e.channelInfo,"refresh-key":e.refreshFlag}})],1),a("el-dialog",{attrs:{"custom-class":"dgiot_dialog","show-close":!1,visible:e.channelDialog,width:"50%"},on:{"update:visible":function(t){e.channelDialog=t}}},[a("vab-query-form",[a("vab-query-form-left-panel",{attrs:{span:12}},[a("el-button",{attrs:{disabled:!e.selectedData.length,type:"danger"},on:{click:function(t){return e.handleDelete(e.channelInfo)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.batch deletion"))+" ")])],1)],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.channelInfo,height:"60vh",stripe:""},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{align:"center",type:"index"}}),a("el-table-column",{attrs:{type:"selection",width:"50"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.channelname"),prop:"name","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.servicetype"),prop:"devType","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.describe"),prop:"desc","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.operation"),prop:"objectId","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.deleteRelation(e.channelInfo,n.objectId)}}},[e._v(" "+e._s(e.$translateTitle("developer.remove"))+" ")])]}}])})],1),a("el-pagination",{attrs:{"current-page":e.pagination.currentPage,layout:e.pagination.layout,"page-size":e.pagination.size,"page-sizes":e.pagination.sizes,total:e.pagination.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)],1)},l=[],r=a("fb07"),s=a("e97b"),i=a("d0d7"),o=a.n(i),c=(a("3dec"),a("9c6a"),a("e170"),a("79da"),a("16b8"),a("4656"),a("1d17"),a("37c6"),a("c4bc"),a("80ab"),a("a98c"),a("fc3d"),a("04d6"),a("4c87"),a("0e9a")),d=a("89e8"),u=a("7212"),h=a("5da95"),p=a("bb22"),m=a("1b07"),g=a("5880"),f=a("67aa"),b=a.n(f),v=a("ca61"),w=Object(s["a"])(Object(s["a"])({components:Object(s["a"])({VabInput:v["default"]},Object(c["requireModule"])(a("d92d"))),data:function(){return{selectedData:[],pagination:{currentPage:4,sizes:[10,20,30,50,100],size:10,layout:"total, sizes, prev, pager, next, jumper",total:0,pageNo:1,pageSize:20,searchDate:[],limit:10,skip:0,order:"-createdAt",keys:"count(*)"},channelid:"",channelInfo:[],channelDialog:!1,router:"",topotopic:"",refreshFlag:"99",msgList:[],submessage:"",subtopic:"",pubtopic:"",channeindex:0,channeType:"",listLoading:!1,dialogVisible:!1,isopen:"suo",pwdType:"password",tableData:[],channelForm:!1,channelupdated:"新增",activeName:"first",channelformsearch:{name:""},height:this.$baseTableHeight(0),channelregion:[],addchannel:{region:"",desc:"",applicationtText:""},applicationList:[],addrules:{applicationtText:[{required:!0,message:"请选择所属应用",trigger:"change"}],roles:[{required:!0,message:"请选择所属应用",trigger:"blur"}],name:[{required:!0,message:"请输入通道名称",trigger:"blur"}],region:[{required:!0,message:"请选择服务类型",trigger:"change"}]},length:10,start:0,total:0,selectregion:{},resourceid:"",resoucetype:"",description:"",detailchannel:"",subdialog:!1,value4:"",subdialogid:"",subdialogtimer:null,channelname:"",arrlist:[],channelId:"",channelrow:[],showTree:!1,topicKey:"",allApps:[],defaultProps:{children:"children",label:"label"}}}},Object(g["mapGetters"])({roleTree:"user/roleTree"})),{},{watch:{topicKey:{handler:function(e,t){var a=this,n=this;e&&(this.$dgiotBus.$off(e),this.$dgiotBus.$on(e,(function(e){var t=e.payload;a.mqttMsg(t)}))),t&&(n.submessage="",n.msgList=[],n.logKey="99")},deep:!0,limit:!0}},mounted:function(){this.router=this.$dgiotBus.router(this.$route.fullPath),this.Get_Re_Channel(0),this.dialogType(),this.getApplication()},methods:{handleSelectionChange:function(e){this.selectedData=e},handleDelete:function(e){var t=this;this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,Object(r["a"])(o.a.mark((function a(){var n;return o.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=t.selectedData,n&&n.forEach((function(t,a){e.forEach((function(a,n){t===a&&e.splice(n,1)}))}));case 2:case"end":return a.stop()}}),a)}))))},deleteRelation:function(e,t){var a=this;return Object(r["a"])(o.a.mark((function e(){var n,l;return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,n={product:{__op:"RemoveRelation",objects:[{__type:"Pointer",className:"Product",objectId:t}]}},l=a.$baseColorfullLoading(),e.next=5,Object(d["saveChanne"])(a.channelid,n);case 5:e.sent,a.$baseMessage(a.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),l.close(),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](0),a.$baseMessage(a.$translateTitle("alert.Data request error")+"".concat(e.t0),"error","vab-hey-message-error");case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))()},handleSizeChange:function(){return Object(r["a"])(o.a.mark((function e(){return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},handleCurrentChange:function(){return Object(r["a"])(o.a.mark((function e(){return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},productinformation:function(e){var t=this;return Object(r["a"])(o.a.mark((function a(){var n,l,r,s,i,c,d;return o.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.channelid=e,n=t.$baseLoading(3),a.prev=2,l={limit:t.pagination.limit,order:t.pagination.order,skip:t.pagination.skip,keys:t.pagination.keys,where:{$relatedTo:{object:{__type:"Pointer",className:"Channel",objectId:e},key:"product"}}},a.next=6,Object(u["queryProduct"])(l);case 6:r=a.sent,s=r.results,i=void 0===s?[]:s,c=r.count,d=void 0===c?0:c,n.close(),t.pagination.total=d,t.channelInfo=i,a.next=20;break;case 16:a.prev=16,a.t0=a["catch"](2),n.close(),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 20:case"end":return a.stop()}}),a,null,[[2,16]])})))()},uploadCkick:function(e,t,a){this.channeindex=t,this.channeType=a,this.$refs["uploadFinish"].$refs.uploader.dispatchEvent(new MouseEvent("click"))},fileInfo:function(e){"arrlist"==this.channeType?this.arrlist[this.channeindex].default=e.url:this.channelregion[this.channeindex].params.ico.default=e.url},addchannelForm:function(e){var t=this;this.resourceid?this.editChannel(this.resourceid,e):this.$refs[e].validate((function(e){if(e&&t.addchannel.applicationtText){var a={};for(var n in t.addchannel)a[n]=t.addchannel[n];delete a.region,delete a.desc,delete a.type,delete a.isEnable,delete a.name;var l="role:"+t.addchannel.applicationtText,r={};r[l]={read:!0,write:!0};var s={ACL:r,config:a,name:t.addchannel.name,cType:t.addchannel.region,desc:t.addchannel.desc,isEnable:!1,status:"OFFLINE",type:t.addchannel.type.toString()};t.addchannelaxios(s)}else t.$message("有必填项未填")}))},addchannelaxios:function(e){var t=this;return Object(r["a"])(o.a.mark((function a(){return o.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(d["postChannel"])(e).then((function(e){e&&(t.$message({type:"success",message:"编辑"==t.channelupdated?"编辑成功":"创建成功"}),t.$refs["addchannel"].resetFields(),t.addchannel={},t.channelForm=!1,t.resourceid="")}));case 2:case"end":return a.stop()}}),a)})))()},handleNodeClick:function(e){this.showTree=!this.showTree,this.$set(this.addchannel,"applicationtText",e.name)},inputChange:function(e){},validUrl:function(e,t,a){var n=/^[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/;n.test(t)?a():a(new Error("需要输入正确的url"))},validPort:function(e,t,a){var n=/^([0-9]|[1-9]\d|[1-9]\d{2}|[1-9]\d{3}|[1-5]\d{4}|6[0-4]\d{3}|65[0-4]\d{2}|655[0-2]\d|6553[0-5])$/;n.test(t)?a():a(new Error("需要输入正确的端口号"))},Get_Re_Channel:function(){var e=arguments,t=this;return Object(r["a"])(o.a.mark((function a(){var n,l,r,s,i;return o.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.length>0&&void 0!==e[0]?e[0]:0,t.listLoading=!0,t.tableData=[],0==n&&(t.start=0),l={count:"objectId",skip:t.start,limit:t.length,order:"-createdAt",keys:"count(*)",where:{name:t.channelformsearch.name.length?{$regex:t.channelformsearch.name}:{$ne:null}}},a.next=7,Object(d["queryChannel"])(l);case 7:r=a.sent,s=r.count,i=r.results,t.total=s,t.tableData=i,t.listLoading=!1;case 13:case"end":return a.stop()}}),a)})))()},getApplication:function(){var e=this;return Object(r["a"])(o.a.mark((function t(){var a,n,l;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={limit:100},t.next=3,Object(h["queryRole"])(a);case 3:n=t.sent,l=n.results,l.map((function(t){var a={};a.id=t.id,a.name=t.desc,e.applicationList.push(a)}));case 6:case"end":return t.stop()}}),t)})))()},dialogType:function(){var e=this;return Object(r["a"])(o.a.mark((function t(){var a;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.allApps=e.roleTree,t.next=3,Object(m["resourceTypes"])();case 3:a=t.sent,a.forEach((function(e){e.params.ico||(e.params.ico={title:{en:"channel ICO",zh:"通道ICO"},description:{en:"channel ICO",zh:"通道ICO"},default:b.a})})),e.channelregion=a;case 6:case"end":return t.stop()}}),t)})))()},switchEnable:function(e,t){var a=this;return Object(r["a"])(o.a.mark((function n(){var l,r;return o.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t=t?"enable":"disable",n.prev=1,n.next=4,Object(p["subupadte"])(e,t);case 4:l=n.sent,r=l.updatedAt,r&&(a.$message.success(a.$translateTitle("developer.".concat(t))+""+a.$translateTitle("node.success")),a.Get_Re_Channel(a.start)),n.next=12;break;case 9:n.prev=9,n.t0=n["catch"](1),a.$message.error("".concat(n.t0));case 12:case"end":return n.stop()}}),n,null,[[1,9]])})))()},updateChannel:function(e){this.dialogVisible=!0,this.resourceid=e.objectId,this.detailchannel=e.config,this.resoucetype=e.cType,this.description=e.desc},editChannel:function(e,t){var a=this;return Object(r["a"])(o.a.mark((function t(){var n,l,r,s;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(l in n={},a.addchannel)n[l]=a.addchannel[l];return delete n.region,delete n.desc,delete n.type,delete n.isEnable,delete n.name,r={config:n,name:a.addchannel.name,cType:a.addchannel.region,desc:a.addchannel.desc},t.next=10,Object(d["putChannel"])(e,r);case 10:s=t.sent,s.updatedAt&&(a.$message({type:"success",message:"编辑成功"}),a.$refs["addchannel"].resetFields(),a.addchannel={},a.channelForm=!1,a.resourceid="",a.Get_Re_Channel(a.start));case 12:case"end":return t.stop()}}),t)})))()},deleteChannel:function(e){this.delchannelaxios(e)},delchannelaxios:function(e){var t=this;Object(d["delChannel"])(e.objectId).then((function(a){t.$message({type:"success",message:"删除成功"}),e._self.$refs["popover-".concat(e.$index)].doClose(),t.Get_Re_Channel(t.start)})).catch((function(e){}))},addchanneltype:function(){this.$router.push({path:"/CreateResourcechannel",query:{type:"create"}})},handleClose:function(){this.addchannel={},this.channelForm=!1,this.$refs["addchannel"].resetFields(),this.resourceid=""},getChannelEnable:function(e,t){return 1==e.row.isEnable?"green_active":"red_active"},channelSizeChange:function(e){this.length=e,this.Get_Re_Channel(1)},channelCurrentChange:function(e){e<=1&&(this.total=0),this.start=(e-1)*this.length,this.Get_Re_Channel(1)},arrSort:function(e,t){var a=e.order,n=t.order;return a<n?-1:a>n?1:0},orderObject:function(e){var t=[];for(var a in e)e[a].showname=a,t.push(e[a]);return t.sort(this.arrSort)},setCard:function(e){this.removeauto(e)},removeauto:function(e){var t=this,a={},n={applicationtText:[{required:!0,message:"请选择所属应用",trigger:"change"}],roles:[{required:!0,message:"请选择所属应用",trigger:"blur"}],name:[{required:!0,message:"请输入通道名称",trigger:"blur"}],region:[{required:!0,message:"请选择服务类型",trigger:"change"}]};if(""==this.resourceid?this.channelregion.map((function(l){l.cType==e&&(t.$forceUpdate(),t.selectregion=l,t.arrlist=t.orderObject(t.selectregion.params),t.arrlist.map((function(e){e.default?a[e.showname]=e.default:a[e.showname]="",e.required&&("string"==e.type||"integer"==e.type?n[e.showname]=[{required:!0,trigger:"blur"}]:n[e.showname]=[{required:!0,trigger:"change"}])})),a.region=e,a.desc="",a.name="",a.type=t.selectregion.type,a.isEnable=!1)})):this.channelregion.map((function(l){l.cType==e&&(t.selectregion=l,t.$forceUpdate(),t.arrlist=t.orderObject(t.selectregion.params),t.arrlist.map((function(l){for(var r in t.channelrow.config)l.showname==r&&(a[l.showname]=t.channelrow.config[r]),l.required&&("string"==l.type||"integer"==l.type?n[l.showname]=[{required:!0,trigger:"blur"}]:n[l.showname]=[{required:!0,trigger:"change"}]),a.region=e,a.desc=t.channelrow.desc,a.name=t.channelrow.name,a.type=t.selectregion.type,a.isEnable=t.channelrow.isEnable})))})),this.channelrow)for(var l in this.channelrow.ACL)a.applicationtText=l?l.substr(5):"";this.addchannel=a,this.addchannel.region=e,this.addrules=n},editorChannel:function(e){this.channelrow=e,this.resourceid=e.objectId,this.channelForm=!0,this.channelupdated="编辑",this.removeauto(e.cType)},nowtime:function(){var e=Date.parse(new Date),t=new Date(e),a=(t.getFullYear(),t.getMonth()+1<=10?t.getMonth():t.getMonth(),t.getDate()+1<=10?t.getDate():t.getDate(),(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":"),n=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",l=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return a+n+l+" "},mqttMsg:function(e){this.msgList.push({timestamp:moment().format("x"),msg:e}),this.refreshFlag=moment().format("x"),this.submessage+=e+"\n"},subProTopic:function(e){var t=this;this.productinformation(e.objectId),this.subdialog=!0,this.subdialogid=e.objectId,this.channelname=e.objectId,this.subtopic="log/channel/"+e.objectId+"/#",this.submessage="",this.msgList=[];var a={router:this.router,topic:this.subtopic,qos:2,ttl:108e5};this.$dgiotBus.$emit("MqttSubscribe",a),this.topicKey=this.$dgiotBus.topicKey(this.router,this.subtopic),this.pubtopic="channel/"+e.objectId,setTimeout((function(){t.$dgiotBus.$emit("MqttPublish",t.pubtopic,JSON.stringify({action:"start_logger"}),0,!1),t.refreshFlag=t.subtopic.split("log")[1]}),500)},handleCloseSubdialog:function(e){this.$dgiotBus.$emit("MqttPublish",e,JSON.stringify({action:"stop_logger"}),0,!1),this.refreshFlag=moment().format("x"),this.submessage="",this.msgList=[],this.subdialog=!this.subdialog}}}),y=w,_=(a("edc4"),a("d982"),a("bdd7")),$=Object(_["a"])(y,n,l,!1,null,"2f373419",null);t["default"]=$.exports}}]);