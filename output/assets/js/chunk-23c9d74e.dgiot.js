/*!
 *  build: 杭州数蛙科技有限公司 
 *  copyright: dgiot-dashboard 
 *  author: h7ml(h7ml@qq.com) 
 *  time: Mon Nov 15 2021 02:26:38 GMT+0000 (Coordinated Universal Time)
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-23c9d74e"],{"627a":function(e,t,i){"use strict";i.r(t);var s,a,n,o,c=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"onlinetest"},[i("div",{staticClass:"onlinetest_top"},[i("div",[i("el-form",{attrs:{inline:!0,model:e.devices,size:"mini"}},[i("el-form-item",{attrs:{label:"请选择设备"}},[i("el-select",{on:{change:e.selsectProduct},model:{value:e.devices.productid,callback:function(t){e.$set(e.devices,"productid",t)},expression:"devices.productid"}},e._l(e.productlist,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),i("el-form-item",[i("el-select",{directives:[{name:"el-select-loadmore",rawName:"v-el-select-loadmore",value:e.loadmore,expression:"loadmore"}],model:{value:e.devices.devicedevaddr,callback:function(t){e.$set(e.devices,"devicedevaddr",t)},expression:"devices.devicedevaddr"}},e._l(e.devicelist,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.devaddr}})})),1)],1),i("el-form-item",{attrs:{label:"服务通道"}},[i("el-select",{model:{value:e.devices.subtopic,callback:function(t){e.$set(e.devices,"subtopic",t)},expression:"devices.subtopic"}},e._l(e.channellist,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1),i("el-form-item",[i("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.subTopic.apply(null,arguments)}}},[e._v("订阅")])],1)],1)],1),i("div",{staticClass:"top_content"},[i("span",{staticStyle:{display:"inline-block","font-size":"20px","font-weight":"900"}},[e._v(" 实时日志 ")]),i("span",{staticClass:"status",class:e.status}),i("div",{staticStyle:{float:"right"}},[i("el-switch",{staticStyle:{display:"inline-block","margin-right":"10px"},attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","inactive-text":"自动刷新"},on:{change:e.isInterval},model:{value:e.value4,callback:function(t){e.value4=t},expression:"value4"}}),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.sendTrueInterval}},[e._v(" 刷新 ")]),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.clearTopic}},[e._v(" 清屏 ")])],1),e._m(0)])]),i("div",{staticClass:"onlinetest_bottom"},[i("el-tabs",{attrs:{type:"border-card"}},[i("el-tab-pane",{attrs:{label:"调试真实设备"}},[i("div",{staticClass:"bottom1_top"},[i("div",[i("div",{staticClass:"editorheader"},[i("el-form",{attrs:{inline:!0,"label-width":"80px",model:e.editor1,size:"mini"}},[i("el-form-item",{attrs:{label:"调试功能"}},[i("el-select",{on:{change:e.selectMessage},model:{value:e.editor1.function,callback:function(t){e.$set(e.editor1,"function",t)},expression:"editor1.function"}},e._l(e.dataslist,(function(e,t){return i("el-option",{key:t,attrs:{label:e.data.name,value:e.objectId}})})),1)],1),i("el-form-item",[i("el-button",{attrs:{circle:"",icon:"el-icon-plus",type:"primary"},on:{click:e.addMessage}}),i("el-button",{attrs:{circle:"",disabled:""==e.editor1.function,icon:"el-icon-delete",type:"danger"},on:{click:e.deleteMessage}})],1),i("div",{staticStyle:{"margin-top":"10px"}},[""==e.editor1.function?i("el-tooltip",{staticClass:"item",attrs:{content:"请选择功能",effect:"dark",placement:"top-start"}},[i("span",[i("el-button",{attrs:{disabled:""==e.editor1.function,size:"mini",type:"primary"},on:{click:e.sendMessage1}},[e._v(" 发送指令 ")])],1)]):i("el-button",{attrs:{disabled:""==e.editor1.function,size:"mini",type:"primary"},on:{click:e.sendMessage1}},[e._v(" 发送指令 ")]),i("el-button",{attrs:{disabled:""==e.editor1.function,icon:"el-icon-edit",size:"mini",type:"primary"},on:{click:e.editorMessage}},[e._v(" 更新 ")]),i("el-button",{attrs:{disabled:""==e.editor1.function,plain:"",size:"mini",type:"info"}},[e._v(" 重置 ")])],1)],1)],1),i("div",{staticStyle:{background:"#ffffff"}},[i("label",{attrs:{id:"plug-name"}})]),i("pre",{staticClass:"ace_editor",staticStyle:{"min-height":"300px"},attrs:{id:"editor1"}},[i("textarea",{staticClass:"ace_text-input"})])])])]),i("el-tab-pane",{attrs:{label:"调试虚拟设备"}},[i("div",{staticClass:"editor2header"},[1==e.isactive?i("div",{staticClass:"editor2show animated fadeIn"},[i("el-button-group",[i("el-button",{attrs:{plain:"",size:"mini",type:1==e.primary1?"primary":"info"},on:{click:function(t){e.primary1=1}}},[e._v(" 属性上报 ")]),i("el-button",{attrs:{plain:"",size:"mini",type:2==e.primary1?"primary":"info"},on:{click:function(t){e.primary1=2}}},[e._v(" 事件上报 ")]),i("el-button",{attrs:{plain:"",size:"mini",type:3==e.primary1?"primary":"info"},on:{click:e.functionClick}},[e._v(" 属性调试 ")]),i("el-button",{attrs:{plain:"",size:"mini",type:4==e.primary1?"primary":"info"},on:{click:function(t){e.primary1=4}}},[e._v(" 服务调用 ")])],1),i("div",{directives:[{name:"show",rawName:"v-show",value:1==e.primary1,expression:"primary1 == 1"}],staticClass:"primary1"},[i("el-form",{attrs:{model:e.primary1form,size:"mini"}},[i("el-form-item",{attrs:{label:"lightStatus"}},[i("el-select",{model:{value:e.primary1form.status,callback:function(t){e.$set(e.primary1form,"status",t)},expression:"primary1form.status"}},[i("el-option",{attrs:{label:"11111",value:"2222"}})],1)],1),i("div",{staticClass:"primary1content"}),i("div",{staticClass:"primary1bottom"},[i("el-button",{attrs:{size:"mini",type:"primary"}},[e._v("推送")]),i("el-button",{attrs:{plain:"",size:"mini",type:"info"}},[e._v(" 策略推送 ")]),i("el-button",{attrs:{plain:"",size:"mini",type:"info"},on:{click:function(t){e.isactive=!1}}},[e._v(" 关闭虚拟设备 ")]),i("el-button",{attrs:{plain:"",size:"mini",type:"info"}},[e._v(" 查看数据 ")])],1)],1)],1),i("div",{directives:[{name:"show",rawName:"v-show",value:2==e.primary1,expression:"primary1 == 2"}],staticClass:"primary2 animated fadeInUp"},[i("div",{staticStyle:{"margin-top":"20px","margin-bottom":"20px","font-size":"20px",color:"#73777a"}},[e._v(" 暂无数据 ")]),i("div",[i("el-button",{attrs:{size:"small",type:"primary"}},[e._v("编辑物模型")]),i("el-button",{attrs:{size:"small",type:"info"},on:{click:function(t){e.isactive=!1}}},[e._v(" 关闭设备 ")])],1)]),i("div",{directives:[{name:"show",rawName:"v-show",value:3==e.primary1||4==e.primary1,expression:"primary1 == 3 || primary1 == 4"}],staticClass:"primary3"},[i("div",{staticClass:"editorheader"},[i("el-form",{attrs:{inline:!0,"label-width":"80px",model:e.editor2,size:"mini"}},[i("el-form-item",{attrs:{label:"调试功能"}},[i("el-select",{model:{value:e.editor2.function,callback:function(t){e.$set(e.editor2,"function",t)},expression:"editor2.function"}},[i("el-option",{attrs:{label:"11111",value:"2222"}})],1)],1),3==e.primary1?i("div",{staticStyle:{display:"inline-block"}},[i("el-form-item",{attrs:{label:"功能"}},[i("el-select",{model:{value:e.editor2.method,callback:function(t){e.$set(e.editor2,"method",t)},expression:"editor2.method"}},[i("el-option")],1)],1)],1):e._e()],1)],1),i("div",{staticStyle:{background:"#ffffff"}},[i("label",{attrs:{id:"plug-name"}})]),i("pre",{staticClass:"ace_editor",staticStyle:{"min-height":"300px"},attrs:{id:"editor2"}},[i("textarea",{staticClass:"ace_text-input"})]),i("div",[""==e.editor2.function?i("el-tooltip",{staticClass:"item",attrs:{content:"请选择功能",effect:"dark",placement:"top-start"}},[i("span",[i("el-button",{attrs:{disabled:""==e.editor2.function,plain:"",size:"mini",type:"info"}},[e._v(" 发送指令 ")])],1)]):i("el-button",{attrs:{plain:"",size:"mini",type:"info"}},[e._v(" 发送指令 ")]),i("el-button",{attrs:{plain:"",size:"mini",type:"info"}},[e._v("重置")])],1)])],1):i("div",{staticClass:"editor2hidden animated fadeInDown"},[i("div",{staticStyle:{"margin-top":"20px","font-size":"20px"}},[e._v("调试虚拟设备")]),i("div",{staticStyle:{"margin-top":"8px","margin-bottom":"20px","font-size":"14px",color:"#73777a","text-align":"center"}},[e._v(" 虚拟设备可以模拟真实设备在云端建立连接，上报定义的属性及事件处理， "),i("br"),e._v(" 这样可以不依赖真实设备快速开发应用 ")]),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){e.isactive=!0}}},[e._v(" 启动真实设备 ")])],1)])])],1)],1),i("el-dialog",{attrs:{"append-to-body":!0,"close-on-click-modal":!1,title:"新建功能",visible:e.messageDialogVisible,width:"50%"},on:{"update:visible":function(t){e.messageDialogVisible=t}}},[i("el-form",{attrs:{inline:!0,model:e.messageform,size:"small"}},[i("el-form-item",{attrs:{label:"功能名称"}},[i("el-input",{attrs:{type:"text"},model:{value:e.messageform.name,callback:function(t){e.$set(e.messageform,"name",t)},expression:"messageform.name"}})],1)],1),i("label",{attrs:{id:"plug-name"}},[e._v("消息体")]),i("pre",{staticClass:"ace_editor",staticStyle:{"min-height":"300px"},attrs:{id:"message"}},[i("textarea",{staticClass:"ace_text-input"})]),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.messageDialogVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addCmd.apply(null,arguments)}}},[e._v("确 定")])],1)],1)],1)},l=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{"margin-top":"20px"}},[i("pre",{staticClass:"ace_editor",staticStyle:{width:"100%","min-height":"300px"},attrs:{id:"subprodevice"}},[e._v("          "),i("textarea",{staticClass:"ace_text-input",staticStyle:{overflow:"scroll"}}),e._v("        ")])])}],r=i("e97b"),d=(i("e472"),i("1ec3"),i("1d17"),i("9f39"),i("4656"),i("04d6"),i("c4bc"),i("16b8"),i("c620")),u=i("7212"),p=i("e0e9"),m=i("89e8"),v="",f={name:"OnlineTest",directives:{"el-select-loadmore":{bind:function(e,t){var i=e.querySelector(".el-select-dropdown .el-select-dropdown__wrap");i.addEventListener("scroll",(function(){var e=this.scrollHeight-this.scrollTop<=this.clientHeight;e&&t.value()}))}}},data:function(){return{primary:!0,status:"active",value4:!0,contentData:[],devices:{devicedevaddr:"",productid:"",subtopic:""},editor1:{function:"",method:""},editor2:{function:"",method:""},messageDialogVisible:!1,primary2active:!0,primary1:1,isactive:!1,primary1form:{status:""},productlist:[],devicelist:[],formData:{pageIndex:1,pageSize:20},channellist:[],subdialogtimer:null,messageform:{name:""},dataslist:[],sendindex:0,detaildatas:{}}},mounted:function(){s=ace.edit("editor1"),s.session.setMode("ace/mode/json"),s.setTheme("ace/theme/eclipse"),s.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),n=ace.edit("subprodevice"),n.session.setMode("ace/mode/text"),n.setTheme("ace/theme/gob"),n.setReadOnly(!0),n.setOptions({enableBasicAutocompletion:!1,enableSnippets:!0,enableLiveAutocompletion:!0}),this.getProduct()},beforeDestroy:function(){var e={topic:"log/channel/"+this.devices.subtopic+"/"+this.devices.productid+"/"+this.devices.devicedevaddr,qos:2};d["Websocket"].unsubscribe(e,(function(e){e.result})),n.setValue(""),v=""},methods:{sendZl:function(){},setJson:function(){},nowtime:function(){var e=Date.parse(new Date),t=new Date(e),i=(t.getFullYear(),t.getMonth()+1<=10?t.getMonth():t.getMonth(),t.getDate()+1<=10?t.getDate():t.getDate(),(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":"),s=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",a=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return i+s+a+" "},subTopic:function(){this.sendindex++;var e={topic:"log/channel/"+this.devices.subtopic+"/"+this.devices.productid+"/"+this.devices.devicedevaddr,qos:2},t=new RegExp("log/channel/"+this.devices.subtopic+"/"+this.devices.productid+"/"+this.devices.devicedevaddr),i=this;d["Websocket"].add_hook(t,(function(e){n.session.getLength()>=1e3?v="":v+=i.nowtime()+e+"\n",n.setValue(v),n.gotoLine(n.session.getLength())}));var s=JSON.stringify({action:"start_logger"});d["Websocket"].subscribe(e,(function(e){if(e.result){var t={topic:"channel/"+i.devices.subtopic+"/"+i.devices.productid+"/"+i.devices.devicedevaddr,text:s,retained:!0,qos:2};d["Websocket"].sendMessage(t),i.subdialogtimer=window.setInterval((function(){d["Websocket"].sendMessage(t)}),6e5)}}))},addMessage:function(){this.messageDialogVisible=!0,setTimeout((function(){o=ace.edit("message"),o.session.setMode("ace/mode/json"),o.setTheme("ace/theme/eclipse"),o.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),n=ace.edit("subprodevice"),n.session.setMode("ace/mode/text"),n.setTheme("ace/theme/gob"),n.setOptions({enableBasicAutocompletion:!1,enableSnippets:!0,enableLiveAutocompletion:!0})}))},selectMessage:function(e){var t=this;this.dataslist.map((function(i){i.objectId==e&&(s.setValue(JSON.stringify(i.data.commond)),t.detaildatas=JSON.parse(JSON.stringify(i.data)))}))},sendMessage1:function(){if(""!=this.editor1.function){0==this.sendindex&&this.subTopic();var e=this,t={topic:"thing/"+e.devices.productid+"/"+e.devices.devicedevaddr,text:s.getValue(),retained:!0,qos:2};d["Websocket"].sendMessage(t)}else this.$message("请挑选调试功能")},addCmd:function(){var e=this;""!=this.messageform.name?""!=o.getValue()?Object(u["getProduct"])(this.devices.productid).then((function(t){if(t){var i={};i=Object(r["a"])(Object(r["a"])({},i),JSON.parse(o.getValue()));var s={};s.name=e.messageform.name,s.type=t.devType,s.productid=t.objectId,s.commond=i;var a={ACL:t.ACL,data:s,type:"CMD"};Object(p["postDict"])(a).then((function(t){t&&(e.$message("创建成功"),e.messageDialogVisible=!1,e.getDict())})).catch((function(e){}))}})).catch((function(e){})):this.$message("请输入功能"):this.$message("请输入功能名称")},getDict:function(){var e=this,t={limit:100,where:{type:"CMD","data.productid":this.devices.productid}};Object(p["queryDict"])(t).then((function(t){t&&(e.dataslist=t.results)})).catch((function(e){}))},isInterval:function(e){var t="",i=this;t=0==e?JSON.stringify({action:"stop_logger"}):JSON.stringify({action:"start_logger"});var s={topic:"channel/"+i.devices.subtopic+"/"+i.devices.productid+"/"+i.devices.devicedevaddr,text:t,retained:!0,qos:2};d["Websocket"].sendMessage(s)},sendTrueInterval:function(){var e=this,t=JSON.stringify({action:"start_logger"}),i={topic:"channel/"+e.devices.subtopic+"/"+e.devices.productid+"/"+e.devices.devicedevaddr,text:t,retained:!0,qos:2};d["Websocket"].sendMessage(i)},clearTopic:function(){n.setValue(""),v=""},loadmore:function(){this.formData.pageIndex++,this.selsectProduct(this.productid)},deleteMessage:function(){var e=this;Object(p["delDict"])(this.editor1.function).then((function(t){t&&(e.$message("删除成功"),e.getDict(),e.editor1.function="",s.setValue(""))})).catch((function(e){}))},editorMessage:function(){var e=this;this.detaildatas.commond=JSON.parse(s.getValue());var t={data:this.detaildatas};Object(p["putDict"])(this.editor1.function,t).then((function(t){t&&(e.$message("编辑成功"),e.getDict())})).catch((function(e){}))},getProduct:function(){var e=this,t={limit:100};Object(u["queryProduct"])(t).then((function(t){e.productlist=t.results,e.devices.productid=e.$route.query.productid,e.getDevices(e.devices.productid,!0),e.getChannel(e.devices.productid),e.getDict()})).catch((function(e){}))},getChannel:function(e){var t=this,i="1",s={__type:"Pointer",className:"Product",objectId:e};Object(m["getChannelCountByProduct"])(this.channellength,this.channelstart,s,i).then((function(e){e.count>0?(t.channellist=e.results,t.devices.subtopic=e.results[0].objectId):(t.channellist={},t.devices.subtopic="")})).catch((function(e){t.$baseMessage("请求出错",e.error,3e3)}))},getDevices:function(e,t){var i=this,s={limit:this.formData.pageSize,skip:(this.formData.pageIndex-1)*this.formData.pageSize,count:"objectId",include:"product",where:{product:e}};this.$queryDevice(s).then((function(e){e.count>0&&(i.devicelist=e.results,i.devices.devicedevaddr=e.results[0].devaddr),t&&(i.devices.devicedevaddr=i.$route.query.deviceid)})).catch((function(e){i.$baseMessage("请求出错",e.error,3e3)}))},selsectProduct:function(e){this.formData.pageIndex=1,this.devicelist=[],this.devices.productid=e,this.devices.devicedevaddr="",this.getDevices(e),this.getChannel(e)},functionClick:function(){this.primary1=3,setTimeout((function(){a=ace.edit("editor2"),a.session.setMode("ace/mode/json"),a.setTheme("ace/theme/eclipse"),a.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0})}),300)}}},b=f,h=(i("9ead"),i("bdd7")),g=Object(h["a"])(b,c,l,!1,null,"2c4a0bb4",null);t["default"]=g.exports},"9ead":function(e,t,i){"use strict";i("cafb")},cafb:function(e,t,i){}}]);