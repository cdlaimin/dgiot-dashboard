/*!
 *  build: 杭州数蛙科技有限公司 
 *  copyright: dgiot-dashboard 
 *  author: h7ml(h7ml@qq.com) 
 *  time: Wed Nov 17 2021 04:11:49 GMT+0000 (Coordinated Universal Time)
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4b144e50"],{"0557":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"logs logs-container",class:{"vab-fullscreen":e.isFullscreen}},[a("vab-query-form",[a("vab-query-form-top-panel",[a("el-form",{ref:"form",attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{staticClass:"item-time",attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{staticClass:"item-time-picker",attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",{attrs:{label:"level"}},[a("el-select",{attrs:{clearable:""},model:{value:e.queryForm.level,callback:function(t){e.$set(e.queryForm,"level",t)},expression:"queryForm.level"}},e._l(e.leverData,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}},[e._v(" "+e._s(t)+" ")])})),1)],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.fold,expression:"!fold"}],attrs:{label:"pid"}},[a("el-input",{attrs:{clearable:""},model:{value:e.queryForm.pid,callback:function(t){e.$set(e.queryForm,"pid",t)},expression:"queryForm.pid"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.fold,expression:"!fold"}],attrs:{label:"domain"}},[a("el-input",{attrs:{clearable:""},model:{value:e.queryForm.domain,callback:function(t){e.$set(e.queryForm,"domain",t)},expression:"queryForm.domain"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.fold,expression:"!fold"}],attrs:{label:"mfa"}},[a("el-input",{attrs:{clearable:""},model:{value:e.queryForm.mfa,callback:function(t){e.$set(e.queryForm,"mfa",t)},expression:"queryForm.mfa"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.fold,expression:"!fold"}],attrs:{label:"clientid"}},[a("el-input",{attrs:{clearable:""},model:{value:e.queryForm.clientid,callback:function(t){e.$set(e.queryForm,"clientid",t)},expression:"queryForm.clientid"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.fold,expression:"!fold"}],attrs:{label:"topic"}},[a("el-input",{attrs:{clearable:""},model:{value:e.queryForm.topic,callback:function(t){e.$set(e.queryForm,"topic",t)},expression:"queryForm.topic"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.fold,expression:"!fold"}],attrs:{label:"peername","label-width":"80px"}},[a("el-input",{attrs:{clearable:""},model:{value:e.queryForm.peername,callback:function(t){e.$set(e.queryForm,"peername",t)},expression:"queryForm.peername"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"text"},on:{click:function(t){e.fold=!e.fold}}},[e.fold?a("span",[e._v(" "+e._s(e.$translateTitle("Maintenance.Unfold"))+" ")]):a("span",[e._v(e._s(e.$translateTitle("Maintenance.merge")))]),a("vab-icon",{staticClass:"vab-dropdown",class:{"vab-dropdown-active":e.fold},attrs:{icon:"arrow-up-s-line"}})],1),a("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},on:{click:function(t){return e.queryTable({})}}}),a("el-button",{staticStyle:{margin:"0 10px 10px 10px !important"},attrs:{type:"success"},on:{click:e.handleHeight}},[a("vab-icon",{attrs:{icon:e.isFullscreen?"fullscreen-exit-fill":"fullscreen-fill"}})],1),a("el-popover",{attrs:{trigger:"hover"},scopedSlots:e._u([{key:"reference",fn:function(){return[a("el-button",{staticStyle:{margin:"0 0 10px 0 !important"},attrs:{icon:"el-icon-setting",type:"primary"}},[e._v(" "+e._s(e.$translateTitle("Logs.Draggable column settings"))+" ")])]},proxy:!0}])},[a("el-checkbox-group",{model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},[a("vue-draggable",e._b({attrs:{list:e.logcolumns}},"vue-draggable",e.dragOptions,!1),e._l(e.logcolumns,(function(t,r){return a("div",{key:t+r},[a("vab-icon",{attrs:{icon:"drag-drop-line"}}),a("el-checkbox",{attrs:{disabled:!0===t.disableCheck,label:t}},[e._v(" "+e._s(t)+" ")])],1)})),0)],1)],1)],1)],1)],1)],1),a("el-table",{key:e.finallyColumns.length+e.momentKey,ref:"dragTable",staticClass:"logs-table",attrs:{border:"",data:e.logdata,"default-expand-all":"",height:e.height,"highlight-current-row":"",resizable:"","row-class-name":e.tableRowClassName,stripe:""},scopedSlots:e._u([{key:"empty",fn:function(){return[a("vab-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center",fixed:"left",label:"time",prop:"time","show-overflow-tooltip":"",sortable:"",width:"160"}}),e._l(e.finallyColumns,(function(t,r){return a("el-table-column",{key:r,attrs:{align:"center",label:t,prop:t,"show-overflow-tooltip":"",sortable:"",width:e.w80.includes(t)?80:e.Wh120.includes(t)?120:"auto"}})})),a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-descriptions",{staticClass:"margin-top",attrs:{border:"",column:2}},[a("el-descriptions-item",[a("template",{slot:"label"},[a("i",{directives:[{name:"copy",rawName:"v-copy",value:t.row.msg,expression:"props.row.msg"}],staticClass:"el-icon-copy-document"})]),e._v(" "+e._s(t.row.msg)+" ")],2)],1)]}}])})],2),a("vab-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.queryForm.total>0,expression:"queryForm.total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.queryForm.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.queryTable}})],1)},n=[],i=a("1da1"),s=(a("96cf"),a("4de4"),a("d3b7"),a("caad"),a("2532"),a("a434"),a("ac1f"),a("1276"),a("159b"),a("a9e3"),a("25f0"),a("d292")),o={name:"HistoryLog",data:function(){return{isFullscreen:!1,height:this.$baseTableHeight(0),logdata:[],momentKey:moment(new Date).valueOf(),checkList:["pid","level","mfa","line"],logcolumns:["pid","level","domain","mfa","line","clientid","topic","peername"],fold:!0,w80:["line","level"],Wh120:["pid","domain","gl"],Wh200:["time","clientid","peername"],leverData:["debug","info","notice","warning","error","crtical","alert","emergency"],queryForm:{total:0,count:"objectId",limit:20,pageNo:1,pageSize:20,skip:0,level:"",peername:"",pid:"",mfa:"",topic:"",domain:"",searchDate:[moment().subtract("days",7).format("YYYY-MM-DD"),moment(new Date).format("YYYY-MM-DD")],order:"-createdAt",keys:"count(*)"}}},computed:{dragOptions:function(){return{animation:600,group:"description"}},finallyColumns:function(){var e=this;return this.logcolumns.filter((function(t){return e.checkList.includes(t)}))}},created:function(){},mounted:function(){this.queryTable({}),this.rowDrop(),this.columnDrop()},methods:{handleHeight:function(){this.isFullscreen=!this.isFullscreen,this.isFullscreen?this.height=this.$baseTableHeight(0)+120:this.height=this.$baseTableHeight(0),this.momentKey=moment(new Date).valueOf()},tableRowClassName:function(e){var t=e.row;return t.disabled?"disabled":""},rowDrop:function(){var e=this.$refs.dragTable.$el.querySelector(".el-table__body-wrapper tbody"),t=this;Sortable.create(e,{draggable:".el-table__row",onEnd:function(e){var a=e.newIndex,r=e.oldIndex,n=t.logdata.splice(r,1)[0];t.logdata.splice(a,0,n)}})},columnDrop:function(){var e=this,t=this.$refs.dragTable.$el.querySelector(".el-table__header-wrapper tr");e.sortable=Sortable.create(t,{animation:180,delay:0,onEnd:function(t){var a=e.finallyColumns[t.oldIndex];e.finallyColumns.splice(t.oldIndex,1),e.finallyColumns.splice(t.newIndex,0,a),e.momentKey=moment(new Date).valueOf(),setTimeout((function(){e.rowDrop(),e.columnDrop()}),1500)}})},queryTable:function(){var e=arguments,t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,o,l,c,u,d;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.length>0&&void 0!==e[0]?e[0]:{},r.limit||(r=t.queryForm),n=t.$baseColorfullLoading(),a.prev=3,n.close(),i={limit:r.limit,skip:r.skip,order:r.order,count:t.queryForm.count,include:"",where:{level:t.queryForm.level?t.queryForm.level:{$ne:"3333"},pid:t.queryForm.pid?{$regex:t.queryForm.pid,$options:"i"}:{$ne:"3333"},mfa:t.queryForm.mfa?{$regex:t.queryForm.mfa,$options:"i"}:{$ne:"3333"},domain:t.queryForm.domain?{$all:t.queryForm.domain.split(/,(?=(?:[^']*(?:'[^']*')?[^']*)*$)/)}:{$ne:""},topic:t.queryForm.topic?{$regex:t.queryForm.topic,$options:"i"}:{$ne:"3333"},peername:t.queryForm.peername?{$regex:t.queryForm.peername,$options:"i"}:{$ne:"3333"},clientid:t.queryForm.clientid?{$regex:t.queryForm.clientid,$options:"i"}:{$ne:"3333"},createdAt:{$gte:{__type:"Date",iso:"".concat(t.queryForm.searchDate[0],"T00:00:00.000Z")},$lte:{__type:"Date",iso:"".concat(t.queryForm.searchDate[1],"T23:59:59.000Z")}}}},a.next=8,Object(s["queryLog"])(i);case 8:o=a.sent,l=o.results,c=void 0===l?[]:l,u=o.count,d=void 0===u?0:u,c.forEach((function(e){e.time=t.$moment(Number(e.time.toString().substring(0,13))).format("YYYY-MM-DD HH:mm:ss.SSS")})),t.logdata=c,t.queryForm.total=d,t.$baseMessage(t.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),n.close(),a.next=24;break;case 20:a.prev=20,a.t0=a["catch"](3),n.close(),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 24:t.momentKey=moment(new Date).valueOf();case 25:case"end":return a.stop()}}),a,null,[[3,20]])})))()}}},l=o,c=(a("b5cf"),a("2877")),u=Object(c["a"])(l,r,n,!1,null,"3124c1a7",null);t["default"]=u.exports},"0804":function(e,t,a){},"11ed":function(e,t,a){},"1310b":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"system-log-container"},[a("vab-query-form",[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"60px",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"账号"}},[a("el-input",{attrs:{clearable:"",placeholder:"请输入账号"},model:{value:e.queryForm.account,callback:function(t){e.$set(e.queryForm,"account","string"===typeof t?t.trim():t)},expression:"queryForm.account"}})],1),a("el-form-item",{attrs:{label:"周期"}},[a("el-date-picker",{attrs:{"end-placeholder":"结束日期",format:"yyyy-MM-dd","start-placeholder":"开始日期",type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search",type:"primary"},nativeOn:{click:function(t){return e.queryData.apply(null,arguments)}}},[e._v(" 查询 ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{data:e.list},scopedSlots:e._u([{key:"empty",fn:function(){},proxy:!0}])},[a("el-table-column",{attrs:{align:"center",label:"日志类型",prop:"type","show-overflow-tooltip":"",width:"230px"}}),a("el-table-column",{attrs:{align:"center",label:"账号",prop:"account","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{align:"center",label:"执行结果",prop:"executeResult","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return["登录成功"===r.executeResult?a("span",[a("span",{staticClass:"vab-dot vab-dot-success"},[a("span")]),e._v(" "+e._s(r.executeResult)+" ")]):a("span",[a("span",{staticClass:"vab-dot vab-dot-error"},[a("span")]),e._v(" "+e._s(r.executeResult)+" ")])]}}])}),a("el-table-column",{attrs:{align:"center",label:"登录IP",prop:"ip"}}),a("el-table-column",{attrs:{align:"center",label:"访问时间",prop:"datetime","show-overflow-tooltip":""}})],1),a("el-pagination",{attrs:{background:"","current-page":e.queryForm.pageNo,layout:e.layout,"page-size":e.queryForm.pageSize,total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)},n=[],i=a("1da1"),s=(a("96cf"),a("8781")),o={name:"SystemLog",data:function(){return{list:[],listLoading:!0,layout:"total, sizes, prev, pager, next, jumper",total:0,queryForm:{account:"",searchDate:"",pageNo:1,pageSize:20}}},created:function(){this.fetchData()},methods:{handleSizeChange:function(e){this.queryForm.pageSize=e,this.fetchData()},handleCurrentChange:function(e){this.queryForm.pageNo=e,this.fetchData()},queryData:function(){this.queryForm.pageNo=1,this.fetchData()},fetchData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r,n,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.listLoading=!0,t.next=3,Object(s["getList"])(e.queryForm);case 3:a=t.sent,r=a.data,n=r.list,i=r.total,e.list=n,e.total=i,e.listLoading=!1;case 10:case"end":return t.stop()}}),t)})))()}}},l=o,c=a("2877"),u=Object(c["a"])(l,r,n,!1,null,null,null);t["default"]=u.exports},1944:function(e,t,a){"use strict";a("367c")},"19cb":function(e,t,a){},"1f1b":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mycontainer"},[a("div",{staticClass:"ticker-dialog"},[a("div",{staticClass:"home_dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e.showdeviceFlag,width:"100vh"},on:{"update:visible":function(t){e.showdeviceFlag=t}}},[a("Change-Step",{ref:"ChangeStep",attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status,expression:"detail.status == 0"}],on:{click:function(t){return e.set_deviceStep(-1)}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status&&e.isfooter,expression:"detail.status == 0 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dispatch()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Dispatch"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status,expression:"detail.status == 1"}],on:{click:function(t){return e.backChange(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.back"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.Reassign(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reassign"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.check()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.check"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status&&e.isfooter,expression:"detail.status == 1 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dealwith()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("Maintenance.create Ticket"),visible:e.dialogFormVisible,width:"90vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project"),prop:"product"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("Maintenance.Please choose the product")},on:{change:e.prodChange},model:{value:e.form.product,callback:function(t){e.$set(e.form,"product",t)},expression:"form.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name"),prop:"name"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.Device.length,placeholder:0==e.Device.length?e.$translateTitle("Maintenance.Please choose the product"):e.$translateTitle("Maintenance.Please select a device")},on:{change:e.deviceChange},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},e._l(e.Device,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:e.objectId,expression:"item.objectId"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type"),prop:"type"}},[a("el-input",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")}},[a("el-upload",{attrs:{action:"#","auto-upload":!0,"http-request":e.myUpload,"list-type":"picture-card"}},[a("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"}),e._l(e.form.photo,(function(e,t){return a("div",{key:t},[a("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{alt:"",src:e.url}})])}))],2),a("el-dialog",{attrs:{"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{alt:"",src:e.dialogImageUrl,width:"100%"}})])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Create now"))+" ")]),a("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reset"))+" ")])],1)],1)],1)]),a("vab-query-form",{staticClass:"query-form"},[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.number")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.projects")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.project")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.type")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.fetchData}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")]),a("el-button",{attrs:{icon:"el-icon-circle-plus-outline",size:"mini",type:"primary"},on:{click:function(t){e.dialogFormVisible=!e.dialogFormVisible}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.create Ticket"))+" ")]),a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-s-promotion",size:"mini",type:"primary"},on:{click:function(t){return e.batchExport(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:"",data:e.list,height:e.height,stripe:""},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[a("vab-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortable:"",width:"120"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.getStatus(a.status,a))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.project"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.productname?a.info.productname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.devicename?a.info.devicename:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.createdname?a.info.createdname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$moment(a.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("Maintenance.operating"),width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showInfo(r,!0,!1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:3!=r.status,expression:"row.status != 3"}],attrs:{disabled:0!=r.status,size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(r,2)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.delete"))+" ")])]}}])})],1),a("vab-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},n=[],i=a("1da1"),s=a("5530"),o=(a("96cf"),a("d81d"),a("b0c0"),a("99af"),a("a4d3"),a("e01a"),a("d3b7"),a("159b"),a("ddb0"),a("0941")),l=a("dcc6"),c=a("1285"),u=a("5880"),d=a("2ec0"),m=a("1267"),p={name:"CreateTicket",components:{ChangeStep:d["default"]},data:function(){return{showdeviceFlag:!1,created:0,Assigned:0,form:{receiveuseid:"",productname:"",devicename:"",createdname:"",receiveusername:"",receiveuserphone:"",name:"",product:"",type:"",description:"",photo:[],objectId:""},dialogFormVisible:!1,fold:!1,step:1,ishard:!1,height:this.$baseTableHeight(0)-30,isfooter:!0,detail:{},AllDevice:[],selectedList:[],types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择所属项目",trigger:"change"}],name:[{required:!0,message:"请选择设备",trigger:"change"}],type:[{required:!0,message:"请输入工单类型",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,status:[{key:0,text:"Maintenance.To be assigned"},{key:1,text:"Maintenance.Assigned"},{key:2,text:"Maintenance.Processed"},{key:3,text:"Maintenance.Statement"}],queryForm:{devicename:"",statusFlag:!1,status:"",number:"",product:"",type:"",pageNo:1,pageSize:20,searchDate:[],limt:10,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:Object(s["a"])(Object(s["a"])({},Object(u["mapGetters"])({_Product:"user/_Product",objectid:"user/objectId",role:"acl/role",username:"user/username"})),{},{_deviceStep:{get:function(){return this.$store.state.global._deviceStep},set:function(e){this.set_deviceStep(e)}},aclObj:function(){var e={};return this.role.map((function(t){e["".concat("role:"+t.name)]={read:!0,write:!0}})),e}}),watch:{_deviceStep:function(e){-1==e&&this.fetchData()},"queryForm.status":function(e){this.queryForm.statusFlag=""!=e}},created:function(){},mounted:function(){this.handleCreated("created")},methods:Object(s["a"])(Object(s["a"])({myUpload:function(e){var t=this,a=e.file,r=a.name.substring(a.name.lastIndexOf(".")+1),n={file:a,path:"ticket",filename:"ticket"+"".concat(moment().format("x"),".").concat(r)};Object(m["UploadImg"])(n).then((function(e){e.data.url&&t.form.photo.push(e.data.url)})).catch((function(e){}))},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.createdTicket(t.form)}))},createdTicket:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r={},r[t.objectid]={read:!0,write:!0},n={number:moment(new Date).unix()+"",type:e.type,ACL:_.merge(r,t.aclObj),info:{photo:e.photo,timeline:[{timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"生成工单",p:"".concat(t.username,"新建工单")}],description:e.description,step1:{},step2:{},step3:{},step4:{},productid:e.product,productname:e.productname,devicename:e.devicename,deviceid:e.name,createdname:t.username,receiveusername:e.receiveusername,receiveuseid:e.receiveuseid,receiveuserphone:e.receiveuserphone},device:{objectId:e.name,__type:"Pointer",className:"Device"}},i=t.$baseColorfullLoading(),a.next=6,Object(o["create_object"])("Maintenance",n);case 6:a.sent,t.set_deviceStep(-1),i.close(),t.fetchData(),t.dialogFormVisible=!1;case 11:case"end":return a.stop()}}),a)})))()},resetForm:function(e){this.$refs[e].resetFields()},changeBox:function(e){var t=this;this.selectedList=[],e.forEach((function(e){t.selectedList.push(e)}))}},Object(u["mapMutations"])({set_deviceStep:"global/set_deviceStep"})),{},{handleFold:function(){this.fold=!this.fold,this.handleHeight()},batchExport:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r={results:[]},r["results"]=e,a.next=5,Object(m["exlout"])(r);case 5:n=a.sent,t.$convertRes2Blob(n),t.$message.success(t.$translateTitle("node.export success")),a.next=13;break;case 10:a.prev=10,a.t0=a["catch"](0),t.$message.error(t.$translateTitle("node.export error")+"".concat(a.t0));case 13:case"end":return a.stop()}}),a,null,[[0,10]])})))()},handleDelete:function(e,t){var a=this,r=[];2==t?r.push({method:"DELETE",path:"/classes/Maintenance/".concat(e.objectId),body:{}}):e.forEach((function(e){r.push({method:"DELETE",path:"/classes/Maintenance/".concat(e.objectId),body:{}})})),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["batch"])(r);case 2:e.sent,a.$baseMessage(a.$translateTitle("Maintenance.successfully deleted"),"success","vab-hey-message-success"),setTimeout((function(){a.fetchData()}),1500);case 5:case"end":return e.stop()}}),e)}))))},handleHeight:function(){this.fold?this.height=this.$baseTableHeight(0)-20:this.height=this.$baseTableHeight(0)-30},getStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch(e){case 0:return this.$translateTitle("Maintenance.To be assigned");case 1:return this.$translateTitle("Maintenance.Assigned");case 2:return this.$translateTitle("Maintenance.Processed");case 3:return this.$translateTitle("Maintenance.Statement");default:return e}},showInfo:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.showdeviceFlag=!1,this.ishard=t,this.isfooter=a;var r=e.status,n=void 0===r?0:r;this.detail=e,this.step=n+1,this.set_deviceStep(n),this.showdeviceFlag=!0},handleCreated:function(e){"created"==e?this.created++:this.Assigned++,this.fetchData()},fetchData:function(){var e=arguments,t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.length>0&&void 0!==e[0]?e[0]:{},n.limit||(n=t.queryForm),t.listLoading=!1,i=t.$baseColorfullLoading(),s={limit:n.limit,order:n.order,skip:n.skip,keys:n.keys,where:{"info.receiveuseid":t.Assigned%2==0?{$ne:"99"}:t.objectid,number:t.queryForm.number.length?{$regex:t.queryForm.number}:{$ne:null},status:0,"info.productid":t.queryForm.product.length?t.queryForm.product:{$ne:"99"},type:t.queryForm.type.length?{$regex:t.queryForm.type}:{$ne:null}}},null!==(r=t.queryForm.searchDate)&&void 0!==r&&r.length&&(s.where["createdAt"]={$gt:{__type:"Date",iso:t.queryForm.searchDate[0]}},s.where["updatedAt"]={$lt:{__type:"Date",iso:t.queryForm.searchDate[1]}}),a.next=8,Object(o["query_object"])("Maintenance",s).then((function(e){var a=e.results,r=void 0===a?[]:a,n=e.count,s=void 0===n?0:n;t.list=r,t.list.forEach((function(e){if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(0)})),t.total=s,i.close()})).catch((function(e){t.$message.error("".concat(e)),i.close()}));case 8:case"end":return a.stop()}}),a)})))()},prodChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.Device=[],t._Product.map((function(a){a.objectId==e&&(t.form.productname=a.name)})),t.form.name="",r={where:{product:e}},a.next=6,Object(c["queryDevice"])(r);case 6:n=a.sent,i=n.results,t.Device=i;case 9:case"end":return a.stop()}}),a)})))()},deviceChange:function(e){var t=this;this.Device.map((function(a){a.objectId==e&&(t.form.devicename=a.name)}))},dispatch:function(){this.$refs.ChangeStep.$refs.step1.dispatchUser()},backChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.objectId,n=e.info,n.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已回退",p:"".concat(t.username," 回退了流程")}),i={status:0,info:n},a.next=5,Object(o["update_object"])("Maintenance",r,i);case 5:s=a.sent,s.updatedAt&&t.set_deviceStep(-1);case 7:case"end":return a.stop()}}),a)})))()},Reassign:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.objectId,n=e.info,n.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已改派",p:"".concat(t.username," 改派了工单")}),i={status:0,info:n},a.next=5,Object(o["update_object"])("Maintenance",r,i);case 5:s=a.sent,s.updatedAt&&t.set_deviceStep(-1);case 7:case"end":return a.stop()}}),a)})))()},dealwith:function(){this.$refs.ChangeStep.$refs.step2.dispatchUser()},check:function(){this.$refs.ChangeStep.$refs.step3.dispatchUser()}})},f=p,h=(a("cd37"),a("2877")),b=Object(h["a"])(f,r,n,!1,null,"64811a01",null);t["default"]=b.exports},"1f97":function(e,t,a){"use strict";a("df15")},2187:function(e,t,a){"use strict";a("11ed")},"23e9":function(e,t,a){"use strict";a("5a05")},"251c":function(e,t,a){},"2c89":function(e,t,a){"use strict";a("3200")},"2ec0":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.detail?a("div",{staticClass:"changeInfo"},[a("el-row",{directives:[{name:"show",rawName:"v-show",value:1==e.showHard,expression:"showHard == true"}],staticClass:"row-bg",attrs:{justify:"space-around",type:"flex"}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v(" "+e._s(e.$translateTitle("Maintenance.Ticket number"))+" : "+e._s(e.detail.number)+" ")])]),a("el-col",{attrs:{span:5}},[a("div",{staticClass:"grid-content bg-purple-light"},[e._v(" "+e._s(e.$translateTitle("Maintenance.Ticket type"))+" : "+e._s(e.detail.type)+" ")])]),a("el-col",{attrs:{span:7}},[a("div",{staticClass:"grid-content bg-purple"},[e._v(" "+e._s(e.$translateTitle("Maintenance.the starting time"))+" : "+e._s(e.$moment(e.detail.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")])])],1),a("el-steps",{directives:[{name:"show",rawName:"v-show",value:1==e.showHard,expression:"showHard == true"}],staticClass:"steps",attrs:{active:e.step,"finish-status":"success",simple:""}},[a("el-step",{attrs:{title:e.$translateTitle("Maintenance.To be assigned")}}),a("el-step",{attrs:{title:e.$translateTitle("Maintenance.Assigned")}}),a("el-step",{attrs:{title:e.$translateTitle("Maintenance.Processed")}}),a("el-step",{attrs:{title:e.$translateTitle("Maintenance.Statement")}})],1),1===e.step?a("step1",{ref:"step1",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":e.showHard,step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),2===e.step?a("step2",{ref:"step2",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),3===e.step?a("step3",{ref:"step3",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),4===e.step?a("Step4",{ref:"step4",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e()],1):a("div",{staticClass:"empty"},[a("vab-empty")],1)},n=[],i=(a("a9e3"),a("c7e3")),s=a("f715"),o=a("926e"),l=a("4901"),c={name:"ChangeStep",components:{Step1:i["default"],Step2:s["default"],Step3:o["default"],Step4:l["default"]},props:{detail:{type:Object,default:function(){}},showFooter:{type:Boolean,default:!1},showHard:{type:Boolean,default:!1},step:{type:Number,default:1}},data:function(){return{isStep:0}},mounted:function(){4==this.step&&(this.isStep=4)},methods:{next:function(){this.isStep++>5&&(this.isStep=0)},handleSetStep:function(e,t){t&&(this.form=Object.assign(this.form,t))}}},u=c,d=(a("2f4c"),a("2877")),m=Object(d["a"])(u,r,n,!1,null,"3945c17e",null);t["default"]=m.exports},"2f4c":function(e,t,a){"use strict";a("83d5")},3200:function(e,t,a){},"367c":function(e,t,a){},"3a95":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mycontainer"},[a("div",{staticClass:"ticker-dialog"},[a("div",{staticClass:"home_dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e._deviceFlag,width:"100vh"},on:{"update:visible":function(t){e._deviceFlag=t}}},[a("change-info",{ref:"changeinfo",attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status,expression:"detail.status == 0"}],on:{click:function(t){return e.set_deviceFlag(!1)}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status&&e.isfooter,expression:"detail.status == 0 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dispatch()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Dispatch"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status,expression:"detail.status == 1"}],on:{click:function(t){return e.backChange(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.back"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.Reassign(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reassign"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.check()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.check"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status&&e.isfooter,expression:"detail.status == 1 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dealwith()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("Maintenance.create Ticket"),visible:e.dialogFormVisible,width:"90vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project"),prop:"product"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("Maintenance.Please choose the product")},on:{change:e.prodChange},model:{value:e.form.product,callback:function(t){e.$set(e.form,"product",t)},expression:"form.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name"),prop:"name"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.Device.length,placeholder:0==e.Device.length?e.$translateTitle("Maintenance.Please choose the product"):e.$translateTitle("Maintenance.Please select a device")},on:{change:e.deviceChange},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},e._l(e.Device,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:e.objectId,expression:"item.objectId"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type"),prop:"type"}},[a("el-input",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")}},[a("el-upload",{attrs:{action:"#","auto-upload":!0,"http-request":e.myUpload,"list-type":"picture-card"}},[a("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"}),e._l(e.form.photo,(function(e,t){return a("div",{key:t},[a("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{alt:"",src:e.url}})])}))],2),a("el-dialog",{attrs:{"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{alt:"",src:e.dialogImageUrl,width:"100%"}})])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Create now"))+" ")]),a("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reset"))+" ")])],1)],1)],1)]),a("vab-query-form",{staticClass:"query-form"},[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.number")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.projects")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.project")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.type")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.status")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket status")},model:{value:e.queryForm.status,callback:function(t){e.$set(e.queryForm,"status",t)},expression:"queryForm.status"}},e._l(e.status,(function(t){return a("el-option",{key:t.key,attrs:{label:e.$translateTitle(t.text),value:t.key}})})),1),a("el-button",{attrs:{icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.fetchData}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")])],1),a("el-form-item",[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:e.handleFold}},[e.fold?a("span",[e._v(" "+e._s(e.$translateTitle("Maintenance.Unfold"))+" ")]):a("span",[e._v(e._s(e.$translateTitle("Maintenance.merge")))]),a("vab-icon",{staticClass:"vab-dropdown",class:{"vab-dropdown-active":e.fold},attrs:{icon:"arrow-up-s-line"}})],1)],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.fold,expression:"!fold"}]},[a("el-button",{attrs:{icon:"el-icon-circle-plus-outline",size:"mini",type:"primary"},on:{click:function(t){e.dialogFormVisible=!e.dialogFormVisible}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.create Ticket"))+" ")]),a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-s-promotion",size:"mini",type:"primary"},on:{click:function(t){return e.batchExport(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")]),a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-delete",size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(e.selectedList,1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.batch deletion"))+" ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:"",data:e.list,height:e.height,stripe:""},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[a("vab-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortable:"",width:"120"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.getStatus(a.status,a))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.project"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.productname?a.info.productname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.devicename?a.info.devicename:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.createdname?a.info.createdname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$moment(a.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("Maintenance.operating"),width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showInfo(r,!0,!1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==r.status,expression:"row.status == 1"}],attrs:{size:"mini",type:"success"},on:{click:function(t){return e.showInfo(r)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==r.status,expression:"row.status == 2"}],attrs:{size:"mini",type:"info"},on:{click:function(t){return e.showInfo(r)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Evaluation"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:3!=r.status,expression:"row.status != 3"}],attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(r,2)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.delete"))+" ")])]}}])})],1),a("vab-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},n=[],i=a("1da1"),s=a("5530"),o=(a("96cf"),a("d81d"),a("b0c0"),a("99af"),a("a4d3"),a("e01a"),a("d3b7"),a("159b"),a("ddb0"),a("0941")),l=a("dcc6"),c=a("1285"),u=a("5880"),d=a("5857"),m=a("1267"),p={name:"MyWork",components:{ChangeInfo:d["default"]},data:function(){return{created:0,Assigned:0,form:{receiveuseid:"",productname:"",devicename:"",createdname:"",receiveusername:"",receiveuserphone:"",name:"",product:"",type:"",description:"",photo:[],objectId:""},dialogFormVisible:!1,fold:!1,step:1,ishard:!1,height:this.$baseTableHeight(0)-30,isfooter:!0,detail:{},AllDevice:[],selectedList:[],types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择所属项目",trigger:"change"}],name:[{required:!0,message:"请选择设备",trigger:"change"}],type:[{required:!0,message:"请输入工单类型",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,status:[{key:0,text:"Maintenance.To be assigned"},{key:1,text:"Maintenance.Assigned"},{key:2,text:"Maintenance.Processed"},{key:3,text:"Maintenance.Statement"}],queryForm:{devicename:"",statusFlag:!1,status:"",number:"",product:"",type:"",pageNo:1,pageSize:20,searchDate:[],limt:10,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:Object(s["a"])(Object(s["a"])({},Object(u["mapGetters"])({_Product:"user/_Product",objectid:"user/objectId",role:"acl/role",username:"user/username"})),{},{_deviceFlag:{get:function(){return this.$store.state.global._deviceFlag},set:function(e){this.set_deviceFlag(e)}},aclObj:function(){var e={};return this.role.map((function(t){e["".concat("role:"+t.name)]={read:!0,write:!0}})),e}}),watch:{_deviceFlag:function(e){0==e&&this.fetchData()},"queryForm.status":function(e){this.queryForm.statusFlag=""!=e}},created:function(){},mounted:function(){this.handleCreated("created")},methods:Object(s["a"])(Object(s["a"])({myUpload:function(e){var t=this,a=e.file,r=a.name.substring(a.name.lastIndexOf(".")+1),n={file:a,path:"ticket",filename:"ticket"+"".concat(moment().format("x"),".").concat(r)};Object(m["UploadImg"])(n).then((function(e){e.data.url&&t.form.photo.push(e.data.url)})).catch((function(e){}))},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.createdTicket(t.form)}))},createdTicket:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r={},r[t.objectid]={read:!0,write:!0},n={number:moment(new Date).unix()+"",type:e.type,ACL:_.merge(r,t.aclObj),info:{photo:e.photo,timeline:[{timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"生成工单",p:"".concat(t.username,"新建工单")}],description:e.description,step1:{},step2:{},step3:{},step4:{},productid:e.product,productname:e.productname,devicename:e.devicename,deviceid:e.name,createdname:t.username,receiveusername:e.receiveusername,receiveuseid:e.receiveuseid,receiveuserphone:e.receiveuserphone},device:{objectId:e.name,__type:"Pointer",className:"Device"}},i=t.$baseColorfullLoading(),a.next=6,Object(o["create_object"])("Maintenance",n);case 6:a.sent,i.close(),t.fetchData(),t.dialogFormVisible=!1;case 10:case"end":return a.stop()}}),a)})))()},resetForm:function(e){this.$refs[e].resetFields()},changeBox:function(e){var t=this;this.selectedList=[],e.forEach((function(e){t.selectedList.push(e)}))}},Object(u["mapMutations"])({set_deviceFlag:"global/set_deviceFlag"})),{},{handleFold:function(){this.fold=!this.fold,this.handleHeight()},batchExport:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r={results:[]},r["results"]=e,a.next=5,Object(m["exlout"])(r);case 5:n=a.sent,t.$convertRes2Blob(n),t.$message.success(t.$translateTitle("node.export success")),a.next=13;break;case 10:a.prev=10,a.t0=a["catch"](0),t.$message.error(t.$translateTitle("node.export error")+"".concat(a.t0));case 13:case"end":return a.stop()}}),a,null,[[0,10]])})))()},handleDelete:function(e,t){var a=this,r=[];2==t?r.push({method:"DELETE",path:"/classes/Maintenance/".concat(e.objectId),body:{}}):e.forEach((function(e){r.push({method:"DELETE",path:"/classes/Maintenance/".concat(e.objectId),body:{}})})),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["batch"])(r);case 2:e.sent,a.$baseMessage(a.$translateTitle("Maintenance.successfully deleted"),"success","vab-hey-message-success"),setTimeout((function(){a.fetchData()}),1500);case 5:case"end":return e.stop()}}),e)}))))},handleHeight:function(){this.fold?this.height=this.$baseTableHeight(0)-20:this.height=this.$baseTableHeight(0)-30},getStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch(e){case 0:return this.$translateTitle("Maintenance.To be assigned");case 1:return this.$translateTitle("Maintenance.Assigned");case 2:return this.$translateTitle("Maintenance.Processed");case 3:return this.$translateTitle("Maintenance.Statement");default:return e}},showInfo:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.ishard=t,this.isfooter=a;var r=e.status,n=void 0===r?0:r;this.detail=e,this.step=n+1,this.set_deviceFlag(!0)},handleCreated:function(e){"created"==e?this.created++:this.Assigned++,this.fetchData()},fetchData:function(){var e=arguments,t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.length>0&&void 0!==e[0]?e[0]:{},n.limit||(n=t.queryForm),t.listLoading=!1,i=t.$baseColorfullLoading(),s={limit:n.limit,order:n.order,skip:n.skip,keys:n.keys,where:{"info.receiveuseid":t.Assigned%2==0?{$ne:"99"}:t.objectid,number:t.queryForm.number.length?{$regex:t.queryForm.number}:{$ne:null},status:t.queryForm.statusFlag?t.queryForm.status:{$ne:9},"info.productid":t.queryForm.product.length?t.queryForm.product:{$ne:"99"},type:t.queryForm.type.length?{$regex:t.queryForm.type}:{$ne:null}}},null!==(r=t.queryForm.searchDate)&&void 0!==r&&r.length&&(s.where["createdAt"]={$gt:{__type:"Date",iso:t.queryForm.searchDate[0]}},s.where["updatedAt"]={$lt:{__type:"Date",iso:t.queryForm.searchDate[1]}}),a.next=8,Object(o["query_object"])("Maintenance",s).then((function(e){var a=e.results,r=void 0===a?[]:a,n=e.count,s=void 0===n?0:n;t.list=r,t.list.forEach((function(e){if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(0)})),t.total=s,i.close()})).catch((function(e){t.$message.error("".concat(e)),i.close()}));case 8:case"end":return a.stop()}}),a)})))()},prodChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.Device=[],t._Product.map((function(a){a.objectId==e&&(t.form.productname=a.name)})),t.form.name="",r={where:{product:e}},a.next=6,Object(c["queryDevice"])(r);case 6:n=a.sent,i=n.results,t.Device=i;case 9:case"end":return a.stop()}}),a)})))()},deviceChange:function(e){var t=this;this.Device.map((function(a){a.objectId==e&&(t.form.devicename=a.name)}))},dispatch:function(){this.$refs.changeinfo.$refs.step1.dispatchUser()},backChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.objectId,n=e.info,n.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已回退",p:"".concat(t.username," 回退了流程")}),i={status:0,info:n},a.next=5,Object(o["update_object"])("Maintenance",r,i);case 5:s=a.sent,s.updatedAt&&t.set_deviceFlag(!1);case 7:case"end":return a.stop()}}),a)})))()},Reassign:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.objectId,n=e.info,n.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已改派",p:"".concat(t.username," 改派了工单")}),i={status:0,info:n},a.next=5,Object(o["update_object"])("Maintenance",r,i);case 5:s=a.sent,s.updatedAt&&t.set_deviceFlag(!1);case 7:case"end":return a.stop()}}),a)})))()},dealwith:function(){this.$refs.changeinfo.$refs.step2.dispatchUser()},check:function(){this.$refs.changeinfo.$refs.step3.dispatchUser()}})},f=p,h=(a("2c89"),a("2877")),b=Object(h["a"])(f,r,n,!1,null,"5365c4c1",null);t["default"]=b.exports},"43ee":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{"append-to-body":!0,title:e.title,visible:e.dialogFormVisible,width:"500px"},on:{"update:visible":function(t){e.dialogFormVisible=t},close:e.close},scopedSlots:e._u([{key:"footer",fn:function(){return[a("el-button",{on:{click:e.close}},[e._v(" 取 消 ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.save.apply(null,arguments)}}},[e._v(" 确 定 ")])]},proxy:!0}])},[a("el-form",{ref:"form",attrs:{"label-width":"80px",model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:"标题",prop:"title"}},[a("el-input",{model:{value:e.form.title,callback:function(t){e.$set(e.form,"title","string"===typeof t?t.trim():t)},expression:"form.title"}})],1),a("el-form-item",{attrs:{label:"作者",prop:"author"}},[a("el-input",{model:{value:e.form.author,callback:function(t){e.$set(e.form,"author","string"===typeof t?t.trim():t)},expression:"form.author"}})],1)],1)],1)},n=[],i=a("1da1"),s=(a("96cf"),a("8456")),o={name:"TableEdit",data:function(){return{form:{title:"",author:""},rules:{title:[{required:!0,trigger:"blur",message:"请输入标题"}],author:[{required:!0,trigger:"blur",message:"请输入作者"}]},title:"",dialogFormVisible:!1}},created:function(){},methods:{showEdit:function(e){e?(this.title="编辑",this.form=Object.assign({},e)):this.title="添加",this.dialogFormVisible=!0},close:function(){this.$refs["form"].resetFields(),this.form=this.$options.data().form,this.dialogFormVisible=!1},save:function(){var e=this;this.$refs["form"].validate(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(a){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!a){t.next=8;break}return t.next=3,Object(s["doEdit"])(e.form);case 3:r=t.sent,n=r.msg,e.$baseMessage(n,"success","vab-hey-message-success"),e.$emit("fetch-data"),e.close();case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},l=o,c=a("2877"),u=Object(c["a"])(l,r,n,!1,null,null,null);t["default"]=u.exports},"448c":function(e,t,a){},"45e7":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mycontainer"},[a("div",{staticClass:"ticker-dialog"},[a("el-dialog",{directives:[{name:"drag",rawName:"v-drag"}],attrs:{"append-to-body":!0,visible:e.parserView},on:{"update:visible":function(t){e.parserView=t}}},[a("ele-form",e._b({attrs:{config:e.formConfig,pure:"","request-fn":e.handleSubmit},on:{"request-success":function(t){return e.handleSuccess(e.alertConfig)}},model:{value:e.alertConfig.config,callback:function(t){e.$set(e.alertConfig,"config",t)},expression:"alertConfig.config"}},"ele-form",e.alertConfig.config,!1))],1),a("el-dialog",{directives:[{name:"drag",rawName:"v-drag"}],attrs:{"append-to-body":!0,visible:e.dynamicformView,width:"50vh"},on:{"update:visible":function(t){e.dynamicformView=t}}},[a("el-form",[a("el-form-item",{attrs:{label:"设备名称","label-width":"200"}},[a("span",[e._v(e._s(e.devicename))])])],1),e._l(e.dynamicformInfo,(function(t){return a("el-form",{key:t.key,ref:"dynamicformInfo",refInFor:!0},[a("el-form-item",{attrs:{label:t.key}},[a("el-link",{attrs:{type:"success"}},[e._v(" "+e._s(t.value)+" ")])],1)],1)})),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-form",[a("el-form-item",{attrs:{label:e.$translateTitle("alert.Alarm status")}},[a("el-radio",{attrs:{label:"1"},model:{value:e.status,callback:function(t){e.status=t},expression:"status"}},[e._v("已处理")]),a("el-radio",{attrs:{label:"2"},model:{value:e.status,callback:function(t){e.status=t},expression:"status"}},[e._v("误报")])],1),a("el-form-item",{attrs:{label:e.$translateTitle("alert.Alarm handling"),"label-width":"200"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.process,callback:function(t){e.process=t},expression:"process"}})],1)],1),a("el-button",{on:{click:function(t){e.dynamicformView=!1}}},[e._v(" "+e._s(e.$translateTitle("button.cancel"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitAlert(e.alertId)}}},[e._v(" "+e._s(e.$translateTitle("button.submit"))+" ")])],1)],2)],1),a("vab-query-form",{staticClass:"query-form"},[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm,size:"mini"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("alert.productname")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("equipment.entername")},model:{value:e.queryForm.productName,callback:function(t){e.$set(e.queryForm,"productName",t)},expression:"queryForm.productName"}},e._l(e._Product,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("alert.isprocess")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("alert.isprocess")},model:{value:e.queryForm.isprocess,callback:function(t){e.$set(e.queryForm,"isprocess",t)},expression:"queryForm.isprocess"}},e._l(e.processAll,(function(e,t){return a("el-option",{key:t,attrs:{label:e.key,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search",type:"primary"},nativeOn:{click:function(t){return e.fetchData.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")])],1),a("el-form-item",[a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-delete",type:"danger"},on:{click:function(t){return e.fetchDelete(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.delete"))+" ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{data:e.list,height:e.height},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[a("vab-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("alert.alert number"),prop:"objectId","show-overflow-tooltip":"",sortablesortable:"",width:"120"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("alert.productname"),prop:"productname","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("alert.devicename"),prop:"devicename","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.createdAt"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$moment(a.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("alert.Alarm status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-tag",{attrs:{effect:"dark",type:r.alertstatus?"danger":"success"}},[e._v(" "+e._s(r.alertstatus?e.$translateTitle("alert.start"):e.$translateTitle("alert.stop"))+" ")])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("alert.Alarm handling"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-link",{attrs:{effect:"dark",type:1==r.status?"success":"info"}},[e._v(" "+e._s(1==r.status?e.$translateTitle("Maintenance.Processed"):0==r.status?e.$translateTitle("Maintenance.Untreated"):e.$translateTitle("Maintenance.Distort"))+" ")])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("alert.process"),prop:"process","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.operating"),prop:"name","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showdynamicform(r.objectId,r.Public,r.dynamicform,r.process,r.status,r.devicename)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(r.objectId)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.delete"))+" ")])]}}])})],1),a("VabPagination",{directives:[{name:"show",rawName:"v-show",value:e.total,expression:"total"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},n=[],i=a("3835"),s=a("1da1"),o=a("5530"),l=(a("96cf"),a("d3b7"),a("159b"),a("a9e3"),a("ac1f"),a("1276"),a("99af"),a("d81d"),a("ddb0"),a("b0c0"),a("a434"),a("4569")),c=a("dcc6"),u=a("7212"),d=a("5880"),m=a("4be7"),p={name:"Index",components:{},data:function(){return{selectedList:[],isDisable:!1,parserView:!1,dynamicformView:!1,formConfig:{},alertConfig:{},dynamicformInfo:{},alertId:"",step:1,detail:{},deviceFlag:!1,AllDevice:[],height:this.$baseTableHeight(0),dialogFormVisible:!1,types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",process:"",status:"",devicename:"",rules:{product:[{required:!0,message:"请选择活动区域",trigger:"change"}],name:[{required:!0,message:"请选择活动区域",trigger:"change"}],type:[{required:!0,message:"请选择活动资源",trigger:"change"}]},processAll:[{key:"未处理",value:0},{key:"已处理",value:1},{key:"误报",value:2}],list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,queryForm:{productName:"",isprocess:"",number:"",product:"",type:"",searchDate:[],limit:20,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:Object(o["a"])({},Object(d["mapGetters"])({_Product:"user/_Product",objectId:"user/objectId",role:"acl/role",username:"user/username"})),created:function(){},mounted:function(){this.fetchData()},methods:{fetchDelete:function(e){var t=this,a=[];e.forEach((function(e){a.push({method:"DELETE",path:"/classes/Notification/".concat(e.objectId),body:{}})})),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(c["batch"])(a);case 2:e.sent,t.$baseMessage(t.$translateTitle("Maintenance.successfully deleted"),"success","vab-hey-message-success"),setTimeout((function(){t.fetchData()}),1500);case 5:case"end":return e.stop()}}),e)}))))},handleSubmit:function(e){return m["Promise"].resolve()},handleSuccess:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r,n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(r=e.table,n={public:!0},r){a.next=4;break}return a.abrupt("return");case 4:return i=t.$baseColorfullLoading(3),a.prev=5,a.next=8,t.$update_object(r,t.alertId,n);case 8:a.sent,i.close(),a.next=16;break;case 12:a.prev=12,a.t0=a["catch"](5),i.close(),t.$message.error("".concat(a.t0));case 16:t.$nextTick((function(){t.parserView=!1,t.fetchData()}));case 17:case"end":return a.stop()}}),a,null,[[5,12]])})))()},changeBox:function(e){var t=this;this.selectedList=[],e.forEach((function(e){t.selectedList.push(e)}))},submitAlert:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=t.$baseColorfullLoading(4),r.close(),n={process:t.process,status:Number(t.status)},a.prev=3,a.next=6,Object(l["putNotification"])(e,n);case 6:a.sent,t.$message.success("处理成功"),a.next=13;break;case 10:a.prev=10,a.t0=a["catch"](3),t.$message.error("处理失败");case 13:t.fetchData(),t.dynamicformView=!1;case 15:case"end":return a.stop()}}),a,null,[[3,10]])})))()},showdynamicform:function(e,t,a,r,n,i){this.alertId=e,this.isDisable=t,this.process=r,this.status=String(n),this.devicename=i;var s=[];for(var o in a)for(var l in a[o]){var c={key:l,value:a[o][l]};s.push(c)}this.dynamicformInfo=s,this.dynamicformView=!0},showInfo:function(e,t,a){var r=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var s,o,l,c,d,m,p,f,h,b,v,g,y;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return s=r.$baseColorfullLoading(4),o=e.split("_"),l=Object(i["a"])(o,2),c=l[0],d=l[1],r.alertId=a,n.prev=3,n.next=6,Object(u["getProduct"])(c);case 6:m=n.sent,p=m.config,s.close(),f=p.parser,h=void 0===f?[]:f,b=p.profile,v=void 0===b?[]:b,g=[].concat(v,h),y=g.map((function(e){if(e.uid==d)return e})),r.formConfig=y[0].config,r.alertConfig=y[0],n.next=20;break;case 16:n.prev=16,n.t0=n["catch"](3),s.close(),r.$message.error("".concat(n.t0));case 20:r.formConfig=_.merge(t,r.formConfig),r.$nextTick((function(){r.parserView=!0}));case 22:case"end":return n.stop()}}),n,null,[[3,16]])})))()},handleDelete:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(l["delNotification"])(e);case 2:r=a.sent,r=={}&&t.$message.success(t.$translateTitle("Maintenance.delete")+$translateTitle("message.success")),t.fetchData();case 5:case"end":return a.stop()}}),a)})))()},fetchData:function(){var e=arguments,t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r,n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.length>0&&void 0!==e[0]?e[0]:{},r.limit||(r=t.queryForm),t.listLoading=!1,n=t.$baseColorfullLoading(3),i={limit:r.limit,order:r.order,skip:r.skip,keys:r.keys,productid:t.queryForm.productName?t.queryForm.productName:"all",isprocess:t.queryForm.isprocess,include:"",where:{objectId:t.queryForm.number.length?{$regex:t.queryForm.number}:{$ne:null}}},t.queryForm.searchDate.length&&(i.where["createdAt"]={$gt:{__type:"Date",iso:t.queryForm.searchDate[0]}},i.where["updatedAt"]={$lt:{__type:"Date",iso:t.queryForm.searchDate[1]}}),a.next=8,Object(l["queryNotification"])(i).then((function(e){var a=e.results,r=void 0===a?[]:a,i=e.count,s=void 0===i?0:i;t.list=r,t.total=s,n.close()})).catch((function(e){t.$message.error("".concat(e)),n.close()}));case 8:case"end":return a.stop()}}),a)})))()},prodChange:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r,n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.Device=[],r={where:{product:e}},a.next=4,queryDevice(r);case 4:n=a.sent,i=n.results,t.Device=i;case 7:case"end":return a.stop()}}),a)})))()},handleRemove:function(e){var t=this;this.form.photo.forEach((function(a,r){a.split("/")["".concat(a.split("/").length-1)]==e.name&&t.form.photo.splice(r,1)}))},handleSizeChange:function(e){this.queryForm.limit=e,this.fetchData()},handleCurrentChange:function(e){this.queryForm.skip=(e-1)*this.queryForm.limit,this.fetchData()}}},f=p,h=(a("5f5e"),a("2877")),b=Object(h["a"])(f,r,n,!1,null,"9a3f9eea",null);t["default"]=b.exports},4901:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("Maintenance.Work order information"),name:"first"}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,size:"medium "}},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project")+": "}},[a("span",[e._v(e._s(e.form.info.productname))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name")+": "}},[a("span",[e._v(e._s(e.form.info.createdname))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Initiator")+": "}},[a("span",[e._v(e._s(e.form.info.createdname))])])],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")+": "}},[a("el-input",{attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),readonly:"",type:"textarea"},model:{value:e.form.info.description,callback:function(t){e.$set(e.form.info,"description",t)},expression:"form.info.description"}})],1)],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")+": "}},[a("el-carousel",{attrs:{height:"200px",interval:2e3,type:"card"}},e._l(e.form.info.photo,(function(e,t){return a("el-carousel-item",{key:t},[a("img",{staticStyle:{width:"100%",height:"100%"},attrs:{alt:e,src:e,title:e}})])})),1)],1)],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Processing records")+": "}},[a("el-input",{staticStyle:{margin:"0 0 10px"},attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),readonly:"",size:"1",type:"textarea"},model:{value:e.form.info.step2.Remarks,callback:function(t){e.$set(e.form.info.step2,"Remarks",t)},expression:"form.info.step2.Remarks"}})],1)],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Evaluation description")+": "}},[a("el-input",{attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),readonly:"",type:"textarea"},model:{value:e.form.info.step3.Remarks,callback:function(t){e.$set(e.form.info.step3,"Remarks",t)},expression:"form.info.step3.Remarks"}})],1)],1)],1)],1)],1),a("el-tab-pane",{staticStyle:{height:"90%","overflow-x":"hidden","overflow-y":"auto"},attrs:{label:e.$translateTitle("Maintenance.work process"),name:"second"}},[a("el-card",{attrs:{shadow:"hover"},scopedSlots:e._u([{key:"header",fn:function(){return[a("el-radio-group",{staticClass:"card-header-radio",model:{value:e.reverse,callback:function(t){e.reverse=t},expression:"reverse"}},[a("el-radio",{attrs:{label:!0}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Positive order"))+" ")]),a("el-radio",{attrs:{label:!1}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reverse order"))+" ")])],1)]},proxy:!0}])},[a("el-timeline",{attrs:{reverse:e.reverse}},e._l(e.form.info.timeline,(function(t){return a("el-timeline-item",{key:t.timestamp,attrs:{placement:"top",timestamp:t.timestamp}},[a("el-card",[a("h4",[e._v(e._s(t.h4))]),a("p",[e._v(e._s(t.p))])])],1)})),1)],1)],1)],1)],1)},n=[],i={props:{detail:{type:Object,default:function(){}}},data:function(){return{reverse:!0,activeName:"first",form:this.detail}}},s=i,o=(a("6e6c"),a("2877")),l=Object(o["a"])(s,r,n,!1,null,"320e87a6",null);t["default"]=l.exports},"4df8":function(e,t,a){"use strict";a("19cb")},"4e23":function(e,t,a){"use strict";a("b101")},5857:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.detail?a("div",{staticClass:"changeInfo"},[a("el-row",{directives:[{name:"show",rawName:"v-show",value:1==e.showHard,expression:"showHard == true"}],staticClass:"row-bg",attrs:{justify:"space-around",type:"flex"}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v(" "+e._s(e.$translateTitle("Maintenance.Ticket number"))+" : "+e._s(e.detail.number)+" ")])]),a("el-col",{attrs:{span:5}},[a("div",{staticClass:"grid-content bg-purple-light"},[e._v(" "+e._s(e.$translateTitle("Maintenance.Ticket type"))+" : "+e._s(e.detail.type)+" ")])]),a("el-col",{attrs:{span:7}},[a("div",{staticClass:"grid-content bg-purple"},[e._v(" "+e._s(e.$translateTitle("Maintenance.the starting time"))+" : "+e._s(e.$moment(e.detail.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")])])],1),a("el-steps",{directives:[{name:"show",rawName:"v-show",value:1==e.showHard,expression:"showHard == true"}],staticClass:"steps",attrs:{active:e.step,"finish-status":"success",simple:""}},[a("el-step",{attrs:{title:e.$translateTitle("Maintenance.To be assigned")}}),a("el-step",{attrs:{title:e.$translateTitle("Maintenance.Assigned")}}),a("el-step",{attrs:{title:e.$translateTitle("Maintenance.Processed")}}),a("el-step",{attrs:{title:e.$translateTitle("Maintenance.Statement")}})],1),1===e.step?a("step1",{ref:"step1",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":e.showHard,step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),2===e.step?a("step2",{ref:"step2",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),3===e.step?a("step3",{ref:"step3",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),4===e.step?a("Step4",{ref:"step4",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e()],1):a("div",{staticClass:"empty"},[a("vab-empty")],1)},n=[],i=(a("a9e3"),a("c7e3")),s=a("f715"),o=a("926e"),l=a("4901"),c={name:"ChangeInfo",components:{Step1:i["default"],Step2:s["default"],Step3:o["default"],Step4:l["default"]},props:{detail:{type:Object,default:function(){}},showFooter:{type:Boolean,default:!1},showHard:{type:Boolean,default:!1},step:{type:Number,default:1}},data:function(){return{isStep:0}},mounted:function(){4==this.step&&(this.isStep=4)},methods:{next:function(){this.isStep++>5&&(this.isStep=0)},handleSetStep:function(e,t){t&&(this.form=Object.assign(this.form,t))}}},u=c,d=(a("b30d"),a("2877")),m=Object(d["a"])(u,r,n,!1,null,"da9958fe",null);t["default"]=m.exports},"590c":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"logs logs-container",class:{"vab-fullscreen":e.isFullscreen}},[a("vab-query-form",[a("vab-query-form-top-panel",[a("el-form",{ref:"form",attrs:{inline:!0,"label-width":"100px",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{staticClass:"item-time",attrs:{label:e.$translateTitle("device.Log type")}},[a("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:e.queryForm.domain,callback:function(t){e.$set(e.queryForm,"domain",t)},expression:"queryForm.domain"}},e._l(e.domainOptions,(function(t){return a("el-option",{key:t,attrs:{label:e.$translateTitle("deviceLog."+t),value:t}})})),1)],1),a("el-form-item",{staticClass:"item-time",attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{staticClass:"item-time-picker",attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.isDeviceInfo,expression:"!isDeviceInfo"}],attrs:{label:e.$translateTitle("equipment.Products")}},[a("el-select",{attrs:{clearable:""},model:{value:e.queryForm.productid,callback:function(t){e.$set(e.queryForm,"productid",t)},expression:"queryForm.productid"}},e._l(e.proTableData,(function(t,r){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=t.objectId,expression:"item.objectId != 0"}],key:r,attrs:{label:e.$translateTitle("deviceLog."+t.name),value:t.objectId}})})),1)],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.isDeviceInfo,expression:"!isDeviceInfo"}],attrs:{label:e.$translateTitle("equipment.devicenumber")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("equipment.enterdevicenumber")},model:{value:e.queryForm.devaddr,callback:function(t){e.$set(e.queryForm,"devaddr",t)},expression:"queryForm.devaddr"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},on:{click:function(t){return e.queryTable({})}}}),a("el-button",{staticStyle:{margin:"0 10px 10px 10px !important"},attrs:{type:"success"},on:{click:e.handleHeight}},[a("vab-icon",{attrs:{icon:e.isFullscreen?"fullscreen-exit-fill":"fullscreen-fill"}})],1),a("el-popover",{attrs:{trigger:"hover"},scopedSlots:e._u([{key:"reference",fn:function(){return[a("el-button",{staticStyle:{margin:"0 0 10px 0 !important"},attrs:{icon:"el-icon-setting",type:"primary"}},[e._v(" "+e._s(e.$translateTitle("Logs.Draggable column settings"))+" ")])]},proxy:!0}])},[a("el-checkbox-group",{model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},[a("vue-draggable",e._b({attrs:{list:e.logcolumns}},"vue-draggable",e.dragOptions,!1),e._l(e.logcolumns,(function(t,r){return a("div",{key:t+r},[a("vab-icon",{attrs:{icon:"drag-drop-line"}}),a("el-checkbox",{attrs:{disabled:!0===t.disableCheck,label:t}},[e._v(" "+e._s(e.$translateTitle("deviceLog."+t))+" ")])],1)})),0)],1)],1)],1)],1)],1)],1),a("el-dialog",{attrs:{"append-to-body":"",visible:e.preDialog},on:{"update:visible":function(t){e.preDialog=t}}},[a("vab-editor",{key:e.refreshFlag,attrs:{height:(e.isFullscreen,Number(e.$baseTableHeight(1))),lang:"json","max-lines":(e.isFullscreen,Number(e.$baseTableHeight(1))/12),"min-lines":(e.isFullscreen,Number(e.$baseTableHeight(1))/12),theme:"gob"},model:{value:e.msg,callback:function(t){e.msg=t},expression:"msg"}})],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],key:e.finallyColumns.length+e.momentKey,ref:"dragTable",staticClass:"block",attrs:{border:"",data:e.logdata,"element-loading-background":"rgba(0, 0, 0, 0.8)","element-loading-spinner":"el-icon-loading","element-loading-text":e.$translateTitle("developer.Waitingtoreturn"),height:e.height,"highlight-current-row":"",resizable:"","row-class-name":e.tableRowClassName,size:"mini",stripe:""},scopedSlots:e._u([{key:"empty",fn:function(){return[a("vab-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-descriptions",{staticClass:"margin-top",attrs:{border:"",column:2,size:e.size}},e._l(t.row,(function(t,r,n){return a("el-descriptions-item",{key:n,attrs:{label:e.$translateTitle("deviceLog."+r),"label-class-name":"my-label"}},[e._v(" "+e._s(t)+" ")])})),1)]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("device.Log type")},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$translateTitle("deviceLog."+a.domain))+" ")]}}])}),e._l(e.finallyColumns,(function(t,r){return a("el-table-column",{key:r,attrs:{align:"center",label:e.$translateTitle("deviceLog."+t),prop:t,"show-overflow-tooltip":"",sortable:""}})})),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("concentrator.operation")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.showDetail(r)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.detail"))+" ")])]}}])})],2),a("vab-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.queryForm.total>0,expression:"queryForm.total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.queryForm.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.queryTable}})],1)},n=[],i=a("1da1"),s=(a("96cf"),a("4de4"),a("d3b7"),a("caad"),a("2532"),a("a434"),a("e9c4"),a("159b"),a("a9e3"),a("25f0"),a("d292")),o=a("7212"),l={name:"AccessLog",props:{productid:{type:String,default:""},devaddr:{type:String,default:""},deviceid:{type:String,default:""},isDeviceInfo:{type:Boolean,default:!0}},data:function(){return{preDialog:!1,msg:"",loading:!1,size:"",domainOptions:["device_statuslog","device_operationlog","transparent","event","tcp_send","tcp_receive","readProperty","writeProperty","reportProperty","child","childReply","functionInvoke","readPropertyReply","writePropertyReply","functionReply","register","unregister","offline","online","other","parse_api"],isFullscreen:!1,height:this.$baseTableHeight(2),logdata:[],refreshFlag:moment(new Date).valueOf(),momentKey:moment(new Date).valueOf(),checkList:["time","msg"],logcolumns:["devaddr","time","msg","username","productname","devicename","status","protocol","thingname","identifier","value"],proTableData:[],activeName:"second",queryForm:{total:0,count:"objectId",limit:20,pageNo:1,pageSize:20,skip:0,level:"",peername:"",pid:"",mfa:"",topic:"",domain:[],searchDate:[moment().subtract("days",7).format("YYYY-MM-DD"),moment(new Date).format("YYYY-MM-DD")],order:"-createdAt",keys:"count(*)",productid:"",devaddr:""}}},computed:{dragOptions:function(){return{animation:600,group:"description"}},finallyColumns:function(){var e=this;return this.logcolumns.filter((function(t){return e.checkList.includes(t)}))}},created:function(){},mounted:function(){this.productid&&(this.queryForm.productid=this.productid),this.deviceid&&(this.queryForm.deviceid=this.deviceid),this.$route.query.deviceid&&(this.queryForm.deviceid=this.$route.query.deviceid),this.queryTable({}),this.rowDrop(),this.queryProduct(),this.columnDrop()},methods:{queryProduct:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.proTableData=[],t.next=3,Object(o["queryProduct"])({count:"objectId",order:"-updatedAt",where:{category:"IotHub"}});case 3:a=t.sent,r=a.results,n=void 0===r?[]:r,e.proTableData=n;case 7:case"end":return t.stop()}}),t)})))()},handleHeight:function(){this.isFullscreen=!this.isFullscreen,this.isFullscreen?this.height=this.$baseTableHeight(0)+120:this.height=this.$baseTableHeight(0),this.momentKey=moment(new Date).valueOf()},tableRowClassName:function(e){var t=e.row;return t.disabled?"disabled":""},rowDrop:function(){var e=this.$refs.dragTable.$el.querySelector(".el-table__body-wrapper tbody"),t=this;Sortable.create(e,{draggable:".el-table__row",onEnd:function(e){var a=e.newIndex,r=e.oldIndex,n=t.logdata.splice(r,1)[0];t.logdata.splice(a,0,n)}})},columnDrop:function(){var e=this,t=this.$refs.dragTable.$el.querySelector(".el-table__header-wrapper tr");e.sortable=Sortable.create(t,{animation:180,delay:0,onEnd:function(t){var a=e.finallyColumns[t.oldIndex];e.finallyColumns.splice(t.oldIndex,1),e.finallyColumns.splice(t.newIndex,0,a),e.momentKey=moment(new Date).valueOf(),setTimeout((function(){e.rowDrop(),e.columnDrop()}),1500)}})},showDetail:function(e){this.preDialog=!0,this.msg=JSON.stringify(e,null,2),this.refreshFlag=moment(new Date).valueOf()},queryTable:function(){var e=arguments,t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,o,l,c,u,d;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.length>0&&void 0!==e[0]?e[0]:{},t.loading=!0,r.limit||(r=t.queryForm),n=t.$baseColorfullLoading(),a.prev=4,n.close(),i={limit:r.limit,skip:r.skip,order:r.order,count:t.queryForm.count,include:"",where:{deviceid:t.deviceid?t.deviceid:"",domain:t.queryForm.domain.length?{$in:t.queryForm.domain}:{$ne:""},createdAt:{$gte:{__type:"Date",iso:"".concat(t.queryForm.searchDate[0],"T00:00:00.000Z")},$lte:{__type:"Date",iso:"".concat(t.queryForm.searchDate[1],"T23:59:59.000Z")}}}},a.next=9,Object(s["queryLog"])(i);case 9:o=a.sent,l=o.results,c=void 0===l?[]:l,u=o.count,d=void 0===u?0:u,c.forEach((function(e){if(e.time=t.$moment(Number(e.time.toString().substring(0,13))).format("YYYY-MM-DD HH:mm:ss"),"text"!=e.type){var a=JSON.parse(e.msg);for(var r in a)e[r]=a[r]}})),t.logdata=c,t.queryForm.total=d,t.$baseMessage(t.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),n.close(),a.next=25;break;case 21:a.prev=21,a.t0=a["catch"](4),n.close(),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 25:t.loading=!1;case 26:case"end":return a.stop()}}),a,null,[[4,21]])})))()}}},c=l,u=(a("1944"),a("2877")),d=Object(u["a"])(c,r,n,!1,null,"b6e07176",null);t["default"]=d.exports},"5a05":function(e,t,a){},"5f5e":function(e,t,a){"use strict";a("251c")},"61a4":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mycontainer"},[a("div",{staticClass:"ticker-dialog"},[a("div",{staticClass:"home_dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e.showdeviceFlag,width:"100vh"},on:{"update:visible":function(t){e.showdeviceFlag=t}}},[a("change-step",{ref:"ChangeStep",attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:3!=e.detail.status,expression:"detail.status != 3"}],attrs:{type:"primary"},on:{click:function(t){return e.check()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.check"))+" ")])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("Maintenance.create Ticket"),visible:e.dialogFormVisible,width:"90vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project"),prop:"product"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("Maintenance.Please choose the product")},on:{change:e.prodChange},model:{value:e.form.product,callback:function(t){e.$set(e.form,"product",t)},expression:"form.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name"),prop:"name"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.Device.length,placeholder:0==e.Device.length?e.$translateTitle("Maintenance.Please choose the product"):e.$translateTitle("Maintenance.Please select a device")},on:{change:e.deviceChange},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},e._l(e.Device,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:e.objectId,expression:"item.objectId"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type"),prop:"type"}},[a("el-input",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")}},[a("el-upload",{attrs:{action:"#","auto-upload":!0,"http-request":e.myUpload,"list-type":"picture-card"}},[a("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"}),e._l(e.form.photo,(function(e,t){return a("div",{key:t},[a("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{alt:"",src:e.url}})])}))],2),a("el-dialog",{attrs:{"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{alt:"",src:e.dialogImageUrl,width:"100%"}})])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Create now"))+" ")]),a("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reset"))+" ")])],1)],1)],1)]),a("vab-query-form",{staticClass:"query-form"},[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.number")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.projects")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.project")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.type")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.fetchData}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")]),a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-s-promotion",size:"mini",type:"primary"},on:{click:function(t){return e.batchExport(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:"",data:e.list,height:e.height,stripe:""},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[a("vab-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortable:"",width:"120"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.getStatus(a.status,a))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.project"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.productname?a.info.productname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.devicename?a.info.devicename:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.createdname?a.info.createdname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$moment(a.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("Maintenance.operating"),width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showInfo(r,!0,!1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==r.status,expression:"row.status == 2"}],attrs:{size:"mini",type:"info"},on:{click:function(t){return e.showInfo(r,!0)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Evaluation"))+" ")])]}}])})],1),a("vab-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},n=[],i=a("1da1"),s=a("5530"),o=(a("96cf"),a("d81d"),a("b0c0"),a("a4d3"),a("e01a"),a("d3b7"),a("159b"),a("ddb0"),a("0941")),l=a("dcc6"),c=a("1285"),u=a("5880"),d=a("2ec0"),m=a("1267"),p={name:"EvaluationTicket",components:{ChangeStep:d["default"]},data:function(){return{showdeviceFlag:!1,created:0,Assigned:0,form:{receiveuseid:"",productname:"",devicename:"",createdname:"",receiveusername:"",receiveuserphone:"",name:"",product:"",type:"",description:"",photo:[],objectId:""},dialogFormVisible:!1,fold:!1,step:1,ishard:!1,height:this.$baseTableHeight(0)-30,isfooter:!0,detail:{},AllDevice:[],selectedList:[],types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择所属项目",trigger:"change"}],name:[{required:!0,message:"请选择设备",trigger:"change"}],type:[{required:!0,message:"请输入工单类型",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,status:[{key:0,text:"Maintenance.To be assigned"},{key:1,text:"Maintenance.Assigned"},{key:2,text:"Maintenance.Processed"},{key:3,text:"Maintenance.Statement"}],queryForm:{devicename:"",statusFlag:!1,status:"",number:"",product:"",type:"",pageNo:1,pageSize:20,searchDate:[],limt:10,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:Object(s["a"])(Object(s["a"])({},Object(u["mapGetters"])({_Product:"user/_Product",objectid:"user/objectId",role:"acl/role",username:"user/username"})),{},{_deviceStep:{get:function(){return this.$store.state.global._deviceStep},set:function(e){this.set_deviceStep(e)}},aclObj:function(){var e={};return this.role.map((function(t){e["".concat("role:"+t.name)]={read:!0,write:!0}})),e}}),watch:{_deviceStep:function(e){-1==e&&(this.showdeviceFlag=!1,this.fetchData())},"queryForm.status":function(e){this.queryForm.statusFlag=""!=e}},created:function(){},mounted:function(){this.handleCreated("created")},methods:Object(s["a"])(Object(s["a"])({myUpload:function(e){var t=this,a={headers:{proxy:!0,produrl:"/",devurl:"iotapi/"}};Object(m["UploadImg"])(e.file,a).then((function(e){e.data.url&&t.form.photo.push(e.data.url)})).catch((function(e){}))},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.createdTicket(t.form)}))},createdTicket:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r={},r[t.objectid]={read:!0,write:!0},n={number:moment(new Date).unix()+"",type:e.type,ACL:_.merge(r,t.aclObj),info:{photo:e.photo,timeline:[{timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"生成工单",p:"".concat(t.username,"新建工单")}],description:e.description,step1:{},step2:{},step3:{},step4:{},productid:e.product,productname:e.productname,devicename:e.devicename,deviceid:e.name,createdname:t.username,receiveusername:e.receiveusername,receiveuseid:e.receiveuseid,receiveuserphone:e.receiveuserphone},device:{objectId:e.name,__type:"Pointer",className:"Device"}},i=t.$baseColorfullLoading(),a.next=6,Object(o["create_object"])("Maintenance",n);case 6:a.sent,i.close(),t.fetchData(),t.dialogFormVisible=!1;case 10:case"end":return a.stop()}}),a)})))()},resetForm:function(e){this.$refs[e].resetFields()},changeBox:function(e){var t=this;this.selectedList=[],e.forEach((function(e){t.selectedList.push(e)}))}},Object(u["mapMutations"])({set_deviceStep:"global/set_deviceStep"})),{},{handleFold:function(){this.fold=!this.fold,this.handleHeight()},batchExport:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r={results:[]},r["results"]=e,a.next=5,Object(m["exlout"])(r);case 5:n=a.sent,t.$convertRes2Blob(n),t.$message.success(t.$translateTitle("node.export success")),a.next=13;break;case 10:a.prev=10,a.t0=a["catch"](0),t.$message.error(t.$translateTitle("node.export error")+"".concat(a.t0));case 13:case"end":return a.stop()}}),a,null,[[0,10]])})))()},handleDelete:function(e,t){var a=this,r=[];2==t?r.push({method:"DELETE",path:"/classes/Maintenance/".concat(e.objectId),body:{}}):e.forEach((function(e){r.push({method:"DELETE",path:"/classes/Maintenance/".concat(e.objectId),body:{}})})),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["batch"])(r);case 2:e.sent,a.$baseMessage(a.$translateTitle("Maintenance.successfully deleted"),"success","vab-hey-message-success"),setTimeout((function(){a.fetchData()}),1500);case 5:case"end":return e.stop()}}),e)}))))},handleHeight:function(){this.fold?this.height=this.$baseTableHeight(0)-20:this.height=this.$baseTableHeight(0)-30},getStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch(e){case 0:return this.$translateTitle("Maintenance.To be assigned");case 1:return this.$translateTitle("Maintenance.Assigned");case 2:return this.$translateTitle("Maintenance.Processed");case 3:return this.$translateTitle("Maintenance.Statement");default:return e}},showInfo:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.showdeviceFlag=!1,this.ishard=t,this.isfooter=a;var r=e.status,n=void 0===r?0:r;this.detail=e,this.step=n+1,this.showdeviceFlag=!0,this.set_deviceStep(n)},handleCreated:function(e){"created"==e?this.created++:this.Assigned++,this.fetchData()},fetchData:function(){var e=arguments,t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.length>0&&void 0!==e[0]?e[0]:{},n.limit||(n=t.queryForm),t.listLoading=!1,i=t.$baseColorfullLoading(),s={limit:n.limit,order:n.order,skip:n.skip,keys:n.keys,where:{"info.receiveuseid":t.Assigned%2==0?{$ne:"99"}:t.objectid,number:t.queryForm.number.length?{$regex:t.queryForm.number}:{$ne:null},status:{$gte:2},"info.productid":t.queryForm.product.length?t.queryForm.product:{$ne:"99"},type:t.queryForm.type.length?{$regex:t.queryForm.type}:{$ne:null}}},null!==(r=t.queryForm.searchDate)&&void 0!==r&&r.length&&(s.where["createdAt"]={$gt:{__type:"Date",iso:t.queryForm.searchDate[0]}},s.where["updatedAt"]={$lt:{__type:"Date",iso:t.queryForm.searchDate[1]}}),a.next=8,Object(o["query_object"])("Maintenance",s).then((function(e){var a=e.results,r=void 0===a?[]:a,n=e.count,s=void 0===n?0:n;t.list=r,t.list.forEach((function(e){if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(0)})),t.total=s,i.close()})).catch((function(e){t.$message.error("".concat(e)),i.close()}));case 8:case"end":return a.stop()}}),a)})))()},prodChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.Device=[],t._Product.map((function(a){a.objectId==e&&(t.form.productname=a.name)})),t.form.name="",r={where:{product:e}},a.next=6,Object(c["queryDevice"])(r);case 6:n=a.sent,i=n.results,t.Device=i;case 9:case"end":return a.stop()}}),a)})))()},deviceChange:function(e){var t=this;this.Device.map((function(a){a.objectId==e&&(t.form.devicename=a.name)}))},dispatch:function(){this.$refs.ChangeStep.$refs.step1.dispatchUser()},backChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.objectId,n=e.info,n.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已回退",p:"".concat(t.username," 回退了流程")}),i={status:0,info:n},a.next=5,Object(o["update_object"])("Maintenance",r,i);case 5:s=a.sent,s.updatedAt&&t.set_deviceStep(-1);case 7:case"end":return a.stop()}}),a)})))()},Reassign:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.objectId,n=e.info,n.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已改派",p:"".concat(t.username," 改派了工单")}),i={status:0,info:n},a.next=5,Object(o["update_object"])("Maintenance",r,i);case 5:s=a.sent,s.updatedAt&&t.set_deviceStep(-1);case 7:case"end":return a.stop()}}),a)})))()},dealwith:function(){this.$refs.ChangeStep.$refs.step2.dispatchUser()},check:function(){this.$refs.ChangeStep.$refs.step3.dispatchUser()}})},f=p,h=(a("be42"),a("2877")),b=Object(h["a"])(f,r,n,!1,null,"ab16e8a6",null);t["default"]=b.exports},"6b66":function(e,t,a){"use strict";a("448c")},"6e6c":function(e,t,a){"use strict";a("fcaf")},"773a":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mycontainer"},[a("div",{staticClass:"ticker-dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e.deviceFlag,width:"100vh"},on:{"update:visible":function(t){e.deviceFlag=t}}},[a("change-info",{attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}})],1)],1),a("vab-query-form",{staticClass:"query-form"},[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket number")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project")}},[a("el-select",{attrs:{placeholder:e.$translateTitle("Maintenance.project")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type")}},[a("el-input",{attrs:{placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.the starting time")}},[a("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search",type:"primary"},nativeOn:{click:function(t){return e.fetchData.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")]),a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-folder-checked",type:"primary"},on:{click:function(t){return e.Export(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{data:e.list,height:e.height},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[a("vab-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortablesortable:"",width:"120"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:"",width:"140"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.getStatus(a.status))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.project"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.productname?a.info.productname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.devicename?a.info.devicename:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.createdname?a.info.createdname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$moment(a.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.operating"),prop:"name","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){return e.showInfo(r)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")])]}}])})],1),a("VabPagination",{directives:[{name:"show",rawName:"v-show",value:e.total,expression:"total"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},n=[],i=a("1da1"),s=a("5530"),o=(a("96cf"),a("d81d"),a("b0c0"),a("d3b7"),a("159b"),a("ddb0"),a("ac1f"),a("1276"),a("a434"),a("0941")),l=a("1267"),c=a("1285"),u=a("5857"),d=a("5880"),m={name:"Index",components:{ChangeInfo:u["default"]},data:function(){return{selectedList:[],ishard:!0,isfooter:!1,step:1,detail:{},deviceFlag:!1,AllDevice:[],height:this.$baseTableHeight(0),dialogFormVisible:!1,types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择活动区域",trigger:"change"}],name:[{required:!0,message:"请选择活动区域",trigger:"change"}],type:[{required:!0,message:"请选择活动资源",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,queryForm:{number:"",product:"",type:"",searchDate:[],limit:20,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:Object(s["a"])(Object(s["a"])({},Object(d["mapGetters"])({_Product:"user/_Product",objectId:"user/objectId",role:"acl/role",username:"user/username"})),{},{aclObj:function(){var e={};return this.role.map((function(t){e["".concat("role:"+t.name)]={read:!0,write:!0}})),e}}),created:function(){},mounted:function(){this.fetchData()},methods:{changeBox:function(e){var t=this;this.selectedList=[],e.forEach((function(e){t.selectedList.push(e)}))},Export:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r={results:[]},r["results"]=e,a.next=5,Object(l["exlout"])(r);case 5:n=a.sent,t.$convertRes2Blob(n),t.$message.success(t.$translateTitle("node.export success")),a.next=13;break;case 10:a.prev=10,a.t0=a["catch"](0),t.$message.error(t.$translateTitle("node.export error")+"".concat(a.t0));case 13:case"end":return a.stop()}}),a,null,[[0,10]])})))()},showInfo:function(e){this.ishard=!0,this.isfooter=!1;var t=e.status,a=void 0===t?0:t;this.detail=e,this.step=a+1,this.deviceFlag=!0},getStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch(e){case 0:return"待分配";case 1:return"已分配";case 2:return"已处理";case 3:return"已结单";default:return e}},fetchData:function(){var e=arguments,t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.length>0&&void 0!==e[0]?e[0]:{},n.limit||(n=t.queryForm),t.listLoading=!1,i=t.$baseColorfullLoading(),s={limit:n.limit,order:n.order,skip:n.skip,keys:n.keys,where:{number:t.queryForm.number.length?{$regex:t.queryForm.number}:{$ne:null},"info.productid":t.queryForm.product.length?t.queryForm.product:{$ne:"98"},type:t.queryForm.type.length?{$regex:t.queryForm.type}:{$ne:null}}},null!==(r=t.queryForm.searchDate)&&void 0!==r&&r.length&&(s.where["createdAt"]={$gt:{__type:"Date",iso:t.queryForm.searchDate[0]}},s.where["updatedAt"]={$lt:{__type:"Date",iso:t.queryForm.searchDate[1]}}),a.next=8,Object(o["query_object"])("Maintenance",s).then((function(e){var a=e.results,r=void 0===a?[]:a,n=e.count,s=void 0===n?0:n;t.list=r,t.list.forEach((function(e){if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(5)})),t.total=s,i.close()})).catch((function(e){t.$message.error("".concat(e)),i.close()}));case 8:case"end":return a.stop()}}),a)})))()},prodChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.Device=[],r={where:{product:e}},a.next=4,Object(c["queryDevice"])(r);case 4:n=a.sent,i=n.results,t.Device=i;case 7:case"end":return a.stop()}}),a)})))()},handleRemove:function(e){var t=this;this.form.photo.forEach((function(a,r){a.split("/")["".concat(a.split("/").length-1)]==e.name&&t.form.photo.splice(r,1)}))},handleSizeChange:function(e){this.queryForm.limit=e,this.fetchData()},handleCurrentChange:function(e){this.queryForm.skip=(e-1)*this.queryForm.limit,this.fetchData()}}},p=m,f=(a("b676"),a("2877")),h=Object(f["a"])(p,r,n,!1,null,"ff183c9a",null);t["default"]=h.exports},"7f5e":function(e,t,a){},"80cc":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"system-log-container"},[a("vab-query-form",[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"60px",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"账号"}},[a("el-input",{attrs:{clearable:"",placeholder:"请输入账号"},model:{value:e.queryForm.account,callback:function(t){e.$set(e.queryForm,"account","string"===typeof t?t.trim():t)},expression:"queryForm.account"}})],1),a("el-form-item",{attrs:{label:"周期"}},[a("el-date-picker",{attrs:{"end-placeholder":"结束日期",format:"yyyy-MM-dd","start-placeholder":"开始日期",type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search",type:"primary"},nativeOn:{click:function(t){return e.queryData.apply(null,arguments)}}},[e._v(" 查询 ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{data:e.list},scopedSlots:e._u([{key:"empty",fn:function(){},proxy:!0}])},[a("el-table-column",{attrs:{align:"center",label:"日志类型",prop:"type","show-overflow-tooltip":"",width:"230px"}}),a("el-table-column",{attrs:{align:"center",label:"账号",prop:"account","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{align:"center",label:"执行结果",prop:"executeResult","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return["登录成功"===r.executeResult?a("span",[a("span",{staticClass:"vab-dot vab-dot-success"},[a("span")]),e._v(" "+e._s(r.executeResult)+" ")]):a("span",[a("span",{staticClass:"vab-dot vab-dot-error"},[a("span")]),e._v(" "+e._s(r.executeResult)+" ")])]}}])}),a("el-table-column",{attrs:{align:"center",label:"登录IP",prop:"ip"}}),a("el-table-column",{attrs:{align:"center",label:"访问时间",prop:"datetime","show-overflow-tooltip":""}})],1),a("el-pagination",{attrs:{background:"","current-page":e.queryForm.pageNo,layout:e.layout,"page-size":e.queryForm.pageSize,total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)},n=[],i=a("1da1"),s=(a("96cf"),a("8781")),o={name:"SystemLog",data:function(){return{list:[],listLoading:!0,layout:"total, sizes, prev, pager, next, jumper",total:0,queryForm:{account:"",searchDate:"",pageNo:1,pageSize:20}}},created:function(){this.fetchData()},methods:{handleSizeChange:function(e){this.queryForm.pageSize=e,this.fetchData()},handleCurrentChange:function(e){this.queryForm.pageNo=e,this.fetchData()},queryData:function(){this.queryForm.pageNo=1,this.fetchData()},fetchData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r,n,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.listLoading=!0,t.next=3,Object(s["getList"])(e.queryForm);case 3:a=t.sent,r=a.data,n=r.list,i=r.total,e.list=n,e.total=i,e.listLoading=!1;case 10:case"end":return t.stop()}}),t)})))()}}},l=o,c=a("2877"),u=Object(c["a"])(l,r,n,!1,null,null,null);t["default"]=u.exports},"82ec":function(e,t,a){},"83d5":function(e,t,a){},"864f":function(e,t,a){},"926e":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("Maintenance.Work order information"),name:"first"}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,size:"medium "}},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project")+": "}},[a("span",[e._v(e._s(e.form.info.productname))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name")+": "}},[a("span",[e._v(e._s(e.form.info.devicename))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Initiator")+": "}},[a("span",[e._v(e._s(e.form.info.createdname))])])],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")+": "}},[e._v(" "+e._s(e.form.info.description)+" ")])],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")+": "}},[a("el-carousel",{attrs:{height:"200px",interval:2e3,type:"card"}},e._l(e.form.info.photo,(function(e,t){return a("el-carousel-item",{key:t},[a("img",{staticStyle:{width:"100%",height:"100%"},attrs:{alt:e,src:e,title:e}})])})),1)],1)],1),e.showFooter?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Evaluation description")+": "}},[a("el-input",{attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),type:"textarea"},model:{value:e.form.info.step3.Remarks,callback:function(t){e.$set(e.form.info.step3,"Remarks",t)},expression:"form.info.step3.Remarks"}})],1)],1):e._e()],1)],1)],1),a("el-tab-pane",{staticStyle:{height:"90%","overflow-x":"hidden","overflow-y":"auto"},attrs:{label:e.$translateTitle("Maintenance.work process"),name:"second"}},[a("el-card",{attrs:{shadow:"hover"},scopedSlots:e._u([{key:"header",fn:function(){return[a("el-radio-group",{staticClass:"card-header-radio",model:{value:e.reverse,callback:function(t){e.reverse=t},expression:"reverse"}},[a("el-radio",{attrs:{label:!0}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Positive order"))+" ")]),a("el-radio",{attrs:{label:!1}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reverse order"))+" ")])],1)]},proxy:!0}])},[a("el-timeline",{attrs:{reverse:e.reverse}},e._l(e.form.info.timeline,(function(t){return a("el-timeline-item",{key:t.timestamp,attrs:{placement:"top",timestamp:t.timestamp}},[a("el-card",[a("h4",[e._v(e._s(t.h4))]),a("p",[e._v(e._s(t.p))])])],1)})),1)],1)],1)],1)],1)},n=[],i=a("1da1"),s=a("5530"),o=(a("96cf"),a("0941")),l=a("8665"),c=a("5880"),u={props:{detail:{type:Object,default:function(){}},showFooter:{type:Boolean,default:!1}},data:function(){return{reverse:!0,activeName:"first",form:this.detail}},computed:Object(s["a"])({},Object(c["mapGetters"])({username:"user/username"})),mounted:function(){this.featUser()},methods:Object(s["a"])(Object(s["a"])({},Object(c["mapMutations"])({set_deviceFlag:"global/set_deviceFlag",set_deviceStep:"global/set_deviceStep"})),{},{featUser:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(l["queryUser"])({});case 2:a=t.sent,r=a.results,e.user=r;case 5:case"end":return t.stop()}}),t)})))()},dispatchUser:function(){var e=this;this.$refs["form"].validate(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(a){var r,n,i,s,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!a||!e.form.info.receiveusername){t.next=10;break}return r=e.form,n=r.objectId,i=r.info,i.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已结单",p:"".concat(e.username," 已结束这条工单")}),s={status:3,info:i},t.next=6,Object(o["update_object"])("Maintenance",n,s);case 6:l=t.sent,l.updatedAt&&(e.set_deviceFlag(!1),e.set_deviceStep(-1)),t.next=12;break;case 10:return e.$message.error("请选择分配人员"),t.abrupt("return",!1);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}})},d=u,m=(a("d030"),a("2877")),p=Object(m["a"])(d,r,n,!1,null,"9d9537fe",null);t["default"]=p.exports},"9b7f":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mycontainer"},[a("div",{staticClass:"ticker-dialog"},[a("div",{staticClass:"home_dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e.showdeviceFlag,width:"100vh"},on:{"update:visible":function(t){e.showdeviceFlag=t}}},[a("change-step",{ref:"ChangeStep",attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status,expression:"detail.status == 0"}],on:{click:function(t){return e.set_deviceStep(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status&&e.isfooter,expression:"detail.status == 0 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dispatch()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Dispatch"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status,expression:"detail.status == 1"}],on:{click:function(t){return e.backChange(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.back"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.Reassign(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reassign"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.check()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.check"))+" ")]),a("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){return e.dealwith()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("Maintenance.create Ticket"),visible:e.dialogFormVisible,width:"90vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project"),prop:"product"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("Maintenance.Please choose the product")},on:{change:e.prodChange},model:{value:e.form.product,callback:function(t){e.$set(e.form,"product",t)},expression:"form.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name"),prop:"name"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.Device.length,placeholder:0==e.Device.length?e.$translateTitle("Maintenance.Please choose the product"):e.$translateTitle("Maintenance.Please select a device")},on:{change:e.deviceChange},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},e._l(e.Device,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:e.objectId,expression:"item.objectId"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type"),prop:"type"}},[a("el-input",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")}},[a("el-upload",{attrs:{action:"#","auto-upload":!0,"http-request":e.myUpload,"list-type":"picture-card"}},[a("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"}),e._l(e.form.photo,(function(e,t){return a("div",{key:t},[a("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{alt:"",src:e.url}})])}))],2),a("el-dialog",{attrs:{"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{alt:"",src:e.dialogImageUrl,width:"100%"}})])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Create now"))+" ")]),a("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reset"))+" ")])],1)],1)],1)]),a("vab-query-form",{staticClass:"query-form"},[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.number")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.projects")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.project")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.type")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.fetchData}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")]),a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-s-promotion",size:"mini",type:"primary"},on:{click:function(t){return e.batchExport(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:"",data:e.list,height:e.height,stripe:""},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[a("vab-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortable:"",width:"120"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.getStatus(a.status,a))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.project"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.productname?a.info.productname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.devicename?a.info.devicename:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.createdname?a.info.createdname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$moment(a.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("Maintenance.operating"),width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showInfo(r,!0,!1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.showInfo(r,!0,!0)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")])]}}])})],1),a("vab-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},n=[],i=a("1da1"),s=a("5530"),o=(a("96cf"),a("d81d"),a("b0c0"),a("a4d3"),a("e01a"),a("d3b7"),a("159b"),a("ddb0"),a("0941")),l=a("dcc6"),c=a("1285"),u=a("5880"),d=a("2ec0"),m=a("1267"),p={name:"ProcessTicket",components:{ChangeStep:d["default"]},data:function(){return{showdeviceFlag:!1,created:0,Assigned:0,form:{receiveuseid:"",productname:"",devicename:"",createdname:"",receiveusername:"",receiveuserphone:"",name:"",product:"",type:"",description:"",photo:[],objectId:""},dialogFormVisible:!1,fold:!1,step:1,ishard:!1,height:this.$baseTableHeight(0)-30,isfooter:!0,detail:{},AllDevice:[],selectedList:[],types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择所属项目",trigger:"change"}],name:[{required:!0,message:"请选择设备",trigger:"change"}],type:[{required:!0,message:"请输入工单类型",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,status:[{key:0,text:"Maintenance.To be assigned"},{key:1,text:"Maintenance.Assigned"},{key:2,text:"Maintenance.Processed"},{key:3,text:"Maintenance.Statement"}],queryForm:{devicename:"",statusFlag:!1,status:"",number:"",product:"",type:"",pageNo:1,pageSize:20,searchDate:[],limt:10,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:Object(s["a"])(Object(s["a"])({},Object(u["mapGetters"])({_Product:"user/_Product",objectid:"user/objectId",role:"acl/role",username:"user/username"})),{},{_deviceStep:{get:function(){return this.$store.state.global._deviceStep},set:function(e){this.set_deviceStep(e)}},aclObj:function(){var e={};return this.role.map((function(t){e["".concat("role:"+t.name)]={read:!0,write:!0}})),e}}),watch:{_deviceStep:function(e){-1==e&&(this.fetchData(),this.showdeviceFlag=!1)},"queryForm.status":function(e){this.queryForm.statusFlag=""!=e}},created:function(){},mounted:function(){this.handleCreated("created")},methods:Object(s["a"])(Object(s["a"])({myUpload:function(e){var t=this,a={headers:{proxy:!0,produrl:"/",devurl:"iotapi/"}};Object(m["UploadImg"])(e.file,a).then((function(e){e.data.url&&t.form.photo.push(e.data.url)})).catch((function(e){}))},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.createdTicket(t.form)}))},createdTicket:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r={},r[t.objectid]={read:!0,write:!0},n={number:moment(new Date).unix()+"",type:e.type,ACL:_.merge(r,t.aclObj),info:{photo:e.photo,timeline:[{timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"生成工单",p:"".concat(t.username,"新建工单")}],description:e.description,step1:{},step2:{},step3:{},step4:{},productid:e.product,productname:e.productname,devicename:e.devicename,deviceid:e.name,createdname:t.username,receiveusername:e.receiveusername,receiveuseid:e.receiveuseid,receiveuserphone:e.receiveuserphone},device:{objectId:e.name,__type:"Pointer",className:"Device"}},i=t.$baseColorfullLoading(),a.next=6,Object(o["create_object"])("Maintenance",n);case 6:a.sent,i.close(),t.fetchData(),t.dialogFormVisible=!1;case 10:case"end":return a.stop()}}),a)})))()},resetForm:function(e){this.$refs[e].resetFields()},changeBox:function(e){var t=this;this.selectedList=[],e.forEach((function(e){t.selectedList.push(e)}))}},Object(u["mapMutations"])({set_deviceStep:"global/set_deviceStep"})),{},{handleFold:function(){this.fold=!this.fold,this.handleHeight()},batchExport:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r={results:[]},r["results"]=e,a.next=5,Object(m["exlout"])(r);case 5:n=a.sent,t.$convertRes2Blob(n),t.$message.success(t.$translateTitle("node.export success")),a.next=13;break;case 10:a.prev=10,a.t0=a["catch"](0),t.$message.error(t.$translateTitle("node.export error")+"".concat(a.t0));case 13:case"end":return a.stop()}}),a,null,[[0,10]])})))()},handleDelete:function(e,t){var a=this,r=[];2==t?r.push({method:"DELETE",path:"/classes/Maintenance/".concat(e.objectId),body:{}}):e.forEach((function(e){r.push({method:"DELETE",path:"/classes/Maintenance/".concat(e.objectId),body:{}})})),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["batch"])(r);case 2:e.sent,a.$baseMessage(a.$translateTitle("Maintenance.successfully deleted"),"success","vab-hey-message-success"),setTimeout((function(){a.fetchData()}),1500);case 5:case"end":return e.stop()}}),e)}))))},handleHeight:function(){this.fold?this.height=this.$baseTableHeight(0)-20:this.height=this.$baseTableHeight(0)-30},getStatus:function(e){return this.$translateTitle("Maintenance.Assigned")},showInfo:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.showdeviceFlag=!1,this.ishard=t,this.isfooter=a;var r=e.status,n=void 0===r?0:r;this.detail=e,this.step=n+1,this.set_deviceStep(n),this.showdeviceFlag=!0},handleCreated:function(e){"created"==e?this.created++:this.Assigned++,this.fetchData()},fetchData:function(){var e=arguments,t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.length>0&&void 0!==e[0]?e[0]:{},n.limit||(n=t.queryForm),t.listLoading=!1,i=t.$baseColorfullLoading(),s={limit:n.limit,order:n.order,skip:n.skip,keys:n.keys,where:{"info.receiveuseid":t.Assigned%2==0?{$ne:"99"}:t.objectid,number:t.queryForm.number.length?{$regex:t.queryForm.number}:{$ne:null},status:1,"info.productid":t.queryForm.product.length?t.queryForm.product:{$ne:"99"},type:t.queryForm.type.length?{$regex:t.queryForm.type}:{$ne:null}}},null!==(r=t.queryForm.searchDate)&&void 0!==r&&r.length&&(s.where["createdAt"]={$gt:{__type:"Date",iso:t.queryForm.searchDate[0]}},s.where["updatedAt"]={$lt:{__type:"Date",iso:t.queryForm.searchDate[1]}}),a.next=8,Object(o["query_object"])("Maintenance",s).then((function(e){var a=e.results,r=void 0===a?[]:a,n=e.count,s=void 0===n?0:n;t.list=r,t.list.forEach((function(e){if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(0)})),t.total=s,i.close()})).catch((function(e){t.$message.error("".concat(e)),i.close()}));case 8:case"end":return a.stop()}}),a)})))()},prodChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.Device=[],t._Product.map((function(a){a.objectId==e&&(t.form.productname=a.name)})),t.form.name="",r={where:{product:e}},a.next=6,Object(c["queryDevice"])(r);case 6:n=a.sent,i=n.results,t.Device=i;case 9:case"end":return a.stop()}}),a)})))()},deviceChange:function(e){var t=this;this.Device.map((function(a){a.objectId==e&&(t.form.devicename=a.name)}))},dispatch:function(){this.$refs.ChangeStep.$refs.step1.dispatchUser()},backChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.objectId,n=e.info,n.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已回退",p:"".concat(t.username," 回退了流程")}),i={status:0,info:n},a.next=5,Object(o["update_object"])("Maintenance",r,i);case 5:s=a.sent,s.updatedAt&&(t.set_deviceStep(-1),t.showdeviceFlag=!1);case 7:case"end":return a.stop()}}),a)})))()},Reassign:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.objectId,n=e.info,n.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已改派",p:"".concat(t.username," 改派了工单")}),i={status:0,info:n},a.next=5,Object(o["update_object"])("Maintenance",r,i);case 5:s=a.sent,s.updatedAt&&(t.set_deviceStep(-1),t.showdeviceFlag=!1);case 7:case"end":return a.stop()}}),a)})))()},dealwith:function(){this.$refs.ChangeStep.$refs.step2.dispatchUser()},check:function(){this.$refs.ChangeStep.$refs.step3.dispatchUser()}})},f=p,h=(a("b5d6"),a("2877")),b=Object(h["a"])(f,r,n,!1,null,"105d9b64",null);t["default"]=b.exports},aae6:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"logs logs-container",class:{"vab-fullscreen":e.isFullscreen}},[a("vab-query-form",[a("vab-query-form-top-panel",[a("el-form",{ref:"form",attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{staticClass:"item-time",attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{staticClass:"item-time-picker",attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},on:{click:function(t){return e.queryTable({})}}}),a("el-button",{staticStyle:{margin:"0 10px 10px 10px !important"},attrs:{type:"success"},on:{click:e.handleHeight}},[a("vab-icon",{attrs:{icon:e.isFullscreen?"fullscreen-exit-fill":"fullscreen-fill"}})],1),a("el-popover",{attrs:{trigger:"hover"},scopedSlots:e._u([{key:"reference",fn:function(){return[a("el-button",{staticStyle:{margin:"0 0 10px 0 !important"},attrs:{icon:"el-icon-setting",type:"primary"}},[e._v(" "+e._s(e.$translateTitle("Logs.Draggable column settings"))+" ")])]},proxy:!0}])},[a("el-checkbox-group",{model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},[a("vue-draggable",e._b({attrs:{list:e.logcolumns}},"vue-draggable",e.dragOptions,!1),e._l(e.logcolumns,(function(t,r){return a("div",{key:t+r},[a("vab-icon",{attrs:{icon:"drag-drop-line"}}),a("el-checkbox",{attrs:{disabled:!0===t.disableCheck,label:t}},[e._v(" "+e._s(t)+" ")])],1)})),0)],1)],1)],1)],1)],1)],1),a("el-table",{key:e.finallyColumns.length+e.momentKey,ref:"dragTable",staticClass:"logs-table",attrs:{border:"",data:e.logdata,height:e.height,"highlight-current-row":"",resizable:"","row-class-name":e.tableRowClassName,size:e.size,stripe:""},scopedSlots:e._u([{key:"empty",fn:function(){return[a("vab-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-descriptions",{staticClass:"margin-top",attrs:{border:"",column:2,size:e.size}},e._l(t.row.body,(function(t,r,n){return a("el-descriptions-item",{directives:[{name:"show",rawName:"v-show",value:"elm"!=r,expression:"key != 'elm'"}],key:n,attrs:{label:r,"label-class-name":"my-label"}},[e._v(" "+e._s(t)+" ")])})),1)]}}])}),e._l(e.finallyColumns,(function(e,t){return a("el-table-column",{key:t,attrs:{align:"center",label:e,prop:e,"show-overflow-tooltip":"",sortable:""}})})),a("el-table-column",{attrs:{align:"center",fixed:"right",label:"msg",prop:"msg.body","show-overflow-tooltip":"",sortable:""}})],2),a("vab-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.queryForm.total>0,expression:"queryForm.total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.queryForm.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.queryTable}})],1)},n=[],i=a("1da1"),s=(a("96cf"),a("4de4"),a("d3b7"),a("caad"),a("2532"),a("a434"),a("ac1f"),a("1276"),a("159b"),a("a9e3"),a("25f0"),a("d292")),o={name:"AccessLog",data:function(){return{size:"",isFullscreen:!1,height:this.$baseTableHeight(0),logdata:[],momentKey:moment(new Date).valueOf(),checkList:["time","username","ip","method","path","code","reason","elapsedtime"],logcolumns:["time","username","ip","method","path","code","reason","elapsedtime"],queryForm:{total:0,count:"objectId",limit:20,pageNo:1,pageSize:20,skip:0,level:"",peername:"",pid:"",mfa:"",topic:"",domain:"parse_api",searchDate:[moment().subtract("days",7).format("YYYY-MM-DD"),moment(new Date).format("YYYY-MM-DD")],order:"-createdAt",keys:"count(*)"}}},computed:{dragOptions:function(){return{animation:600,group:"description"}},finallyColumns:function(){var e=this;return this.logcolumns.filter((function(t){return e.checkList.includes(t)}))}},created:function(){},mounted:function(){this.queryTable({}),this.rowDrop(),this.columnDrop()},methods:{handleHeight:function(){this.isFullscreen=!this.isFullscreen,this.isFullscreen?this.height=this.$baseTableHeight(0)+120:this.height=this.$baseTableHeight(0),this.momentKey=moment(new Date).valueOf()},tableRowClassName:function(e){var t=e.row;return t.disabled?"disabled":""},rowDrop:function(){var e=this.$refs.dragTable.$el.querySelector(".el-table__body-wrapper tbody"),t=this;Sortable.create(e,{draggable:".el-table__row",onEnd:function(e){var a=e.newIndex,r=e.oldIndex,n=t.logdata.splice(r,1)[0];t.logdata.splice(a,0,n)}})},columnDrop:function(){var e=this,t=this.$refs.dragTable.$el.querySelector(".el-table__header-wrapper tr");e.sortable=Sortable.create(t,{animation:180,delay:0,onEnd:function(t){var a=e.finallyColumns[t.oldIndex];e.finallyColumns.splice(t.oldIndex,1),e.finallyColumns.splice(t.newIndex,0,a),e.momentKey=moment(new Date).valueOf(),setTimeout((function(){e.rowDrop(),e.columnDrop()}),1500)}})},queryTable:function(){var e=arguments,t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,o,l,c,u,d;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.length>0&&void 0!==e[0]?e[0]:{},r.limit||(r=t.queryForm),n=t.$baseColorfullLoading(),a.prev=3,n.close(),i={limit:r.limit,skip:r.skip,order:r.order,count:t.queryForm.count,keys:"time,msg",include:"",where:{domain:t.queryForm.domain?{$all:t.queryForm.domain.split(/,(?=(?:[^']*(?:'[^']*')?[^']*)*$)/)}:{$ne:""},createdAt:{$gte:{__type:"Date",iso:"".concat(t.queryForm.searchDate[0],"T00:00:00.000Z")},$lte:{__type:"Date",iso:"".concat(t.queryForm.searchDate[1],"T23:59:59.000Z")}}}},a.next=8,Object(s["queryLog"])(i);case 8:o=a.sent,l=o.results,c=void 0===l?[]:l,u=o.count,d=void 0===u?0:u,c.forEach((function(e,a){e.time=t.$moment(Number(e.time.toString().substring(0,13))).format("YYYY-MM-DD HH:mm:ss.SSS");var r=JSON.parse(e.msg);for(var n in r)"body"==n?e["body"]=r["body"]:e[n]=r[n]})),t.logdata=c,t.queryForm.total=d,t.$baseMessage(t.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),n.close(),a.next=24;break;case 20:a.prev=20,a.t0=a["catch"](3),n.close(),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 24:t.momentKey=moment(new Date).valueOf();case 25:case"end":return a.stop()}}),a,null,[[3,20]])})))()}}},l=o,c=(a("1f97"),a("6b66"),a("2877")),u=Object(c["a"])(l,r,n,!1,null,"fdabf5a2",null);t["default"]=u.exports},acc4:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"logs logs-container"},[a("a-row",{staticClass:"logs-row"},[a("a-col",{staticClass:"logs-row-tree",style:{height:Number(e.$baseTableHeight(0))+105+"px"},attrs:{lg:6,md:6,sm:24,xl:4,xs:24,xxl:4}},[e.logTree.length?a("a-tree",{staticClass:"logs-row-tree-antd",attrs:{"auto-expand-parent":!0,"block-node":!0,"default-expand-all":!0,"show-icon":!0,"show-line":!0,"tree-data":e.logTree},on:{rightClick:e.onRightClick,select:e.onSelect},scopedSlots:e._u([{key:"title",fn:function(t){var r=t.objectId,n=t.name,i=t.objectId,s=t.type;return[a("a-dropdown",{attrs:{disabled:!e.disableType.includes(s),trigger:["contextmenu"]},on:{click:function(t){return e.subLog()}},scopedSlots:e._u([{key:"overlay",fn:function(){return[a("a-menu",{key:i,attrs:{size:"mini"},on:{click:function(t){return t.target!==t.currentTarget?null:function(t){var a=t.key;return e.onContextMenuClick(r,a)}.apply(null,arguments)}}},[a("a-menu-item",[e._v(" "+e._s(e.$translateTitle("Logs.log lever"))+" "),a("el-select",{staticStyle:{width:"120px"},attrs:{size:"mini"},on:{change:e.handleChange},model:{value:e.defaultLever,callback:function(t){e.defaultLever=t},expression:"defaultLever"}},e._l(e.leverData,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1)]},proxy:!0}],null,!0)},[a("span",{attrs:{title:n}},[a("a-icon",{attrs:{slot:"icon",theme:"twoTone","two-tone-color":"#52c41a",type:"check-circle"},slot:"icon"}),e._v(" "+e._s(n)+" ")],1)])]}}],null,!1,740860110)}):e._e()],1),a("a-col",{staticClass:"logs-row-table",class:{"vab-fullscreen":e.isFullscreen},style:{height:Number(e.$baseTableHeight(0))+25+"px"},attrs:{lg:18,md:18,sm:24,xl:20,xs:24,xxl:20}},[a("a-tabs",{attrs:{"default-active-key":"editor"}},[a("a-tab-pane",{key:"editor"},[a("span",{attrs:{slot:"tab"},slot:"tab"},[a("vab-icon",{attrs:{icon:"aspect-ratio-fill"}}),e._v(" "+e._s(e.$translateTitle("Logs.console"))+" ")],1),a("vab-editor",{key:e.key,attrs:{height:e.isFullscreen?Number(e.$baseTableHeight(0))+80:Number(e.$baseTableHeight(0))+40,lang:"json","max-lines":e.isFullscreen?Number(e.$baseTableHeight(0)+80)/12:Number(e.$baseTableHeight(0)-80)/12,"min-lines":e.isFullscreen?Number(e.$baseTableHeight(0)+80)/12:Number(e.$baseTableHeight(0)-80)/12,theme:"gob"},model:{value:e.clickItem,callback:function(t){e.clickItem=t},expression:"clickItem"}})],1),a("a-tab-pane",{key:"table"},[a("span",{attrs:{slot:"tab"},slot:"tab"},[a("vab-icon",{attrs:{icon:"table-2"}}),e._v(" "+e._s(e.$translateTitle("Logs.table"))+" ")],1),a("vab-query-form",[a("vab-query-form-left-panel",[a("el-button",{staticStyle:{margin:"0 10px 10px 10px !important"},attrs:{type:"success"},on:{click:e.handleHeight}},[a("vab-icon",{attrs:{icon:e.isFullscreen?"fullscreen-exit-fill":"fullscreen-fill"}})],1),a("el-popover",{attrs:{trigger:"hover"},scopedSlots:e._u([{key:"reference",fn:function(){return[a("el-button",{staticStyle:{margin:"0 0 10px 0 !important"},attrs:{icon:"el-icon-setting",type:"primary"}},[e._v(" "+e._s(e.$translateTitle("Logs.Draggable column settings"))+" ")])]},proxy:!0}])},[a("el-checkbox-group",{model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},[a("vue-draggable",e._b({attrs:{list:e.logcolumns}},"vue-draggable",e.dragOptions,!1),e._l(e.logcolumns,(function(t,r){return a("div",{key:t+r},[a("vab-icon",{attrs:{icon:"drag-drop-line"}}),a("el-checkbox",{attrs:{disabled:!0===t.disableCheck,label:t}},[e._v(" "+e._s(t)+" ")])],1)})),0)],1)],1)],1)],1),a("el-table",{key:e.key,ref:"dragTable",attrs:{border:"",data:e.scroketMsg.slice((e.currentPage-1)*e.pageSize,e.currentPage*e.pageSize),"default-expand-all":"",height:e.height,"highlight-current-row":"",resizable:"",size:"mini",stripe:""},scopedSlots:e._u([{key:"empty",fn:function(){return[a("vab-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center",fixed:"left",label:e.$translateTitle("equipment.serialnumber"),"show-overflow-tooltip":"",width:"55"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.$index;return[e._v(" "+e._s(a+1)+" ")]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"left",label:"time",prop:"time","show-overflow-tooltip":"",sortable:"",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(" "+e._s(e.$moment(Number(r.time.toString().substring(0,13))).format("YYYY-MM-DD HH:mm:ss.SSS"))+" ")])]}}])}),e._l(e.finallyColumns,(function(t,r){return a("el-table-column",{directives:[{name:"show",rawName:"v-show",value:"msg"!=t,expression:"item != 'msg'"}],key:r,attrs:{align:"center",label:t,prop:t,"show-overflow-tooltip":"",sortable:"",width:e.w80.includes(t)?80:e.Wh120.includes(t)?120:180}})})),a("el-table-column",{attrs:{align:"center",fixed:"right",label:"msg",prop:"msg","show-overflow-tooltip":"",sortable:""}})],2),a("el-pagination",{attrs:{"current-page":e.currentPage,layout:"total, sizes, prev, pager, next, jumper","page-size":e.pageSize,"page-sizes":[10,20,30,50,100],total:e.scroketMsg.length},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)],1)],1)],1)],1)},n=[],i=a("1da1"),s=(a("96cf"),a("4de4"),a("d3b7"),a("caad"),a("2532"),a("b0c0"),a("e9c4"),a("d292")),o=(a("ed08"),{name:"RealLog",data:function(){return{logMqtt:{channeltopic:"",key:moment(new Date).valueOf()},key:moment(new Date).valueOf(),subtopic:"",topicKey:"",router:"",currentPage:1,pageSize:20,isFullscreen:!1,leverData:["debug","info","notice","warning","error","crtical","alert","emergency"],disableType:["system","app","module"],dataRef:{},defaultLever:"",queryForm:{},logTree:[],clickItem:"",height:this.$baseTableHeight(1),checkList:["pid","level","gl","mfa"],logcolumns:["topic","pid","peername","level","gl","clientid","mfa"],w80:["line","level"],Wh120:["pid","level","domain","gl"],Wh200:["time","clientid","peername"],scroketMsg:[]}},computed:{dragOptions:function(){return{animation:600,group:"description"}},finallyColumns:function(){var e=this;return this.logcolumns.filter((function(t){return e.checkList.includes(t)}))},treeQueryForm:function(){return{province:"",class:"LogLevel",filter:'{"keys":["parent","name","level","name","order","type","topic"],"where":{}}',parent:"parent"}}},watch:{},mounted:function(){this.router=this.$dgiotBus.router(this.$route.fullPath),this.getTree(this.treeQueryForm)},methods:{handleSizeChange:function(e){this.pageSize=e},handleCurrentChange:function(e){this.currentPage=e},onSelect:function(e,t){this.dataRef=t.node.dataRef,this.defaultLever=this.dataRef.level,this.subLog()},handleHeight:function(){this.isFullscreen=!this.isFullscreen,this.isFullscreen?this.height=this.$baseTableHeight(1)+120:this.height=this.$baseTableHeight(1)},onRightClick:function(e){this.clickItem="",this.dataRef=e.node.dataRef,this.defaultLever=this.dataRef.level},onContextMenuClick:function(e,t){switch(t){case"Level":break}},getTree:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r=t.$baseColorfullLoading(),a.next=4,Object(s["post_tree"])(e);case 4:n=a.sent,i=n.results,o=void 0===i?[]:i,t.logTree=o,r.close(),t.$baseMessage(t.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),a.next=15;break;case 12:a.prev=12,a.t0=a["catch"](0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 15:case"end":return a.stop()}}),a,null,[[0,12]])})))()},handleChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,o,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r=t.dataRef,n=r.type,i=r.name,o=t.$baseColorfullLoading(),l={type:n,name:i,level:e},a.next=6,Object(s["putLogLevel"])(l);case 6:a.sent,t.getTree(t.treeQueryForm),o.close(),a.next=14;break;case 11:a.prev=11,a.t0=a["catch"](0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 14:case"end":return a.stop()}}),a,null,[[0,11]])})))()},subLog:function(){this.clickItem="",this.scroketMsg=[],this.key=moment(new Date).valueOf(),this.dataRef.objectId&&(this.subtopic="".concat(this.dataRef.topic),this.topicKey=this.$dgiotBus.topicKey(this.router,this.subtopic),this.$dgiotBus.$emit("MqttSubscribe",{router:this.router,topic:this.subtopic,qos:0,ttl:108e5}),this.$baseMessage(this.subtopic+this.$translateTitle("websocket.subscribeSuccess"),"success",!1,"vab-hey-message-success"),this.$baseNotify(this.subtopic,"topic:","success","",5e3),this.handleMqttMsg())},handleMqttMsg:function(){var e=this;this.scroketMsg=[],this.clickItem="",this.$dgiotBus.$off(this.topicKey),this.$dgiotBus.$on(this.topicKey,(function(t){t.payload&&(e.scroketMsg.push(JSON.parse(t.payload)),e.key=moment(new Date).valueOf(),e.clickItem=JSON.stringify(e.scroketMsg,null,2))}))}}}),l=o,c=(a("23e9"),a("2877")),u=Object(c["a"])(l,r,n,!1,null,"7ff67bcb",null);t["default"]=u.exports},b101:function(e,t,a){},b30d:function(e,t,a){"use strict";a("0804")},b5cf:function(e,t,a){"use strict";a("82ec")},b5d6:function(e,t,a){"use strict";a("b826")},b676:function(e,t,a){"use strict";a("e0fb")},b826:function(e,t,a){},be42:function(e,t,a){"use strict";a("7f5e")},c1bc:function(e,t,a){},c7e3:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("Maintenance.Work order information"),name:"first"}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project")+": "}},[a("span",[e._v(e._s(e.form.info.productname))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name")+": "}},[a("span",[e._v(e._s(e.form.info.devicename))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Initiator")+": "}},[a("span",[e._v(e._s(e.form.info.createdname))])])],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")+": "}},[e._v(" "+e._s(e.form.info.description)+" ")])],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")+": "}},[a("el-carousel",{attrs:{height:"200px",interval:2e3,type:"card"}},e._l(e.form.info.photo,(function(e,t){return a("el-carousel-item",{key:t},[a("img",{staticStyle:{width:"100%",height:"100%"},attrs:{alt:e,src:e,title:e}})])})),1)],1)],1),e.showFooter?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Remarks")}},[a("el-input",{staticStyle:{"margin-bottom":"20px"},attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),type:"textarea"},model:{value:e.form.info.step1.Remarks,callback:function(t){e.$set(e.form.info.step1,"Remarks",t)},expression:"form.info.step1.Remarks"}})],1)],1):e._e(),e.showFooter?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Maintenance staff"),prop:"info.receiveusername",required:""}},[a("el-tree",{ref:"workGroup",staticStyle:{float:"left",width:"50%"},attrs:{data:e.deptTreeData,"default-expand-all":"","expand-on-click-node":!1,"node-key":"index",props:e.roleProps},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,n=t.data;return a("div",{staticClass:"custom-tree-node"},[a("span",{class:{selected:n.objectId==e.curDepartmentId},on:{click:function(t){return e.handleNodeClick(n,r)}}},[e._v(" "+e._s(r.label)+" ")])])}}],null,!1,2722443036)}),a("el-select",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"50%"},attrs:{disabled:!e.user.length,"element-loading-background":"rgba(0, 0, 0, 0.8)","element-loading-spinner":"el-icon-loading","element-loading-text":e.$translateTitle("developer.Data is loading"),placeholder:e.$translateTitle("product.selectdepartment")},model:{value:e.form.info.receiveusername,callback:function(t){e.$set(e.form.info,"receiveusername",t)},expression:"form.info.receiveusername"}},e._l(e.user,(function(t){return a("el-option",{key:t.objectId,attrs:{label:t.nick,value:t.objectId}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.nick))]),a("span",{staticStyle:{float:"right","font-size":"14px",color:"#8492a6"}},[e._v(" "+e._s(t.objectId)+" ")])])})),1)],1)],1):e._e()],1)],1)],1),a("el-tab-pane",{staticStyle:{height:"90%","overflow-x":"hidden","overflow-y":"auto"},attrs:{label:e.$translateTitle("Maintenance.work process"),name:"second"}},[a("el-card",{attrs:{shadow:"hover"},scopedSlots:e._u([{key:"header",fn:function(){return[a("el-radio-group",{staticClass:"card-header-radio",model:{value:e.reverse,callback:function(t){e.reverse=t},expression:"reverse"}},[a("el-radio",{attrs:{label:!0}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Positive order"))+" ")]),a("el-radio",{attrs:{label:!1}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reverse order"))+" ")])],1)]},proxy:!0}])},[a("el-timeline",{attrs:{reverse:e.reverse}},e._l(e.form.info.timeline,(function(t){return a("el-timeline-item",{key:t.timestamp,attrs:{placement:"top",timestamp:t.timestamp}},[a("el-card",[a("h4",[e._v(e._s(t.h4))]),a("p",[e._v(e._s(t.p))])])],1)})),1)],1)],1)],1)],1)},n=[],i=a("1da1"),s=a("5530"),o=(a("96cf"),a("a9e3"),a("b0c0"),a("4de4"),a("d3b7"),a("99af"),a("0941")),l=a("5da9"),c=a("bc35"),u=a("5880"),d={props:{detail:{type:Object,default:function(){}},step:{type:Number,default:1},showFooter:{type:Boolean,default:!1},showHard:{type:Boolean,default:!1}},data:function(){return{roleName:"",loading:!1,user:[],deptTreeData:[],reverse:!0,roleProps:{children:"children",label:"name"},rules:{reverse:!0,"info.receiveusername":[{required:!0,message:"请选择分配人员",trigger:"change"}]},curDepartmentId:"",activeName:"first",form:this.detail}},computed:Object(s["a"])({},Object(u["mapGetters"])({username:"user/username",token:"user/token",objectId:"user/objectId"})),mounted:function(){this.getRoletree()},methods:Object(s["a"])(Object(s["a"])({},Object(u["mapMutations"])({set_deviceFlag:"global/set_deviceFlag",set_deviceStep:"global/set_deviceStep"})),{},{getRoletree:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(c["Roletree"])().then((function(t){e.deptTreeData=t.results,e.handleNodeClick(t.results[0],0)})).catch((function(e){}));case 2:case"end":return t.stop()}}),t)})))()},handleNodeClick:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a.loading=!0,a.curDepartmentId=e.objectId,a.user=[],a.roleName=e.name,t.next=6,Object(l["queryRoledepartment"])({name:e.name});case 6:r=t.sent,n=r.users,a.user=n,a.loading=!1;case 10:case"end":return t.stop()}}),t)})))()},dispatchUser:function(){var e=this;this.$refs["form"].validate(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(a){var r,n,i,s,l,c,u,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.user.filter((function(t){return t.objectId==e.form.info.receiveusername})),!a||!e.form.info.receiveusername){t.next=17;break}return n={},i=e.form,s=i.objectId,l=i.info,c=i.ACL,i.user,l.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已分配",p:"".concat(e.username," 分配给 ").concat(r[0].nick)}),l.receiveusername=r[0].nick,l.receiveuseid=r[0].objectId,l.receiveuserphone=r[0].phone,n["".concat(r[0].objectId)]={read:!0,write:!0},n["role:".concat(e.roleName)]={read:!0,write:!0},u={status:1,info:l,ACL:_.merge(n,c),user:{objectId:r[0].objectId,__type:"Pointer",className:"_User"}},t.next=13,Object(o["update_object"])("Maintenance",s,u);case 13:d=t.sent,d.updatedAt&&(e.set_deviceFlag(!1),e.set_deviceStep(-1)),t.next=19;break;case 17:return e.$message.error("请选择分配人员"),t.abrupt("return",!1);case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}})},m=d,p=(a("2187"),a("2877")),f=Object(p["a"])(m,r,n,!1,null,"77b2ec3e",null);t["default"]=f.exports},cd37:function(e,t,a){"use strict";a("c1bc")},d030:function(e,t,a){"use strict";a("864f")},d170:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{ref:"custom-table",staticClass:"custom-table-container",class:{"vab-fullscreen":e.isFullscreen}},[r("vab-query-form",[r("vab-query-form-left-panel",[r("el-form",{ref:"form",attrs:{inline:!0,"label-width":"0",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",[r("el-input",{attrs:{placeholder:"标题"},model:{value:e.queryForm.title,callback:function(t){e.$set(e.queryForm,"title",t)},expression:"queryForm.title"}})],1),r("el-form-item",[r("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},on:{click:e.handleQuery}},[e._v(" 查询 ")]),r("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},nativeOn:{click:function(t){return e.handleAdd.apply(null,arguments)}}},[e._v(" 添加 ")]),r("el-button",{attrs:{icon:"el-icon-delete",type:"danger"},on:{click:e.handleDelete}},[e._v(" 删除 ")])],1)],1)],1),r("vab-query-form-right-panel",[r("div",{staticClass:"stripe-panel"},[r("el-checkbox",{model:{value:e.stripe,callback:function(t){e.stripe=t},expression:"stripe"}},[e._v(" 斑马纹 ")])],1),r("div",{staticClass:"border-panel"},[r("el-checkbox",{model:{value:e.border,callback:function(t){e.border=t},expression:"border"}},[e._v(" 边框（可拉伸列） ")])],1),r("el-button",{staticStyle:{margin:"0 10px 10px 0 !important"},attrs:{type:"primary"},on:{click:e.clickFullScreen}},[r("vab-icon",{attrs:{icon:e.isFullscreen?"fullscreen-exit-fill":"fullscreen-fill"}}),e._v(" 表格全屏 ")],1),r("el-popover",{ref:"popover",attrs:{"popper-class":"custom-table-checkbox",trigger:"hover"},scopedSlots:e._u([{key:"reference",fn:function(){return[r("el-button",{staticStyle:{margin:"0 10px 10px 0 !important"},attrs:{type:"primary"}},[r("vab-icon",{attrs:{icon:"line-height"}}),e._v(" 表格尺寸 ")],1)]},proxy:!0}])},[r("el-radio-group",{model:{value:e.lineHeight,callback:function(t){e.lineHeight=t},expression:"lineHeight"}},[r("el-radio",{attrs:{label:"medium"}},[e._v(" 大 ")]),r("el-radio",{attrs:{label:"small"}},[e._v(" 中 ")]),r("el-radio",{attrs:{label:"mini"}},[e._v(" 小 ")])],1)],1),r("el-popover",{attrs:{"popper-class":"custom-table-checkbox",trigger:"hover"},scopedSlots:e._u([{key:"reference",fn:function(){return[r("el-button",{staticStyle:{margin:"0 0 10px 0 !important"},attrs:{icon:"el-icon-setting",type:"primary"}},[e._v(" 可拖拽列设置 ")])]},proxy:!0}])},[r("el-checkbox-group",{model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},[r("vab-draggable",e._b({attrs:{list:e.columns}},"vab-draggable",e.dragOptions,!1),e._l(e.columns,(function(t,a){return r("div",{key:t+a},[r("vab-icon",{attrs:{icon:"drag-drop-line"}}),r("el-checkbox",{attrs:{disabled:!0===t.disableCheck,label:t.label}},[e._v(" "+e._s(t.label)+" ")])],1)})),0)],1)],1)],1)],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:e.border,data:e.list,height:e.height,size:e.lineHeight,stripe:e.stripe},on:{"selection-change":e.setSelectRows},scopedSlots:e._u([{key:"empty",fn:function(){return[r("el-image",{staticClass:"vab-data-empty",attrs:{src:a("c2ad")}})]},proxy:!0}])},[r("el-table-column",{attrs:{align:"center",type:"selection",width:"55"}}),r("el-table-column",{attrs:{align:"center",label:"序号","show-overflow-tooltip":"",sortable:"",width:"95"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.$index;return[e._v(" "+e._s(a+1)+" ")]}}])}),e._l(e.finallyColumns,(function(t,a){return r("el-table-column",{key:a,attrs:{align:"center",label:t.label,sortable:"",width:t.width},scopedSlots:e._u([{key:"default",fn:function(a){var n=a.row;return["评级"===t.label?r("span",[r("el-rate",{attrs:{disabled:""},model:{value:n.rate,callback:function(t){e.$set(n,"rate",t)},expression:"row.rate"}})],1):r("span",[e._v(e._s(n[t.prop]))])]}}],null,!0)})})),r("el-table-column",{attrs:{align:"center",label:"操作","show-overflow-tooltip":"",sortable:"",width:"85"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleEdit(a)}}},[e._v(" 编辑 ")]),r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleDelete(a)}}},[e._v(" 删除 ")])]}}])})],2),r("el-pagination",{attrs:{background:"","current-page":e.queryForm.pageNo,layout:e.layout,"page-size":e.queryForm.pageSize,total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}}),r("table-edit",{ref:"edit",on:{"fetch-data":e.fetchData}})],1)},n=[],i=a("1da1"),s=(a("96cf"),a("4de4"),a("d3b7"),a("caad"),a("2532"),a("a15b"),a("d81d"),a("159b"),a("8456")),o=a("43ee"),l=a("289a"),c=a.n(l),u={name:"Empty",components:{TableEdit:o["default"],VabDraggable:c.a},data:function(){return{infoData:"Empty",isFullscreen:!1,border:!0,height:this.$baseTableHeight(1),stripe:!1,lineHeight:"medium",checkList:["标题","作者","评级","点击量","时间"],columns:[{label:"标题",width:"auto",prop:"title",sortable:!0,disableCheck:!0},{label:"作者",width:"auto",prop:"author",sortable:!0},{label:"评级",width:"200",prop:"rate",sortable:!0},{label:"点击量",width:"auto",prop:"pageViews",sortable:!0},{label:"时间",width:"auto",prop:"datetime",sortable:!0}],list:[],imageList:[],listLoading:!0,layout:"total, sizes, prev, pager, next, jumper",total:0,selectRows:"",queryForm:{pageNo:1,pageSize:20,title:""}}},computed:{dragOptions:function(){return{animation:600,group:"description"}},finallyColumns:function(){var e=this;return this.columns.filter((function(t){return e.checkList.includes(t.label)}))}},mounted:function(){},created:function(){this.fetchData()},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){},methods:{clickFullScreen:function(){this.isFullscreen=!this.isFullscreen,this.handleHeight()},handleHeight:function(){this.isFullscreen?this.height=this.$baseTableHeight(1)+210:this.height=this.$baseTableHeight(1)},setSelectRows:function(e){this.selectRows=e},handleAdd:function(){this.$refs["edit"].showEdit()},handleEdit:function(e){this.$refs["edit"].showEdit(e)},handleDelete:function(e){var t=this;if(e.id)this.$baseConfirm("你确定要删除当前项吗",null,Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(s["doDelete"])({ids:e.id});case 2:return r=a.sent,n=r.msg,t.$baseMessage(n,"success","vab-hey-message-success"),a.next=7,t.fetchData();case 7:case"end":return a.stop()}}),a)}))));else if(this.selectRows.length>0){var a=this.selectRows.map((function(e){return e.id})).join();this.$baseConfirm("你确定要删除选中项吗",null,Object(i["a"])(regeneratorRuntime.mark((function e(){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(s["doDelete"])({ids:a});case 2:return r=e.sent,n=r.msg,t.$baseMessage(n,"success","vab-hey-message-success"),e.next=7,t.fetchData();case 7:case"end":return e.stop()}}),e)}))))}else this.$baseMessage("未选中任何行","error","vab-hey-message-error")},handleSizeChange:function(e){this.queryForm.pageSize=e,this.fetchData()},handleCurrentChange:function(e){this.queryForm.pageNo=e,this.fetchData()},handleQuery:function(){this.queryForm.pageNo=1,this.fetchData()},fetchData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r,n,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.listLoading=!0,t.next=3,Object(s["getList"])(e.queryForm);case 3:a=t.sent,r=a.data,n=r.list,i=r.total,e.list=n,o=[],n.forEach((function(e){o.push(e.img)})),e.imageList=o,e.total=i,e.listLoading=!1;case 13:case"end":return t.stop()}}),t)})))()}}},d=u,m=(a("4e23"),a("2877")),p=Object(m["a"])(d,r,n,!1,null,"733ada00",null);t["default"]=p.exports},db62:function(e,t,a){},df15:function(e,t,a){},e0fb:function(e,t,a){},ef07:function(e,t,a){"use strict";a("db62")},f365:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mycontainer"},[a("div",{staticClass:"ticker-dialog"},[a("div",{staticClass:"home_dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e.showdeviceFlag,width:"100vh"},on:{"update:visible":function(t){e.showdeviceFlag=t}}},[a("change-Step",{ref:"ChangeStep",attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status&&e.isfooter,expression:"detail.status == 0 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dispatch()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Dispatch"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status,expression:"detail.status == 1"}],on:{click:function(t){return e.backChange(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.back"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.Reassign(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reassign"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.check()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.check"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status&&e.isfooter,expression:"detail.status == 1 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dealwith()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("Maintenance.create Ticket"),visible:e.dialogFormVisible,width:"90vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project"),prop:"product"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("Maintenance.Please choose the product")},on:{change:e.prodChange},model:{value:e.form.product,callback:function(t){e.$set(e.form,"product",t)},expression:"form.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name"),prop:"name"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.Device.length,placeholder:0==e.Device.length?e.$translateTitle("Maintenance.Please choose the product"):e.$translateTitle("Maintenance.Please select a device")},on:{change:e.deviceChange},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},e._l(e.Device,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:e.objectId,expression:"item.objectId"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type"),prop:"type"}},[a("el-input",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")}},[a("el-upload",{attrs:{action:"#","auto-upload":!0,"http-request":e.myUpload,"list-type":"picture-card"}},[a("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"}),e._l(e.form.photo,(function(e,t){return a("div",{key:t},[a("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{alt:"",src:e.url}})])}))],2),a("el-dialog",{attrs:{"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{alt:"",src:e.dialogImageUrl,width:"100%"}})])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Create now"))+" ")]),a("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reset"))+" ")])],1)],1)],1)]),a("vab-query-form",{staticClass:"query-form"},[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.number")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.projects")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.project")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.type")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.fetchData}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")]),a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-s-promotion",size:"mini",type:"primary"},on:{click:function(t){return e.batchExport(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:"",data:e.list,height:e.height,stripe:""},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[a("vab-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortable:"",width:"120"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.getStatus(a.status,a))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.project"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.productname?a.info.productname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.devicename?a.info.devicename:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.createdname?a.info.createdname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$moment(a.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("Maintenance.operating"),width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showInfo(r,!0,!1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),a("el-button",{attrs:{size:"mini",type:"success"},nativeOn:{click:function(t){return e.showInfo(r)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Dispatch"))+" ")])]}}])})],1),a("vab-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},n=[],i=a("1da1"),s=a("5530"),o=(a("96cf"),a("d81d"),a("b0c0"),a("a4d3"),a("e01a"),a("d3b7"),a("159b"),a("ddb0"),a("0941")),l=a("dcc6"),c=a("1285"),u=a("5880"),d=a("1267"),m=a("2ec0"),p={name:"DispatchTicket",components:{ChangeStep:m["default"]},data:function(){return{created:0,Assigned:0,showdeviceFlag:!1,form:{receiveuseid:"",productname:"",devicename:"",createdname:"",receiveusername:"",receiveuserphone:"",name:"",product:"",type:"",description:"",photo:[],objectId:""},dialogFormVisible:!1,fold:!1,step:1,ishard:!1,height:this.$baseTableHeight(0)-30,isfooter:!0,detail:{},AllDevice:[],selectedList:[],types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择所属项目",trigger:"change"}],name:[{required:!0,message:"请选择设备",trigger:"change"}],type:[{required:!0,message:"请输入工单类型",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,status:[{key:0,text:"Maintenance.To be assigned"},{key:1,text:"Maintenance.Assigned"},{key:2,text:"Maintenance.Processed"},{key:3,text:"Maintenance.Statement"}],queryForm:{devicename:"",statusFlag:!1,status:"",number:"",product:"",type:"",pageNo:1,pageSize:20,searchDate:[],limt:10,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:Object(s["a"])(Object(s["a"])({},Object(u["mapGetters"])({_Product:"user/_Product",objectid:"user/objectId",role:"acl/role",username:"user/username"})),{},{_deviceStep:{get:function(){return this.$store.state.global._deviceStep},set:function(e){this.set_deviceStepg(e)}},aclObj:function(){var e={};return this.role.map((function(t){e["".concat("role:"+t.name)]={read:!0,write:!0}})),e}}),watch:{_deviceStep:function(e){-1==e&&(this.showdeviceFlag=!1,this.fetchData())},"queryForm.status":function(e){this.queryForm.statusFlag=""!=e}},created:function(){},mounted:function(){this.fetchData(),this.handleCreated("created")},methods:Object(s["a"])(Object(s["a"])({myUpload:function(e){var t=this,a={headers:{proxy:!0,produrl:"/",devurl:"iotapi/"}};Object(d["UploadImg"])(e.file,a).then((function(e){e.data.url&&t.form.photo.push(e.data.url)})).catch((function(e){}))},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.createdTicket(t.form)}))},createdTicket:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r={},r["".concat(t.objectid)]={read:!0,write:!0},n={number:moment(new Date).unix()+"",type:e.type,ACL:_.merge(r,t.aclObj),info:{photo:e.photo,timeline:[{timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"生成工单",p:"".concat(t.username,"新建工单")}],description:e.description,step1:{},step2:{},step3:{},step4:{},productid:e.product,productname:e.productname,devicename:e.devicename,deviceid:e.name,createdname:t.username,receiveusername:e.receiveusername,receiveuseid:e.receiveuseid,receiveuserphone:e.receiveuserphone},device:{objectId:e.name,__type:"Pointer",className:"Device"}},i=t.$baseColorfullLoading(),a.next=6,Object(o["create_object"])("Maintenance",n);case 6:a.sent,i.close(),t.fetchData(),t.dialogFormVisible=!1;case 10:case"end":return a.stop()}}),a)})))()},resetForm:function(e){this.$refs[e].resetFields()},changeBox:function(e){var t=this;this.selectedList=[],e.forEach((function(e){t.selectedList.push(e)}))}},Object(u["mapMutations"])({set_deviceStep:"global/set_deviceStep"})),{},{handleFold:function(){this.fold=!this.fold,this.handleHeight()},batchExport:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r={results:[]},r["results"]=e,a.next=5,Object(d["exlout"])(r);case 5:n=a.sent,t.$convertRes2Blob(n),t.$message.success(t.$translateTitle("node.export success")),a.next=13;break;case 10:a.prev=10,a.t0=a["catch"](0),t.$message.error(t.$translateTitle("node.export error")+"".concat(a.t0));case 13:case"end":return a.stop()}}),a,null,[[0,10]])})))()},handleDelete:function(e,t){var a=this,r=[];2==t?r.push({method:"DELETE",path:"/classes/Maintenance/".concat(e.objectId),body:{}}):e.forEach((function(e){r.push({method:"DELETE",path:"/classes/Maintenance/".concat(e.objectId),body:{}})})),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["batch"])(r);case 2:e.sent,a.$baseMessage(a.$translateTitle("Maintenance.successfully deleted"),"success","vab-hey-message-success"),setTimeout((function(){a.fetchData()}),1500);case 5:case"end":return e.stop()}}),e)}))))},handleHeight:function(){this.fold?this.height=this.$baseTableHeight(0)-20:this.height=this.$baseTableHeight(0)-30},getStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch(e){case 0:return this.$translateTitle("Maintenance.To be assigned");case 1:return this.$translateTitle("Maintenance.Assigned");case 2:return this.$translateTitle("Maintenance.Processed");case 3:return this.$translateTitle("Maintenance.Statement");default:return e}},showInfo:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.showdeviceFlag=!1,this.ishard=t,this.isfooter=a;var r=e.status;this.detail=e,this.set_deviceStep(r),this.step=r+1,this.showdeviceFlag=!0},handleCreated:function(e){"created"==e?this.created++:this.Assigned++,this.fetchData()},fetchData:function(){var e=arguments,t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.length>0&&void 0!==e[0]?e[0]:{},n.limit||(n=t.queryForm),t.listLoading=!1,i=t.$baseColorfullLoading(),s={limit:n.limit,order:n.order,skip:n.skip,keys:n.keys,where:{status:0,"info.receiveuseid":t.Assigned%2==0?{$ne:"99"}:t.objectid,number:t.queryForm.number.length?{$regex:t.queryForm.number}:{$ne:null},"info.productid":t.queryForm.product.length?t.queryForm.product:{$ne:"99"},type:t.queryForm.type.length?{$regex:t.queryForm.type}:{$ne:null}}},null!==(r=t.queryForm.searchDate)&&void 0!==r&&r.length&&(s.where["createdAt"]={$gt:{__type:"Date",iso:t.queryForm.searchDate[0]}},s.where["updatedAt"]={$lt:{__type:"Date",iso:t.queryForm.searchDate[1]}}),a.next=8,Object(o["query_object"])("Maintenance",s).then((function(e){var a=e.results,r=void 0===a?[]:a,n=e.count,s=void 0===n?0:n;t.list=r,t.list.forEach((function(e){if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(0)})),t.total=s,i.close()})).catch((function(e){t.$message.error("".concat(e)),i.close()}));case 8:case"end":return a.stop()}}),a)})))()},prodChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.Device=[],t._Product.map((function(a){a.objectId==e&&(t.form.productname=a.name)})),t.form.name="",r={where:{product:e}},a.next=6,Object(c["queryDevice"])(r);case 6:n=a.sent,i=n.results,t.Device=i;case 9:case"end":return a.stop()}}),a)})))()},deviceChange:function(e){var t=this;this.Device.map((function(a){a.objectId==e&&(t.form.devicename=a.name)}))},dispatch:function(){this.$refs.ChangeStep.$refs.step1.dispatchUser()},backChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.objectId,n=e.info,n.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已回退",p:"".concat(t.username," 回退了流程")}),i={status:0,info:n},a.next=5,Object(o["update_object"])("Maintenance",r,i);case 5:s=a.sent,s.updatedAt&&t.set_deviceStep(-1);case 7:case"end":return a.stop()}}),a)})))()},Reassign:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.objectId,n=e.info,n.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已改派",p:"".concat(t.username," 改派了工单")}),i={status:0,info:n},a.next=5,Object(o["update_object"])("Maintenance",r,i);case 5:s=a.sent,s.updatedAt&&t.set_deviceStep(-1);case 7:case"end":return a.stop()}}),a)})))()},dealwith:function(){this.$refs.ChangeStep.$refs.step2.dispatchUser()},check:function(){this.$refs.ChangeStep.$refs.step3.dispatchUser()}})},f=p,h=(a("4df8"),a("2877")),b=Object(h["a"])(f,r,n,!1,null,"22bfaa40",null);t["default"]=b.exports},f715:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("Maintenance.Work order information"),name:"first"}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,size:"medium "}},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project")+": "}},[a("span",[e._v(e._s(e.form.info.productname))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name")+": "}},[a("span",[e._v(e._s(e.form.info.devicename))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Initiator")+": "}},[a("span",[e._v(e._s(e.form.info.createdname))])])],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")+": "}},[e._v(" "+e._s(e.form.info.description)+" ")])],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")+": "}},[a("el-carousel",{attrs:{height:"200px",interval:2e3,type:"card"}},e._l(e.form.info.photo,(function(e,t){return a("el-carousel-item",{key:t},[a("img",{staticStyle:{width:"100%",height:"100%"},attrs:{alt:e,src:e,title:e}})])})),1)],1)],1),e.showFooter?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Processing records")+": "}},[a("el-input",{attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),type:"textarea"},model:{value:e.form.info.step2.Remarks,callback:function(t){e.$set(e.form.info.step2,"Remarks",t)},expression:"form.info.step2.Remarks"}})],1)],1):e._e()],1)],1)],1),a("el-tab-pane",{staticStyle:{height:"90%","overflow-x":"hidden","overflow-y":"auto"},attrs:{label:e.$translateTitle("Maintenance.work process"),name:"second"}},[a("el-card",{attrs:{shadow:"hover"},scopedSlots:e._u([{key:"header",fn:function(){return[a("el-radio-group",{staticClass:"card-header-radio",model:{value:e.reverse,callback:function(t){e.reverse=t},expression:"reverse"}},[a("el-radio",{attrs:{label:!0}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Positive order"))+" ")]),a("el-radio",{attrs:{label:!1}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reverse order"))+" ")])],1)]},proxy:!0}])},[a("el-timeline",{attrs:{reverse:e.reverse}},e._l(e.form.info.timeline,(function(t){return a("el-timeline-item",{key:t.timestamp,attrs:{placement:"top",timestamp:t.timestamp}},[a("el-card",[a("h4",[e._v(e._s(t.h4))]),a("p",[e._v(e._s(t.p))])])],1)})),1)],1)],1)],1)],1)},n=[],i=a("1da1"),s=a("5530"),o=(a("96cf"),a("a9e3"),a("0941")),l=a("8665"),c=a("5880"),u={props:{detail:{type:Object,default:function(){}},step:{type:Number,default:2},showFooter:{type:Boolean,default:!1}},data:function(){return{reverse:!0,activeName:"first",form:this.detail}},computed:Object(s["a"])({},Object(c["mapGetters"])({username:"user/username"})),mounted:function(){this.featUser()},methods:Object(s["a"])(Object(s["a"])({},Object(c["mapMutations"])({set_deviceFlag:"global/set_deviceFlag",set_deviceStep:"global/set_deviceStep"})),{},{featUser:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(l["queryUser"])({});case 2:a=t.sent,r=a.results,e.user=r;case 5:case"end":return t.stop()}}),t)})))()},dispatchUser:function(){var e=this;this.$refs["form"].validate(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(a){var r,n,i,s,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!a||!e.form.info.receiveusername){t.next=10;break}return r=e.form,n=r.objectId,i=r.info,i.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已处理",p:"".concat(e.username,"处理了这条工单")}),s={status:2,info:i},t.next=6,Object(o["update_object"])("Maintenance",n,s);case 6:l=t.sent,l.updatedAt&&(e.set_deviceFlag(!1),e.set_deviceStep(-1)),t.next=12;break;case 10:return e.$message.error("请选择分配人员"),t.abrupt("return",!1);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}})},d=u,m=(a("ef07"),a("2877")),p=Object(m["a"])(d,r,n,!1,null,"df24b6fa",null);t["default"]=p.exports},fcaf:function(e,t,a){}}]);