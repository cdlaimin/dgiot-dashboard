/*!
 *  build: 杭州数蛙科技有限公司 
 *  copyright: dgiot-dashboard 
 *  author: h7ml(h7ml@qq.com) 
 *  time: Wed Nov 17 2021 04:11:49 GMT+0000 (Coordinated Universal Time)
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5d3779ce"],{3412:function(e,t,a){},"40bf":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"editdevices"},[a("div",[a("el-tabs",{on:{"tab-click":e.tabHandleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.deviceinformation"),name:"first"}},[a("info",{attrs:{devicedetail:e.deviceInfo}})],1),a("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.real time data"),name:"first1"}},[a("vab-query-form",[a("vab-query-form-left-panel",[a("span",[e._v(" "+e._s(e.$translateTitle("equipment.realtimerefresh"))+" ")]),a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#cccccc"},on:{change:function(t){return e.updateTrue(t)}},model:{value:e.isupdate,callback:function(t){e.isupdate=t},expression:"isupdate"}})],1),a("vab-query-form-right-panel",[a("vab-help",{attrs:{src:"https://tech.iotn2n.com/w/docs/details?id=6",title:"产品下的所有设备都会继承该产品的 Topic 类",trigger:"click"}})],1)],1),a("div",[a("div",{staticClass:"thirdtb"},[a("el-row",{key:e.thirdtbKey},e._l(e.machinelist,(function(t,i,r){return a("el-col",{key:r,attrs:{span:24}},[a("el-card",{attrs:{"body-style":{padding:"0px"},shadow:"never"}},[a("div",{staticStyle:{padding:"14px"}},[a("span",{staticStyle:{"font-size":"30px"}},[e._v(e._s(i))]),t.length?a("ul",{staticStyle:{display:"flex","flex-wrap":"wrap"}},e._l(t,(function(t,i){return a("li",{key:i,staticClass:"updatedtable"},[a("div",{staticStyle:{height:"70px"}},[a("span",{staticStyle:{"font-size":"16px"}},[e._v(e._s(t.name))]),a("span",{staticStyle:{float:"right","margin-top":"10px","margin-right":"15px"}},[a("el-image",{staticStyle:{width:"60px",height:"60px"},attrs:{src:t.imgurl}},[a("div",{staticClass:"image-slot",staticStyle:{width:"60px",height:"60px"},attrs:{slot:"error"},slot:"error"},[a("i",{staticClass:"el-icon-picture-outline"})])])],1)]),a("div",{staticClass:"stla"},[a("span",{attrs:{title:e._f("filterVal")(t.number)}},[e._v(" "+e._s(e._f("filterVal")(t.number))+" ")]),t.unit?a("span",{attrs:{title:t.unit}},[e._v(" "+e._s(t.unit)+" ")]):e._e()]),a("div",{staticClass:"ta"},[a("span",{staticClass:"fontSize"},[e._v(" "+e._s(e.$translateTitle("equipment.updatetime")+":")+" ")]),a("span",{staticClass:"fontSize",on:{click:function(t){return e.print(e.machinelist)}}},[e._v(" "+e._s(t.time)+" ")])])])})),0):e._e()])])],1)})),1)],1)])],1),a("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.historical data"),name:"third"}},[a("div",{staticStyle:{"box-sizing":"border-box",padding:"10px",background:"#ffffff"}},[a("div",{staticClass:"chartsinfo"},[a("div",{staticClass:"queryHeader",style:{height:"desktop"==e.Device?"50px":"240px"}},[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"desktop"==e.Device?"80px":"70px",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("developer.startTime")}},[a("el-date-picker",{staticStyle:{width:"83%"},attrs:{align:"right","picker-options":e.pickerOptionsDay,placeholder:e.$translateTitle("developer.startTime"),size:"mini",type:"datetime"},model:{value:e.params.startTime,callback:function(t){e.$set(e.params,"startTime",t)},expression:"params.startTime"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.EndTime")}},[a("el-date-picker",{staticStyle:{width:"83%"},attrs:{align:"right",clearable:!1,"picker-options":e.pickerOptionsDay,placeholder:e.$translateTitle("developer.EndTime"),size:"mini",type:"datetime"},model:{value:e.params.endTime,callback:function(t){e.$set(e.params,"endTime",t)},expression:"params.endTime"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.type")}},[a("el-select",{staticStyle:{width:"90px"},attrs:{placeholder:"请选择",size:"mini"},on:{change:e.toggleChart},model:{value:e.params.style,callback:function(t){e.$set(e.params,"style",t)},expression:"params.style"}},e._l(e.chartType,(function(t,i){return a("el-option",{key:i,attrs:{disabled:-1!=e.disabledChart.indexOf(t.type),label:t.name,value:t.type}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.interval")}},[a("el-input-number",{staticStyle:{width:"100px"},attrs:{min:1,placeholder:"请输入内容",size:"mini"},model:{value:e.params.number,callback:function(t){e.$set(e.params,"number",t)},expression:"params.number"}}),a("el-select",{staticStyle:{width:"70px"},attrs:{placeholder:"请选择",size:"mini"},model:{value:e.params.interval,callback:function(t){e.$set(e.params,"interval",t)},expression:"params.interval"}},e._l(e.interval,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.type}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.function")}},[a("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择",size:"mini"},model:{value:e.params._function,callback:function(t){e.$set(e.params,"_function",t)},expression:"params._function"}},e._l(e.functionarr,(function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})})),1),a("el-button",{attrs:{disabled:e.queryFlag,icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.queryChart}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1)],1)],1)],1),a("div",{key:e.chartKey,staticClass:"chartsmain"},[a("vabChart",{ref:"charts",attrs:{"after-config":e.afterConfig,data:e.chartData,"data-empty":e.dataEmpty,"data-zoom":e.chartDataZoom,extend:e.chartExtend,loading:e.loading,"set-option-opts":!1,settings:e.chartSettings,toolbox:e.toolbox,type:e.params.style}})],1),a("div",{staticClass:"chartOther"},[a("el-row",{attrs:{gutter:20}},[e._l(e.chartData.child,(function(t,i){return a("el-col",{directives:[{name:"show",rawName:"v-show",value:"日期"!=t.columns[1],expression:"item.columns[1] != '日期'"}],key:i,attrs:{md:e.md,sm:e.sm,xl:e.xl,xs:e.xs}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v(e._s(t.columns[1])+" : "+e._s(t.unit))]),a("el-button-group",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"}},[a("el-button",{attrs:{icon:"el-icon-warning-outline"}}),a("el-button",{attrs:{icon:"el-icon-full-screen"},on:{click:function(t){return e.toggleCardRow(i,e.xs,e.sm,e.md,e.xl)}}})],1)],1),a("vabChart",{ref:"charts",refInFor:!0,attrs:{"after-config":e.afterConfig,data:e.chartData.child[i],"data-empty":e.dataEmpty,"data-zoom":e.chartDataZoom,extend:e.chartExtend,height:"300px","legend-visible":!1,loading:e.loading,"set-option-opts":!1,settings:e.chartSettings,toolbox:e.toolbox,type:e.params.style}})],1)],1)})),a("el-col",{directives:[{name:"show",rawName:"v-show",value:!e.chartData.child,expression:"!chartData.child"}],attrs:{span:24}},[a("vab-empty")],1)],2)],1)])]),a("div",{staticClass:"twofirsttable",staticStyle:{"box-sizing":"border-box",padding:"10px","margin-top":"20px",background:"#ffffff"}})]),"0"!=e.$route.query.nodeType?a("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.subdevice"),name:"children"}},[a("div",{staticClass:"childrendevices"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.childrendevices,size:"small"}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicenumber")+":"}},[a("el-input",{attrs:{placeholder:e.$t("equipment.devicenumber")},model:{value:e.childrendevices.devicesname,callback:function(t){e.$set(e.childrendevices,"devicesname",t)},expression:"childrendevices.devicesname"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.getDevices(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1),a("el-form-item",[a("el-button",{attrs:{disabled:0==e.multipleTable.length,type:"primary"},on:{click:e.deleteDevcie}},[e._v(" "+e._s(e.$translateTitle("equipment.RelievingAssociation"))+" ")]),a("el-button",{attrs:{disabled:0==e.multipleTable.length,type:"primary"},on:{click:e.unactiveDevice}},[e._v(" "+e._s(e.$translateTitle("developer.prohibit"))+" ")]),a("el-button",{attrs:{disabled:0==e.multipleTable.length,type:"primary"},on:{click:e.activeDevice}},[e._v(" "+e._s(e.$translateTitle("developer.enable"))+" ")])],1),a("el-form-item",[a("el-button",{attrs:{plain:"",type:"info"}},[e._v(" "+e._s(e.$translateTitle("equipment.Refresh"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){e.childDialog=!0}}},[e._v(" "+e._s(e.$translateTitle("equipment.addchilddevice"))+" ")])],1)],1),a("div",{staticClass:"devicetable"},[a("el-table",{ref:"filterTable",staticStyle:{width:"100%","margin-top":"20px","text-align":"center"},attrs:{data:e.devicesTableData},on:{"selection-change":e.DevicesSelectionChange}},[a("el-table-column",{attrs:{align:"center",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.devicenumber")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.devaddr))]),a("p",{staticStyle:{margin:"0",color:"green"}},[e._v(e._s(t.row.name))])]}}],null,!1,4136976086)}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.state")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{class:t.row.status},[e._v(" "+e._s(t.row.status)+" ")])]}}],null,!1,2447536504)}),a("el-table-column",{attrs:{align:"center",label:"子网地址"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(" "+e._s(void 0==t.row.route?"":t.row.route[e.devicedetail.devaddr])+" ")])]}}],null,!1,2958591836)}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.product")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{attrs:{type:"success"}},[e._v(e._s(t.row.productName))])]}}],null,!1,1749163773)}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.nodetype")}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.prohibit")+"/"+e.$translateTitle("developer.enable")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-color":"#5eb058","inactive-color":"#cccccc"},on:{change:function(a){return e.handelUpdate(a,t.row,t.$index)}},model:{value:t.row.isEnable,callback:function(a){e.$set(t.row,"isEnable",a)},expression:"scope.row.isEnable"}})]}}],null,!1,1866847722)}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.lastonlinetime")},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.lastOnlineTime?a("span",[e._v(" "+e._s(e.timestampToTime(t.row.lastOnlineTime))+" ")]):a("span",[e._v("—")])]}}],null,!1,1144690468)}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.operation")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{attrs:{icon:"el-icon-view",type:"primary",underline:!1},on:{click:function(a){return e.deviceToDetail(t.row)}}},[e._v(" "+e._s(e.$translateTitle("equipment.see"))+" ")]),a("el-popover",{ref:"popover-"+t.$index,attrs:{placement:"top",width:"300"}},[a("p",[e._v("确定解除这个"+e._s(t.row.name)+"设备关联吗？")]),a("div",{staticStyle:{margin:"0","text-align":"right"}},[a("el-button",{attrs:{size:"mini"},on:{click:function(e){t._self.$refs["popover-"+t.$index].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.makeSure(t)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),a("el-link",{attrs:{slot:"reference",icon:"el-icon-delete",type:"danger",underline:!1},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("equipment.RelievingAssociation"))+" ")])],1)]}}],null,!1,4047583086)})],1)],1),a("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[a("el-pagination",{attrs:{layout:"total, sizes, prev, pager, next, jumper","page-size":e.childrenDeviceLength,"page-sizes":[10,20,30,50],total:e.childrenDeviceTotal},on:{"current-change":e.childrenDeviceCurrentChange,"size-change":e.childrenDeviceSizeChange}})],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,"close-on-click-modal":!1,title:e.$t("equipment.addchilddevice"),visible:e.childDialog,width:"30%"},on:{"update:visible":function(t){e.childDialog=t}}},[a("div",{staticClass:"childdialog"},[a("el-form",{ref:"childrenForm",staticClass:"demo-form-inline",attrs:{model:e.childrenForm}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.products"),prop:"product",rules:[{required:!0,message:"选择产品",trigger:"change"}]}},[a("el-select",{attrs:{placeholder:e.$t("equipment.products")},on:{change:e.checkProduct},model:{value:e.childrenForm.product,callback:function(t){e.$set(e.childrenForm,"product",t)},expression:"childrenForm.product"}},e._l(e.allProudct,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.equipment"),prop:"device",rules:[{required:!0,message:"选择设备",trigger:"change"}]}},[a("el-select",{directives:[{name:"el-select-loadmore",rawName:"v-el-select-loadmore",value:e.loadmore,expression:"loadmore"}],attrs:{disabled:!e.ischange,placeholder:e.$t("product.equipment")},model:{value:e.childrenForm.device,callback:function(t){e.$set(e.childrenForm,"device",t)},expression:"childrenForm.device"}},e._l(e.productDevices,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:"子网地址",prop:"route",rules:[{required:!0,message:"请输入子网地址",trigger:"blur"}]}},[a("el-input",{attrs:{placeholder:"子网地址"},model:{value:e.childrenForm.route,callback:function(t){e.$set(e.childrenForm,"route",t)},expression:"childrenForm.route"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.childDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitDevice("childrenForm")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)])],1):e._e(),e.isshowchild?a("el-tab-pane",{attrs:{label:e.$translateTitle("device.instruct"),name:"instruct"}},[a("Instruct",{attrs:{"devices-id":e.deviceid,"product-id":e.productid}})],1):e._e(),a("el-tab-pane",{attrs:{label:e.$translateTitle("device.trace"),name:"task"}},[a("scene-log",{directives:[{name:"show",rawName:"v-show",value:"task"==e.activeName,expression:"activeName == 'task'"}],ref:"SceneLog",attrs:{"device-info":e.deviceInfo,name:e.activeName}})],1),a("el-tab-pane",{attrs:{label:e.$translateTitle("device.log"),name:"trace"}},[a("device-log",{directives:[{name:"show",rawName:"v-show",value:"trace"==e.activeName,expression:"activeName == 'trace'"}],attrs:{devaddr:e.devicedevaddr,deviceid:e.deviceid,"is-device-info":!0,productid:e.productId}})],1),a("el-tab-pane",{attrs:{label:e.$translateTitle("device.alert"),name:"alert"}},[a("vab-empty")],1)],1)],1)])},r=[],n=a("1da1"),l=a("5530"),o=(a("96cf"),a("99af"),a("d3b7"),a("159b"),a("ddb0"),a("b0c0"),a("d81d"),a("e9c4"),a("3ca3"),a("c4e6")),s=a("6b97"),c=a("590c"),d=a("5880"),u=a("1285"),p=a("ed08"),m=a("c4b2"),h=a("ca7b"),f=[{title:"图片",width:120,dataIndex:"imgurl",fixed:"left",key:"imgurl",scopedSlots:{customRender:"imgurl"}},{title:"时间",dataIndex:"time",key:"time"},{title:"名称",dataIndex:"name",key:"name"},{title:"值",dataIndex:"number",key:"number"},{title:"单位",dataIndex:"unit",key:"unit"}],v={components:{Instruct:m["default"],info:o["default"],deviceLog:c["default"],SceneLog:s["default"]},filters:{filterVal:function(e){return e||0==e?e:"--"}},directives:{"el-select-loadmore":{bind:function(e,t){var a=e.querySelector(".el-select-dropdown .el-select-dropdown__wrap");a.addEventListener("scroll",(function(){var e=this.scrollHeight-this.scrollTop<=this.clientHeight;e&&t.value()}))}}},data:function(){return this.chartExtend={series:{barMaxWidth:35},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],left:"9%",bottom:-5,start:10,end:90}],grid:{right:40}},this.toolbox={orient:"vertical",right:-5,feature:{dataZoom:{yAxisIndex:"none"},magicType:{type:["line","bar","histogram","pie","ring","waterfall","funnel","radar","heatmap","scatter","candle","stack"]},dataView:{show:!0,readOnly:!1},saveAsImage:{show:!0},restore:{show:!0}}},{router:"",chartKey:moment(new Date).valueOf(),machinelist:{},thirdtbKey:moment(new Date).valueOf(),deviceInfo:{},columns:f,productId:this.$route.query.productid,activeNames:["1"],queryForm:{account:"",searchDate:"",pageNo:1,pageSize:20},buttonactive:1,loading:!0,xl:6,xs:24,sm:24,md:12,dataEmpty:!0,chartDataZoom:[{type:"slider"}],pickerOptions:{shortcuts:[{text:this.$translateTitle("developer.LastWeek"),onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:this.$translateTitle("developer.LastMonth"),onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:this.$translateTitle("developer.LastThreeMonths"),onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]},pickerOptionsDay:{shortcuts:[{text:this.$translateTitle("developer.today"),onClick:function(e){e.$emit("pick",new Date)}},{text:this.$translateTitle("developer.yesterday"),onClick:function(e){var t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:this.$translateTitle("developer.A week ago"),onClick:function(e){var t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]},chartData:{identifier:[],columns:[],rows:[]},params:{_function:"last",style:"",number:1,interval:"h",datetimerange:"",keys:"*",limit:100,endTime:new Date,startTime:(new Date).getTime()-6048e5},interval:[{type:"y",name:"年"},{type:"n",name:"月"},{type:"w",name:"周"},{type:"d",name:"日"},{type:"h",name:"时"},{type:"m",name:"分"},{type:"s",name:"秒"},{type:"a",name:"毫秒"},{type:"u",name:"微秒"}],functionarr:["count","avg","sum","stddev","min","max","first","last"],disabledChart:["map","sankey","wordcloud","liquidfill","tree","gauge"],chartType:h["default"],options:[{value:"选项1",label:"黄金糕"},{value:"选项2",label:"双皮奶"},{value:"选项3",label:"蚵仔煎"},{value:"选项4",label:"龙须面"},{value:"选项5",label:"北京烤鸭"}],value:"",chartSettings:{},queryFlag:!0,width:0,lineChartData:"",datafordetail:[],datadialogVisible:!1,childDialog:!1,ninthform:{product:"",devices:""},wmxform:{product:"",devices:""},tableData:[],activeName:"first",text:"1111111",deviceid:"",devicedetail:{},topicData:[],thirdstart:1,thirdlength:10,thirdtotal:0,topic:[{topic:"thing/${ProductId}/${DevAddr}/post",type:"pub",desc:"设备上报",isdef:!0},{topic:"thing/${ProductId}/${DevAddr}",type:"sub",desc:"消息下发",isdef:!0}],thirdData:[],thirdDatas:[],isupdate:!1,ispushdata:!0,timer:null,isshowtable:!1,childrendevices:{devicesname:""},multipleTable:[],devicesTableData:[],childrenDeviceLength:10,childrenDeviceStart:0,childrenDeviceTotal:0,childrenForm:{product:"",device:"",route:""},isshowchild:!1,allProudct:[],productDevices:[],ischange:!1,ischildren:!1,productid:"",dataDeviceTotal:0,dataDeviceLength:10,dataDeviceStart:1,devicedevaddr:"",dirstart:1,dirlength:20,selectproduct:"",watchNum:0}},computed:Object(l["a"])({},Object(d["mapGetters"])({Device:"settings/device"})),watch:{machinelist:{deep:!0,handler:function(e){}},sm:function(e){var t=this;this.$nextTick((function(e){t.resizeTheChart(),setTimeout((function(){t.loading=!1}),2e3)}))}},mounted:function(){this.params.style=this.chartType[0].type,this.$route.query.deviceid&&(this.deviceid=this.$route.query.deviceid,this.getDeviceDetail(this.deviceid),this.initChart(),this.getDeviceInfo(this.deviceid),window.addEventListener("resize",this.resizeTheChart)),this.router=this.$dgiotBus.router(location.href+this.$route.fullPath)},destroyed:function(){this.Unbscribe(),window.clearInterval(this.timer),this.timer=null},beforeDestroy:function(){window.removeEventListener("resize",this.resizeTheChart)},methods:{Unbscribe:function(){var e="logger_trace/trace/"+this.deviceInfo.objectId+"/#",t=this.$dgiotBus.topicKey(this.router,e);this.$dgiotBus.$emit("MqttUnbscribe",t,e)},getDeviceInfo:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var i,r,n,l,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(u["getDevice"])(e);case 2:r=a.sent,n="",n=null!==r&&void 0!==r&&null!==(i=r.product)&&void 0!==i&&i.objectId?r.product.objectId:"",l=r.devaddr,o=[{topic:"thing/".concat(n,"/").concat(l,"/post"),type:"pub",desc:"设备上报",isdef:!0},{topic:"thing/".concat(n,"/").concat(l),type:"sub",desc:"消息下发",isdef:!0}],r.product.topics?r.topicData=r.product.topics.concat(o):r.topicData=o,t.deviceInfo=r;case 9:case"end":return a.stop()}}),a)})))()},toggleChart:function(e){this.chartKey=moment(new Date).valueOf(),this.loading=!1,this.chartExtend={},this.chartDataZoom=[];var t=["funnel","radar","radar"];-1!=t.indexOf(e)?(this.chartExtend={},this.chartDataZoom=[]):(this.chartExtend={series:{barMaxWidth:35},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],left:"9%",bottom:-5,start:10,end:90}],grid:{right:40},yAxis:[{type:"value",axisLabel:{formatter:"{value} %"}}]},this.chartDataZoom=[{type:"slider"}]),this.resizeTheChart()},resizeTheChart:function(){var e=this.$refs["charts"];e instanceof Array?e.forEach((function(e){e.$children[0].resize()})):e.$children[0].resize()},toggleCardRow:function(e,t,a,i,r){this.sm=24==a?12:24,this.md=12==i?24:12,this.xl=6==r?12:6,this.loading=!0},afterConfig:function(e){return e.tooltip.showDelay=500,e},initChart:function(){var e=this,t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),this.params.datetimerange=[a,t],this.queryFlag=!1,this.$queryProduct({}).then((function(t){e.allProudct=t.results}))},queryChart:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a,i,r,n,l,o,s,c,d,p,m;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.chartData={identifier:[],columns:[],rows:[]},!e.params.startTime||!e.params.endTime){t.next=10;break}return e.$baseColorfullLoading(1,e.$translateTitle("home.messag_loding")),a=e.$route.query.deviceid,i=e.params,r=i.interval,n=i.keys,l=i.limit,o=i.number,s=i.style,c=i._function,d=i.startTime,p=i.endTime,m={starttime:moment(d).valueOf(),endtime:moment(p).valueOf(),interval:o+r,keys:n,limit:l,function:c,style:s},t.next=8,Object(u["getDabDevice"])(a,m).then((function(t){if(e.$baseColorfullLoading().close(),null!==t&&void 0!==t&&t.chartData){var a=t.chartData,i=void 0===a?{}:a;e.chartData=i,e.$nextTick((function(){setTimeout((function(){e.loading=!0,e.toggleChart("line")}),1e3)}))}e.loading=!1,e.dataEmpty=!1})).catch((function(t){e.loading=!1,e.$baseColorfullLoading().close()}));case 8:t.next=11;break;case 10:e.$message.error(e.$translateTitle("developer.Please select the query time"));case 11:case"end":return t.stop()}}),t)})))()},print:function(e){},tabHandleClick:function(e){"ninth"==e.name?this.$router.push({path:"/roles/onlinetest",query:{deviceid:this.devicedevaddr,productid:this.productid}}):"children"==e.name?this.getDevices():"third"==e.name?this.queryChart():"task"==e.name&&this.$refs.SceneLog.get_topic()},timestampToTime:function(e){var t=new Date(1e3*e),a=t.getFullYear()+"-",i=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",r=(t.getDate()+1<=10?"0"+t.getDate():t.getDate())+" ",n=(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":",l=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",o=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return a+i+r+n+l+o},getDevices:function(e){var t=this;0==e&&(this.childrenDeviceStart=0),this.devicesTableData=[];var a="route."+this.devicedetail.devaddr,i={};i[a]={$regex:".+"};var r={limit:this.childrenDeviceLength,skip:this.childrenDeviceStart,count:"objectId",include:"product",parentId:this.deviceId,where:i};""!=this.childrendevices.devicesname&&(r.where.devaddr=this.childrendevices.devicesname),this.$queryDevice(r).then((function(e){t.childrenDeviceTotal=e.count,e.results&&e.results.map((function(e){var a={};a.objectId=e.objectId,a.name=e.name,a.status=e.status,a.originstatus=e.status,a.nodeType=e.product.nodeType,a.productName=e.product.name,a.devaddr=e.devaddr,a.isEnable=e.isEnable,a.route=e.route,t.devicesTableData.push(a)}))})).catch((function(e){t.$baseMessage("请求出错11",e.error,3e3)}))},getDeviceDetail:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var i,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:i=t,i.ischildren=i.$route.query.ischildren,r={limit:1,count:"objectId",include:"product",where:{objectId:e}},Object(u["queryDevice"])(r).then((function(e){if(e.results.length>0){var t=e.results[0],a={};i.productid=i.$objGet(t,"product.objectId"),i.devicedevaddr=i.$objGet(t,"devaddr"),a.id=t.objectId,a.createdAt=Object(p["utc2beijing"])(t.createdAt),a.productName=i.$objGet(t,"product.name"),a.productid=i.$objGet(t,"product.objectId"),a.ip=i.$objGet(t,"ip"),a.basedata=JSON.stringify(t.basedata),a.DeviceName=t.name,a.status=t.status,a.desc=i.$objGet(t,"desc"),a.devaddr=i.$objGet(t,"devaddr"),a.nodeType=i.$objGet(t,"product.nodeType"),a.devType=i.$objGet(t,"product.devType"),a.productSecret=i.$objGet(t,"product.productSecret"),a.address=i.$objGet(t,"detail.address")||i.$objGet(t,"location.latitude")+"，"+i.$objGet(t,"location.longitude");i.$objGet(t,"tddata");var r=JSON.parse(JSON.stringify(i.$objGet(t,"product.thing.properties")));i.Update();var n=[];if(!r)return;r.forEach((function(e){e.devicetype&&n.push(e.devicetype)})),n=_.uniqBy(n);var l={};if(n.forEach((function(e){var t=[];r.forEach((function(a){e==a.devicetype&&t.push(a)})),l[e]=t})),i.machinelist=l,i.thirdtbKey=moment(new Date).valueOf(),i.devicedetail=a,0!=i.$route.query.nodeType&&"true"==i.ischildren){i.activeName="children",i.isshowchild=!0,i.getDevices()}else i.ischildren=!1,i.isshowchild=!0;i.isupdate=!0,i.updateTrue(!0),t.product.topics?i.topicData=t.product.topics.concat(i.topic):i.topicData=i.topic}else i.$message("objectId 未返回")}));case 4:case"end":return a.stop()}}),a)})))()},Update:function(){var e=this,t=this;Object(u["getCardDevice"])(t.deviceid).then((function(a){if(t.machinelist={},null!==a&&void 0!==a&&a.data){var i=[],r=a.data;r.forEach((function(e){e.devicetype&&i.push(e.devicetype)})),i=_.uniqBy(i);var n={};i.forEach((function(e){var t=[];r.forEach((function(a){e==a.devicetype&&t.push(a)})),n[e]=t})),t.machinelist=n,t.thirdtbKey=moment(new Date).valueOf()}else e.updateTrue(!1),e.isupdate=!1})).catch((function(t){e.updateTrue(!1),e.isupdate=!1}))},updateTrue:function(e){var t=this;this.ispushdata=!1,1==e?this.timer=window.setInterval((function(){t.Update()}),1e4):(window.clearInterval(this.timer),this.timer=null)},dataDeviceSizeChange:function(e){this.dataDeviceStart=1},dataDeviceCurrentChange:function(e){this.dataDeviceStart=e},handleSizeChange1:function(e){this.thirdstart=1,this.thirdlength=e},handleCurrentChange1:function(e){this.thirdstart=e},DevicesSelectionChange:function(e){this.multipleTable=e},childrenDeviceCurrentChange:function(e){this.childrenDeviceStart=(e-1)*this.childrenDeviceLength,this.getDevices()},childrenDeviceSizeChange:function(e){this.childrenDeviceLength=e,this.getDevices()},checkProduct:function(e){var t=this;this.ischange=!0,this.selectproduct=e;var a={limit:this.dirlength,skip:(this.dirstart-1)*this.dirlength,count:"objectId",where:{product:e}};this.$queryDevice(a).then((function(e){e.results&&e.results.length>0?t.productDevices=e.results:t.productDevices=[],t.childrenForm.device=""}))},deviceToDetail:function(e){this.$router.push({path:"/roles/editdevices",query:{deviceid:e.objectId,nodeType:e.nodeType,ischildren:"false"}})},loadmore:function(){this.dirstart++,this.checkProduct(this.selectproduct)},submitDevice:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;var a={};a[t.devicedevaddr]=t.childrenForm.route;var i={parentId:{__type:"Pointer",className:"Device",objectId:t.deviceid},route:a};t.$putDevice(t.childrenForm.device,i).then((function(e){e&&(t.$message({type:"success",message:"添加成功"}),t.childDialog=!1,t.getDevices(),t.$refs["childrenForm"].resetFields())}))}))},deleteDevcie:function(e){var t=this;Promise.all([this.multipleTable.map((function(e){var a={parentId:null};t.$putDevice(e.objectId,a).then((function(e){}))}))]).then((function(e){e&&0!=e.length?(t.$message({message:"解除关联成功",type:"success"}),t.getDevices()):t.$message({message:"解除关联失败",type:"error"})})).catch((function(e){}))},unactiveDevice:function(e){var t=this;Promise.all([this.multipleTable.map((function(e){var a={isEnable:!1};t.$putDevice(e.objectId,a).then((function(e){}))}))]).then((function(e){e&&0!=e.length?(t.$message({message:"禁用成功",type:"success"}),t.getDevices()):t.$message({message:"禁用失败",type:"error"})})).catch((function(e){}))},activeDevice:function(e){var t=this;Promise.all([this.multipleTable.map((function(e){var a={isEnable:!0};t.$putDevice(e.objectId,a).then((function(e){}))}))]).then((function(e){e&&0!=e.length?(t.$message({message:"启用成功",type:"success"}),t.getDevices()):t.$message({message:"启用失败",type:"error"})})).catch((function(e){}))},makeSure:function(e){var t=this,a=JSON.parse(JSON.stringify(e.row.route)),i=this.devicedevaddr;delete a[i];var r={parentId:null,route:a};this.$putDevice(e.row.objectId,r).then((function(a){a&&(t.$message({type:"success",message:"解除关联成功"}),e._self.$refs["popover-".concat(e.$index)].doClose(),t.getDevices())}))},handelUpdate:function(e,t,a){var i=this,r={};for(var n in t)r[n]=t[n];r.isEnable=1!=r.isEnable,this.devicesTableData[a]=r,this.$confirm("是否修改此设备状态?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e={};for(var a in t)e[a]=t[a];e.isEnable=1==e.isEnable;var r={isEnable:e.isEnable};i.$putDevice(t.objectId,r).then((function(e){i.$message({type:"success",message:"状态修改成功"})})),i.getDevices()})).catch((function(){i.$message({type:"info",message:"已取消修改"});var e=t;e.isEnable=1!=e.isEnable,i.devicesTableData[a]=e}))}}},g=v,b=(a("6bd1"),a("d361"),a("2877")),y=Object(b["a"])(g,i,r,!1,null,"4f4ef7fa",null);t["default"]=y.exports},"4c11":function(e,t,a){},"5d5b":function(e,t,a){"use strict";a("3412")},"602b":function(e,t,a){},"681c":function(e,t,a){"use strict";a("a1b9")},"6bd1":function(e,t,a){"use strict";a("d007")},"784a":function(e,t,a){},"7e10":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"group"},[a("el-container",[a("el-container",[a("el-main",[a("div",{staticClass:"main"},[a("el-drawer",{attrs:{direction:"ltr",visible:e.drawer},on:{"update:visible":function(t){e.drawer=t}}},[e.showTree?a("div",{staticClass:"tree"},[e._v(" 搜索 : "),a("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),a("el-tree",{ref:"tree",staticClass:"treeitems",attrs:{"allow-drag":e.allowDrag,"allow-drop":e.allowDrop,data:e.treeData,"default-expand-all":"",draggable:"","filter-node-method":e.filterNode,"node-key":"id",props:e.defaultProps},on:{"node-drop":e.handleDrop},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node,r=t.data;return a("span",{staticClass:"custom-tree-node"},[1==r.roles.seen?a("span",[a("el-input",{staticStyle:{width:"80%"},model:{value:e.editLabel,callback:function(t){e.editLabel=t},expression:"editLabel"}})],1):a("span",{staticStyle:{color:"#409eff"}},[e._v(e._s(i.label))]),0==r.roles.seen?a("span",{staticStyle:{"margin-left":"5px"}},[a("i",{staticClass:"el-icon-plus",staticStyle:{color:"#67c23a"},attrs:{title:"新增"},on:{click:function(t){return t.stopPropagation(),e.append(r)}}}),a("i",{staticClass:"el-icon-delete",staticStyle:{color:"red"},attrs:{title:"删除"},on:{click:function(t){return t.stopPropagation(),e.deletes(r)}}}),a("i",{staticClass:"el-icon-edit",staticStyle:{color:"#909399"},attrs:{title:"编辑"},on:{click:function(t){return t.stopPropagation(),e.rename(r)}}})]):a("span",[a("i",{staticClass:"el-icon-check",attrs:{slot:"suffix",title:"保存"},on:{click:function(t){return t.stopPropagation(),e.savename(r)}},slot:"suffix"})])])}}],null,!1,3055715610)})],1):e._e()]),a("el-tabs",{staticStyle:{display:"none"},on:{"tab-click":e.goTo},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.tabsNav,(function(e){return a("el-tab-pane",{key:e.url,attrs:{label:e.label,name:e.url}})})),1),a("router-view")],1),a("div",{staticClass:"setting"},[a("i",{class:[e.drawer?"el-icon-s-fold":"el-icon-s-unfold"],on:{click:function(t){return e.toggleTree()}}})])])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,center:"",title:"添加角色",visible:e.centerDialogRole,width:"35%"},on:{close:e.closeDialogRole}},[a("addroles",{ref:"addRoleRef"})],1)],1)},r=[],n=a("53ca"),l=(a("ac1f"),a("5319"),a("4de4"),a("d3b7"),a("b0c0"),a("5da9")),o=a("5638"),s=a("3858"),c={name:"Group",components:{addroles:s["default"]},data:function(){return{drawer:!1,tabsNav:[{label:"统计预览",url:"platform"},{label:"虚拟分组",url:"devproduct"},{label:"通道列表",url:"resourcechannel"},{label:"设备列表",url:"devicelist"},{label:"产品列表",url:"productlist"},{label:"规则列表",url:"engine"}],numberValidateForm:{name:""},centerDialogRole:!1,editLabel:"",filterText:"",addForm:{seen:!1,date:"",name:"",address:""},treeData:[],defaultProps:{children:"children",label:"alias",isLeaf:"leaf"},showTree:!0}},computed:{activeName:{get:function(){return""!=this.$route.path.replace("/dashboard/","")?this.$route.path.replace("/dashboard/",""):"platform"},set:function(){}}},watch:{filterText:function(e){this.$refs.tree.filter(e)}},mounted:function(){var e=this;this.$baseEventBus.$on("dialogHide",(function(){e.centerDialogRole=!1,e.getTree()})),this.getTree()},methods:{goTo:function(e){this.$router.push({path:"/dashboard/"+e.name})},toggleTree:function(){this.drawer=!this.drawer},getTree:function(){var e=this;function t(e){var a=Array.isArray(e)?[]:{};if(e&&"object"===Object(n["a"])(e))for(var i in e)e.roles&&(e.roles.seen=!1),e.hasOwnProperty(i)&&(e[i]&&"object"===Object(n["a"])(e[i])?a[i]=t(e[i]):a[i]=e[i]);return a}Object(l["roletree"])().then((function(a){e.treeData=t(a.results)})).catch((function(t){e.treeData=[]}))},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;Object(o["addGroup"])(t.numberValidateForm.name).then((function(e){t.$message({message:"新建设备分组成功",type:"success"})})).catch((function(e){t.$message({message:"新建设备分组失败"+e.computed,type:"error"})}))}))},resetForm:function(e){this.$refs[e].resetFields()},append:function(e){var t=this;this.centerDialogRole=!0,this.$nextTick((function(){t.$refs["addRoleRef"].getData(e)}))},closeDialogRole:function(){this.centerDialogRole=!1,this.getTree()},deletes:function(e){var t=this;this.$confirm("此操作将永久删除该节点,包括其子节点","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(l["delRole"])(e.objectId).then((function(e){t.getTree(),t.$message({type:"success",message:"删除成功!"})})).catch((function(e){t.$message({type:"error",message:"删除失败"+e.error})}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},rename:function(e){this.editLabel=e.alias,e.roles.seen=!0},savename:function(e){var t=this;e.alias!=this.editLabel&&Object(l["putRole"])(e.objectId,this.editLabel).then((function(a){t.$message({type:"success",message:"编辑成功"}),e.alias=t.editLabel})).catch((function(e){})),e.roles.seen=!1},allowDrop:function(e,t,a){return e.level===t.level&&(e.data.parentId===t.data.parentId?"prev"===a||"next"===a:void 0)},allowDrag:function(e){return 1!==e.level},handleDrop:function(e,t,a,i){var r=[],n=t.parent.childNodes;for(var l in n)r.push({id:n[l].data.id})},filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)}}},d=c,u=(a("681c"),a("2877")),p=Object(u["a"])(d,i,r,!1,null,"2819e2d5",null);t["default"]=p.exports},a1b9:function(e,t,a){},ce09:function(e,t,a){},d007:function(e,t,a){},d238:function(e,t,a){"use strict";a("602b")},d361:function(e,t,a){"use strict";a("4c11")},d60d:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"devproduct"},[a("h3",[e._v(" "+e._s(e.$translateTitle("route.产品管理"))+" "),e.projectName?a("span",[e._v(e._s("(所属应用:"+e.projectName+")"))]):e._e()]),a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("product.myproduct")+"("+e.total+")",name:"first"}},[a("div",{staticClass:"prosecond"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline,size:"small"}},[a("el-form-item",[a("el-input",{attrs:{placeholder:e.$translateTitle("product.searchproductname")},model:{value:e.formInline.productname,callback:function(t){e.$set(e.formInline,"productname",t)},expression:"formInline.productname"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.searchProduct(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1),a("el-form-item",{staticStyle:{float:"right","text-align":"right"}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:""!=e.projectid,expression:"projectid != ''"}],attrs:{type:"primary"},on:{click:e.addproduct}},[e._v(" "+e._s(e.$translateTitle("product.createproduct"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.goTopoview.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("product.topoview"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.exportpro.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("product.exportpro"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){e.importDialogShow=!0}}},[e._v(" "+e._s(e.$translateTitle("product.importpro"))+" ")])],1)],1),a("div",{staticClass:"protable"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.proTableData}},[a("el-table-column",{attrs:{label:"ProductID",prop:"objectId"}}),a("el-table-column",{attrs:{label:e.$translateTitle("product.productname")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.name))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.productgrouping")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.devType))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.nodetype")},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.nodeType?a("span",[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]):a("span",[e._v(e._s(e.$translateTitle("product.gateway")))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.classification")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.CategoryKey))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.addingtime")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.utc2beijing(t.row.createdAt)))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.operation"),width:"320"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{attrs:{icon:"el-icon-view",type:"primary",underline:!1},on:{click:function(a){return e.deviceToDetail(t.row)}}},[e._v(" "+e._s(e.$translateTitle("product.config"))+" ")]),a("el-popover",{ref:"popover-"+t.$index,attrs:{placement:"top",width:"300"}},[a("p",[e._v(" "+e._s(e.$translateTitle("product.qdsczg"))+e._s(t.row.name)+e._s(e.$translateTitle("equipment.cpm"))+" ")]),a("div",{staticStyle:{margin:"0","text-align":"right"}},[a("el-button",{attrs:{size:"mini"},on:{click:function(e){t._self.$refs["popover-"+t.$index].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.makeSure(t)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),a("el-link",{attrs:{slot:"reference",icon:"el-icon-delete",type:"danger",underline:!1},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1),a("el-link",{attrs:{icon:"el-icon-attract",type:"primary",underline:!1},on:{click:function(a){return e.GoTodevices(t.row)}}},[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]),a("el-link",{attrs:{icon:"el-icon-edit",type:"success",underline:!1},on:{click:function(a){return e.editorProduct(t.row)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.edit"))+" ")]),a("el-link",{attrs:{icon:"el-icon-s-promotion",type:"primary",underline:!1},on:{click:function(a){return e.proudctView(t.row)}}},[e._v(" "+e._s(e.$translateTitle("product.monitorconfiguration"))+" ")])]}}])})],1)],1),a("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[a("el-pagination",{attrs:{layout:"total, sizes, prev, pager, next, jumper","page-size":e.length,"page-sizes":[10,20,30,50],total:e.total},on:{"current-change":e.productCurrentChange,"size-change":e.productSizeChange}})],1)],1)])],1),a("div",{staticClass:"prodialog"},[a("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleClose,"close-on-click-modal":!1,title:e.$translateTitle("product.createproduct"),top:"5vh",visible:e.dialogFormVisible,width:"40%"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("div",{staticClass:"content"},[a("div",{staticClass:"contentone"},[a("div",{staticStyle:{display:"flex"}},[a("span",[e._v(e._s(e.$translateTitle("product.productinformation")))]),a("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"name"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.productgrouping"),prop:"devType"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.devType,callback:function(t){e.$set(e.form,"devType",t)},expression:"form.devType"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.classification")}},[a("el-cascader",{attrs:{options:e.categoryListOptions},model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("application.applicationtype"),rules:[{required:!0,message:e.$translateTitle("product.pleaseselectyourapp"),trigger:"blur"}]}},[a("el-select",{attrs:{disabled:""},on:{change:e.selectApp},model:{value:e.form.relationApp,callback:function(t){e.$set(e.form,"relationApp",t)},expression:"form.relationApp"}},e._l(e.allApps,(function(e,t){return a("el-option",{key:t,attrs:{label:e.title,value:e.title}})})),1)],1)],1)],1),a("div",{staticClass:"contenttwo",staticStyle:{"margin-top":"20px"}},[a("div",{staticStyle:{display:"flex"}},[a("span",[e._v(e._s(e.$translateTitle("product.nodetype")))]),a("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.nodetype"),prop:"nodeType"}},[a("el-radio-group",{on:{change:e.changeNode},model:{value:e.form.nodeType,callback:function(t){e.$set(e.form,"nodeType",t)},expression:"form.nodeType"}},[a("el-radio",{attrs:{label:0}},[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]),a("el-radio",{attrs:{label:1}},[e._v(" "+e._s(e.$translateTitle("product.gateway"))+" ")])],1)],1)],1)],1),a("div",{staticClass:"contentthird",staticStyle:{"margin-top":"20px"}},[a("div",{staticStyle:{display:"flex"}},[a("span",[e._v(" "+e._s(e.$translateTitle("product.networkinganddescription"))+" ")]),a("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.networking")+"(共"+e.channel.length+"项)",prop:"netType"}},[a("el-select",{attrs:{placeholder:e.$translateTitle("product.selectgateway")},model:{value:e.form.netType,callback:function(t){e.$set(e.form,"netType",t)},expression:"form.netType"}},e._l(e.channel,(function(e,t){return a("el-option",{key:t,attrs:{label:t+1+":"+e.label,title:"当前第"+(t+1)+"项",value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.productmodel")}},[e.imageUrl?a("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):a("i",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"el-icon-plus avatar-uploader-icon"}),a("form",{ref:"uploadform",staticStyle:{position:"absolute"},attrs:{enctype:"multipart/form-data",method:"POST"}},[a("input",{staticStyle:{position:"relative",top:"-100px","z-index":"5",width:"100px",height:"100px",cursor:"pointer",opacity:"0"},attrs:{type:"file"},on:{change:function(t){return e.upload(t)}}})]),e.imageUrl?a("el-button",{staticStyle:{"vertical-align":"text-bottom"},attrs:{size:"mini",type:"danger"},on:{click:e.deleteImgsrc}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")]):e._e()],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.describe"),prop:"desc"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1)],1)],1)]),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)])],1),a("div",{staticClass:"import-dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("product.importpro"),visible:e.importDialogShow,width:"25%"},on:{"update:visible":function(t){e.importDialogShow=t}}},[a("el-form",{ref:"uploadProForm",attrs:{model:e.formPro}},[a("el-upload",{ref:"fileUpload",staticClass:"upload-demo",attrs:{accept:".xls, .xlsx, .zip",action:e.uploadAction,"auto-upload":!1,data:e.uploadData,"file-list":e.fileList,headers:e.uploadHeaders,"on-change":e.handleChange,"on-error":e.handleUploadError,"on-success":e.handleUploadSuccess,"with-credentials":!0}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v(" "+e._s(e.$translateTitle("application.selectfiles"))+" ")])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"btn-left",attrs:{size:"small",type:"primary"},on:{click:e.submitUpload}},[e._v(" "+e._s(e.$translateTitle("application.upload"))+" ")]),a("el-button",{staticClass:"btn-right",attrs:{size:"small"},on:{click:function(t){e.importDialogShow=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)],1)],1)],1)},r=[],n=a("1da1"),l=(a("e9c4"),a("4de4"),a("d3b7"),a("b0c0"),a("ac1f"),a("1276"),a("c19f"),a("5cc69"),a("907a"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("72f7"),a("5319"),a("d81d"),a("a9e3"),a("99af"),a("96cf"),a("e0e9")),o=a("58dd"),s=a("1285"),c=a("7212"),d=(a("5118"),a("926a")),u=a("e455"),p=a("be65"),m=a.n(p),h=a("5da9"),f=(a("0b16"),a("f43e").Base64),v={data:function(){return{length:10,total:0,start:0,activeName:"first",formInline:{productname:""},uploadHeaders:{sessionToken:m.a.get("access_token")},uploadAction:"",uploadData:{},fileList:[],productIdentifier:"",proTableData:[],formLabelWidth:"80px",dialogFormVisible:!1,importDialogShow:!1,form:{name:"",category:[],nodeType:0,desc:"",netType:"",devType:"",productSecret:"",roles:[],relationApp:""},formPro:{name:"",url:""},rules:{roles:[{required:!0,message:"请选择所属应用",trigger:"blur"}],name:[{required:!0,message:"请输入产品",trigger:"blur"}],devType:[{required:!0,message:"请输入产品标识，用于区分不同设备",trigger:"blur"}],category:[{required:!0,message:"请选择所属分类",trigger:"change"}],nodeType:[{required:!0,message:"请选择节点类型",trigger:"change"}],netType:[{required:!0,message:"请选择联网方式",trigger:"change"}],relationApp:[{required:!0,message:"请选择产品可见角色",trigger:"change"}]},option:[],ruleoptions:[],channel:[{label:"蜂窝(2G/3G/4G)(直连)",value:"CELLULAR"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"BLE(低功耗蓝牙)",value:"Bluetooth"},{label:"5G通道(直连)",value:"5G"},{label:"WIFI通道(直连)",value:"WIFI"},{label:"ZigBee通道",value:"ZigBee"},{label:"Modbus",value:"Modbus"},{label:"LoRa(WAN)(直连)",value:"LoRaWAN"},{label:"OPC UA",value:" OPC UA"},{label:"ZETA通道",value:"ZETA"},{label:"网线连接(直连)",value:"网线连接"},{label:"自定义",value:"OTHER"}],imageUrl:"",productid:"",loading:!1,allApps:[],categoryList:[],categoryListOptions:[],fileServer:"",access_token:"",projectid:"",projectName:"",allTableDate:[]}},computed:{},mounted:function(){this.Industry(),this.searchProduct(0)},beforeDestroy:function(){this.projectName=""},methods:{changeNode:function(e,t){0!=t&&(this.form.netType=""),this.channel=0==e?[{label:"蜂窝(2G/3G/4G)",value:"CELLULAR"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"BLE(低功耗蓝牙)",value:"Bluetooth"},{label:"5G通道",value:"5G"},{label:"WIFI通道",value:"WIFI"},{label:"ZigBee通道",value:"ZigBee"},{label:"LoRa(WAN)",value:"LoRaWAN"},{label:"Modbus",value:"Modbus"},{label:"OPC UA",value:" OPC UA"},{label:"ZETA通道",value:"ZETA"},{label:"网线连接",value:"网线连接"},{label:"自定义",value:"OTHER"}]:[{label:"蜂窝(2G/3G/4G)",value:"CELLULAR"},{label:"5G通道",value:"5G"},{label:"WIFI通道",value:"WIFI"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"LoRaWAN",value:"LoRaWAN"},{label:"网线连接",value:"网线连接"},{label:"自定义",value:"OTHER"}]},getRoles:function(){return Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(o["app_count"])({where:{}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))()},selectApp:function(e){var t=this;e&&Object(h["getServer"])(e).then((function(e){e&&(t.fileServer=e.file,t.access_token=e.access_token)}))},treeData:function(e){var t=JSON.parse(JSON.stringify(e));return t.filter((function(e){var a=t.filter((function(t){return e.id==t.parentid}));return a.length>0&&(e.children=a),0==e.parentid}))},deleteImgsrc:function(){event.stopPropagation(),this.imageUrl=""},upload:function(e){if(this.loading=!0,e){var t=e.target.files[0],a=t.name,i=e.target.files[0].type,r=(t.type.split("/")[0],"image/jpeg"===i||"image/JPEG"===i||"image/png"===i||"image/PNG"===i||"image/bpm"===i||"image/BPM"===i);if(!r)return this.$message({message:"请上传图片",type:"error"}),!1;var n=new FileReader;n.readAsDataURL(t);var l=this;n.onloadend=function(){var e=n.result,t=l.dataURItoBlob(e);l.uploadFile(t,a)}}},dataURItoBlob:function(e){for(var t=atob(e.split(",")[1]),a=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(t.length),r=new Uint8Array(i),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return new Blob([i],{type:a})},uploadFile:function(e,t){var a=this,i=new FormData;i.append("file",e,t),i.append("output","json"),i.append("path",this.form.relationApp),i.append("auth_token",this.access_token);this.$http.post(this.fileServer,i).then((function(e){e&&(a.imageUrl=e.body.url,a.loading=!1)})).catch((function(e){a.loading=!1,a.$message(e.bodyText)}))},submitUpload:function(){var e=this;this.uploadAction="/product",this.$nextTick((function(){e.uploadData.appid=m.a.get("appids"),e.$refs.fileUpload.submit()}))},handleUploadSuccess:function(e,t,a){this.$message({type:"success",message:"产品导入成功"}),this.importDialogShow=!1,this.$refs["uploadProForm"].resetFields(),this.searchProduct()},handleUploadError:function(e,t,a){this.$message({showClose:!0,message:e})},handleChange:function(e,t){t.length>0&&(this.fileList=[t[t.length-1]])},utc2beijing:function(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},getDict:function(e,t){var a=this;return Object(n["a"])(regeneratorRuntime.mark((function i(){var r,n;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,a.$query_object("Dict",{limit:1e3,where:{type:{$in:t}}});case 2:r=i.sent,n=r.results,a.allTableDate=n,e.map((function(e){n.map((function(t){e.category==t.type&&(e.CategoryKey=t.data.CategoryName)}))})),a.proTableData=e;case 7:case"end":return i.stop()}}),i)})))()},searchProduct:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var i,r,n,l,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return 0==e&&(t.start=0),i=[],r={order:"-updatedAt",skip:t.start,limit:t.length,count:1,where:{devType:{$ne:"report"}}},""!=t.formInline.productname&&(r.where.name=t.formInline.productname),a.next=6,Object(c["queryProduct"])(r);case 6:n=a.sent,l=n.results,o=n.count,l.map((function(e,t){""!=e.category&&e.category&&i.push(e.category)})),t.getDict(l,i),t.total=o,t.getRoles().then((function(e){t.allApps=e.results})).catch((function(e){Object(d["returnLogin"])(e)}));case 13:case"end":return a.stop()}}),a)})))()},handleClose:function(){this.dialogFormVisible=!1},addproduct:function(){this.dialogFormVisible=!0},getParent:function(e,t,a){var i=this;return t.map((function(r){e==r.id?(a.unshift(r.value),i.getParent(r.parentid,t,a)):0==r.parentid&&r.id==e&&a.unshift(r.value)})),this.form.category=a,a},getIndustryParent:function(e,t){var a=this;t.map((function(i){i.value==e&&a.getParent(i.id,t,[])}))},editorProduct:function(e){for(var t in this.form.relationApp="",this.dialogFormVisible=!0,this.productid=e.objectId,this.getIndustryParent(e.category,this.categoryList),this.form.desc=e.desc,this.form.name=e.name,this.form.nodeType=e.nodeType,this.form.netType=e.netType,this.form.devType=e.devType,this.form.productSecret=e.productSecret,this.changeNode(e.nodeType,0),e.icon&&(this.imageUrl=e.icon),e.ACL)this.form.relationApp=t?t.substr(5):"";this.selectApp(this.form.relationApp)},Industry:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a,i,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.categoryList=[],a={limit:1e3,where:{"data.key":"category"}},t.next=4,Object(l["queryDict"])(a);case 4:i=t.sent,r=i.results,r.map((function(t){var a={};a.value=t.type,a.label=t.data.CategoryName,a.id=t.data.Id,a.parentid=t.data.SuperId,e.categoryList.push(a)})),e.categoryListOptions=e.treeData(e.categoryList);case 8:case"end":return t.stop()}}),t)})))()},addProduct:function(){this.$message("新增产品")},editProduct:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var i,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i={productSecret:t.form.productSecret,nodeType:t.form.nodeType,netType:t.form.netType,dynamicReg:!1,category:t.form.category[t.form.category.length-1],icon:t.imageUrl,name:t.form.name,devType:t.form.devType,desc:t.form.desc,topics:[]},a.next=3,Object(c["putProduct"])(e,i);case 3:r=a.sent,r&&(t.$message({type:"success",message:"编辑成功"}),t.dialogFormVisible=!1,t.$refs["ruleForm"].resetFields(),t.searchProduct(),t.productid="");case 5:case"end":return a.stop()}}),a)})))()},submitForm:function(e){var t=this;this.$Cookies.get("userId");this.$refs[e].validate((function(e){if(!e)return!1;var a=Math.ceil(25*Math.random());f.encode(String.fromCharCode(65+a)+Math.ceil(1e7*Math.random())+Number(new Date));""==t.productid?t.addProduct():t.editProduct(t.productid)}))},resetProductForm:function(){this.form={name:"",category:[],nodeType:0,desc:"",netType:"",devType:"",productSecret:"",roles:[],relationApp:""},this.imageUrl=""},deviceToDetail:function(e){this.$router.push({path:"/roles/detailproduct",query:{id:e.objectId}})},GoTodevices:function(e){this.$router.push({path:"/roles/thing",query:{productid:e.objectId}})},makeSure:function(e){var t=this,a={count:"objectId",skip:0,limit:1,where:{product:e.row.objectId}};Object(s["queryDevice"])(a).then((function(a){a.count>0?t.$message("请先删除该产品下设备"):Object(c["getProduct"])(e.row.objectId).then((function(a){Object(c["delProduct"])(e.row.objectId).then((function(a){a&&(t.$message({type:"success",message:"删除成功"}),e._self.$refs["popover-".concat(e.$index)].doClose(),t.searchProduct())})).catch((function(e){}))})).catch((function(e){}))})).catch((function(e){}))},productSizeChange:function(e){this.length=e,this.searchProduct()},productCurrentChange:function(e){this.start=(e-1)*this.length,this.searchProduct()},proudctView:function(e){var t=window.location.origin+"/spa",a="production";t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var i="".concat(t,"/#/views/").concat(e.objectId);window.open(i,"__blank")},goTopoview:function(){var e=window.location.origin+"/spa",t="production";e="development"==t?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var a="".concat(e,"/#/view");window.open(a,"__blank")},exportpro:function(){this.allTableDate?Object(u["export_txt_to_zip"])(JSON.stringify(this.allTableDate),"Dict","Dict"):this.$message({type:"warning",message:"数据为空,无法导出"})}}},g=v,b=(a("d238"),a("5d5b"),a("2877")),y=Object(b["a"])(g,i,r,!1,null,"2cdf902f",null);t["default"]=y.exports},da47:function(e,t,a){"use strict";a("784a")},f0db:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"gateway"},[a("el-card",{staticClass:"wayheader",attrs:{shadow:"always"}},[a("div",{staticClass:"wayheaderone"},[a("span",{staticClass:"oneheader"},[e._v("网络设备")]),a("span",{staticClass:"twoheader"},[e._v("网络层级:"+e._s(e.cengji))]),a("span",{staticClass:"threeheader"})])])],1)},r=[],n={data:function(){return{cengji:2}},mounted:function(){},methods:{}},l=n,o=(a("da47"),a("2877")),s=Object(o["a"])(l,i,r,!1,null,"2c55e581",null);t["default"]=s.exports}}]);