/*!
 *  build: 杭州数蛙科技有限公司 
 *  copyright: dgiot-Dashboard 
 *  author: h7ml(h7ml@qq.com) 
 *  time: Wed Nov 17 2021 03:58:09 GMT+0000 (Coordinated Universal Time)
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6b859066"],{"0238":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-drawer",{staticClass:"parserTable",attrs:{"append-to-body":!0,direction:"rtl",visible:e.dialogFormVisible,width:"500"},on:{close:e.close},scopedSlots:e._u([{key:"footer",fn:function(){return[a("el-button",{on:{click:e.close}},[e._v(" "+e._s(e.$translateTitle("category.cancel"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.save(e.form.mark)}}},[e._v(" "+e._s(e.$translateTitle("category.submit"))+" ")])]},proxy:!0}])},[a("vab-query-form",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[a("vab-query-form-top-panel",[a("el-form",{ref:"form",attrs:{inline:!0,"label-width":"80px",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("alert.productname")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("alert.please enter")+e.$translateTitle("alert.product name")},on:{clear:e.Industry},model:{value:e.queryForm.productId,callback:function(t){e.$set(e.queryForm,"productId",t)},expression:"queryForm.productId"}},e._l(e.productData,(function(t){return a("el-option",{key:t.objectId,attrs:{label:t.name,value:t.objectId},nativeOn:{click:function(a){return e.Industry(t)}}})})),1)],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},on:{click:e.Industry}},[e._v(" 查询 ")])],1)],1)],1)],1),a("el-table",{staticStyle:{width:"100%"},attrs:{border:"","cell-style":{"text-align":"center"},data:e.tableData,"header-cell-style":{"text-align":"center"},height:e.$baseTableHeight(0)+180,size:"mini"}},[a("el-table-column",{attrs:{label:"objectId",prop:"objectId",width:"140"}}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.Templatename"),prop:"name",width:"180"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.operation")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.toDeleteATemplate(r.objectId)}}},[e._v(" "+e._s(e.$translateTitle("product.Delete template"))+" ")])]}}])})],1),a("vab-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.queryForm.total>0,expression:"queryForm.total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.queryForm.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.Industry}})],1)},i=[],l=a("fb07"),o=a("e97b"),n=a("d0d7"),s=a.n(n),c=(a("c4bc"),a("16b8"),a("3dec"),a("79da"),a("ef68")),d=a("7212"),u=a("5880"),p={name:"ProductTemplet",data:function(){return{form:{},dialogFormVisible:!1,tableData:[],productData:[],queryForm:{productId:"",productFlag:!1,pageNo:1,pageSize:20,searchDate:[],limt:10,skip:0,total:0,order:"-createdAt",keys:"count(*)"}}},computed:Object(o["a"])(Object(o["a"])({},Object(u["mapGetters"])({role:"acl/role",username:"user/username"})),{},{aclObj:function(){var e={};return this.role.map((function(t){e["".concat("role:"+t.name)]={read:!0,write:!0}})),e}}),created:function(){},mounted:function(){},methods:{selectType:function(e){this.form.data=e},categoryChange:function(e){},Industry:function(){var e=arguments,t=this;return Object(l["a"])(s.a.mark((function a(){var r,i,l,o,n,d,u;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.length>0&&void 0!==e[0]?e[0]:{},r.limit||(r=t.queryForm),i={limit:r.limit,order:r.order,skip:r.skip,keys:r.keys},a.prev=3,l=t.$baseColorfullLoading(),a.next=7,Object(c["queryProductTemplet"])(i);case 7:o=a.sent,n=o.results,d=o.count,u=void 0===d?0:d,l.close(),t.tableData=n,t.queryForm.total=u,a.next=19;break;case 16:a.prev=16,a.t0=a["catch"](3),t.$message.error("".concat(a.t0));case 19:case"end":return a.stop()}}),a,null,[[3,16]])})))()},queryProduct:function(){var e=this;return Object(l["a"])(s.a.mark((function t(){var a,r,i;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a=e.$baseColorfullLoading(),t.next=4,Object(d["queryProduct"])({keys:"name",where:{}});case 4:r=t.sent,i=r.results,a.close(),e.productData=i,t.next=12;break;case 10:t.prev=10,t.t0=t["catch"](0);case 12:case"end":return t.stop()}}),t,null,[[0,10]])})))()},updateTemplate:function(e){return Object(l["a"])(s.a.mark((function t(){return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,api(e);case 3:t.sent,t.next=8;break;case 6:t.prev=6,t.t0=t["catch"](0);case 8:case"end":return t.stop()}}),t,null,[[0,6]])})))()},toDeleteATemplate:function(e){var t=this;return Object(l["a"])(s.a.mark((function a(){var r;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r=t.$baseColorfullLoading(),a.next=4,Object(c["delProductTemplet"])(e);case 4:a.sent,r.close(),t.$message.success(t.$translateTitle("user.successfully deleted")),t.Industry(),a.next=13;break;case 10:a.prev=10,a.t0=a["catch"](0),t.$message.error(t.$translateTitle("user.error deleted")+"".concat(a.t0));case 13:case"end":return a.stop()}}),a,null,[[0,10]])})))()},showEdit:function(e){this.queryProduct(),e&&(this.queryForm.productId=e),this.queryForm.productFlag=!0,this.Industry(),this.dialogFormVisible=!0},close:function(){this.dialogFormVisible=!1},save:function(e){var t=this,a={"*":{read:!0}};a[this.objectid]={read:!0,write:!0};var r={name:this.form.name,type:this.form.type,data:this.form.data,order:this.form.order},i="top"==e?_.merge(r,{ACL:_.merge(a,this.aclObj),parent:{objectId:"0",__type:"Pointer",className:"Category"}}):"child"==e?_.merge(r,{ACL:_.merge(a,this.aclObj),parent:{objectId:this.form.objectId,__type:"Pointer",className:"Category"}}):r;this.$refs["form"].validate(function(){var a=Object(l["a"])(s.a.mark((function a(r){var l,o;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!r){a.next=15;break}if("edit"!=e){a.next=7;break}return a.next=4,putCategory(t.form.objectId,i);case 4:a.t0=a.sent,a.next=10;break;case 7:return a.next=9,postCategory(i);case 9:a.t0=a.sent;case 10:l=a.t0,o=l.msg,t.$baseMessage(o,"success","vab-hey-message-success"),t.$emit("fetch-data"),t.close();case 15:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())}}},m=p,f=a("bdd7"),b=Object(f["a"])(m,r,i,!1,null,null,null);t["default"]=b.exports},"02df":function(e,t,a){"use strict";a("adc5")},"04b0":function(e,t,a){},"0fd9":function(e,t,a){"use strict";a("04b0")},1238:function(e,t,a){},"1c75":function(e,t,a){"use strict";a("e442")},2368:function(e,t,a){"use strict";a("c2d2")},"27bd":function(e,t,a){"use strict";a("6dad")},"2ea6":function(e,t,a){},"30d9":function(e,t,a){"use strict";a("e094")},"31fb":function(e,t,a){},"39b8":function(e,t,a){},4095:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"gateway"},[a("el-card",{staticClass:"wayheader",attrs:{shadow:"always"}},[a("div",{staticClass:"wayheaderone"},[a("span",{staticClass:"oneheader"},[e._v("网络设备")]),a("span",{staticClass:"twoheader"},[e._v("网络层级:"+e._s(e.cengji))]),a("span",{staticClass:"threeheader"})])])],1)},i=[],l={data:function(){return{cengji:2}},mounted:function(){},methods:{}},o=l,n=(a("1c75"),a("bdd7")),s=Object(n["a"])(o,r,i,!1,null,"421e4474",null);t["default"]=s.exports},"4c00":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{key:e.productId},[a("el-descriptions",{staticClass:"margin-top",attrs:{border:"",column:2,"content-style":{"text-align":"left"},"label-style":{"text-align":"center"}}},[a("el-descriptions-item",[a("template",{slot:"label"},[a("el-link",{attrs:{type:"success"},nativeOn:{click:function(t){e.dialogTableVisible=!1}}},[e._v(" "+e._s(e.$translateTitle("product.physicalmodel"))+" ")])],1),a("el-link",{attrs:{disabled:!e.productDetail.thing.properties.length,type:e.productDetail.thing.properties.length?"success":"default"},nativeOn:{click:function(t){return e.featProperties(e.productDetail.thing.properties)}}},[e._v(" "+e._s(e.productDetail.thing.properties.length||0)+" ")])],2),a("el-descriptions-item",{attrs:{label:e.$translateTitle("product.parser")}},[a("template",{slot:"label"},[a("el-link",{attrs:{type:"success"},nativeOn:{click:function(t){return e.feateditorParser(e.productDetail,"parser",!0)}}},[e._v(" "+e._s(e.$translateTitle("product.parser"))+" ")])],1),a("el-link",{attrs:{type:e.productDetail.config.parser.length?"success":"default"},nativeOn:{click:function(t){return e.feateditorParser(e.productDetail,"parser",!1)}}},[e._v(" "+e._s(e.productDetail.config.parser.length||0)+" ")])],2),a("el-descriptions-item",[a("template",{slot:"label"},[a("el-link",{attrs:{type:"success"},nativeOn:{click:function(t){return e.feateditorParser(e.productDetail,"profile",!0)}}},[e._v(" "+e._s(e.$translateTitle("product.profile"))+" ")])],1),a("el-link",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.feateditorParser(e.productDetail,"profile",!1)}}},[e._v(" "+e._s(e.productDetail.config.profile.length||0)+" ")])],2),e._e(),a("el-descriptions-item",[a("template",{slot:"label"},[a("el-link",{attrs:{disabled:!e.productDetail.decoder.code.length,type:"primary"},nativeOn:{click:function(t){return e.seeDecoder(e.productDetail)}}},[e._v(" "+e._s(e.$translateTitle("product.decoder"))+" ")])],1)],2),a("el-descriptions-item",[a("template",{slot:"label"},[a("el-link",{attrs:{disabled:10!=e.productId.length,type:"success"},nativeOn:{click:function(t){e.dialogTableVisible=!e.dialogTableVisible}}},[e._v(" "+e._s(e.$translateTitle("product.lowcode"))+" ")])],1),a("el-link",{attrs:{disabled:10!=e.productId.length,type:"success"},nativeOn:{click:function(t){e.dialogTableVisible=!e.dialogTableVisible}}},[e._v(" "+e._s(e.lowcodeLen)+" ")])],2)],1),a("vab-query-form",{directives:[{name:"show",rawName:"v-show",value:10==e.productId.length&&!e.dialogTableVisible,expression:"productId.length == 10 && !dialogTableVisible"}]},[a("vab-query-form-left-panel",[a("el-button",{attrs:{size:"small",type:"primary"},nativeOn:{click:function(t){return e.checkschema.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("product.viewobjectmodel"))+" ")]),a("el-button",{attrs:{size:"small",type:"primary"},nativeOn:{click:function(t){return e.createProperty.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("product.newobjectmodel"))+" ")])],1)],1),e.dialogTableVisible?a("div",{staticStyle:{"margin-top":"10px"}},[a("dgiot-views",{attrs:{"view-form":e.viewForm}})],1):e._e(),e.codeFlag||e.dialogTableVisible?e.codeFlag?a("vab-editor",{staticStyle:{height:"500px"},attrs:{lang:"erlang",theme:"monokai"},model:{value:e.ace_editor,callback:function(t){e.ace_editor=t},expression:"ace_editor"}}):a("el-empty",{attrs:{"image-size":200}}):a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],key:e.tableType,staticStyle:{width:"100%"},attrs:{"cell-style":{"text-align":"center"},data:"things"==e.tableType?e.things:"profile"==e.tableType||"parser"==e.tableType?e.parserTableList:"basedate.params"==e.tableType?e.dictTableList:[],"header-cell-style":{"text-align":"center"},height:"60vh","highlight-current-row":"",size:"medium"}},["things"==e.tableType?a("div",{key:e.tableType+e.thingKey},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return"struct"==e.row.dataType.type?[a("el-table",{staticStyle:{"box-sizing":"border-box",width:"60%","text-align":"center"},attrs:{data:e.row.dataType.specs}},[a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("product.identifier")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.identifier))])]}}],null,!0)}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("product.functionaltypes")}},[a("span",[e._v(" "+e._s(e.$translateTitle("product.attribute"))+" ")])]),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("product.functionname"),prop:"name"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("product.datadefinition")}})],1)]:void 0}}],null,!0)}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("product.order"),sortable:"",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.dataForm.order)+" ")]}}],null,!1,3334091129)}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("product.Rounds"),sortable:"",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.dataForm.round)+" ")]}}],null,!1,2600166517)}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("product.Strategy"),sortable:"",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.dataForm.strategy)+" ")]}}],null,!1,1968030284)}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("product.protocol"),sortable:"",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.dataForm&&a.dataForm.protocol?a.dataForm.protocol:"")+" ")]}}],null,!1,1423239548)}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("product.functionaltypes"),sortable:"",width:"120"}},[a("span",[e._v(e._s(e.$translateTitle("product.attribute")))])]),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("product.identifier"),prop:"identifier",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("product.functionname"),prop:"name",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("product.datatype"),sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(r.dataType.type))])]}}],null,!1,3310753818)}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("product.datadefinition"),sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[!r.dataType.specs||"double"!=r.dataType.type&&"float"!=r.dataType.type&&"int"!=r.dataType.type?"string"==r.dataType.type?a("span",[e._v(" "+e._s(e.$translateTitle("product.datalength")+":"+r.dataType.size+e.$translateTitle("product.byte"))+" ")]):"date"==r.dataType.type?a("span"):"struct"!=r.dataType.type?a("span",[e._v(" "+e._s(r.dataType.specs)+" ")]):a("span"):a("span",[e._v(" "+e._s(e.$translateTitle("product.rangeofvalues")+r.dataType.specs.min+"~"+r.dataType.specs.max)+" ")])]}}],null,!1,2493208036)}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.operation"),width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{size:"mini",type:"danger"},nativeOn:{click:function(t){return e.deletewmx(e.scope.$index)}}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")]),a("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){return e.wmxDataFill(r.scope.$index)}}},[e._v(" "+e._s(e.$translateTitle("task.Edit"))+" ")])]}}],null,!1,1097713753)})],1):"profile"==e.tableType||"parser"==e.tableType?a("div",[a("el-table-column",{attrs:{align:"center",label:"uid",prop:"uid","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("product.chinesetitle"),prop:"name","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-popover",{attrs:{placement:"top",trigger:"hover"}},[a("p",[e._v(" "+e._s(e.$translateTitle("product.englishtitle"))+": "+e._s(r.enname)+" ")]),a("p",[e._v(" "+e._s(e.$translateTitle("developer.describe"))+": "+e._s(r.description)+" ")]),a("p",[e._v(" "+e._s(e.$translateTitle("product.identifier"))+": "+e._s(r.identifier)+" ")]),a("p",[e._v(" "+e._s(e.$translateTitle("developer.describe"))+": "+e._s(r.description)+" ")]),a("p",[e._v(" "+e._s(e.$translateTitle("product.Table Name"))+": "+e._s(r.table)+" ")]),a("p",[e._v(" "+e._s(e.$translateTitle("product.class"))+": "+e._s(r.field)+" ")]),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("el-tag",{attrs:{size:"medium"}},[e._v(" "+e._s(r.name)+" ")])],1)])]}}],null,!1,1179674302)}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("product.functionaltypes"),prop:"type","show-overflow-tooltip":"",sortable:""}})],1):"basedate.params"==e.tableType?a("div",[a("el-table-column",{attrs:{label:"序号",prop:"order"}}),a("el-table-column",{attrs:{label:"标识符",prop:"identifier"}}),a("el-table-column",{attrs:{label:"功能名称",prop:"name"}}),a("el-table-column",{attrs:{label:"数据类型",prop:"type"}}),a("el-table-column",{attrs:{label:"数据地址",prop:"address"}}),a("el-table-column",{attrs:{label:"数据长度",prop:"bytes"}}),a("el-table-column",{attrs:{label:"是否必填",prop:"required"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[r.required?a("span",[e._v("是")]):a("span",[e._v("否")])]}}],null,!1,2053984958)})],1):a("div",[a("el-empty",{attrs:{"image-size":200}})],1)])],1)},i=[],l=a("fb07"),o=a("e97b"),n=a("d0d7"),s=a.n(n),c=(a("04d6"),a("e170"),a("5880")),d=(a("8ba7"),a("c32d")),u=a.n(d),p=a("ef68"),m=a("0c3c"),f={name:"ProfileDescriptions",components:{dgiotViews:m["default"]},props:{thingKey:{required:!0,type:String,default:""},productId:{required:!0,type:String,default:""},tableLoading:{required:!1,type:Boolean,default:!1},dictTableList:{required:!1,type:Array,default:function(){return[]}},decoderTableList:{required:!1,type:Object,default:function(){}},parserTableList:{required:!1,type:Array,default:function(){return[]}},things:{required:!1,type:Array,default:function(){return[]}},tableType:{required:!0,type:String,default:""}},data:function(){return{lowcodeLen:0,viewForm:{},amisconfig:[],amisForm:{},dialogTableVisible:!1,key:u()(new Date).valueOf(),editType:0,amisJsonPlus:"",ace_editor:"",codeFlag:!1,amisFlag:!1,activeName:"first",productDetail:{decoder:{code:""},thing:{properties:[]},config:{parser:[],profile:[],amis:[],basedate:{params:[]}}}}},computed:Object(o["a"])({},Object(c["mapGetters"])({amisJson:"amis/amisJson"})),watch:{amisJson:{deep:!0,handler:function(e){this.amisJsonPlus=JSON.stringify(e)}},productId:{deep:!0,handler:function(e){10==e.length&&(this.viewForm={class:"ProductTemplet",type:"amis",key:e,title:"",disabled:!0,data:{}})}}},mounted:function(){var e=this;this.$baseEventBus.$off("lowcodeLen"),this.$baseEventBus.$on("lowcodeLen",(function(t){e.lowcodeLen=t}))},methods:Object(o["a"])(Object(o["a"])({saveAmis:function(e,t,a){var r=this;return Object(l["a"])(s.a.mark((function a(){return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return _.merge(r.productDetail,{config:{amis:t}}),a.next=3,Object(p["putProductTemplet"])(e,{config:r.productDetail.config});case 3:a.sent,r.$baseMessage(r.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),r.amisFlag=!1;case 6:case"end":return a.stop()}}),a)})))()},addAmis:function(){},handleEdit:function(e,t){this.amisForm=t,this.editType=e,this.set_amisJson(t.json),this.amisFlag=!0},handleDelete:function(e,t){this.amisconfig.splice(e,1)},cancelForm:function(){this.amisconfig[this.editType].json=this.amisJson,"add"==this.amisconfig[this.editType].type&&(this.amisconfig[this.editType].type="edit"),this.amisFlag=!1}},Object(c["mapMutations"])({set_amisJson:"amis/set_amisJson"})),{},{seeDecoder:function(e){var t=e.decoder,a=void 0===t?{}:t;this.codeFlag=!this.codeFlag,this.ace_editor=Base64.decode(a.code)},featProperties:function(e){this.codeFlag=!1,this.$parent.$parent.$parent.properties(e)},feateditorParser:function(e,t,a){this.codeFlag=!1,this.$parent.$parent.$parent.editorParser(e,t,a)},createProperty:function(){this.$parent.$parent.$parent.createProperty()},deletewmx:function(e){this.$parent.$parent.$parent.deletewmx(e)},wmxDataFill:function(e,t){this.$parent.$parent.$parent.wmxDataFill(e,t)},goKonva:function(e){this.$parent.$parent.$parent.goKonva(e)},checkschema:function(){this.$parent.$parent.$parent.checkschema()}})},b=f,v=(a("e46b"),a("bdd7")),h=Object(v["a"])(b,r,i,!1,null,"5e5b2b9d",null);t["default"]=h.exports},5887:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"devproduct"},[a("div",{staticClass:"prosecond"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline,size:"small"}},[a("el-form-item",[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("product.searchproductname")},model:{value:e.formInline.productname,callback:function(t){e.$set(e.formInline,"productname",t)},expression:"formInline.productname"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.searchProduct(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1),a("el-form-item",{staticStyle:{float:"right","text-align":"right"}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:""!=e.projectid,expression:"projectid != ''"}],attrs:{type:"primary"},on:{click:e.addproduct}},[e._v(" "+e._s(e.$translateTitle("product.createproduct"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addgroup.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("product.newlyadded"))+" ")])],1)],1),a("div",{staticClass:"protable"},[a("el-table",{staticStyle:{width:"100%"},attrs:{"cell-style":{"text-align":"center"},data:e.groupData,"header-cell-style":{"text-align":"center"}}},[a("el-table-column",{attrs:{label:"ProductID",prop:"objectId"}}),a("el-table-column",{attrs:{label:e.$translateTitle("product.productname")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(r.name))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.productgrouping")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(r.devType))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.nodetype")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[1==r.nodeType?a("span",[e._v(" "+e._s(e.$translateTitle("product.gateway"))+" ")]):e._e(),0==r.nodeType?a("span",[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]):e._e(),2==r.nodeType?a("span",[e._v(" "+e._s(e.$translateTitle("product.grouping"))+" ")]):e._e()]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.classification")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(r.category))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.addingtime")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(e.utc2beijing(r.createdAt)))])]}}])}),a("el-table-column",{attrs:{fixed:"right",label:e.$translateTitle("developer.operation"),width:"420"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary",underline:!1},on:{click:function(t){return e.deviceToDetail(r)}}},[e._v(" "+e._s(e.$translateTitle("product.config"))+" ")]),a("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.goKonva(r.objectId)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.konva"))+" ")]),a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.GoTodevices(r)}}},[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]),a("el-popover",{ref:"popover-"+e.scope.$index,staticStyle:{"margin-left":"10px"},attrs:{placement:"top"}},[a("p",[e._v(" "+e._s(e.$translateTitle("product.qdsczg"))+e._s(r.name)+e._s(e.$translateTitle("equipment.cpm"))+" ")]),a("div",{staticStyle:{margin:"0","text-align":"right"}},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.scope._self.$refs["popover-"+e.scope.$index].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.makeSure(e.scope)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),a("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)]}}])})],1)],1),a("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[a("el-pagination",{attrs:{layout:"total, sizes, prev, pager, next, jumper","page-size":e.length,"page-sizes":[10,20,30,50],total:e.total},on:{"current-change":e.productCurrentChange,"size-change":e.productSizeChange}})],1)],1),a("div",{staticClass:"prodialog"},[a("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleClose,"close-on-click-modal":!1,title:e.$translateTitle("product.createproduct"),top:"5vh",visible:e.dialogFormVisible,width:"40%"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("div",{staticClass:"content"},[a("div",{staticClass:"contentone"},[a("div",{staticStyle:{display:"flex"}},[a("span",[e._v(e._s(e.$translateTitle("product.productinformation")))]),a("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"name"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.productgrouping"),prop:"devType"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.devType,callback:function(t){e.$set(e.form,"devType",t)},expression:"form.devType"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.classification")}},[a("el-cascader",{attrs:{options:e.categoryListOptions},model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("application.applicationtype"),rules:[{required:!0,message:"请选择所属应用",trigger:"blur"}]}},[a("el-select",{attrs:{disabled:""},on:{change:e.selectApp},model:{value:e.form.relationApp,callback:function(t){e.$set(e.form,"relationApp",t)},expression:"form.relationApp"}},e._l(e.allApps,(function(e,t){return a("el-option",{key:t,attrs:{label:e.title,value:e.title}})})),1)],1)],1)],1),a("div",{staticClass:"contenttwo",staticStyle:{"margin-top":"20px"}},[a("div",{staticStyle:{display:"flex"}},[a("span",[e._v(e._s(e.$translateTitle("product.nodetype")))]),a("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.nodetype"),prop:"nodeType"}},[a("el-radio-group",{on:{change:e.changeNode},model:{value:e.form.nodeType,callback:function(t){e.$set(e.form,"nodeType",t)},expression:"form.nodeType"}},[a("el-radio",{attrs:{label:0}},[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]),a("el-radio",{attrs:{label:1}},[e._v(" "+e._s(e.$translateTitle("product.gateway"))+" ")]),a("el-radio",{attrs:{label:2}},[e._v(" "+e._s(e.$translateTitle("product.grouping"))+" ")])],1)],1)],1)],1),a("div",{staticClass:"contentthird",staticStyle:{"margin-top":"20px"}},[a("div",{staticStyle:{display:"flex"}},[a("span",[e._v(" "+e._s(e.$translateTitle("product.networkinganddescription"))+" ")]),a("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.networking")+"(共"+e.channel.length+"项)",prop:"netType"}},[a("el-select",{attrs:{placeholder:e.$translateTitle("product.selectgateway")},model:{value:e.form.netType,callback:function(t){e.$set(e.form,"netType",t)},expression:"form.netType"}},e._l(e.channel,(function(e,t){return a("el-option",{key:t,attrs:{label:t+1+":"+e.label,title:"当前第"+(t+1)+"项",value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.productmodel")}},[e.imageUrl?a("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):a("i",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"el-icon-plus avatar-uploader-icon"}),a("form",{ref:"uploadform",staticStyle:{position:"absolute"},attrs:{enctype:"multipart/form-data",method:"POST"}},[a("input",{staticStyle:{position:"relative",top:"-100px","z-index":"5",width:"100px",height:"100px",cursor:"pointer",opacity:"0"},attrs:{type:"file"},on:{change:function(t){return e.upload(t)}}})]),e.imageUrl?a("el-button",{staticStyle:{"vertical-align":"text-bottom"},attrs:{size:"mini",type:"danger"},on:{click:e.deleteImgsrc}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")]):e._e()],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.describe"),prop:"desc"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1)],1)],1)]),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)])],1),a("div",{staticClass:"add-group"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("developer.newvirtualgroup"),visible:e.groupform,width:"25%"},on:{"update:visible":function(t){e.groupform=t}}},[a("el-form",{ref:"addGroup",staticClass:"demo-ruleForm",attrs:{"label-width":"80px",model:e.addGroup}},[a("el-row",[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:e.$translateTitle("developer.groupname"),prop:"name",rules:[{required:!0,message:e.$translateTitle("developer.cannotbeempty")}]}})],1),a("el-col",{attrs:{span:18}},[a("el-input",{attrs:{autocomplete:"off",type:"text"},model:{value:e.addGroup.name,callback:function(t){e.$set(e.addGroup,"name",t)},expression:"addGroup.name"}})],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addDeviceGroup()}}},[e._v(" "+e._s(e.$translateTitle("product.newlyadded"))+" ")]),a("el-button",{on:{click:function(t){return e.resetForm()}}},[e._v(" "+e._s(e.$translateTitle("zetadevices.reset"))+" ")])],1)],1)],1),a("div",{staticClass:"import-dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("product.importpro"),visible:e.importDialogShow,width:"25%"},on:{"update:visible":function(t){e.importDialogShow=t}}},[a("el-form",{ref:"uploadProForm",attrs:{model:e.formPro}},[a("el-upload",{ref:"fileUpload",staticClass:"upload-demo",attrs:{accept:".xls, .xlsx, .zip",action:e.uploadAction,"auto-upload":!1,data:e.uploadData,"file-list":e.fileList,headers:e.uploadHeaders,"on-change":e.handleChange,"on-error":e.handleUploadError,"on-success":e.handleUploadSuccess,"with-credentials":!0}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v(" "+e._s(e.$translateTitle("application.selectfiles"))+" ")])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"btn-left",attrs:{size:"small",type:"primary"},on:{click:e.submitUpload}},[e._v(" "+e._s(e.$translateTitle("application.upload"))+" ")]),a("el-button",{staticClass:"btn-right",attrs:{size:"small"},on:{click:function(t){e.importDialogShow=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)],1)],1)])},i=[],l=a("fb07"),o=a("d0d7"),n=a.n(o),s=(a("16b8"),a("04d6"),a("a0e0"),a("3dec"),a("1d17"),a("4c87"),a("b463"),a("a44e"),a("4ccb"),a("3559"),a("d06e"),a("b340"),a("6924"),a("472c"),a("256c"),a("de71"),a("7876"),a("37a7"),a("d2d8"),a("e2e1"),a("2c1e"),a("26c7"),a("ee7e"),a("f05b"),a("6a4de"),a("11de"),a("172c"),a("0c75"),a("69a3"),a("d30f"),a("3b7f"),a("aadd"),a("98da"),a("c4bc"),a("f1e1"),a("7212")),c=a("5da95"),d=a("1285"),u=a("7497"),p=a("e0e9"),m=a("e455"),f=a("be65"),b=a.n(f),v=a("5638"),h={data:function(){return{category:[],hashkey:"",addGroup:{name:""},groupform:!1,length:10,total:0,start:0,activeName:"first",formInline:{productname:""},uploadHeaders:{sessionToken:b.a.get("access_token")},uploadAction:"",uploadData:{},fileList:[],productIdentifier:"",groupData:[],formLabelWidth:"80px",dialogFormVisible:!1,importDialogShow:!1,form:{name:"",category:[],nodeType:0,desc:"",netType:"",devType:"",productSecret:"",roles:[],relationApp:""},formPro:{name:"",url:""},rules:{roles:[{required:!0,message:"请选择所属应用",trigger:"blur"}],name:[{required:!0,message:"请输入产品",trigger:"blur"}],devType:[{required:!0,message:"请输入产品标识，用于区分不同设备",trigger:"blur"}],category:[{required:!0,message:"请选择所属分类",trigger:"change"}],nodeType:[{required:!0,message:"请选择节点类型",trigger:"change"}],netType:[{required:!0,message:"请选择联网方式",trigger:"change"}],relationApp:[{required:!0,message:"请选择产品可见角色",trigger:"change"}]},option:[],ruleoptions:[],channel:[{label:"蜂窝(2G/3G/4G)(直连)",value:"CELLULAR"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"BLE(低功耗蓝牙)",value:"Bluetooth"},{label:"5G通道(直连)",value:"5G"},{label:"WIFI通道(直连)",value:"WIFI"},{label:"ZigBee通道",value:"ZigBee"},{label:"Modbus",value:"Modbus"},{label:"LoRa(WAN)(直连)",value:"LoRaWAN"},{label:"OPC UA",value:" OPC UA"},{label:"ZETA通道",value:"ZETA"},{label:"网线连接(直连)",value:"网线连接"},{label:"自定义",value:"OTHER"}],imageUrl:"",productid:"",loading:!1,allApps:[],categoryList:[],categoryListOptions:[],fileServer:"",access_token:"",projectid:"",projectName:"",allTableDate:[]}},computed:{},mounted:function(){this.Industry(),this.searchProduct(0)},beforeDestroy:function(){this.projectName=""},methods:{addDeviceGroup:function(){var e=this;this.$refs["addGroup"].validate((function(t){if(!t)return!1;Object(v["addGroup"])(e.addGroup.name).then((function(t){e.$message({message:"新建设备分组成功",type:"success"}),e.searchProduct(),e.groupform=!1})).catch((function(t){e.$message({message:"新建设备分组失败"+t.computed,type:"error"}),e.groupform=!1}))}))},resetForm:function(){this.$refs["addGroup"].resetFields()},changeNode:function(e,t){0!=t&&(this.form.netType=""),this.channel=0==e?[{label:"蜂窝(2G/3G/4G)",value:"CELLULAR"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"BLE(低功耗蓝牙)",value:"Bluetooth"},{label:"5G通道",value:"5G"},{label:"WIFI通道",value:"WIFI"},{label:"ZigBee通道",value:"ZigBee"},{label:"LoRa(WAN)",value:"LoRaWAN"},{label:"Modbus",value:"Modbus"},{label:"OPC UA",value:" OPC UA"},{label:"ZETA通道",value:"ZETA"},{label:"网线连接",value:"网线连接"},{label:"自定义",value:"OTHER"}]:[{label:"蜂窝(2G/3G/4G)",value:"CELLULAR"},{label:"5G通道",value:"5G"},{label:"WIFI通道",value:"WIFI"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"LoRaWAN",value:"LoRaWAN"},{label:"网线连接",value:"网线连接"},{label:"自定义",value:"OTHER"}]},selectApp:function(e){var t=this;e&&Object(c["getRole"])(e).then((function(e){e&&(t.fileServer=e.file,t.access_token=e.access_token)}))},treeData:function(e){var t=JSON.parse(JSON.stringify(e));return t.filter((function(e){var a=t.filter((function(t){return e.id==t.parentid}));return a.length>0&&(e.children=a),0==e.parentid}))},deleteImgsrc:function(){event.stopPropagation(),this.imageUrl=""},upload:function(e){if(this.loading=!0,e){var t=e.target.files[0],a=t.name,r=e.target.files[0].type,i=(t.type.split("/")[0],"image/jpeg"===r||"image/JPEG"===r||"image/png"===r||"image/PNG"===r||"image/bpm"===r||"image/BPM"===r);if(!i)return this.$message({message:"请上传图片",type:"error"}),!1;var l=new FileReader;l.readAsDataURL(t);var o=this;l.onloadend=function(){var e=l.result,t=o.dataURItoBlob(e);o.uploadFile(t,a)}}},dataURItoBlob:function(e){for(var t=atob(e.split(",")[1]),a=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),i=new Uint8Array(r),l=0;l<t.length;l++)i[l]=t.charCodeAt(l);return new Blob([r],{type:a})},uploadFile:function(e,t){var a=this,r=new FormData;r.append("file",e,t),r.append("output","json"),r.append("path",this.form.relationApp),r.append("auth_token",this.access_token);this.$http.post(this.fileServer,r).then((function(e){e&&(a.imageUrl=e.body.url,a.loading=!1)})).catch((function(e){a.loading=!1,a.$message(e.bodyText)}))},submitUpload:function(){var e=this;this.uploadAction="/product",this.$nextTick((function(){e.uploadData.appid=b.a.get("appids"),e.$refs.fileUpload.submit()}))},handleUploadSuccess:function(e,t,a){this.$message({type:"success",message:"产品导入成功"}),this.importDialogShow=!1,this.$refs["uploadProForm"].resetFields(),this.searchProduct()},handleUploadError:function(e,t,a){this.$message({showClose:!0,message:e})},handleChange:function(e,t){t.length>0&&(this.fileList=[t[t.length-1]])},utc2beijing:function(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},getDict:function(e,t){return Object(l["a"])(n.a.mark((function e(){var t,a;return n.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={limit:1e3,where:{"data.key":"category"}},e.next=3,Object(p["queryDict"])(t);case 3:a=e.sent,a.results;case 5:case"end":return e.stop()}}),e)})))()},searchProduct:function(e){var t=this;return Object(l["a"])(n.a.mark((function a(){var r,i,l,o;return n.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return 0==e&&(t.start=0),r={order:"-updatedAt",skip:t.start,limit:t.length,where:{nodeType:"2",name:t.formInline.productname.length?{$regex:t.formInline.productname}:{$ne:null}}},a.next=4,Object(s["queryProduct"])(r);case 4:return i=a.sent,l=i.results,t.groupData=l,t.total=t.groupData.length,a.next=10,Object(c["queryRole"])({limit:100});case 10:o=a.sent,t.allApps=o.results;case 12:case"end":return a.stop()}}),a)})))()},handleClose:function(){this.dialogFormVisible=!1},addproduct:function(){this.dialogFormVisible=!0},addgroup:function(){this.groupform=!0},getParent:function(e,t,a){var r=this;return t.map((function(i){e==i.id?(a.unshift(i.value),r.getParent(i.parentid,t,a)):0==i.parentid&&i.id==e&&a.unshift(i.value)})),this.form.category=a,a},getIndustryParent:function(e,t){var a=this;t.map((function(r){r.value==e&&a.getParent(r.id,t,[])}))},editorProduct:function(e){for(var t in this.form.relationApp="",this.dialogFormVisible=!0,this.productid=e.id,this.getIndustryParent(e.attributes.category,this.categoryList),this.form.desc=e.attributes.desc,this.form.name=e.attributes.name,this.form.nodeType=e.attributes.nodeType,this.form.netType=e.attributes.netType,this.form.devType=e.attributes.devType,this.form.productSecret=e.attributes.productSecret,this.changeNode(e.attributes.nodeType,0),e.attributes.icon&&(this.imageUrl=e.attributes.icon),e.attributes.ACL.permissionsById)this.form.relationApp=t?t.substr(5):"";this.selectApp(this.form.relationApp)},Industry:function(){var e=this;return Object(l["a"])(n.a.mark((function t(){var a,r,i;return n.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.categoryList=[],a={limit:1e3,where:{"data.key":"category"}},t.next=4,Object(p["queryDict"])(a);case 4:r=t.sent,i=r.results,i.map((function(t){var a={};a.value=t.type,a.label=t.data.CategoryName,a.id=t.data.Id,a.parentid=t.data.SuperId,e.categoryList.push(a)})),e.categoryListOptions=e.treeData(e.categoryList);case 8:case"end":return t.stop()}}),t)})))()},submitForm:function(e){},resetProductForm:function(){this.form={name:"",category:[],nodeType:0,desc:"",netType:"",devType:"",productSecret:"",roles:[],relationApp:""},this.imageUrl=""},deviceToDetail:function(e){this.$router.push({path:"/roles/detailproduct",query:{id:e.objectId}})},goKonva:function(e){this.$router.push({path:"/Topo?productid",query:{productid:e}})},GoTodevices:function(e){this.$router.push({path:"/roles/thing",query:{productid:e.objectId}})},makeSure:function(e){var t=this,a={count:"objectId",skip:0,limit:1,where:{product:row.objectId}};Object(d["queryDevice"])(a).then((function(a){a.count>0?t.$message("请先删除该产品下设备"):Object(s["getProduct"])(row.objectId).then((function(a){Object(s["delProduct"])(row.objectId).then((function(a){a&&(t.$message({type:"success",message:"删除成功"}),e._self.$refs["popover-".concat(e.$index)].doClose(),t.searchProduct())})).catch((function(e){}))})).catch((function(e){}))})).catch((function(e){}))},productSizeChange:function(e){this.length=e,this.searchProduct()},productCurrentChange:function(e){this.start=(e-1)*this.length,this.searchProduct()},blackDict:function(e,t){var a=this;return Object(l["a"])(n.a.mark((function r(){var i,l;return n.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return i={data:t,key:e,type:"Product"},r.next=3,Object(p["postDict"])(i);case 3:l=r.sent,l?a.$message({type:"success",message:"备份成功"}):a.$message({type:"error",message:"备份失败"});case 5:case"end":return r.stop()}}),r)})))()},CloneData:function(e){var t=this;return Object(l["a"])(n.a.mark((function a(){var r,i,l,o;return n.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r={category:e.attributes.category,devType:e.attributes.devType,name:e.attributes.name,thing:e.attributes.thing},a.next=3,Object(u["getHashClass"])("Product",r);case 3:i=a.sent,l=i.objectId,o=i.code,200==o&&t.blackDict(l,r);case 7:case"end":return a.stop()}}),a)})))()},proudctClone:function(e){var t=this;return Object(l["a"])(n.a.mark((function a(){var r,i;return n.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:e.attributes.config.cloneState=!0,r=e,i=Object(s["putProduct"])(e.id,r),i&&t.CloneData(e);case 4:case"end":return a.stop()}}),a)})))()},proudctEdit:function(e){var t=window.location.origin+"/spa",a="production";t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var r="".concat(t,"/#?drawProudctid=").concat(e.objectId,"&proudctid=").concat(e.objectId);localStorage.setItem("rowId",e.objectId),window.open(r,"__blank")},proudctView:function(e){var t=window.location.origin+"/spa",a="production";t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var r="".concat(t,"/#/views/").concat(e.objectId);window.open(r,"__blank")},exportpro:function(){this.allTableDate?Object(m["export_txt_to_zip"])(JSON.stringify(this.allTableDate),"Dict","Dict"):this.$message({type:"warning",message:"数据为空,无法导出"})}}},g=h,y=(a("2368"),a("a73e"),a("bdd7")),w=Object(y["a"])(g,r,i,!1,null,"46390aa3",null);t["default"]=w.exports},"59ef":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"logs logs-container",class:{"vab-fullscreen":e.isFullscreen}},[a("vab-query-form",[a("vab-query-form-top-panel",[e.$loadsh.isEmpty(e.queryForm)?e._e():a("el-form",{ref:"form",attrs:{inline:!0,"label-width":"80px",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("device.tracetype")}},[a("el-select",{model:{value:e.queryForm.tracetype,callback:function(t){e.$set(e.queryForm,"tracetype",t)},expression:"queryForm.tracetype"}},e._l(e.traceData,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}},[e._v(" "+e._s(t)+" ")])})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("device.action")}},[a("el-switch",{staticStyle:{display:"block"},attrs:{"active-color":"#13ce66","active-text":e.$translateTitle("device.start"),"active-value":"start","inactive-color":"#ff4949","inactive-text":e.$translateTitle("device.stop"),"inactive-value":"stop"},on:{change:e.starttrace},model:{value:e.queryForm.action,callback:function(t){e.$set(e.queryForm,"action",t)},expression:"queryForm.action"}})],1),a("el-form-item",[a("el-button",{staticStyle:{margin:"0 10px 10px 10px !important"},attrs:{type:"success"},on:{click:e.handleHeight}},[a("vab-icon",{attrs:{icon:e.isFullscreen?"fullscreen-exit-fill":"fullscreen-fill"}})],1),a("el-popover",{directives:[{name:"show",rawName:"v-show",value:e.scroketMsg.length,expression:"scroketMsg.length"}],attrs:{trigger:"hover"},scopedSlots:e._u([{key:"reference",fn:function(){return[a("el-button",{staticStyle:{margin:"0 0 10px 0 !important"},attrs:{icon:"el-icon-setting",type:"primary"}},[e._v(" "+e._s(e.$translateTitle("Logs.Draggable column settings"))+" ")])]},proxy:!0}],null,!1,2370876510)},[a("el-checkbox-group",{model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},[a("vue-draggable",e._b({attrs:{list:e.logcolumns}},"vue-draggable",e.dragOptions,!1),e._l(e.logcolumns,(function(t,r){return a("div",{key:t+r},[a("vab-icon",{attrs:{icon:"drag-drop-line"}}),a("el-checkbox",{attrs:{disabled:!0===t.disableCheck,label:t}},[e._v(" "+e._s(t)+" ")])],1)})),0)],1)],1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("device.topic"),prop:"product"}},[a("el-select",{model:{value:e.instructtopic,callback:function(t){e.instructtopic=t},expression:"instructtopic"}},e._l(e.producttopic,(function(e,t){return a("el-option",{key:t,attrs:{label:e.topic,value:e.topic}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("device.instruct"),prop:"product"}},[a("el-input",{model:{value:e.instruct,callback:function(t){e.instruct=t},expression:"instruct"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.sendinstruct()}}},[e._v(" "+e._s(e.$translateTitle("device.sendinstruct"))+" ")])],1)],1)],1)],1),a("a-tabs",{attrs:{"default-active-key":"editor"}},[a("a-tab-pane",{key:"editor"},[a("span",{attrs:{slot:"tab"},slot:"tab"},[a("vab-icon",{attrs:{icon:"aspect-ratio-fill"}}),e._v(" "+e._s(e.$translateTitle("Logs.console"))+" ")],1),a("vab-editor",{key:e.logMqtt.key,attrs:{height:e.isFullscreen?Number(e.$baseTableHeight(0))+80:Number(e.$baseTableHeight(0))+40,lang:"json","max-lines":e.isFullscreen?Number(e.$baseTableHeight(0)+80)/12:Number(e.$baseTableHeight(0)-80)/12,"min-lines":e.isFullscreen?Number(e.$baseTableHeight(0)+80)/12:Number(e.$baseTableHeight(0)-80)/12,theme:"gob"},model:{value:e.clickItem,callback:function(t){e.clickItem=t},expression:"clickItem"}})],1),a("a-tab-pane",{key:"table"},[a("span",{attrs:{slot:"tab"},slot:"tab"},[a("vab-icon",{attrs:{icon:"table-2"}}),e._v(" "+e._s(e.$translateTitle("Logs.table"))+" ")],1),a("el-table",{key:e.finallyColumns.length+e.momentKey,ref:"dragTable",staticClass:"logs-table",attrs:{border:"",data:e.scroketMsg,"default-expand-all":"",height:e.height,"highlight-current-row":"",resizable:"","row-class-name":e.tableRowClassName,stripe:""},scopedSlots:e._u([{key:"empty",fn:function(){return[a("vab-empty")]},proxy:!0}])},[e._l(e.finallyColumns,(function(t,r){return a("el-table-column",{key:r,attrs:{align:"center",label:t,prop:t,"show-overflow-tooltip":"",sortable:"",width:e.w80.includes(t)?80:e.Wh120.includes(t)?120:"auto"}})})),a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-descriptions",{staticClass:"margin-top",attrs:{border:"",column:2}},[a("el-descriptions-item",[a("template",{slot:"label"},[a("i",{directives:[{name:"copy",rawName:"v-copy",value:t.row.msg,expression:"props.row.msg"}],staticClass:"el-icon-copy-document"})]),e._v(" "+e._s(t.row.msg)+" ")],2)],1)]}}])})],2),a("vab-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.queryForm.total>0,expression:"queryForm.total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.queryForm.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.queryTable}})],1)],1)],1)},i=[],l=(a("a0e0"),a("3dec"),a("f764"),a("5662"),a("1d17"),a("98da"),a("e170"),a("04d6"),a("bb22")),o=a("7212"),n={name:"SceneLog",props:{name:{type:String,required:!0,default:"name"},deviceInfo:{type:Object,required:!0,default:function(){return{}}}},data:function(){return{instruct:"",instructtopic:"",producttopic:[],productId:"",ttl:108e5,topicKey:"",topic:"",logMqtt:{channeltopic:"",key:moment(new Date).valueOf()},subtopic:"",router:"",scroketMsg:[],clickItem:"",isFullscreen:!1,height:this.$baseTableHeight(0),logdata:[],momentKey:moment(new Date).valueOf(),checkList:["time","topic","pid","peername"],logcolumns:["topic","time","pid","peername","msg","level","gl","clientid","mfa"],fold:!0,w80:["line","level"],Wh120:["pid","domain","gl"],Wh200:["time","clientid","peername"],leverData:["debug","info","notice","warning","error","crtical","alert","emergency"],actionData:["start","stop"],traceData:["clientid","topic"],queryForm:{total:0,count:"objectId",limit:20,pageNo:1,pageSize:20,skip:0,level:"info",logfile:"test.txt",order:1,action:"start",tracetype:"clientid"}}},computed:{dragOptions:function(){return{animation:600,group:"description"}},finallyColumns:function(){var e=this;return this.logcolumns.filter((function(t){return e.checkList.includes(t)}))}},watch:{"deviceInfo.product.objectId":{handler:function(e){e&&(this.productId=e)},deep:!0,limit:!0},name:{handler:function(e){"task"==e&&this.queryTable()},deep:!0,limit:!0}},mounted:function(){this.router=this.$dgiotBus.router(location.href+this.$route.fullPath),this.get_topic()},created:function(){},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){},methods:{get_topic:function(){var e=this;Object(o["getProduct"])(this.deviceInfo.product.objectId).then((function(t){e.producttopic=t.topics}))},sendinstruct:function(){var e=this.instructtopic.replace("${DevAddr}",this.deviceInfo.devaddr);this.$dgiotBus.$emit("MqttPublish",e,this.instruct,0,!1)},handleHeight:function(){this.isFullscreen=!this.isFullscreen,this.isFullscreen?this.height=this.$baseTableHeight(0)+120:this.height=this.$baseTableHeight(0),this.momentKey=moment(new Date).valueOf()},tableRowClassName:function(e){var t=e.row;return t.disabled?"disabled":""},rowDrop:function(){var e=this.$refs.dragTable.$el.querySelector(".el-table__body-wrapper tbody"),t=this;Sortable.create(e,{draggable:".el-table__row",onEnd:function(e){var a=e.newIndex,r=e.oldIndex,i=t.logdata.splice(r,1)[0];t.logdata.splice(a,0,i)}})},columnDrop:function(){var e=this,t=this.$refs.dragTable.$el.querySelector(".el-table__header-wrapper tr");e.sortable=Sortable.create(t,{animation:180,delay:0,onEnd:function(t){var a=e.finallyColumns[t.oldIndex];e.finallyColumns.splice(t.oldIndex,1),e.finallyColumns.splice(t.newIndex,0,a),e.momentKey=moment(new Date).valueOf(),setTimeout((function(){e.rowDrop(),e.columnDrop()}),1500)}})},starttrace:function(e){this.queryForm.action=e,this.queryTable()},queryTable:function(){var e=this;this.scroketMsg=[],this.clickItem="",this.queryForm.deviceid=this.deviceInfo.objectId,"start"==this.queryForm.action&&(this.subtopic="logger_trace/trace/"+this.deviceInfo.objectId+"/#"),this.topicKey=this.$dgiotBus.topicKey(this.router,this.subtopic),this.$dgiotBus.$emit("MqttSubscribe",{router:this.router,topic:this.subtopic,qos:0,ttl:108e5}),this.$dgiotBus.$off("".concat(this.topicKey)),this.$dgiotBus.$on("".concat(this.topicKey),(function(t){t.payload&&(e.scroketMsg.unshift(JSON.parse(t.payload)),e.logMqtt.key=e.topicKey,e.clickItem=JSON.stringify(e.scroketMsg,null,2))})),"stop"==this.queryForm.action&&this.MqttUnbscribe();var t=this.$baseColorfullLoading(),a=this.queryForm,r=a.level,i=a.action,o=a.order,n=a.deviceid,s=a.tracetype,c="clientid"==this.queryForm.tracetype?this.queryForm.deviceid:this.queryForm.topic;try{t.close();var d={level:r,action:i,order:o,handle:c,tracetype:s,deviceid:n};Object(l["postTrace"])(d).then((function(t){var a=t.code,r=void 0===a?0:a,i=t.error,l=void 0===i?"":i;t.msg;200==r?e.$baseMessage(e.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"):e.$baseMessage(e.$translateTitle("alert.Data request error")+"".concat(l),"error","vab-hey-message-error")})).catch((function(t){e.$baseMessage(e.$translateTitle("alert.Data request error")+"".concat(t),"error","vab-hey-message-error")})),t.close()}catch(error){t.close(),this.$baseMessage(this.$translateTitle("alert.Data request error")+"".concat(error),"error","vab-hey-message-error")}this.momentKey=moment(new Date).valueOf()},MqttUnbscribe:function(){this.$dgiotBus.$emit("MqttUnbscribe",this.topicKey,this.subtopic)}}},s=n,c=(a("cd14"),a("0fd9"),a("bdd7")),d=Object(c["a"])(s,r,i,!1,null,"fc11fc62",null);t["default"]=d.exports},"5a4c":function(e,t,a){},"5c26":function(e,t,a){"use strict";a("2ea6")},6818:function(e,t,a){var r={"./ProductTemplet.vue":"0238","./ProfileDescriptions.vue":"4c00","./ProfileDict.vue":"d815","./ProfileDrawer.vue":"df9c"};function i(e){var t=l(e);return a(t)}function l(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=l,e.exports=i,i.id="6818"},"6ac7":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"editdevices"},[a("div",[a("el-tabs",{on:{"tab-click":e.tabHandleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.deviceinformation"),name:"first"}},[a("info",{attrs:{devicedetail:e.deviceInfo}})],1),a("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.real time data"),name:"first1"}},[a("vab-query-form",[a("vab-query-form-left-panel",[a("span",[e._v(" "+e._s(e.$translateTitle("equipment.realtimerefresh"))+" ")]),a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#cccccc"},on:{change:function(t){return e.updateTrue(t)}},model:{value:e.isupdate,callback:function(t){e.isupdate=t},expression:"isupdate"}})],1),a("vab-query-form-right-panel",[a("vab-help",{attrs:{src:"https://tech.iotn2n.com/w/docs/details?id=6",title:"产品下的所有设备都会继承该产品的 Topic 类",trigger:"click"}})],1)],1),a("div",[a("div",{staticClass:"thirdtb"},[a("el-row",{key:e.thirdtbKey},e._l(e.machinelist,(function(t,r,i){return a("el-col",{key:i,attrs:{span:24}},[a("el-card",{attrs:{"body-style":{padding:"0px"},shadow:"never"}},[a("div",{staticStyle:{padding:"14px"}},[a("span",{staticStyle:{"font-size":"30px"}},[e._v(e._s(r))]),t.length?a("ul",{staticStyle:{display:"flex","flex-wrap":"wrap"}},e._l(t,(function(t,r){return a("li",{key:r,staticClass:"updatedtable"},[a("div",{staticStyle:{height:"70px"}},[a("span",{staticStyle:{"font-size":"16px"}},[e._v(e._s(t.name))]),a("span",{staticStyle:{float:"right","margin-top":"10px","margin-right":"15px"}},[a("el-image",{staticStyle:{width:"60px",height:"60px"},attrs:{src:t.imgurl}},[a("div",{staticClass:"image-slot",staticStyle:{width:"60px",height:"60px"},attrs:{slot:"error"},slot:"error"},[a("i",{staticClass:"el-icon-picture-outline"})])])],1)]),a("div",{staticClass:"stla"},[a("span",{attrs:{title:e._f("filterVal")(t.number)}},[e._v(" "+e._s(e._f("filterVal")(t.number))+" ")]),t.unit?a("span",{attrs:{title:t.unit}},[e._v(" "+e._s(t.unit)+" ")]):e._e()]),a("div",{staticClass:"ta"},[a("span",{staticClass:"fontSize"},[e._v(" "+e._s(e.$translateTitle("equipment.updatetime")+":")+" ")]),a("span",{staticClass:"fontSize",on:{click:function(t){return e.print(e.machinelist)}}},[e._v(" "+e._s(t.time)+" ")])])])})),0):e._e()])])],1)})),1)],1)])],1),a("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.historical data"),name:"third"}},[a("div",{staticStyle:{"box-sizing":"border-box",padding:"10px",background:"#ffffff"}},[a("div",{staticClass:"chartsinfo"},[a("div",{staticClass:"queryHeader",style:{height:"desktop"==e.Device?"50px":"240px"}},[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"desktop"==e.Device?"80px":"70px",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("developer.startTime")}},[a("el-date-picker",{staticStyle:{width:"83%"},attrs:{"picker-options":e.pickerOptionsDay,placeholder:e.$translateTitle("developer.startTime"),align:"right",size:"mini",type:"datetime"},model:{value:e.params.startTime,callback:function(t){e.$set(e.params,"startTime",t)},expression:"params.startTime"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.EndTime")}},[a("el-date-picker",{staticStyle:{width:"83%"},attrs:{clearable:!1,"picker-options":e.pickerOptionsDay,placeholder:e.$translateTitle("developer.EndTime"),align:"right",size:"mini",type:"datetime"},model:{value:e.params.endTime,callback:function(t){e.$set(e.params,"endTime",t)},expression:"params.endTime"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.type")}},[a("el-select",{staticStyle:{width:"90px"},attrs:{placeholder:"请选择",size:"mini"},on:{change:e.toggleChart},model:{value:e.params.style,callback:function(t){e.$set(e.params,"style",t)},expression:"params.style"}},e._l(e.chartType,(function(t,r){return a("el-option",{key:r,attrs:{disabled:-1!=e.disabledChart.indexOf(t.type),label:t.name,value:t.type}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.interval")}},[a("el-input-number",{staticStyle:{width:"100px"},attrs:{min:1,placeholder:"请输入内容",size:"mini"},model:{value:e.params.number,callback:function(t){e.$set(e.params,"number",t)},expression:"params.number"}}),a("el-select",{staticStyle:{width:"70px"},attrs:{placeholder:"请选择",size:"mini"},model:{value:e.params.interval,callback:function(t){e.$set(e.params,"interval",t)},expression:"params.interval"}},e._l(e.interval,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.type}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.function")}},[a("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择",size:"mini"},model:{value:e.params._function,callback:function(t){e.$set(e.params,"_function",t)},expression:"params._function"}},e._l(e.functionarr,(function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})})),1),a("el-button",{attrs:{disabled:e.queryFlag,icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.queryChart}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1)],1)],1)],1),a("div",{key:e.chartKey,staticClass:"chartsmain"},[a("vabChart",{ref:"charts",attrs:{"after-config":e.afterConfig,data:e.chartData,"data-empty":e.dataEmpty,"data-zoom":e.chartDataZoom,extend:e.chartExtend,loading:e.loading,"set-option-opts":!1,settings:e.chartSettings,toolbox:e.toolbox,type:e.params.style}})],1),a("div",{staticClass:"chartOther"},[a("el-row",{attrs:{gutter:20}},[e._l(e.chartData.child,(function(t,r){return a("el-col",{directives:[{name:"show",rawName:"v-show",value:"日期"!=t.columns[1],expression:"item.columns[1] != '日期'"}],key:r,attrs:{md:e.md,sm:e.sm,xl:e.xl,xs:e.xs}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v(e._s(t.columns[1])+" : "+e._s(t.unit))]),a("el-button-group",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"}},[a("el-button",{attrs:{icon:"el-icon-warning-outline"}}),a("el-button",{attrs:{icon:"el-icon-full-screen"},on:{click:function(t){return e.toggleCardRow(r,e.xs,e.sm,e.md,e.xl)}}})],1)],1),a("vabChart",{ref:"charts",refInFor:!0,attrs:{"after-config":e.afterConfig,data:e.chartData.child[r],"data-empty":e.dataEmpty,"data-zoom":e.chartDataZoom,extend:e.chartExtend,"legend-visible":!1,loading:e.loading,"set-option-opts":!1,settings:e.chartSettings,toolbox:e.toolbox,type:e.params.style,height:"300px"}})],1)],1)})),a("el-col",{directives:[{name:"show",rawName:"v-show",value:!e.chartData.child,expression:"!chartData.child"}],attrs:{span:24}},[a("vab-empty")],1)],2)],1)])]),a("div",{staticClass:"twofirsttable",staticStyle:{"box-sizing":"border-box",padding:"10px","margin-top":"20px",background:"#ffffff"}})]),"0"!=e.$route.query.nodeType?a("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.subdevice"),name:"children"}},[a("div",{staticClass:"childrendevices"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.childrendevices,size:"small"}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicenumber")+":"}},[a("el-input",{attrs:{placeholder:e.$t("equipment.devicenumber")},model:{value:e.childrendevices.devicesname,callback:function(t){e.$set(e.childrendevices,"devicesname",t)},expression:"childrendevices.devicesname"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.getDevices(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1),a("el-form-item",[a("el-button",{attrs:{disabled:0==e.multipleTable.length,type:"primary"},on:{click:e.deleteDevcie}},[e._v(" "+e._s(e.$translateTitle("equipment.RelievingAssociation"))+" ")]),a("el-button",{attrs:{disabled:0==e.multipleTable.length,type:"primary"},on:{click:e.unactiveDevice}},[e._v(" "+e._s(e.$translateTitle("developer.prohibit"))+" ")]),a("el-button",{attrs:{disabled:0==e.multipleTable.length,type:"primary"},on:{click:e.activeDevice}},[e._v(" "+e._s(e.$translateTitle("developer.enable"))+" ")])],1),a("el-form-item",[a("el-button",{attrs:{plain:"",type:"info"}},[e._v(" "+e._s(e.$translateTitle("equipment.Refresh"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){e.childDialog=!0}}},[e._v(" "+e._s(e.$translateTitle("equipment.addchilddevice"))+" ")])],1)],1),a("div",{staticClass:"devicetable"},[a("el-table",{ref:"filterTable",staticStyle:{width:"100%","margin-top":"20px","text-align":"center"},attrs:{data:e.devicesTableData},on:{"selection-change":e.DevicesSelectionChange}},[a("el-table-column",{attrs:{align:"center",type:"selection",width:"55"}}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.devicenumber"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(r.devaddr))]),a("p",{staticStyle:{margin:"0",color:"green"}},[e._v(e._s(r.name))])]}}],null,!1,2894569808)}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.state"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",{class:r.status},[e._v(" "+e._s(r.status)+" ")])]}}],null,!1,2814795006)}),a("el-table-column",{attrs:{align:"center",label:"子网地址"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(" "+e._s(void 0==r.route?"":r.route[e.devicedetail.devaddr])+" ")])]}}],null,!1,3312857562)}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.product"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",{attrs:{type:"success"}},[e._v(e._s(r.productName))])]}}],null,!1,2863909087)}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.nodetype"),align:"center"}}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.prohibit")+"/"+e.$translateTitle("developer.enable"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-switch",{attrs:{"active-color":"#5eb058","inactive-color":"#cccccc"},on:{change:function(t){return e.handelUpdate(t,r.row.$index)}},model:{value:r.isEnable,callback:function(t){e.$set(r,"isEnable",t)},expression:"row.isEnable"}})]}}],null,!1,177466286)}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.lastonlinetime"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[r.lastOnlineTime?a("span",[e._v(" "+e._s(e.timestampToTime(r.lastOnlineTime))+" ")]):a("span",[e._v("—")])]}}],null,!1,1578731938)}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.operation"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-link",{attrs:{underline:!1,icon:"el-icon-view",type:"primary"},on:{click:function(t){return e.deviceToDetail(r)}}},[e._v(" "+e._s(e.$translateTitle("equipment.see"))+" ")]),a("el-popover",{ref:"popover-"+r.$index,attrs:{placement:"top",width:"300"}},[a("p",[e._v("确定解除这个"+e._s(r.name)+"设备关联吗？")]),a("div",{staticStyle:{margin:"0","text-align":"right"}},[a("el-button",{attrs:{size:"mini"},on:{click:function(e){r._self.$refs["popover-"+r.$index].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.makeSure(r)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),a("el-link",{attrs:{slot:"reference",underline:!1,icon:"el-icon-delete",type:"danger"},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("equipment.RelievingAssociation"))+" ")])],1)]}}],null,!1,221227528)})],1)],1),a("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[a("el-pagination",{attrs:{"page-size":e.childrenDeviceLength,"page-sizes":[10,20,30,50],total:e.childrenDeviceTotal,layout:"total, sizes, prev, pager, next, jumper"},on:{"current-change":e.childrenDeviceCurrentChange,"size-change":e.childrenDeviceSizeChange}})],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,"close-on-click-modal":!1,title:e.$t("equipment.addchilddevice"),visible:e.childDialog,width:"30%"},on:{"update:visible":function(t){e.childDialog=t}}},[a("div",{staticClass:"childdialog"},[a("el-form",{ref:"childrenForm",staticClass:"demo-form-inline",attrs:{model:e.childrenForm}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.products"),rules:[{required:!0,message:"选择产品",trigger:"change"}],prop:"product"}},[a("el-select",{attrs:{placeholder:e.$t("equipment.products")},on:{change:e.checkProduct},model:{value:e.childrenForm.product,callback:function(t){e.$set(e.childrenForm,"product",t)},expression:"childrenForm.product"}},e._l(e.allProudct,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.equipment"),rules:[{required:!0,message:"选择设备",trigger:"change"}],prop:"device"}},[a("el-select",{directives:[{name:"el-select-loadmore",rawName:"v-el-select-loadmore",value:e.loadmore,expression:"loadmore"}],attrs:{disabled:!e.ischange,placeholder:e.$t("product.equipment")},model:{value:e.childrenForm.device,callback:function(t){e.$set(e.childrenForm,"device",t)},expression:"childrenForm.device"}},e._l(e.productDevices,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{rules:[{required:!0,message:"请输入子网地址",trigger:"blur"}],label:"子网地址",prop:"route"}},[a("el-input",{attrs:{placeholder:"子网地址"},model:{value:e.childrenForm.route,callback:function(t){e.$set(e.childrenForm,"route",t)},expression:"childrenForm.route"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.childDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitDevice("childrenForm")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)])],1):e._e(),e.isshowchild?a("el-tab-pane",{attrs:{label:e.$translateTitle("device.instruct"),name:"instruct"}},[a("Instruct",{attrs:{"devices-id":e.deviceid,"product-id":e.productid}})],1):e._e(),a("el-tab-pane",{attrs:{label:e.$translateTitle("device.trace"),name:"task"}},[a("scene-log",{directives:[{name:"show",rawName:"v-show",value:"task"==e.activeName,expression:"activeName == 'task'"}],ref:"SceneLog",attrs:{"device-info":e.deviceInfo,name:e.activeName}})],1),a("el-tab-pane",{attrs:{label:e.$translateTitle("device.log"),name:"trace"}},[a("device-log",{directives:[{name:"show",rawName:"v-show",value:"trace"==e.activeName,expression:"activeName == 'trace'"}],attrs:{devaddr:e.devicedevaddr,deviceid:e.deviceid,"is-device-info":!0,productid:e.productId}})],1),a("el-tab-pane",{attrs:{label:e.$translateTitle("device.alert"),name:"alert"}},[a("vab-empty")],1)],1)],1)])},i=[],l=a("fb07"),o=a("e97b"),n=a("d0d7"),s=a.n(n),c=(a("f1e1"),a("3dec"),a("9c6a"),a("79da"),a("16b8"),a("c4bc"),a("04d6"),a("0c40"),a("c4e6")),d=a("59ef"),u=a("c26ac"),p=a("5880"),m=a("1285"),f=a("ed08"),b=a("7dd9"),v=a("ca7b"),h=[{title:"图片",width:120,dataIndex:"imgurl",fixed:"left",key:"imgurl",scopedSlots:{customRender:"imgurl"}},{title:"时间",dataIndex:"time",key:"time"},{title:"名称",dataIndex:"name",key:"name"},{title:"值",dataIndex:"number",key:"number"},{title:"单位",dataIndex:"unit",key:"unit"}],g={components:{Instruct:b["default"],info:c["default"],deviceLog:u["default"],SceneLog:d["default"]},filters:{filterVal:function(e){return e||0==e?e:"--"}},directives:{"el-select-loadmore":{bind:function(e,t){var a=e.querySelector(".el-select-dropdown .el-select-dropdown__wrap");a.addEventListener("scroll",(function(){var e=this.scrollHeight-this.scrollTop<=this.clientHeight;e&&t.value()}))}}},data:function(){return this.chartExtend={series:{barMaxWidth:35},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],left:"9%",bottom:-5,start:10,end:90}],grid:{right:40}},this.toolbox={orient:"vertical",right:-5,feature:{dataZoom:{yAxisIndex:"none"},magicType:{type:["line","bar","histogram","pie","ring","waterfall","funnel","radar","heatmap","scatter","candle","stack"]},dataView:{show:!0,readOnly:!1},saveAsImage:{show:!0},restore:{show:!0}}},{router:"",chartKey:moment(new Date).valueOf(),machinelist:{},thirdtbKey:moment(new Date).valueOf(),deviceInfo:{},columns:h,productId:this.$route.query.productid,activeNames:["1"],queryForm:{account:"",searchDate:"",pageNo:1,pageSize:20},buttonactive:1,loading:!0,xl:6,xs:24,sm:24,md:12,dataEmpty:!0,chartDataZoom:[{type:"slider"}],pickerOptions:{shortcuts:[{text:this.$translateTitle("developer.LastWeek"),onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:this.$translateTitle("developer.LastMonth"),onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:this.$translateTitle("developer.LastThreeMonths"),onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]},pickerOptionsDay:{shortcuts:[{text:this.$translateTitle("developer.today"),onClick:function(e){e.$emit("pick",new Date)}},{text:this.$translateTitle("developer.yesterday"),onClick:function(e){var t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:this.$translateTitle("developer.A week ago"),onClick:function(e){var t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]},chartData:{identifier:[],columns:[],rows:[]},params:{_function:"last",style:"",number:1,interval:"h",datetimerange:"",keys:"*",limit:100,endTime:new Date,startTime:(new Date).getTime()-6048e5},interval:[{type:"y",name:"年"},{type:"n",name:"月"},{type:"w",name:"周"},{type:"d",name:"日"},{type:"h",name:"时"},{type:"m",name:"分"},{type:"s",name:"秒"},{type:"a",name:"毫秒"},{type:"u",name:"微秒"}],functionarr:["count","avg","sum","stddev","min","max","first","last"],disabledChart:["map","sankey","wordcloud","liquidfill","tree","gauge"],chartType:v["default"],options:[{value:"选项1",label:"黄金糕"},{value:"选项2",label:"双皮奶"},{value:"选项3",label:"蚵仔煎"},{value:"选项4",label:"龙须面"},{value:"选项5",label:"北京烤鸭"}],value:"",chartSettings:{},queryFlag:!0,width:0,lineChartData:"",datafordetail:[],datadialogVisible:!1,childDialog:!1,ninthform:{product:"",devices:""},wmxform:{product:"",devices:""},tableData:[],activeName:"first",text:"1111111",deviceid:"",devicedetail:{},topicData:[],thirdstart:1,thirdlength:10,thirdtotal:0,topic:[{topic:"thing/${ProductId}/${DevAddr}/post",type:"pub",desc:"设备上报",isdef:!0},{topic:"thing/${ProductId}/${DevAddr}",type:"sub",desc:"消息下发",isdef:!0}],thirdData:[],thirdDatas:[],isupdate:!1,ispushdata:!0,timer:null,isshowtable:!1,childrendevices:{devicesname:""},multipleTable:[],devicesTableData:[],childrenDeviceLength:10,childrenDeviceStart:0,childrenDeviceTotal:0,childrenForm:{product:"",device:"",route:""},isshowchild:!1,allProudct:[],productDevices:[],ischange:!1,ischildren:!1,productid:"",dataDeviceTotal:0,dataDeviceLength:10,dataDeviceStart:1,devicedevaddr:"",dirstart:1,dirlength:20,selectproduct:"",watchNum:0}},computed:Object(o["a"])({},Object(p["mapGetters"])({Device:"settings/device"})),watch:{machinelist:{deep:!0,handler:function(e){}},sm:function(e){var t=this;this.$nextTick((function(e){t.resizeTheChart(),setTimeout((function(){t.loading=!1}),2e3)}))}},mounted:function(){this.params.style=this.chartType[0].type,this.$route.query.deviceid&&(this.deviceid=this.$route.query.deviceid,this.getDeviceDetail(this.deviceid),this.initChart(),this.getDeviceInfo(this.deviceid),window.addEventListener("resize",this.resizeTheChart)),this.router=this.$dgiotBus.router(location.href+this.$route.fullPath)},destroyed:function(){this.Unbscribe(),window.clearInterval(this.timer),this.timer=null},beforeDestroy:function(){window.removeEventListener("resize",this.resizeTheChart)},methods:{Unbscribe:function(){var e="logger_trace/trace/"+this.deviceInfo.objectId+"/#",t=this.$dgiotBus.topicKey(this.router,e);this.$dgiotBus.$emit("MqttUnbscribe",t,e)},getDeviceInfo:function(e){var t=this;return Object(l["a"])(s.a.mark((function a(){var r,i,l,o,n;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(m["getDevice"])(e);case 2:i=a.sent,l="",l=null!==i&&void 0!==i&&null!==(r=i.product)&&void 0!==r&&r.objectId?i.product.objectId:"",o=i.devaddr,n=[{topic:"thing/".concat(l,"/").concat(o,"/post"),type:"pub",desc:"设备上报",isdef:!0},{topic:"thing/".concat(l,"/").concat(o),type:"sub",desc:"消息下发",isdef:!0}],i.product.topics?i.topicData=i.product.topics.concat(n):i.topicData=n,t.deviceInfo=i;case 9:case"end":return a.stop()}}),a)})))()},toggleChart:function(e){this.chartKey=moment(new Date).valueOf(),this.loading=!1,this.chartExtend={},this.chartDataZoom=[];var t=["funnel","radar","radar"];-1!=t.indexOf(e)?(this.chartExtend={},this.chartDataZoom=[]):(this.chartExtend={series:{barMaxWidth:35},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],left:"9%",bottom:-5,start:10,end:90}],grid:{right:40},yAxis:[{type:"value",axisLabel:{formatter:"{value} %"}}]},this.chartDataZoom=[{type:"slider"}]),this.resizeTheChart()},resizeTheChart:function(){var e=this.$refs["charts"];e instanceof Array?e.forEach((function(e){e.$children[0].resize()})):e.$children[0].resize()},toggleCardRow:function(e,t,a,r,i){this.sm=24==a?12:24,this.md=12==r?24:12,this.xl=6==i?12:6,this.loading=!0},afterConfig:function(e){return e.tooltip.showDelay=500,e},initChart:function(){var e=this,t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),this.params.datetimerange=[a,t],this.queryFlag=!1,this.$queryProduct({}).then((function(t){e.allProudct=t.results}))},queryChart:function(){var e=this;return Object(l["a"])(s.a.mark((function t(){var a,r,i,l,o,n,c,d,u,p,f;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.chartData={identifier:[],columns:[],rows:[]},!e.params.startTime||!e.params.endTime){t.next=10;break}return e.$baseColorfullLoading(1,e.$translateTitle("home.messag_loding")),a=e.$route.query.deviceid,r=e.params,i=r.interval,l=r.keys,o=r.limit,n=r.number,c=r.style,d=r._function,u=r.startTime,p=r.endTime,f={starttime:moment(u).valueOf(),endtime:moment(p).valueOf(),interval:n+i,keys:l,limit:o,function:d,style:c},t.next=8,Object(m["getDabDevice"])(a,f).then((function(t){if(e.$baseColorfullLoading().close(),null!==t&&void 0!==t&&t.chartData){var a=t.chartData,r=void 0===a?{}:a;e.chartData=r,e.$nextTick((function(){setTimeout((function(){e.loading=!0,e.toggleChart("line")}),1e3)}))}e.loading=!1,e.dataEmpty=!1})).catch((function(t){e.loading=!1,e.$baseColorfullLoading().close()}));case 8:t.next=11;break;case 10:e.$message.error(e.$translateTitle("developer.Please select the query time"));case 11:case"end":return t.stop()}}),t)})))()},print:function(e){},tabHandleClick:function(e){"ninth"==e.name?this.$router.push({path:"/roles/onlinetest",query:{deviceid:this.devicedevaddr,productid:this.productid}}):"children"==e.name?this.getDevices():"third"==e.name?this.queryChart():"task"==e.name&&this.$refs.SceneLog.get_topic()},timestampToTime:function(e){var t=new Date(1e3*e),a=t.getFullYear()+"-",r=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",i=(t.getDate()+1<=10?"0"+t.getDate():t.getDate())+" ",l=(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":",o=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",n=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return a+r+i+l+o+n},getDevices:function(e){var t=this;0==e&&(this.childrenDeviceStart=0),this.devicesTableData=[];var a="route."+this.devicedetail.devaddr,r={};r[a]={$regex:".+"};var i={limit:this.childrenDeviceLength,skip:this.childrenDeviceStart,count:"objectId",include:"product",parentId:this.deviceId,where:r};""!=this.childrendevices.devicesname&&(i.where.devaddr=this.childrendevices.devicesname),this.$queryDevice(i).then((function(e){t.childrenDeviceTotal=e.count,e.results&&e.results.map((function(e){var a={};a.objectId=e.objectId,a.name=e.name,a.status=e.status,a.originstatus=e.status,a.nodeType=e.product.nodeType,a.productName=e.product.name,a.devaddr=e.devaddr,a.isEnable=e.isEnable,a.route=e.route,t.devicesTableData.push(a)}))})).catch((function(e){t.$baseMessage("请求出错11",e.error,3e3)}))},getDeviceDetail:function(e){var t=this;return Object(l["a"])(s.a.mark((function a(){var r,i;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:r=t,r.ischildren=r.$route.query.ischildren,i={limit:1,count:"objectId",include:"product",where:{objectId:e}},Object(m["queryDevice"])(i).then((function(e){if(e.results.length>0){var t=e.results[0],a={};r.productid=r.$objGet(t,"product.objectId"),r.devicedevaddr=r.$objGet(t,"devaddr"),a.id=t.objectId,a.createdAt=Object(f["utc2beijing"])(t.createdAt),a.productName=r.$objGet(t,"product.name"),a.productid=r.$objGet(t,"product.objectId"),a.ip=r.$objGet(t,"ip"),a.basedata=JSON.stringify(t.basedata),a.DeviceName=t.name,a.status=t.status,a.desc=r.$objGet(t,"desc"),a.devaddr=r.$objGet(t,"devaddr"),a.nodeType=r.$objGet(t,"product.nodeType"),a.devType=r.$objGet(t,"product.devType"),a.productSecret=r.$objGet(t,"product.productSecret"),a.address=r.$objGet(t,"detail.address")||r.$objGet(t,"location.latitude")+"，"+r.$objGet(t,"location.longitude");r.$objGet(t,"tddata");var i=JSON.parse(JSON.stringify(r.$objGet(t,"product.thing.properties")));r.Update();var l=[];if(!i)return;i.forEach((function(e){e.devicetype&&l.push(e.devicetype)})),l=_.uniqBy(l);var o={};if(l.forEach((function(e){var t=[];i.forEach((function(a){e==a.devicetype&&t.push(a)})),o[e]=t})),r.machinelist=o,r.thirdtbKey=moment(new Date).valueOf(),r.devicedetail=a,0!=r.$route.query.nodeType&&"true"==r.ischildren){r.activeName="children",r.isshowchild=!0,r.getDevices()}else r.ischildren=!1,r.isshowchild=!0;r.isupdate=!0,r.updateTrue(!0),t.product.topics?r.topicData=t.product.topics.concat(r.topic):r.topicData=r.topic}else r.$message("objectId 未返回")}));case 4:case"end":return a.stop()}}),a)})))()},Update:function(){var e=this,t=this;Object(m["getCardDevice"])(t.deviceid).then((function(a){if(t.machinelist={},null!==a&&void 0!==a&&a.data){var r=[],i=a.data;i.forEach((function(e){e.devicetype&&r.push(e.devicetype)})),r=_.uniqBy(r);var l={};r.forEach((function(e){var t=[];i.forEach((function(a){e==a.devicetype&&t.push(a)})),l[e]=t})),t.machinelist=l,t.thirdtbKey=moment(new Date).valueOf()}else e.updateTrue(!1),e.isupdate=!1})).catch((function(t){e.updateTrue(!1),e.isupdate=!1}))},updateTrue:function(e){var t=this;this.ispushdata=!1,1==e?this.timer=window.setInterval((function(){t.Update()}),1e4):(window.clearInterval(this.timer),this.timer=null)},dataDeviceSizeChange:function(e){this.dataDeviceStart=1},dataDeviceCurrentChange:function(e){this.dataDeviceStart=e},handleSizeChange1:function(e){this.thirdstart=1,this.thirdlength=e},handleCurrentChange1:function(e){this.thirdstart=e},DevicesSelectionChange:function(e){this.multipleTable=e},childrenDeviceCurrentChange:function(e){this.childrenDeviceStart=(e-1)*this.childrenDeviceLength,this.getDevices()},childrenDeviceSizeChange:function(e){this.childrenDeviceLength=e,this.getDevices()},checkProduct:function(e){var t=this;this.ischange=!0,this.selectproduct=e;var a={limit:this.dirlength,skip:(this.dirstart-1)*this.dirlength,count:"objectId",where:{product:e}};this.$queryDevice(a).then((function(e){e.results&&e.results.length>0?t.productDevices=e.results:t.productDevices=[],t.childrenForm.device=""}))},deviceToDetail:function(e){this.$router.push({path:"/roles/editdevices",query:{deviceid:e.objectId,nodeType:e.nodeType,ischildren:"false"}})},loadmore:function(){this.dirstart++,this.checkProduct(this.selectproduct)},submitDevice:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;var a={};a[t.devicedevaddr]=t.childrenForm.route;var r={parentId:{__type:"Pointer",className:"Device",objectId:t.deviceid},route:a};t.$putDevice(t.childrenForm.device,r).then((function(e){e&&(t.$message({type:"success",message:"添加成功"}),t.childDialog=!1,t.getDevices(),t.$refs["childrenForm"].resetFields())}))}))},deleteDevcie:function(e){var t=this;Promise.all([this.multipleTable.map((function(e){var a={parentId:null};t.$putDevice(e.objectId,a).then((function(e){}))}))]).then((function(e){e&&0!=e.length?(t.$message({message:"解除关联成功",type:"success"}),t.getDevices()):t.$message({message:"解除关联失败",type:"error"})})).catch((function(e){}))},unactiveDevice:function(e){var t=this;Promise.all([this.multipleTable.map((function(e){var a={isEnable:!1};t.$putDevice(e.objectId,a).then((function(e){}))}))]).then((function(e){e&&0!=e.length?(t.$message({message:"禁用成功",type:"success"}),t.getDevices()):t.$message({message:"禁用失败",type:"error"})})).catch((function(e){}))},activeDevice:function(e){var t=this;Promise.all([this.multipleTable.map((function(e){var a={isEnable:!0};t.$putDevice(e.objectId,a).then((function(e){}))}))]).then((function(e){e&&0!=e.length?(t.$message({message:"启用成功",type:"success"}),t.getDevices()):t.$message({message:"启用失败",type:"error"})})).catch((function(e){}))},makeSure:function(e){var t=this,a=JSON.parse(JSON.stringify(row.route)),r=this.devicedevaddr;delete a[r];var i={parentId:null,route:a};this.$putDevice(row.objectId,i).then((function(a){a&&(t.$message({type:"success",message:"解除关联成功"}),e._self.$refs["popover-".concat(e.$index)].doClose(),t.getDevices())}))},handelUpdate:function(e,t,a){var r=this,i={};for(var l in t)i[l]=t[l];i.isEnable=1!=i.isEnable,this.devicesTableData[a]=i,this.$confirm("是否修改此设备状态?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e={};for(var a in t)e[a]=t[a];e.isEnable=1==e.isEnable;var i={isEnable:e.isEnable};r.$putDevice(t.objectId,i).then((function(e){r.$message({type:"success",message:"状态修改成功"})})),r.getDevices()})).catch((function(){r.$message({type:"info",message:"已取消修改"});var e=t;e.isEnable=1!=e.isEnable,r.devicesTableData[a]=e}))}}},y=g,w=(a("27bd"),a("c83a"),a("bdd7")),$=Object(w["a"])(y,r,i,!1,null,"b2672194",null);t["default"]=$.exports},"6dad":function(e,t,a){},"89bd":function(e,t,a){"use strict";a("bd11")},"96e1":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"group"},[a("el-container",[a("el-container",[a("el-main",[a("div",{staticClass:"main"},[a("el-drawer",{attrs:{direction:"ltr",visible:e.drawer},on:{"update:visible":function(t){e.drawer=t}}},[e.showTree?a("div",{staticClass:"tree"},[e._v(" 搜索 : "),a("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),a("el-tree",{ref:"tree",staticClass:"treeitems",attrs:{"allow-drag":e.allowDrag,"allow-drop":e.allowDrop,data:e.treeData,"default-expand-all":"",draggable:"","filter-node-method":e.filterNode,"node-key":"id",props:e.defaultProps},on:{"node-drop":e.handleDrop},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,i=t.data;return a("span",{staticClass:"custom-tree-node"},[1==i.roles.seen?a("span",[a("el-input",{staticStyle:{width:"80%"},model:{value:e.editLabel,callback:function(t){e.editLabel=t},expression:"editLabel"}})],1):a("span",{staticStyle:{color:"#409eff"}},[e._v(e._s(r.label))]),0==i.roles.seen?a("span",{staticStyle:{"margin-left":"5px"}},[a("i",{staticClass:"el-icon-plus",staticStyle:{color:"#67c23a"},attrs:{title:"新增"},on:{click:function(t){return t.stopPropagation(),e.append(i)}}}),a("i",{staticClass:"el-icon-delete",staticStyle:{color:"red"},attrs:{title:"删除"},on:{click:function(t){return t.stopPropagation(),e.deletes(i)}}}),a("i",{staticClass:"el-icon-edit",staticStyle:{color:"#909399"},attrs:{title:"编辑"},on:{click:function(t){return t.stopPropagation(),e.rename(i)}}})]):a("span",[a("i",{staticClass:"el-icon-check",attrs:{slot:"suffix",title:"保存"},on:{click:function(t){return t.stopPropagation(),e.savename(i)}},slot:"suffix"})])])}}],null,!1,3055715610)})],1):e._e()]),a("el-tabs",{staticStyle:{display:"none"},on:{"tab-click":e.goTo},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.tabsNav,(function(e){return a("el-tab-pane",{key:e.url,attrs:{label:e.label,name:e.url}})})),1),a("router-view")],1),a("div",{staticClass:"setting"},[a("i",{class:[e.drawer?"el-icon-s-fold":"el-icon-s-unfold"],on:{click:function(t){return e.toggleTree()}}})])])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,center:"",title:"添加角色",visible:e.centerDialogRole,width:"35%"},on:{close:e.closeDialogRole}},[a("addroles",{ref:"addRoleRef"})],1)],1)},i=[],l=a("71bc"),o=(a("1d17"),a("98da"),a("a0e0"),a("3dec"),a("16b8"),a("5da95")),n=a("5638"),s=a("d10c"),c={name:"Group",components:{addroles:s["default"]},data:function(){return{drawer:!1,tabsNav:[{label:"统计预览",url:"platform"},{label:"虚拟分组",url:"devproduct"},{label:"通道列表",url:"resourcechannel"},{label:"设备列表",url:"devicelist"},{label:"产品列表",url:"productlist"},{label:"规则列表",url:"engine"}],numberValidateForm:{name:""},centerDialogRole:!1,editLabel:"",filterText:"",addForm:{seen:!1,date:"",name:"",address:""},treeData:[],defaultProps:{children:"children",label:"alias",isLeaf:"leaf"},showTree:!0}},computed:{activeName:{get:function(){return""!=this.$route.path.replace("/Dashboard/","")?this.$route.path.replace("/Dashboard/",""):"platform"},set:function(){}}},watch:{filterText:function(e){this.$refs.tree.filter(e)}},mounted:function(){var e=this;this.$baseEventBus.$on("dialogHide",(function(){e.centerDialogRole=!1,e.getTree()})),this.getTree()},methods:{goTo:function(e){this.$router.push({path:"/Dashboard/"+e.name})},toggleTree:function(){this.drawer=!this.drawer},getTree:function(){var e=this;function t(e){var a=Array.isArray(e)?[]:{};if(e&&"object"===Object(l["a"])(e))for(var r in e)e.roles&&(e.roles.seen=!1),e.hasOwnProperty(r)&&(e[r]&&"object"===Object(l["a"])(e[r])?a[r]=t(e[r]):a[r]=e[r]);return a}Object(o["roletree"])().then((function(a){e.treeData=t(a.results)})).catch((function(t){e.treeData=[]}))},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;Object(n["addGroup"])(t.numberValidateForm.name).then((function(e){t.$message({message:"新建设备分组成功",type:"success"})})).catch((function(e){t.$message({message:"新建设备分组失败"+e.computed,type:"error"})}))}))},resetForm:function(e){this.$refs[e].resetFields()},append:function(e){var t=this;this.centerDialogRole=!0,this.$nextTick((function(){t.$refs["addRoleRef"].getData(e)}))},closeDialogRole:function(){this.centerDialogRole=!1,this.getTree()},deletes:function(e){var t=this;this.$confirm("此操作将永久删除该节点,包括其子节点","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(o["delRole"])(e.objectId).then((function(e){t.getTree(),t.$message({type:"success",message:"删除成功!"})})).catch((function(e){t.$message({type:"error",message:"删除失败"+e.error})}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},rename:function(e){this.editLabel=e.alias,e.roles.seen=!0},savename:function(e){var t=this;e.alias!=this.editLabel&&Object(o["putRole"])(e.objectId,this.editLabel).then((function(a){t.$message({type:"success",message:"编辑成功"}),e.alias=t.editLabel})).catch((function(e){})),e.roles.seen=!1},allowDrop:function(e,t,a){return e.level===t.level&&(e.data.parentId===t.data.parentId?"prev"===a||"next"===a:void 0)},allowDrag:function(e){return 1!==e.level},handleDrop:function(e,t,a,r){var i=[],l=t.parent.childNodes;for(var o in l)i.push({id:l[o].data.id})},filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)}}},d=c,u=(a("02df"),a("bdd7")),p=Object(u["a"])(d,r,i,!1,null,"2e9c5ebb",null);t["default"]=p.exports},a559:function(e,t,a){"use strict";a("d8f1")},a73e:function(e,t,a){"use strict";a("dfab")},a858:function(e,t,a){"use strict";a.r(t);var r,i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"equipment equipment-container"},[a("div",{staticClass:"dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,top:"5vh",visible:e.popoverVisible,width:"40vh"},on:{"update:visible":function(t){e.popoverVisible=t}}},[a("div",{staticClass:"deviceTree"},[a("p",{staticStyle:{"text-align":"center"}},[e._v(" "+e._s(e.$translateTitle("developer.Company"))+" : "+e._s(e.deciceCompany)+" ")]),a("el-tree",{attrs:{data:e.deptTreeData,"default-expand-all":"","expand-on-click-node":!1,"node-key":"index",props:e.roleProps},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,i=t.data;return a("div",{staticClass:"custom-tree-node"},[a("span",{class:{selected:i.objectId==e.curDepartmentId},on:{click:function(t){return e.transferAcl(i)}}},[e._v(" "+e._s(r.label)+" ")])])}}])})],1)]),a("el-dialog",{attrs:{"append-to-body":!0,top:"5vh",visible:e.mapDialog,width:"80vh"},on:{"update:visible":function(t){e.mapDialog=t}}},[a("baidu-map",{staticStyle:{height:"80vh"},attrs:{ak:"fnc5Z92jC7CwfBGz8Dk66E9sXEIYZ6TG",center:e.center,"map-click":!1,"scroll-wheel-zoom":!0,zoom:e.zoom},on:{click:e.mapClick,ready:e.handler}},[a("bm-marker",{attrs:{animation:"BMAP_ANIMATION_BOUNCE",dragging:!0,position:e.center}},[a("bm-label",{attrs:{content:e.deviceId,"label-style":{color:"red",fontSize:"12px"},offset:{width:-25,height:30}}})],1),a("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}})],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,title:e.devicedetail.name,top:"5vh",visible:e.InfoDialog,width:"80%"},on:{"update:visible":function(t){e.InfoDialog=t}}},[a("el-tabs",{attrs:{size:"mini",type:"border-card"},on:{"tab-click":e.handleTabClick},model:{value:e.activeparseTbas,callback:function(t){e.activeparseTbas=t},expression:"activeparseTbas"}},e._l(e.parseTbas,(function(t){return a("el-tab-pane",{key:t.name,attrs:{label:t.name,name:t.name}},[a("ele-form",e._b({attrs:{"request-fn":e.handleSubmit},on:{"request-success":function(a){return e.handleSuccess(t)}},model:{value:t.config,callback:function(a){e.$set(t,"config",a)},expression:"item.config"}},"ele-form",t.config,!1))],1)})),1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.InfoDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){e.InfoDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.CloseState,title:e.stateDialog.name,top:"5vh",visible:e.stateDialog,width:"80%"},on:{"update:visible":function(t){e.stateDialog=t}}},[a("deviceState",{attrs:{devicedetail:e.stateDetail},on:{ParserSave:e.ParserSave}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.stateDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){e.stateDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)],1)],1),a("div",{staticClass:"equtabs"},[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("div",{staticClass:"equdevices"},[a("vab-query-form",[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"100px",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.Department")}},[a("el-select",{attrs:{placeholder:"请选择"},on:{"visible-change":function(t){return e.change(t)}},model:{value:e.queryForm.workGroupName,callback:function(t){e.$set(e.queryForm,"workGroupName",t)},expression:"queryForm.workGroupName"}},[a("el-option",{staticStyle:{height:"auto",padding:"0"},attrs:{value:e.treeDataValue}},[a("el-tree",{ref:"workGroup",attrs:{data:e.deptTreeData,"default-expand-all":"","expand-on-click-node":!1,"node-key":"index",props:e.roleProps},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,i=t.data;return a("div",{staticClass:"custom-tree-node"},[a("span",{class:{selected:i.objectId==e.curDepartmentId},on:{click:function(t){return e.handleNodeClick(i,r)}}},[e._v(" "+e._s(r.label)+" ")])])}}])})],1)],1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.Products")}},[a("el-select",{attrs:{clearable:"",disabled:!e.productenable},on:{change:e.selectProdChange},model:{value:e.equvalue,callback:function(t){e.equvalue=t},expression:"equvalue"}},e._l(e.proTableData,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.device status")}},[a("el-select",{staticStyle:{width:"100px"},attrs:{clearable:""},model:{value:e.onlinedevices,callback:function(t){e.onlinedevices=t},expression:"onlinedevices"}},[a("el-option",{attrs:{value:e.$translateTitle("zetadevices.online")}}),a("el-option",{attrs:{value:e.$translateTitle("zetadevices.offline")}})],1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.condition")}},[e.selectdevice==e.$translateTitle("equipment.devicename")?a("el-input",{attrs:{placeholder:e.$translateTitle("equipment.enterproductname")},model:{value:e.deviceinput,callback:function(t){e.deviceinput=t},expression:"deviceinput"}},[a("el-select",{staticStyle:{width:"140px"},attrs:{slot:"prepend"},slot:"prepend",model:{value:e.selectdevice,callback:function(t){e.selectdevice=t},expression:"selectdevice"}},[a("el-option",{attrs:{value:e.$translateTitle("equipment.devicename")}}),a("el-option",{attrs:{value:e.$translateTitle("equipment.devicenumber")}})],1),a("i",{staticClass:"el-icon-search",staticStyle:{color:"#606266",cursor:"pointer",lineheight:"32px"},attrs:{slot:"suffix"},on:{click:function(t){return e.getDevices({start:0})}},slot:"suffix"})],1):a("el-input",{attrs:{placeholder:e.$translateTitle("equipment.enterdevicenumber")},model:{value:e.deviceinput,callback:function(t){e.deviceinput=t},expression:"deviceinput"}},[a("el-select",{staticStyle:{width:"120px"},attrs:{slot:"prepend"},slot:"prepend",model:{value:e.selectdevice,callback:function(t){e.selectdevice=t},expression:"selectdevice"}},[a("el-option",{attrs:{value:e.$translateTitle("equipment.devicename")}}),a("el-option",{attrs:{value:e.$translateTitle("equipment.devicenumber")}})],1),a("el-button",{attrs:{slot:"append",icon:"el-icon-search",size:"mini"},on:{click:function(t){return e.getDevices({start:0})}},slot:"append"})],1)],1),a("el-form-item",[a("el-button",{staticClass:"el-icon-plus",attrs:{size:"small",title:e.$translateTitle("equipment.adddevice"),type:"primary"},on:{click:e.addDeviceForm}}),a("el-button",{staticClass:"el-icon-delete",attrs:{disabled:!e.selectedList.length,size:"small",title:e.$translateTitle("aintenance.batch deletion"),type:"danger"},on:{click:function(t){return e.handleDelete(e.selectedList,1)}}})],1),a("el-form-item",{staticStyle:{display:"none"}},[a("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:e.deleteDevcie}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")]),a("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:function(t){return e.unactiveDevice(!1)}}},[e._v(" "+e._s(e.$translateTitle("developer.prohibit"))+" ")]),a("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:function(t){return e.unactiveDevice(!0)}}},[e._v(" "+e._s(e.$translateTitle("developer.enable"))+" ")]),a("el-button",{attrs:{size:"small"}},[e._v(" "+e._s(e.$translateTitle("equipment.batchaddition"))+" ")])],1)],1)],1)],1)],1),a("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.list"),name:"first"}},[a("div",{staticClass:"tabstable"},[a("el-table",{directives:[{name:"show",rawName:"v-show",value:e.isALL,expression:"isALL"},{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"filterTable",staticStyle:{width:"100%","margin-top":"20px","text-align":"center"},attrs:{border:e.border,data:e.tableData,height:e.height,"row-style":e.rowClass,size:e.lineHeight,stripe:e.stripe},on:{"selection-change":e.changeBox}},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",sortable:"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.devicenumber"),prop:"devaddr","show-overflow-tooltip":"",sortable:"",width:"120"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.name"),prop:"name","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",{staticStyle:{margin:"0",color:"green"}},[e._v(" "+e._s(r.name)+" ")])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.state"),prop:"status","show-overflow-tooltip":"",sortable:"",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return["ONLINE"==r.status?a("span",{class:r.status},[e._v(" "+e._s(e.$translateTitle("product.online"))+" ")]):e._e(),"ONLINE"==r.status?a("el-tooltip",{attrs:{content:e.$translateTitle("equipment.thedeviceisonline"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"==r.status?a("span",{class:r.status},[e._v(" "+e._s(e.$translateTitle("product.offline"))+" ")]):e._e(),"OFFLINE"==r.status?a("el-tooltip",{attrs:{content:e.$translateTitle("equipment.thedeviceisoffline"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"!=r.status&&"ONLINE"!=r.status?a("span",{class:r.status},[e._v(" "+e._s(e.$translateTitle("product.unregistered"))+" ")]):e._e()]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.product"),prop:"product.name","show-overflow-tooltip":"",sortable:"",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[r.product&&r.product.name?a("span",[e._v(" "+e._s(r.product.name||"")+" ")]):e._e()]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.Company"),prop:"Company","show-overflow-tooltip":"",sortable:"",width:"200"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.enable")+"/"+e.$translateTitle("developer.prohibit"),prop:"isEnable","show-overflow-tooltip":"",sortable:"",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-switch",{attrs:{"active-color":"#5eb058","inactive-color":"#cccccc"},on:{change:function(t){return e.handelUpdate(t,r.scope.$index)}},model:{value:r.isEnable,callback:function(t){e.$set(r,"isEnable",t)},expression:"row.isEnable"}})]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.createdAt"),prop:"createdAt","show-overflow-tooltip":"",sortable:"",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(e.utc2beijing(r.createdAt)))])]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("developer.operation"),width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.deviceToDetail(r)}}},[e._v(" "+e._s(e.$translateTitle("product.details"))+" ")]),a("el-button",{staticStyle:{"text-align":"center"},attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.showInfo(r)}}},[e._v(" "+e._s(e.$translateTitle("product.parser"))+" ")]),a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.konvaDevice(r)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.konva"))+" ")]),a("el-dropdown",{staticStyle:{margin:"0 10px"}},[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){e.isFullscreen=!e.isFullscreen}}},[e._v(" "+e._s(e.$translateTitle("concentrator.more"))+" ")]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",[a("el-link",{attrs:{size:"info",type:"success"},on:{click:function(t){return e.editorDevice(r)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.edit"))+" ")])],1),a("el-dropdown-item",[a("el-link",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showTree(r.objectId,r.Company)}}},[e._v(" "+e._s(e.$translateTitle("equipment.move"))+" ")])],1),a("el-dropdown-item",[a("el-link",{attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.goLink("video",r)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.video"))+" ")])],1),a("el-dropdown-item",[a("el-link",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(r,2)}}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)],1)],1)]}}])})],1),a("el-table",{directives:[{name:"show",rawName:"v-show",value:!e.isALL,expression:"!isALL"},{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"filterTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,height:e.height,"row-style":e.rowClass},on:{"selection-change":e.changeBox}},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",sortable:"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.devicenumber"),"show-overflow-tooltip":"",sortable:"",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.devaddr)+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",{staticStyle:{margin:"0",color:"green"}},[e._v(" "+e._s(r.name)+" ")])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.state"),"show-overflow-tooltip":"",sortable:"",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return["ONLINE"==r.status?a("span",{class:r.status},[e._v(" "+e._s(e.$translateTitle("product.online"))+" ")]):e._e(),"ONLINE"==r.status?a("el-tooltip",{attrs:{content:e.$translateTitle("equipment.thedeviceisonline"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"==r.status?a("span",{class:r.status},[e._v(" "+e._s(e.$translateTitle("product.offline"))+" ")]):e._e(),"OFFLINE"==r.status?a("el-tooltip",{attrs:{content:e.$translateTitle("equipment.thedeviceisoffline"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"!=r.status&&"ONLINE"!=r.status?a("span",{class:r.status},[e._v(" "+e._s(e.$translateTitle("product.unregistered"))+" ")]):e._e()]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.product"),"show-overflow-tooltip":"",sortable:"",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[r.product&&r.product.name?a("span",[e._v(" "+e._s(r.product.name)+" ")]):e._e()]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.Company"),"show-overflow-tooltip":"",sortable:"",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(" "+e._s(r.Company)+" ")])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.enable")+"/"+e.$translateTitle("developer.prohibit"),"show-overflow-tooltip":"",sortable:"",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-switch",{attrs:{"active-color":"#5eb058","inactive-color":"#cccccc"},on:{change:function(t){return e.handelUpdate(t,r.scope.$index)}},model:{value:r.isEnable,callback:function(t){e.$set(r,"isEnable",t)},expression:"row.isEnable"}})]}}])}),e._l(e.dialogtempconfig,(function(t,r){return["bool"==t.type&&t.isshow?a("el-table-column",{key:r,attrs:{align:"center",label:t.name,prop:t.identifier},scopedSlots:e._u([{key:"default",fn:function(r){var i=r.row;return[i[t.default]?a("span",[e._v(" "+e._s(e.$translateTitle("product.yes"))+" ")]):a("span",[e._v(" "+e._s(e.$translateTitle("product.no"))+" ")])]}}],null,!0)}):"enum"==t.type&&t.isshow?a("el-table-column",{key:r,attrs:{align:"center",label:t.name},scopedSlots:e._u([{key:"default",fn:function(r){var i=r.row;return[a("span",[e._v(" "+e._s(t.struct[i[t.identifier]])+" ")])]}}],null,!0)}):t.isshow?a("el-table-column",{key:r,attrs:{align:"center",label:t.name,prop:t.identifier},scopedSlots:e._u([{key:"default",fn:function(r){var i=r.row;return[a("span",[e._v(e._s(i[t.identifier])+" "+e._s(t.unit))])]}}],null,!0)}):e._e()]})),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.createdAt"),width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(e.utc2beijing(r.createdAt)))])]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("developer.operation"),width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.deviceToDetail(r)}}},[e._v(" "+e._s(e.$translateTitle("equipment.see"))+" ")]),a("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.editorDevice(r)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.edit"))+" ")]),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(r,2)}}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")]),a("el-popover",{staticStyle:{margin:"0 10px"},attrs:{placement:"left",trigger:"click"}},[a("el-button",{attrs:{disabled:!r.location,size:"mini",type:"primary"},on:{click:function(t){return e.showMap(r.location,r.objectId)}}},[e._v(" "+e._s(e.$translateTitle("equipment.location"))+" ")]),a("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.showInfo(r)}}},[e._v(" "+e._s(e.$translateTitle("equipment.info"))+" ")]),a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.showTree(r.objectId,r.Company)}}},[e._v(" "+e._s(e.$translateTitle("equipment.move"))+" ")]),a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.konvaDevice(r)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.konva"))+" ")]),a("el-button",{attrs:{slot:"reference",size:"mini",type:"info"},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.operation"))+" ")])],1)]}}])})],2),a("div",{staticClass:"elpagination"},[a("vab-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.devicetotal>0,expression:"devicetotal > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.devicetotal},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.getDevices}})],1)],1)]),a("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.map"),name:"second"}},[a("baidu-map",{staticClass:"map",staticStyle:{height:"67vh"},attrs:{ak:"fnc5Z92jC7CwfBGz8Dk66E9sXEIYZ6TG",center:{lng:116.404,lat:39.915},"scroll-wheel-zoom":!0,zoom:e.sizeZoom}},[a("bm-control",[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.sizeZoom=19}}},[e._v(" 缩放至最大 ")]),a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.sizeZoom=10}}},[e._v("还原")]),a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.sizeZoom=3}}},[e._v(" 缩放至最小 ")]),a("bm-panorama",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT",offset:{width:460,height:0}}}),a("bm-overview-map",{attrs:{"is-open":!0}}),a("bm-scale",{attrs:{offset:{width:200,height:0}}}),a("bm-city-list",{attrs:{offset:{width:280,height:0}}}),a("bm-map-type",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT","map-types":["BMAP_HYBRID_MAP","BMAP_NORMAL_MAP"],offset:{width:360,height:0}}})],1),e._l(e.tableData,(function(t){return a("bm-marker",{key:t.objectId,attrs:{animation:"BMAP_ANIMATION_BOUNCE",content:t.name,dragging:!0,position:{lng:t.location.longitude,lat:t.location.latitude}}},[a("bm-label",{attrs:{content:t.name,"label-style":{color:"red",fontSize:"24px"},offset:{width:-35,height:30}},on:{click:function(a){return e.deviceToDetail(t)}}})],1)})),a("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),a("bm-geolocation",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_RIGHT","auto-location":!0,"show-address-bar":!0}})],2)],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleClose,"close-on-click-modal":!1,title:e.$translateTitle("product.edit")+e.equipmentEditor,visible:e.devicedialogVisible,width:"50%"},on:{"update:visible":function(t){e.devicedialogVisible=t}}},[a("div",{staticClass:"header-title",attrs:{slot:"title"},slot:"title"},[a("span",{staticClass:"title-name"},[e._v(" "+e._s("设备"+e.equipmentEditor)+" "),a("el-tooltip",{staticStyle:{"margin-left":"5px"},attrs:{content:e.$translateTitle("equipment.text"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})])],1)]),a("div",{staticClass:"devicecontent"},[a("el-tabs",{model:{value:e.imeideviceName,callback:function(t){e.imeideviceName=t},expression:"imeideviceName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.commdevice"),name:"first"}},[a("el-form",{ref:"deviceform",attrs:{"label-width":"150px",model:e.deviceform,rules:e.rules}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicename"),prop:"name"}},[a("el-input",{model:{value:e.deviceform.name,callback:function(t){e.$set(e.deviceform,"name",t)},expression:"deviceform.name"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicenumber"),prop:"devaddr"}},[a("el-input",{attrs:{disabled:"编辑"==e.equipmentEditor},model:{value:e.deviceform.devaddr,callback:function(t){e.$set(e.deviceform,"devaddr",t)},expression:"deviceform.devaddr"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"productName"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:"编辑"==e.equipmentEditor,placeholder:e.$translateTitle("equipment.entername")},on:{change:e.selectChange},model:{value:e.deviceform.productName,callback:function(t){e.$set(e.deviceform,"productName",t)},expression:"deviceform.productName"}},e._l(e.proTableData1,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.assetnumber")}},[a("el-input",{model:{value:e.deviceform.assetNum,callback:function(t){e.$set(e.deviceform,"assetNum",t)},expression:"deviceform.assetNum"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.equipmenttype")}},[a("el-input",{model:{value:e.deviceform.devModel,callback:function(t){e.$set(e.deviceform,"devModel",t)},expression:"deviceform.devModel"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.equipmentbrand")}},[a("el-input",{model:{value:e.deviceform.brand,callback:function(t){e.$set(e.deviceform,"brand",t)},expression:"deviceform.brand"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.installationlocation")}},[a("el-input",{on:{focus:e.updateLocation},model:{value:e.deviceform.address,callback:function(t){e.$set(e.deviceform,"address",t)},expression:"deviceform.address"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.videoSrc")}},[a("el-input",{model:{value:e.deviceform.videoSrc,callback:function(t){e.$set(e.deviceform,"videoSrc",t)},expression:"deviceform.videoSrc"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.videoType")}},[a("el-select",{staticStyle:{width:"100%"},model:{value:e.deviceform.videoType,callback:function(t){e.$set(e.deviceform,"videoType",t)},expression:"deviceform.videoType"}},e._l(e.videoOptions,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),e._l(e.arrlist,(function(t,r){return a("el-col",{key:r,attrs:{span:12}},[a("el-form-item",{attrs:{label:t.name,prop:t.identifier,required:t.required}},["bool"==t.type?a("el-select",{staticClass:"notauto",staticStyle:{width:"100%"},attrs:{disabled:t.readonly},model:{value:e.deviceform[t.identifier],callback:function(a){e.$set(e.deviceform,t.identifier,a)},expression:"deviceform[item.identifier]"}},[a("el-option",{attrs:{label:e.$translateTitle("product.yes"),value:!0}}),a("el-option",{attrs:{label:e.$translateTitle("product.no"),value:!1}})],1):"enum"==t.type?a("el-select",{staticClass:"notauto",staticStyle:{width:"100%"},attrs:{disabled:t.readonly},model:{value:e.deviceform[t.identifier],callback:function(a){e.$set(e.deviceform,t.identifier,a)},expression:"deviceform[item.identifier]"}},e._l(t.specs,(function(e,t){return a("el-option",{key:t,attrs:{label:e.attributevalue,value:e.attribute?e.attribute:""}})})),1):"switch"==t.type?a("el-switch",{attrs:{"active-color":"#13ce66","active-value":t.activevalue,"inactive-color":"#ff4949","inactive-value":t.inactivevalue},model:{value:e.deviceform[t.identifier],callback:function(a){e.$set(e.deviceform,t.identifier,a)},expression:"deviceform[item.identifier]"}}):t.readonly?a("el-input",{attrs:{disabled:t.readonly,value:e.deviceform[t.identifier]?e.deviceform[t.identifier]:""}},[a("el-button",{attrs:{slot:"append"},slot:"append"},[e._v(" "+e._s(t.unit?t.unit:"")+" ")])],1):a("el-input",{attrs:{disabled:t.readonly},model:{value:e.deviceform[t.identifier],callback:function(a){e.$set(e.deviceform,t.identifier,a)},expression:"deviceform[item.identifier]"}},[a("el-button",{attrs:{slot:"append"},slot:"append"},[e._v(" "+e._s(t.unit?t.unit:"")+" ")])],1)],1)],1)})),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("developer.describe")}},[a("el-input",{attrs:{autosize:{minRows:4,maxRows:4},type:"textarea"},model:{value:e.deviceform.desc,callback:function(t){e.$set(e.deviceform,"desc",t)},expression:"deviceform.desc"}})],1)],1)],2)],1),a("div",{staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("deviceform")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),a("el-button",{on:{click:e.handleClose}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)],1),"编辑"!=e.equipmentEditor?a("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.imeidevice"),name:"second"}},[a("el-form",{ref:"imeiform",attrs:{"label-width":"150px",model:e.imeiform,rules:e.rules}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"IMEI",prop:"devimei"}},[a("el-input",{model:{value:e.imeiform.devimei,callback:function(t){e.$set(e.imeiform,"devimei",t)},expression:"imeiform.devimei"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"productName"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("equipment.entername")},on:{change:e.selectChange},model:{value:e.imeiform.productName,callback:function(t){e.$set(e.imeiform,"productName",t)},expression:"imeiform.productName"}},e._l(e.proTableData1,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.installationlocation")}},[a("el-input",{on:{focus:e.updateLocation},model:{value:e.imeiform.address,callback:function(t){e.$set(e.imeiform,"address",t)},expression:"imeiform.address"}})],1)],1)],1)],1),a("div",{staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitimeiForm("imeiform")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),a("el-button",{on:{click:e.handleClose}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)],1):e._e()],1)],1)]),a("el-dialog",{directives:[{name:"drag-dialog",rawName:"v-drag-dialog"}],attrs:{"append-to-body":!0,"before-close":e.handleClosebmap,"close-on-click-modal":!1,title:e.$translateTitle("developer.equipmentinstallationaddress"),visible:e.bmapdialogVisible,width:"50%"},on:{"update:visible":function(t){e.bmapdialogVisible=t}}},[a("div",[a("el-form",{attrs:{inline:!0,model:e.bmapform,size:"small"}},[a("el-form-item",{attrs:{label:e.$translateTitle("developer.addressname")}},[a("el-input",{model:{value:e.bmapform.keyword,callback:function(t){e.$set(e.bmapform,"keyword",t)},expression:"bmapform.keyword"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.selectaddress")}},[a("el-input",{attrs:{readonly:""},model:{value:e.bmapform.address,callback:function(t){e.$set(e.bmapform,"address",t)},expression:"bmapform.address"}})],1)],1),a("baidu-map",{staticStyle:{height:"300px"},attrs:{ak:"fnc5Z92jC7CwfBGz8Dk66E9sXEIYZ6TG",center:e.center,"map-click":!1,"scroll-wheel-zoom":!0,zoom:e.zoom},on:{click:e.mapClick,ready:e.handler}},[a("bm-local-search",{staticStyle:{display:"none"},attrs:{"auto-viewport":!0,keyword:e.bmapform.keyword,location:e.bmapform.location,zoom:"12.8"}}),a("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),a("bm-geolocation",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_RIGHT","auto-location":!0,"show-address-bar":!0}}),a("bm-city-list",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addressSure.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("product.preservation"))+" ")]),a("el-button",{on:{click:function(t){e.bmapdialogVisible=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)])],1)])},l=[],o=a("cc85"),n=a("71bc"),s=a("4490"),c=a("fb07"),d=a("e97b"),u=a("d0d7"),p=a.n(u),m=(a("1d17"),a("37c6"),a("3dec"),a("9c6a"),a("f1e1"),a("a0e0"),a("16b8"),a("d6a4"),a("c4bc"),a("f764"),a("5662"),a("04d6"),a("df0e"),a("5ac5"),a("98da"),a("3de5"),a("5880")),f=a("0941"),b=a("dcc6"),v=a("adc7"),h=a("7212"),g=a("2db0"),y=a("cb88"),w=a("926a"),T=a("1285"),k=a("bc35"),x=["createdAt"],F=["updatedAt"],D={components:{BmScale:y["BmScale"],BmMapType:y["BmMapType"],BmOverviewMap:y["BmOverviewMap"],BmPanorama:y["BmPanorama"],BmControl:y["BmControl"],BmLabel:y["BmLabel"],BaiduMap:y["BaiduMap"],BmLocalSearch:y["BmLocalSearch"],BmNavigation:y["BmNavigation"],BmGeolocation:y["BmGeolocation"],BmCityList:y["BmCityList"],BmMarker:y["BmMarker"],deviceState:g["default"]},data:function(){var e=/^[0-9]{15}$/,t=function(t,a,r){if(!e.test(a))return r(new Error("请输入15位IMEI"));r()};this.chartSettings={radius:[5,40],offsetY:70},this.chartExtend={yAxisType:["percent"],tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"}};var a=function(e,t,a){var r=/[0-9A-Za-z]$/;""==t?a(new Error("设备地址不能为空")):r.test(t)?a():a(new Error("设备地址必须为大小写字母数字"))};return{videoOptions:["m3u8","mp4","flv","mp3"],queryInfo:{},isFullscreen:!1,border:!0,stripe:!0,lineHeight:"medium",aclObj:{},editRow:{},selectedList:[],formData:{},height:this.$baseTableHeight(0)-120,topicData:[],InfoDialog:!1,devicedetail:{},stateDialog:!1,stateDetail:{},chartOnlone:{columns:["状态","数量"],rows:[{"状态":"在线","数量":0},{"状态":"离线","数量":0}]},chartwaring:{},parseTbas:[],activeparseTbas:"",chartProduct:{},queryForm:{account:"",searchDate:"",pageNo:1,pageSize:20,workGroupName:"",workGroupTreeShow:!1,statusFlag:!1,status:"",number:"",product:"",type:"",limit:20,skip:0,order:"-createdAt",keys:"count(*)"},treeDataValue:"",isALL:!0,sizeZoom:10,activeName:"first",imeideviceName:"first",mapDialog:!1,dialogtempconfig:[],arrlist:[],deviceId:"",deciceCompany:"",gutter:24,leftRow:3,rightRow:21,popoverVisible:!1,vabicon:"ancient-gate-fill",Company:sessionStorage.getItem("title")||"",curDepartmentId:"",deptTreeData:[],roleProps:{children:"children",label:"name"},listLoading:!1,productimg:"",bmapdialogVisible:!1,onlineall:0,activeall:0,userId:"",batchid:"",pcdialogVisible:!0,devicedialogVisible:!1,equvalue:"",cities:[],selectdevice:"",onlinedevices:"",deviceinput:"",devicenumber:"",multipleTable:[],selectRow:[],devicelength:10,devicestart:0,devicetotal:0,visible2:!1,imeiform:{devimei:"",productName:"",address:""},deviceform:{videoSrc:"",videoType:"m3u8",name:"",devaddr:"",batchId:"",desc:"",nodeType:0,devType:"",netType:"",assetNum:"",devModel:"",address:"",productName:"",status:"",isEnable:"",brand:""},rules:{name:[{required:!0,message:"请输入设备名称",trigger:"blur"}],devaddr:[{required:!0,message:"请输入设备编号",trigger:"blur"},{validator:a}],devimei:[{required:!0,message:"请输入设备IMEI",trigger:"blur"},{validator:t}],batchId:[{required:!0,message:"请输入设备批次",trigger:"blur"}],nodeType:[{required:!0,message:"请输入设备类型",trigger:"blur"}],netType:[{required:!0,message:"请选择网络格式",trigger:"change"}],devType:[{required:!0,message:"请选择设备类型",trigger:"change"}],productName:[{required:!0,message:"请选择产品名称",trigger:"change"}]},pcformrule:{pcname:[{required:!0,message:"请输入批次名称",trigger:"blur"}],createdtime:[{type:"date",required:!0,message:"请选择创建时间",trigger:"change"}]},pcformInline:{pcnumber:"",pcname:"",createdtime:""},pctableData:[],equipmentEditor:"添加",tableData:[],options:[],proTableData:[],proTableData1:[],activelength:[],onlinelength:[],center:{lng:0,lat:0},zoom:13,bmapform:{keyword:"",location:"",address:""},deviceid:"",map:null,addresspointer:"",productenable:!0,changeproduct:!0,tagsid:"",productroleslist:[]}},computed:Object(d["a"])({},Object(m["mapGetters"])({_tableDict:"global/_tableDict",token:"user/token",roleTree:"user/roleTree",language:"settings/language",_product:"user/_Product",_role:"acl/role"})),watch:{multipleTable:function(e){var t=this;this.selectRow=[],e.length>0&&e.forEach((function(e,a){t.selectRow.push(t.tableData.indexOf(e))}))}},mounted:function(){this.onlinedevices="dev_online"==this.$route.query.deciceType?"在线":"dev_unline"==this.$route.query.deciceType?"离线":"",this.getMenu(),this.selectdevice="zh"==this.language?"设备名称":"devicename",this.queryProduct(),this.aclObj=this.$aclObj(this._role)},methods:Object(d["a"])(Object(d["a"])({goLink:function(e,t){var a,r=t.basedata;if(null===r||void 0===r||null===(a=r.videoSrc)||void 0===a||!a.length)return this.$message.info(this.$translateTitle("equipment.The device is not bound to the video address yet")),!1;this.$router.push({path:"/Tools/player",query:{type:r.videoType||"m3u8",url:r.videoSrc}})},handleTabClick:function(e,t){},updateParse:function(e,t,a,r){var i=arguments,l=this;return Object(c["a"])(p.a.mark((function o(){var n,s,c,d,u;return p.a.wrap((function(o){while(1)switch(o.prev=o.next){case 0:for(c in n=i.length>4&&void 0!==i[4]?i[4]:{},n["".concat(t)]={},[],s=[],r.config)l.queryInfo["".concat(c)]?n["".concat(t)]["".concat(c)]=r.config["".concat(c)]:s.push[r.config["".concat(c)]];return d={},d["".concat(t)]=l.queryInfo,u=_.merge(d,n),o.prev=8,o.next=11,l.$update_object(e,a,u);case 11:o.sent,l.$message.success(l.$translateTitle("user.update completed")),o.next=18;break;case 15:o.prev=15,o.t0=o["catch"](8),l.$message.error("".concat(o.t0));case 18:case"end":return o.stop()}}),o,null,[[8,15]])})))()}},Object(m["mapMutations"])({set_tableDict:"global/set_tableDict",set_tableParser:"global/set_tableParser"})),{},{handleSubmit:function(e){return v["Promise"].resolve()},handleSuccess:function(e){var t=this;e.table&&e.field&&e.config.order?this.$get_object(e.table,this.deviceId).then((function(a){t.queryInfo=a["".concat(e.field)],t.queryInfo?t.updateParse(e.table,e.field,t.deviceId,e):t.$message.error("".concat(e.table," no field ").concat(e.field))})):this.$message.error("".concat(e.table," no field ").concat(e.field))},changeBox:function(e){var t=this;this.selectedList=[],e.forEach((function(e){t.selectedList.push(e)}))},handleDelete:function(e,t){var a=this,r=[];2==t?r.push({method:"DELETE",path:"/classes/Device/".concat(e.objectId),body:{}}):e.forEach((function(e){r.push({method:"DELETE",path:"/classes/Device/".concat(e.objectId),body:{}})})),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,Object(c["a"])(p.a.mark((function e(){return p.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(b["batch"])(r);case 2:e.sent,a.$baseMessage(a.$translateTitle("Maintenance.successfully deleted"),"success","vab-hey-message-success"),setTimeout((function(){a.getDevices({start:0})}),1500);case 5:case"end":return e.stop()}}),e)}))))},ParserSave:function(e){},queryProduct:function(){var e=this;return Object(c["a"])(p.a.mark((function t(){var a,r,i;return p.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.proTableData=[],e.proTableData1=[],t.next=4,Object(h["queryProduct"])({count:"objectId",order:"-updatedAt",where:{}});case 4:a=t.sent,r=a.results,i=void 0===r?[]:r,e.proTableData=i,e.$route.query.product&&e.proTableData.forEach((function(t,a){t.objectId==e.$route.query.product&&(e.equvalue=e.proTableData[a].objectId,e.productenable=!0,e.queryForm.access_token=e.token,e.$nextTick((function(){e.selectProdChange(e.$route.query.product)})))})),e.proTableData1=i.filter((function(e){return"0"!=e.objectId})),e.$route.query.productid&&(e.equvalue=e.$route.query.productid,e.productenable=!1);case 11:case"end":return t.stop()}}),t)})))()},change:function(e){e&&$(".el-tree").css({height:"120px",display:"block"})},selectProdChange:function(e){var t=this;return Object(c["a"])(p.a.mark((function a(){var r,i,l,o,n,s;return p.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(e){a.next=2;break}return a.abrupt("return");case 2:if(t.listLoading=!0,"0"!=e){a.next=7;break}t.isALL=!0,a.next=28;break;case 7:return a.next=9,Object(h["getProduct"])(e).then((function(e){t.listLoading=!1;var a=e.config,r=void 0===a?{basedate:{}}:a,i=r.basedate,l=void 0===i?{params:[]}:i;t.dialogtempconfig=[],"undefined"!=l.params&&(t.dialogtempconfig=l.params)}));case 9:return t.isALL=!1,t.tableData=[],r={limit:t.devicelength,skip:t.devicestart,order:"-createdAt",count:"objectId",include:"product,name",where:{product:{$ne:null},name:{$ne:null,$exists:!0}}},""!=t.deviceinput&&("设备名称"==t.selectdevice?r.where.name=t.deviceinput:r.where.devaddr=t.deviceinput),""!=t.onlinedevices&&("在线"==t.onlinedevices?r.where.status="ONLINE":r.where.status="OFFLINE"),""!=t.devicenumber&&(r.where.devaddr=t.devicenumber),r.where.product=e,t.devicestart=0,a.next=19,Object(T["querycompanyDevice"])(r,t.queryForm.access_token);case 19:i=a.sent,l=i.results,o=void 0===l?[]:l,n=i.count,s=void 0===n?0:n,o.forEach((function(e){if(e.ACL)for(var t in e.ACL)e.Company=t.substr(5);else e.Company="";if(e.profile)for(var t in e.profile)e[t]=e.profile[t]})),t.tableData=o,t.devicetotal=s,t.chartOnlone.rows[1]["数量"]=t.devicetotal;case 28:t.listLoading=!1;case 29:case"end":return a.stop()}}),a)})))()},showTree:function(e,t){this.deviceId=e,this.deciceCompany=t,this.popoverVisible=!this.popoverVisible},CloseState:function(){this.stateDialog=!1},showInfo:function(e){var t=this;this.deviceId=e.objectId;var a,r,i={isArr:[],obj:[]},l=[];(this.devicedetail=e,e.product.config.parser)&&(a=l).push.apply(a,Object(s["a"])(e.product.config.parser));e.product.config.profile&&(r=l).push.apply(r,Object(s["a"])(e.product.config.profile));this.devicedetail={},l=l.filter((function(e){return e.visible})),this.devicedetail&&l.length?(l.forEach((function(t){if(e["".concat(t.class)])for(var a in e["".concat(t.class)])for(var r in t.config)if(a==r)"object"==Object(n["a"])(t.config.formDesc["".concat(a)])?(i.obj.push(a),t.config.formDesc["".concat(a)]["default"]=e["".concat(t.class)]["".concat(r)]):(i.isArr.push(r),t.config["".concat(a)]=e["".concat(t.class)]["".concat(r)]);else for(var l in t.config.formDesc)a==l&&(i.obj.push(a),t.config.formDesc["".concat(l)]["default"]=e["".concat(t.class)]["".concat(a)])})),this.parseTbas=l,this.$nextTick((function(){t.activeparseTbas=t.parseTbas[0].name,t.InfoDialog=!0}))):this.$baseMessage(this.$translateTitle("product.No device template configured yet"),"error","vab-hey-message-error")},showMap:function(e,t){this.deviceId=t;var a=e.latitude,r=void 0===a?0:a,i=e.longitude,l=void 0===i?0:i;Number(r)&&Number(l)?(this.mapDialog=!0,this.center.lng=l,this.center.lat=r):this.$message.error("位置信息获取失败")},transferAcl:function(e){var t=this,a="role:"+e.name,r={};r[a]={read:!0,write:!0};var i={ACL:r,detail:{factory:e.depname}};this.$confirm(this.$translateTitle("确定要将设备迁移到"+e.name+"吗"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(c["a"])(p.a.mark((function e(){return p.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(T["putDevice"])(t.deviceId,i).then((function(e){e.updatedAt?(t.popoverVisible=!1,t.getMenu(),t.$message({type:"success",message:t.$translateTitle("迁移成功")})):t.$message({type:"success",message:t.$translateTitle("迁移成功")})}));case 2:case"end":return e.stop()}}),e)})))).catch((function(e){}))},getMenu:function(){this.deptTreeData=this.roleTree,this.handleNodeClick(this.deptTreeData[0],0)},handleNodeClick:function(e,t){var a=this;return Object(c["a"])(p.a.mark((function r(){var i,l,o,n,s;return p.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(i=a._role.map((function(e){return e.name})),$(".el-tree").css({height:"0px",display:"none","overflow-x":"auto"}),$(".el-select-dropdown").css({display:"none"}),a.queryForm.workGroupName=e.label,e.name,l=e.objectId,a.curDepartmentId=l,!i.includes(e.name)){r.next=10;break}a.queryForm.access_token=a.token,r.next=20;break;case 10:if(1==t.level){r.next=19;break}return r.next=13,Object(k["getToken"])(e.name);case 13:o=r.sent,n=o.access_token,s=void 0===n?"":n,a.queryForm.access_token=s,r.next=20;break;case 19:a.queryForm.access_token=a.token;case 20:a.getDevices({start:0});case 21:case"end":return r.stop()}}),r)})))()},rolesSelect:function(e){var t=this;return Object(c["a"])(p.a.mark((function a(){var r;return p.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.productroleslist=[],a.next=3,t.$get_object("Product",e);case 3:r=a.sent,r.results;case 5:case"end":return a.stop()}}),a)})))()},goEdit:function(e){var t=window.location.origin+"/spa",a="production";t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var r="".concat(t,"/#?devaddr=").concat(e.devaddr,"&proudctid=").concat(e.productid);window.open(r,"__blank"),localStorage.setItem("topoData",JSON.stringify(e.config))},addressSure:function(){var e=new BMap.LocalSearch(this.map);e.enableAutoViewport();""==this.bmapform.address&&(this.deviceform.address=this.bmapform.keyword,this.imeiform.address=this.bmapform.keyword),e.search(this.bmapform.keyword),this.bmapdialogVisible=!1},handler:function(e){e.BMap;var t=e.map;this.center.lng=120.2,this.center.lat=30.26667,this.zoom=this.zoom,this.map=t},mapClick:function(e){var t=this;this.center.lng=e.point.lng,this.center.lat=e.point.lat,this.addresspointer=e.point.lng.toFixed(6)+","+e.point.lat.toFixed(6);var a=new BMap.Geocoder;a.getLocation(e.point,(function(e){t.bmapform.address=e.address,t.deviceform.address=e.address,t.imeiform.address=e.address}))},updateLocation:function(){this.bmapdialogVisible=!0},handleClosebmap:function(){this.bmapdialogVisible=!1},getOnlineDevices:function(){var e=this;return Object(c["a"])(p.a.mark((function t(){var a,r,i,l;return p.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.chartOnlone={columns:["状态","数量"],rows:[{"状态":"在线","数量":0},{"状态":"离线","数量":0}]},a={limit:1,count:"objectId",include:"product,name",keys:"name",where:{status:"ONLINE",product:{$ne:null},name:{$ne:null,$exists:!0}}},""!=e.deviceinput&&("设备名称"==e.selectdevice?a.where.name={$regex:e.deviceinput}:a.where.devaddr={$regex:e.deviceinput}),""!=e.devicenumber&&(a.where.devaddr=e.devicenumber),0!=e.equvalue&&e.selectProdChange(e.equvalue),t.prev=5,t.next=8,Object(T["querycompanyDevice"])(a,e.queryForm.access_token);case 8:r=t.sent,i=r.count,l=void 0===i?0:i,e.chartOnlone.rows[1]["数量"]=e.devicetotal-l,e.chartOnlone.rows[0]["数量"]=l,t.next=18;break;case 15:t.prev=15,t.t0=t["catch"](5),e.$message.error("".concat(t.t0));case 18:case"end":return t.stop()}}),t,null,[[5,15]])})))()},getDevices:function(){var e=arguments,t=this;return Object(c["a"])(p.a.mark((function a(){var r,i,l,o,n,s,c,d;return p.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.length>0&&void 0!==e[0]?e[0]:{},r.limit||(r=t.queryForm),t.listLoading=!0,i=t.$baseColorfullLoading(3),t.tableData=[],l={limit:r.limit,skip:r.skip,order:r.order,count:"objectId",include:"product,name",where:{product:{$ne:null},name:{$ne:null,$exists:!0}}},""!=t.deviceinput&&("设备名称"==t.selectdevice?l.where.name={$regex:t.deviceinput}:l.where.devaddr={$regex:t.deviceinput}),""!=t.onlinedevices&&("在线"==t.onlinedevices?l.where.status="ONLINE":l.where.status="OFFLINE"),""!=t.devicenumber&&(l.where.devaddr={$regex:t.deviceinput}),0!=t.equvalue&&t.selectProdChange(t.equvalue),0==r.start&&(t.devicestart=0),a.prev=11,a.next=14,Object(T["querycompanyDevice"])(l,t.queryForm.access_token);case 14:if(o=a.sent,n=o.results,s=void 0===n?[]:n,c=o.count,d=void 0===c?0:c,t.listLoading=!1,i.close(),null!==s&&void 0!==s&&s.length){a.next=23;break}return a.abrupt("return");case 23:s.forEach((function(e){if(e.location||(e.location={longitude:0,latitude:0}),e.ACL)for(var t in e.ACL)e.Company=t.substr(5);else e.Company=""})),t.tableData=s,t.devicetotal=d,t.getOnlineDevices(),a.next=36;break;case 29:a.prev=29,a.t0=a["catch"](11),t.listLoading=!1,i.close(),t.tableData=[],t.devicetotal=0,t.$message.error("".concat(a.t0));case 36:case"end":return a.stop()}}),a,null,[[11,29]])})))()},handelUpdate:function(e,t,a){var r=this;return Object(c["a"])(p.a.mark((function e(){var i,l;return p.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(l in i={},r,t)i[l]=t[l];i.isEnable=1!=i.isEnable,r.tableData[a]=i,r.$confirm("是否修改此设备状态?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(c["a"])(p.a.mark((function e(){var a,i,l,n,s;return p.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(f["get_object"])("Device",t.objectId);case 2:return a=e.sent,i=a.isEnable,i=void 0!=i&&!i,a.isEnable=i,a.createdAt,l=Object(o["a"])(a,x),l.updatedAt,n=Object(o["a"])(l,F),e.next=10,r.$update_object("Device",t.objectId,n);case 10:s=e.sent,void 0!=s?(r.$message({type:"success",message:"状态修改成功"}),r.getDevices()):Object(w["returnLogin"])(error);case 12:case"end":return e.stop()}}),e)})))).catch(Object(c["a"])(p.a.mark((function e(){var i;return p.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r.$message({type:"info",message:"已取消修改"}),i=t,i.isEnable=1!=i.isEnable,r.tableData[a]=i;case 4:case"end":return e.stop()}}),e)}))));case 6:case"end":return e.stop()}}),e)})))()},timestampToTime:function(e){var t=new Date(1200*e),a=t.getFullYear()+"-",r=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",i=(t.getDate()+1<=10?"0"+t.getDate():t.getDate())+" ",l=(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":",o=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",n=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return a+r+i+l+o+n},utc2beijing:function(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},filterTag:function(e,t){return t.tag===e},deleteDevcie:function(e){var t=this;return Object(c["a"])(p.a.mark((function e(){return p.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.multipleTable.map(function(){var e=Object(c["a"])(p.a.mark((function e(a){return p.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$del_object("Device",a.objectId);case 2:e.sent;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.$message({message:"删除成功",type:"success"}),t.getDevices();case 3:case"end":return e.stop()}}),e)})))()},editDevice:function(){var e=this;return Object(c["a"])(p.a.mark((function t(){var a;return p.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$update_object("Device",item.objectId,params);case 2:a=t.sent,a.updatedAt?e.initQuery("设备修改成功","success"):e.$message({type:"error",message:a.error});case 4:case"end":return t.stop()}}),t)})))()},unactiveDevice:function(e){var t=this;return Object(c["a"])(p.a.mark((function a(){var r,i,l,o;return p.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=[],i=[],t.multipleTable.map((function(e){r.push(e.objectId)})),l={isEnable:e},a.next=6,Object(b["Batchdelete"])("PUT","Device",r,l);case 6:o=a.sent,o&&(o.forEach((function(e,t){e.objectId=r[t],e.sortIndex=t+1,"success"==Object.keys(o[t])[0]?(e.msg="edit success",e.dangerouslyUseHTMLString=!1):(e.msg="<ol>\n            edit error <br>\n            message: ".concat(e.error.error," <br>\n            code: ").concat(e.error.code," <ol>"),e.dangerouslyUseHTMLString=!0),i.push({type:Object.keys(o[t])[0],message:e.msg,dangerouslyUseHTMLString:e.dangerouslyUseHTMLString})})),i.forEach((function(e,a){t.$baseNotify(e.message,"".concat(r[a]),e.type,"top-right",5e3*e.sortIndex,e.dangerouslyUseHTMLString)})),t.getDevices());case 8:case"end":return a.stop()}}),a)})))()},rowClass:function(e){e.row;var t=e.rowIndex;if(this.selectRow.includes(t))return{"background-color":"rgba(185, 221, 249, 0.3)"}},deviceSizeChange:function(e){this.devicelength=e,this.getDevices()},deviceCurrentChange:function(e){this.devicestart=(e-1)*this.devicelength,this.getDevices()},handleClose:function(){this.deviceid="",this.deviceform={name:"",devaddr:"",batchId:"",desc:"",nodeType:0,devType:"",netType:"",assetNum:"",devModel:"",address:"",videoSrc:"",productName:"",status:"",isEnable:"",brand:"",auth:"",yysId:""},this.$refs["deviceform"].resetFields(),this.devicedialogVisible=!1,this.equipmentEditor="添加"},addDeviceForm:function(){this.devicedialogVisible=!0,this.arrlist=[],this.equipmentEditor="添加",this.$route.query.productid?this.deviceform.productName=this.$route.query.productid:0!=this.equvalue?(this.changeproduct=!1,this.deviceform.productName=this.equvalue,this.selectChange(this.equvalue,"add")):this.deviceform.productName=""},handleClose1:function(){this.pcdialogVisible=!1,this.batchid="",this.pcformInline={pcname:"",createdtime:""}},makeSure:function(e){var t=this;return Object(c["a"])(p.a.mark((function a(){var r;return p.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$del_object("Device",row.objectId);case 2:r=a.sent,r.error?t.$message({type:"error",message:"删除失败"}):(t.$message({type:"success",message:"删除成功"}),t.getDevices()),e._self.$refs["popover-".concat(e.$index)].doClose();case 5:case"end":return a.stop()}}),a)})))()},editorDevice:function(e){var t=this;return Object(c["a"])(p.a.mark((function a(){var r;return p.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:for(r in t.editRow={},t.selectChange(e.product.objectId,"edit"),t.deviceform={},t.editRow=e,t.deviceid=e.objectId,t.devicedialogVisible=!0,t.imeideviceName="first",t.deviceform={devaddr:e.devaddr,name:e.name,assetNum:e.detail.assetNum,devModel:e.detail.devModel,desc:e.detail.desc,productid:e.product.objectId,brand:e.detail.brand,productName:e.product.objectId,status:e.status,isEnable:e.isEnable,videoType:e.detail.videoType,videoSrc:e.detail.videoSrc,address:e.detail.address},e.basedata)t.$set(t.deviceform,r,e.basedata[r]);t.bmapform={address:e.detail.address},t.center={lat:location.latitude,lng:location.longitude},t.addresspointer=void 0==e.detail||void 0==location||location.latitude+e.detail==void 0?"":location.longitude,t.equipmentEditor="编辑";case 13:case"end":return a.stop()}}),a)})))()},getBatch:function(){return new v["Promise"]((function(e,t){r.length>0?e(r):t(!1)}))},initQuery:function(e,t){this.$message({type:t||"info",message:e}),this.dialogFormVisible=!1,this.getDevices({start:0})},updateDevice:function(e){var t=this;return Object(c["a"])(p.a.mark((function a(){var r;return p.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$update_object("Device",t.deviceid,e);case 2:r=a.sent,r.updatedAt||r.devaddr?t.initQuery("设备更新成功","success"):t.$message({type:"error",message:r.error});case 4:case"end":return a.stop()}}),a)})))()},createDevice:function(e){var t=this;return Object(c["a"])(p.a.mark((function a(){var r;return p.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$create_object("Device",e);case 2:r=a.sent,r.objectId?(t.deviceform={},t.handleClose(),t.initQuery("设备创建成功","success")):t.$message({type:"error",message:r});case 4:case"end":return a.stop()}}),a)})))()},selectChange:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"add";this.arrlist=[],Object(h["getProduct"])(e).then((function(e){var r=e.config,i=void 0===r?{basedate:{}}:r;i.basedate&&i.basedate.params.length>0&&(t.arrlist=i.basedate.params,"add"==a&&t.arrlist.map((function(e){var a;if("bool"==e.type)t.$set(t.deviceform,e.identifier?e.identifier:"",null!==(a=e.default)&&void 0!==a&&a.length?e.default:"");else if("enum"==e.type){var r,i,l;t.$set(t.deviceform,e.identifier?e.identifier:"",null!==(r=e.specs)&&void 0!==r&&null!==(i=r[0])&&void 0!==i&&null!==(l=i.attribute)&&void 0!==l&&l.length?e.specs[0].attribute:"")}else{var o;t.$set(t.deviceform,e.identifier?e.identifier:"",null!==(o=e.default)&&void 0!==o&&o.length?e.default:"")}e.required&&("bool"==e.type?t.rules[e.identifier]=[{required:!0,message:"请选择"+e.name,trigger:"change"}]:t.rules[e.identifier]=[{required:!0,message:"请输入"+e.name,trigger:"blur"}])})))}))},submitForm:function(e){var t=this;return Object(c["a"])(p.a.mark((function a(){return p.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.$refs[e].validate(function(){var e=Object(c["a"])(p.a.mark((function e(a){var r,i,l,o,n,s;return p.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!a){e.next=23;break}for(o in r={__type:"GeoPoint",latitude:t.center.lat?t.center.lat:0,longitude:t.center.lng?t.center.lng:0},i={assetNum:t.deviceform.assetNum,devModel:t.deviceform.devModel,brand:t.deviceform.brand,address:t.bmapform.address,desc:t.deviceform.desc,videoType:t.deviceform.videoType,videoSrc:t.deviceform.videoSrc},l={},t.deviceform)l[o]=t.deviceform[o];t.$delete(l,"address"),t.$delete(l,"assetNum"),t.$delete(l,"batchId"),t.$delete(l,"brand"),t.$delete(l,"desc"),t.$delete(l,"devModel"),t.$delete(l,"devType"),t.$delete(l,"devaddr"),t.$delete(l,"isEnable"),t.$delete(l,"name"),t.$delete(l,"netType"),t.$delete(l,"nodeType"),t.$delete(l,"productName"),t.$delete(l,"status"),t.$delete(l,"productid"),""!=t.deviceid?(n={name:t.deviceform.name,devaddr:t.deviceform.devaddr,product:{__type:"Pointer",className:"Product",objectId:t.editRow.product.objectId},detail:i,location:r,basedata:l,profile:l},t.updateDevice(n),t.handleClose(),t.getDevices({start:0})):(s={count:"objectId",where:{name:{$in:[t.deviceform.name]},devaddr:{$in:[t.deviceform.devaddr]}}},t.$query_object("Device",s).then((function(e){if(e.count>0)t.$message("此设备已被创建");else{var a={product:{__type:"Pointer",className:"Product",objectId:t.deviceform.productName},status:"OFFLINE",isEnable:!1,ACL:t.aclObj,name:t.deviceform.name,devaddr:t.deviceform.devaddr,objectId:t.deviceform.devaddr,lastOnlineTime:0,detail:i,location:r,basedata:l};t.createDevice(a)}}))),e.next=25;break;case 23:return t.$message({type:"error",message:"请按照要求填写参数"}),e.abrupt("return",!1);case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return a.stop()}}),a)})))()},submitimeiForm:function(e){var t=this;return Object(c["a"])(p.a.mark((function a(){return p.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.$refs[e].validate(function(){var e=Object(c["a"])(p.a.mark((function e(a){var r;return p.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!a){e.next=5;break}r={productid:t.imeiform.productName,devaddr:t.imeiform.devimei,latitude:t.center.lat?t.center.lat:0,longitude:t.center.lng?t.center.lng:0},Object(T["addimeidevice"])(r).then((function(e){e.objectId?(t.deviceform={},t.handleClose(),t.initQuery("设备创建成功","success")):t.$message({type:"error",message:e})})),e.next=7;break;case 5:return t.$message({type:"error",message:"请按照要求填写参数"}),e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return a.stop()}}),a)})))()},deviceToDetail:function(e){this.$router.push({path:"/roles/editdevices",query:{deviceid:e.objectId,nodeType:e.nodeType,productid:e.product.objectId,ischildren:"false"}})},konvaDevice:function(e){this.$router.push({path:"/Topo",query:{productid:e.product.objectId,devaddr:e.devaddr,deviceid:e.objectId,type:"device"}})}})},j=D,S=(a("5c26"),a("bdd7")),C=Object(S["a"])(j,i,l,!1,null,"d2803a1c",null);t["default"]=C.exports},ad37:function(e,t,a){},adc5:function(e,t,a){},aed5:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wmxheader"},[a("el-form",{ref:"sizeForm",attrs:{"label-position":"left","label-width":"150px",model:e.sizeForm,rules:e.sizerule,size:"mini"}},[a("div",[a("el-collapse",{model:{value:e.collapseName,callback:function(t){e.collapseName=t},expression:"collapseName"}},[a("el-collapse-item",{attrs:{name:"1"}},[a("template",{slot:"title"},[e._v(" "+e._s(e.$translateTitle("task.datastorage"))+" ")]),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.devicetype"),prop:"devicetype"}},[a("el-input",{model:{value:e.sizeForm.devicetype,callback:function(t){e.$set(e.sizeForm,"devicetype",t)},expression:"sizeForm.devicetype"}})],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.functionname"),prop:"name"}},[e.sizeForm.nobound&&e.sizeForm.nobound.length>0?a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择"},on:{change:e.changeThing},model:{value:e.sizeForm.name,callback:function(t){e.$set(e.sizeForm,"name",t)},expression:"sizeForm.name"}},e._l(e.sizeForm.nobound,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e}})})),1):a("el-input",{model:{value:e.sizeForm.name,callback:function(t){e.$set(e.sizeForm,"name",t)},expression:"sizeForm.name"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.identifier"),prop:"identifier"}},[a("el-input",{attrs:{disabled:e.sizeForm.editdatatype},model:{value:e.sizeForm.identifier,callback:function(t){e.$set(e.sizeForm,"identifier",t)},expression:"sizeForm.identifier"}})],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.datatype"),prop:"type"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:e.sizeForm.editdatatype},on:{change:e.changeGroup},model:{value:e.sizeForm.type,callback:function(t){e.$set(e.sizeForm,"type",t)},expression:"sizeForm.type"}},e._l(e.dataType,(function(t){return a("el-option-group",{key:t.label,attrs:{label:t.label}},e._l(t.options,(function(t){return a("el-option",{key:t.value,attrs:{label:t.value,value:t.value}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.label))]),a("span",{staticStyle:{float:"right",color:"#8492a6"}},[e._v(" "+e._s(t.value)+" ")])])})),1)})),1)],1)],1),"float"==e.sizeForm.type||"double"==e.sizeForm.type?a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"小数位数",prop:"precision"}},[a("el-select",{staticStyle:{width:"100%"},model:{value:e.sizeForm.precision,callback:function(t){e.$set(e.sizeForm,"precision",t)},expression:"sizeForm.precision"}},[a("el-option",{attrs:{label:1,value:"1"}}),a("el-option",{attrs:{label:2,value:"2"}}),a("el-option",{attrs:{label:3,value:"3"}}),a("el-option",{attrs:{label:4,value:"4"}}),a("el-option",{attrs:{label:5,value:"5"}}),a("el-option",{attrs:{label:6,value:"6"}})],1)],1)],1):e._e(),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"图标",prop:"precision"}},[a("el-avatar",{attrs:{size:100,src:e.$FileServe+e.sizeForm.ico},nativeOn:{click:function(t){return e.uploadCkick("userinfo.avatar")}}}),a("vab-input",{ref:"uploadFinish",attrs:{params:e.inputParams},on:{fileInfo:e.fileInfo,files:e.files}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.readandwritetype"),prop:"isread"}},[a("el-radio-group",{staticStyle:{width:"100%"},attrs:{size:"medium"},model:{value:e.sizeForm.isread,callback:function(t){e.$set(e.sizeForm,"isread",t)},expression:"sizeForm.isread"}},[a("el-radio",{attrs:{label:"rw"}},[e._v(" "+e._s(e.$translateTitle("product.write"))+" ")]),a("el-radio",{attrs:{label:"r"}},[e._v(" "+e._s(e.$translateTitle("product.read"))+" ")])],1)],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.isstorage"),prop:"isshow"}},[a("el-radio-group",{staticStyle:{width:"100%"},attrs:{size:"medium"},model:{value:e.sizeForm.isshow,callback:function(t){e.$set(e.sizeForm,"isshow",t)},expression:"sizeForm.isshow"}},[a("el-radio",{attrs:{label:!0}},[e._v(" "+e._s(e.$translateTitle("product.storage"))+" ")]),a("el-radio",{attrs:{label:!1}},[e._v(" "+e._s(e.$translateTitle("product.notstorage"))+" ")])],1)],1)],1)],1),"int"==e.sizeForm.type||"long"==e.sizeForm.type||"float"==e.sizeForm.type||"double"==e.sizeForm.type?a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.valuerangemin"),prop:"startnumber"}},[a("el-input",{attrs:{placeholder:e.$translateTitle("product.minimumvalue"),type:"number"},model:{value:e.sizeForm.startnumber,callback:function(t){e.$set(e.sizeForm,"startnumber",e._n(t))},expression:"sizeForm.startnumber"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.valuerangemax"),prop:"endnumber"}},[a("el-input",{attrs:{placeholder:e.$translateTitle("product.maximumvalue"),type:"number"},on:{input:function(t){return e.changeValue("sizeForm")}},model:{value:e.sizeForm.endnumber,callback:function(t){e.$set(e.sizeForm,"endnumber",e._n(t))},expression:"sizeForm.endnumber"}})],1)],1)],1):e._e(),"int"==e.sizeForm.type||"long"==e.sizeForm.type||"float"==e.sizeForm.type||"double"==e.sizeForm.type?a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"步长",prop:"step"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,precision:2,step:.01},model:{value:e.sizeForm.step,callback:function(t){e.$set(e.sizeForm,"step",t)},expression:"sizeForm.step"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.unit")}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:e.$translateTitle("product.unit")},model:{value:e.sizeForm.unit,callback:function(t){e.$set(e.sizeForm,"unit",t)},expression:"sizeForm.unit"}},e._l(e.allunit,(function(t){return a("el-option-group",{key:t.label,attrs:{label:t.label}},e._l(t.options,(function(t){return a("el-option",{key:t.id,attrs:{label:t.symbol,value:t.symbol}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.name))]),a("span",{staticStyle:{float:"right",color:"#8492a6"}},[e._v(" "+e._s(t.symbol)+" ")])])})),1)})),1)],1)],1)],1):e._e(),"bool"==e.sizeForm.type?a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.attribute"),prop:"truevalue",required:""}},[a("el-input",{attrs:{placeholder:e.$translateTitle("product.attribute"),readonly:"",type:"number"},model:{value:e.sizeForm.truevalue,callback:function(t){e.$set(e.sizeForm,"truevalue",t)},expression:"sizeForm.truevalue"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"-"}},[a("el-input",{attrs:{placeholder:e.$translateTitle("product.egopen")},model:{value:e.sizeForm.true,callback:function(t){e.$set(e.sizeForm,"true",t)},expression:"sizeForm.true"}})],1)],1)],1):e._e(),"bool"==e.sizeForm.type?a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",[a("el-input",{attrs:{placeholder:e.$translateTitle("product.attribute"),readonly:"",type:"number"},model:{value:e.sizeForm.falsevalue,callback:function(t){e.$set(e.sizeForm,"falsevalue",t)},expression:"sizeForm.falsevalue"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"-"}},[a("el-input",{attrs:{placeholder:e.$translateTitle("product.egclose")},model:{value:e.sizeForm.false,callback:function(t){e.$set(e.sizeForm,"false",t)},expression:"sizeForm.false"}})],1)],1)],1):e._e(),"enum"==e.sizeForm.type?a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"枚举项"}},[a("el-link",{attrs:{icon:"el-icon-plus",type:"primary",underline:!1},on:{click:e.addDomain}},[e._v(" "+e._s(e.$translateTitle("product.add"))+" ")]),a("el-alert",{attrs:{closable:!1,description:"存库值必须是int类型，界面值是字符串类型,设备值与存库值转化请使用采集公式",title:"参数提示",type:"success"}}),a("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{data:e.sizeForm.struct}},[a("el-table-column",{attrs:{align:"center",label:"存库值"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{model:{value:r.attribute,callback:function(t){e.$set(r,"attribute",t)},expression:"row.attribute"}})]}}],null,!1,145805847)}),a("el-table-column",{attrs:{align:"center",label:"界面值"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{model:{value:r.attributevalue,callback:function(t){e.$set(r,"attributevalue",t)},expression:"row.attributevalue"}})]}}],null,!1,2139517436)}),a("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{plain:"",size:"mini",title:"删除",type:"danger"},nativeOn:{click:function(t){return e.removeDomain(r)}}},[e._v(" 删除 ")])]}}],null,!1,1667144408)})],1)],1)],1)],1):e._e(),"struct"==e.sizeForm.type?a("div",[a("el-form-item",{attrs:{label:"JSON对象",required:""}},[a("ul",{staticStyle:{"padding-left":"20px",margin:"0"}},e._l(e.sizeForm.struct,(function(t,r){return a("li",{key:r,staticStyle:{display:"flex","list-style":"none"},attrs:{value:"item"}},[a("div",[a("span",[e._v(" "+e._s(e.$translateTitle("product.parametername")+":")+"} ")]),a("span",[e._v(e._s(t.name))])]),a("div",[a("el-link",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary",underline:!1},on:{click:function(a){return e.editStruct(t,r)}}},[e._v(" "+e._s(e.$translateTitle("developer.edit"))+" ")]),a("el-link",{attrs:{type:"primary",underline:!1},on:{click:function(t){return e.deleteStruct(r)}}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)])})),0),a("el-link",{attrs:{icon:"el-icon-plus",type:"primary",underline:!1},on:{click:function(t){return e.addStruct("structform")}}},[e._v(" "+e._s(e.$translateTitle("product.addparameter"))+" ")])],1)],1):e._e(),"text"==e.sizeForm.type?a("div",[a("el-form-item",{attrs:{label:e.$translateTitle("product.datalength"),prop:"string"}},[a("el-input",{attrs:{type:"number"},model:{value:e.sizeForm.string,callback:function(t){e.$set(e.sizeForm,"string",e._n(t))},expression:"sizeForm.string"}},[a("template",{slot:"append"},[e._v(" "+e._s(e.$translateTitle("product.byte"))+" ")])],2)],1)],1):e._e(),"date"==e.sizeForm.type?a("div",[a("el-form-item",{attrs:{label:e.$translateTitle("product.timeformat")}},[a("el-input",{attrs:{readonly:""},model:{value:e.sizeForm.date,callback:function(t){e.$set(e.sizeForm,"date",t)},expression:"sizeForm.date"}})],1)],1):e._e(),"geopoint"==e.sizeForm.type?a("div",[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{staticClass:"is-required",attrs:{label:e.$translateTitle("product.gps type")}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:""},model:{value:e.sizeForm.gpstype,callback:function(t){e.$set(e.sizeForm,"gpstype",t)},expression:"sizeForm.gpstype"}},e._l(["NMEA0183"],(function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1)],1)],1)],1):e._e(),"file"==e.sizeForm.type?a("div",[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{staticClass:"is-required",attrs:{label:e.$translateTitle("product.image type")}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:""},model:{value:e.options.value,callback:function(t){e.$set(e.options,"value",t)},expression:"options.value"}},e._l(["二进制","Base64"],(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.File parameters")}},[a("el-input",{model:{value:e.sizeForm.file,callback:function(t){e.$set(e.sizeForm,"file",t)},expression:"sizeForm.file"}})],1)],1)],1)],1):e._e(),"image"==e.sizeForm.type?a("div",[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{staticClass:"is-required",attrs:{label:e.$translateTitle("product.image type")}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:""},model:{value:e.sizeForm.imagevalue,callback:function(t){e.$set(e.sizeForm,"imagevalue",t)},expression:"sizeForm.imagevalue"}},e._l(["jpg","png","ico"],(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1)],1)],1):e._e()],2),a("el-collapse-item",{attrs:{name:"2"}},[a("template",{slot:"title"},[e._v(" "+e._s(e.$translateTitle("task.dataacquisition"))+" "),a("el-row",{staticStyle:{margin:"0 auto"}},[a("el-col",{attrs:{span:2}},[a("el-popover",{attrs:{placement:"right",trigger:"click",width:"400"}},[a("el-table",{attrs:{data:e.wmxData.slice((e.wmxstart-1)*e.wmxPageSize,e.wmxstart*e.wmxPageSize)}},[a("el-table-column",{attrs:{label:e.$translateTitle("product.identifier")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",{staticStyle:{"margin-left":"10px"}},[e._v(" "+e._s(r.identifier)+" ")])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.functionname")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",{staticStyle:{"margin-left":"10px"}},[e._v(" "+e._s(r.name)+" ")])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.datatype")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",{staticStyle:{"margin-left":"10px"}},[e._v(" "+e._s(r.dataType.type)+" ")])]}}])})],1),a("el-pagination",{staticStyle:{"margin-top":"10px"},attrs:{layout:"total, sizes, prev, pager, next, jumper","page-size":e.wmxPageSize,"page-sizes":[10,20,30,50],total:e.wmxData.length},on:{"current-change":e.wmxCurrentChange,"size-change":e.wmxSizeChange}})],1)],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-tooltip",{staticStyle:{float:"left"},attrs:{effect:"dark",placement:"right-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v(" 采集策略表达式 。 "),a("br"),e._v(" 如： "),a("br"),e._v(" 5分钟 = 5 * 60 "),a("br"),e._v(" 1小时 = 60 * 60 "),a("br"),e._v(" 5小时 = 5 * 60 * 60 "),a("br"),e._v(" 1天 = 24 * 60 * 60 "),a("br")]),a("i",{staticClass:"el-icon-question"})]),a("el-form-item",{attrs:{label:"采集策略(单位：秒)"}},[a("el-select",{staticStyle:{width:"95%"},attrs:{"allow-create":"","default-first-option":"",filterable:"",placeholder:"请选择",size:"mini"},model:{value:e.sizeForm.strategy,callback:function(t){e.$set(e.sizeForm,"strategy",t)},expression:"sizeForm.strategy"}},e._l(e.sizeOption,(function(e){return a("el-option",{key:e.val,attrs:{label:e.label,size:"mini",value:e.val}})})),1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"采集轮次"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{"allow-create":"","default-first-option":"",filterable:"",placeholder:"请选择生效轮次",size:"mini"},model:{value:e.sizeForm.round,callback:function(t){e.$set(e.sizeForm,"round",t)},expression:"sizeForm.round"}},e._l(e.options,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),a("p",{staticStyle:{position:"absolute",top:"26px",margin:"0","font-size":"12px",color:"black"}},[e._v(" 例如:1,3,5,8;(可选可自主填写)(注意:逗号为英文逗号) ")])],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-tooltip",{staticStyle:{float:"left"},attrs:{effect:"dark",placement:"right-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v(" 1. 采集值 设备上行数据经采集公式计算后显示 。 "),a("br"),e._v(" 公式中的%s为占位符，是固定字段。 "),a("br"),e._v(" 如： "),a("br"),e._v(" 加：%s+10 "),a("br"),e._v(" 减：%s-10 "),a("br"),e._v(" 乘：%s*10 "),a("br"),e._v(" 除：%s/10 "),a("br"),e._v(" 余数：%s%10 "),a("br"),e._v(" 2. 计算值 添加变量按钮, "),a("br"),e._v(" 复制对应的标识符 "),a("br"),e._v(" 例：pressure_out "),a("br"),e._v(" 加：pressure_out+10 "),a("br"),e._v(" 减：pressure_out-10 "),a("br"),e._v(" 乘：pressure_out*10 "),a("br"),e._v(" 除：pressure_out/10 "),a("br"),e._v(" 余数：pressure_out%10 "),a("br"),e._v(" 3. 复杂值 ：关闭本弹窗后使用物解析处理 "),a("br")]),a("i",{staticClass:"el-icon-question"})]),a("el-form-item",{attrs:{label:"采集公式"}},[a("el-input",{staticStyle:{width:"95%"},attrs:{placeholder:"%s",rows:1,type:"textarea"},model:{value:e.sizeForm.collection,callback:function(t){e.$set(e.sizeForm,"collection",t)},expression:"sizeForm.collection"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"采集顺序"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{label:"采集顺序",min:0},model:{value:e.sizeForm.order,callback:function(t){e.$set(e.sizeForm,"order",t)},expression:"sizeForm.order"}})],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:24}},[a("el-tooltip",{attrs:{effect:"dark",placement:"right-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v(" 1. 采集值: 主动向设备写数据经控制公式计算后下发 。 "),a("br"),e._v(" 公式中的%s为占位符，是固定字段。 "),a("br"),e._v(" 如： "),a("br"),e._v(" 加：%s+10 "),a("br"),e._v(" 减：%s-10 "),a("br"),e._v(" 乘：%s*10 "),a("br"),e._v(" 除：%s/10 "),a("br"),e._v(" 余数：%s%10 "),a("br"),e._v(" 2. 计算值: 点击添加变量按钮, "),a("br"),e._v(" 复制对应的标识符 "),a("br"),e._v(" 例：pressure_out "),a("br"),e._v(" 加：pressure_out+10 "),a("br"),e._v(" 减：pressure_out-10 "),a("br"),e._v(" 乘：pressure_out*10 "),a("br"),e._v(" 除：pressure_out/10 "),a("br"),e._v(" 余数：pressure_out%10 "),a("br"),e._v(" 3. 复杂值 ：关闭本弹窗后使用物解析处理 "),a("br")]),a("i",{staticClass:"el-icon-question",staticStyle:{float:"left"}})]),a("el-form-item",{attrs:{label:"控制公式"}},[a("el-input",{staticStyle:{width:"98%"},attrs:{placeholder:"%s",rows:1,type:"textarea"},model:{value:e.sizeForm.control,callback:function(t){e.$set(e.sizeForm,"control",t)},expression:"sizeForm.control"}})],1)],1)],1)],2),a("el-collapse-item",{attrs:{name:"4"}},[a("template",{slot:"title"},[e._v("数据来源")]),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"协议类型"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.sizeForm.protocol,callback:function(t){e.$set(e.sizeForm,"protocol",t)},expression:"sizeForm.protocol"}},e._l(["normal","modbus","DLT645","xinchuangwei","mingcheng"],(function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1)],1)],1),a("el-row",{directives:[{name:"show",rawName:"v-show",value:"modbus"==e.sizeForm.protocol,expression:"sizeForm.protocol == 'modbus'"}],attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据格式"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.sizeForm.originaltype,callback:function(t){e.$set(e.sizeForm,"originaltype",t)},expression:"sizeForm.originaltype"}},e._l([{value:"bit",label:"位"},{value:"short16_AB",label:"16位 有符号(AB)"},{value:"short16_BA",label:"16位 有符号(BA)"},{value:"ushort16_AB",label:"16位 无符号(AB)"},{value:"ushort16_BA",label:"16位 无符号(BA)"},{value:"long32_ABCD",label:"32位 有符号(ABCD)"},{value:"long32_CDAB",label:"32位 有符号(CDAB)"},{value:"ulong32_ABCD",label:"32位 无符号(ABCD)"},{value:"ulong32_CDAB",label:"32位 无符号(CDAB)"},{value:"float32_ABCD",label:"32位 浮点数(ABCD)"},{value:"float32_CDAB",label:"32位 浮点数(CDAB)"}],(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),a("el-table",{directives:[{name:"show",rawName:"v-show",value:"modbus"==e.sizeForm.protocol,expression:"sizeForm.protocol == 'modbus'"}],staticStyle:{width:"100%"},attrs:{border:"",data:e.dataList,size:"small"}},[a("el-table-column",{attrs:{align:"center",label:"从机地址(16进制加0X,例:0X10,否则是十进制)","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{model:{value:e.sizeForm.slaveid,callback:function(t){e.$set(e.sizeForm,"slaveid",t)},expression:"sizeForm.slaveid"}}),a("span",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[e._v(e._s(r))])]}}])}),a("el-table-column",{attrs:{align:"center",label:"寄存器状态","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.sizeForm.operatetype,callback:function(t){e.$set(e.sizeForm,"operatetype",t)},expression:"sizeForm.operatetype"}},e._l([{value:"readCoils",label:"0X01:读线圈寄存器"},{value:"readInputs",label:"0X02:读离散输入寄存器"},{value:"readHregs",label:"0X03:读保持寄存器"},{value:"readIregs",label:"0X04:读输入寄存器"},{value:"writeCoil",label:"0X05:写单个线圈寄存器"},{value:"writeHreg",label:"0X06:写单个保持寄存器"},{value:"writeCoils",label:"0X0f:写多个线圈寄存器"},{value:"writeHregs",label:"0X10:写多个保持寄存器"}],(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),a("span",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[e._v(e._s(r.slaveid))])]}}])}),a("el-table-column",{attrs:{align:"center",label:"数据地址(16进制加0X,例:0X10,否则是十进制)","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{model:{value:e.sizeForm.dis,callback:function(t){e.$set(e.sizeForm,"dis",t)},expression:"sizeForm.dis"}}),a("span",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[e._v(e._s(r.slaveid))])]}}])}),a("el-table-column",{attrs:{align:"center",label:"数据长度(字节)","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{model:{value:e.sizeForm.dinumber,callback:function(t){e.$set(e.sizeForm,"dinumber",t)},expression:"sizeForm.dinumber"}}),a("span",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[e._v(e._s(r.slaveid))])]}}])})],1),a("el-row",{directives:[{name:"show",rawName:"v-show",value:"modbus"!=e.sizeForm.protocol,expression:"sizeForm.protocol != 'modbus'"}],attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据地址"}},[a("el-input",{attrs:{placeholder:"数据地址"},model:{value:e.sizeForm.dis,callback:function(t){e.$set(e.sizeForm,"dis",t)},expression:"sizeForm.dis"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据长度"}},[a("el-input",{attrs:{placeholder:"数据长度（字节）"},model:{value:e.sizeForm.dinumber,callback:function(t){e.$set(e.sizeForm,"dinumber",e._n(t))},expression:"sizeForm.dinumber"}})],1)],1)],1)],2)],1)],1)]),a("div",{staticStyle:{"margin-top":"26px","text-align":"center"}},[a("el-button",{on:{click:e.wmxhandleClose}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("sizeForm")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)],1)},i=[],l=a("fb07"),o=a("e97b"),n=a("d0d7"),s=a.n(n),c=(a("1d17"),a("37c6"),a("f1e1"),a("16b8"),a("e09d")),d=a("e0e9"),u=a("5880"),p={name:"Wmxdetail",components:{},data:function(){var e=this,t=/^[a-z][a-z0-9_]*$/,a=function(e,a,r){if(!t.test(a))return r(new Error("请以小写字母开头，只能输入小写字母,数字,_"));r()},r=function(t,a,r){""===a?r(new Error("最小值不能为空")):""!==e.sizeForm.endnumber&&(a>=e.sizeForm.endnumber?r(new Error("最小值小于最大值")):r())},i=function(t,a,r){""===a?r(new Error("最大值不能为空")):""!==e.sizeForm.startnumber&&(a<=e.sizeForm.startnumber?r(new Error("最大值必须大于最小值")):r())},l=function(t,a,r){a<0?r(new Error("步长大于0")):a>=e.sizeForm.endnumber-e.sizeForm.startnumber?r(new Error("步长必须小于最大值和最小值的差值")):r()};return{inputParams:{},dataList:[{}],dataType:c["default"].mockModules.dataType,options:[{value:"all",label:"全部"},{value:"first",label:"第一轮"},{value:"last",label:"最后一轮"}],wmxData:[],allunit:c["default"].mockModules.dataNnit,sizerule:{step:[{required:!0,trigger:"blur",validator:l}],string:[{required:!0,trigger:"blur",message:"请输入数据长度"},{type:"number",message:"数据长度必须为数字"}],startnumber:[{validator:r,required:!0,trigger:"blur"}],endnumber:[{validator:i,required:!0,trigger:"blur"}],resource:[{required:!0,message:"请选择功能类型",trigger:"change"}],true:[{required:!0,message:"请输入属性值",trigger:"blur"}],false:[{required:!0,message:"请输入属性值",trigger:"blur"}],name:[{required:!0,message:"请输入属性名称",trigger:"blur"}],identifier:[{required:!0,message:"请输入标识符",trigger:"blur"},{validator:a}],dis:[{required:!0,message:"请输入数据标识",trigger:"blur"}],type:[{required:!0,message:"请选择数据类型",trigger:"change"}],attribute:[{required:!0,message:"请输入属性",trigger:"blur"}],attributevalue:[{required:!0,message:"请输入属性值",trigger:"blur"}],isread:[{required:!0,message:"请选择读写类型",trigger:"change"}],isshow:[{required:!0,message:"请选择是否存储",trigger:"change"}]},collapseName:["1","2","3","4"],wmxstart:1,wmxPageSize:10,sizeOption:[{label:"20",val:"20"},{label:"不采集(计算值)",val:"计算值"},{label:"不采集(主动上报)",val:"主动上报"}],countsizeOption:[{label:"10",val:"10"},{label:"20",val:"20"},{label:"30",val:"30"}]}},computed:Object(o["a"])(Object(o["a"])({},Object(u["mapGetters"])({sizeForm:"konva/sizeForm"})),{},{showNewItem:function(){return!(!this.sizeForm||"modbus"!=this.sizeForm.protocol)}}),watch:{},mounted:function(){},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},activated:function(){},methods:Object(o["a"])(Object(o["a"])({changeGroup:function(e){},fileInfo:function(e){this.sizeForm.ico=e.path},uploadCkick:function(e){this.upNodeType=e,this.$refs["uploadFinish"].$refs.uploader.dispatchEvent(new MouseEvent("click")),this.inputParams={file:"",scene:"app",path:"devicething/ico/",filename:""}},files:function(e,t){this.inputParams.filename="".concat(this.$route.query.id,".").concat(this.sizeForm.identifier?this.sizeForm.identifier:moment().format("x"),".").concat(t),this.inputParams.file=e}},Object(u["mapMutations"])({setSizeForm:"konva/setSizeForm"})),{},{changeThing:function(e){var t=this,a={};if(-1!=["float","double","int","long"].indexOf(e.dataType.type))a={name:e.name,devicetype:e.devicetype,ico:e.ico,type:e.dataType.type,endnumber:t.$objGet(e,"dataType.specs.max"),startnumber:t.$objGet(e,"dataType.specs.min"),step:t.$objGet(e,"dataType.specs.step"),unit:t.$objGet(e,"dataType.specs.unit"),precision:this.$objGet(e,"dataType.specs.precision"),round:t.$objGet(e,"dataForm.round"),dinumber:t.$objGet(e,"dataForm.data"),rate:t.$objGet(e,"dataForm.rate"),offset:t.$objGet(e,"dataForm.offset"),order:t.$objGet(e,"dataForm.order"),protocol:t.$objGet(e,"dataForm.protocol"),operatetype:t.$objGet(e,"dataForm.operatetype"),originaltype:t.$objGet(e,"dataForm.originaltype"),slaveid:t.$objGet(e,"dataForm.slaveid"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),collection:"",control:"",strategy:"",required:!0,isread:e.accessMode,isshow:e.isshow,identifier:e.identifier},e.dataForm&&(a.collection=e.dataForm.collection,a.control=e.dataForm.control,a.strategy=e.dataForm.strategy);else if("image"==e.dataType.type)a={name:e.name,devicetype:e.devicetype,ico:e.ico,type:e.dataType.type,imagevalue:e.dataType.imagevalue,true:e.dataType.specs[1],false:e.dataType.specs[0],startnumber:t.$objGet(e,"dataType.specs.min"),step:t.$objGet(e,"dataType.specs.step"),unit:t.$objGet(e,"dataType.specs.unit"),round:t.$objGet(e,"dataForm.round"),dinumber:t.$objGet(e,"dataForm.data"),rate:t.$objGet(e,"dataForm.rate"),offset:t.$objGet(e,"dataForm.offset"),order:t.$objGet(e,"dataForm.order"),protocol:t.$objGet(e,"dataForm.protocol"),operatetype:t.$objGet(e,"dataForm.operatetype"),originaltype:t.$objGet(e,"dataForm.originaltype"),slaveid:t.$objGet(e,"dataForm.slaveid"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!1,isread:e.accessMode,isshow:e.isshow,identifier:e.identifier,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy};else if("bool"==e.dataType.type)a={name:e.name,devicetype:e.devicetype,ico:e.ico,type:e.dataType.type,true:e.dataType.specs[1],false:e.dataType.specs[0],startnumber:t.$objGet(e,"dataType.specs.min"),step:t.$objGet(e,"dataType.specs.step"),unit:t.$objGet(e,"dataType.specs.unit"),round:t.$objGet(e,"dataForm.round"),dinumber:t.$objGet(e,"dataForm.data"),rate:t.$objGet(e,"dataForm.rate"),offset:t.$objGet(e,"dataForm.offset"),order:t.$objGet(e,"dataForm.order"),protocol:t.$objGet(e,"dataForm.protocol"),operatetype:t.$objGet(e,"dataForm.operatetype"),originaltype:t.$objGet(e,"dataForm.originaltype"),slaveid:t.$objGet(e,"dataForm.slaveid"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!1,isread:e.accessMode,isshow:e.isshow,identifier:e.identifier,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy};else if("enum"==e.dataType.type){var r=[];for(var i in e.dataType.specs)r.push({attribute:i,attributevalue:e.dataType.specs[i]});a={name:e.name,devicetype:e.devicetype,ico:e.ico,type:e.dataType.type,specs:e.dataType.specs,struct:r,startnumber:t.$objGet(e,"dataType.specs.min"),step:t.$objGet(e,"dataType.specs.step"),unit:t.$objGet(e,"dataType.specs.unit"),round:t.$objGet(e,"dataForm.round"),dinumber:t.$objGet(e,"dataForm.data"),rate:t.$objGet(e,"dataForm.rate"),offset:t.$objGet(e,"dataForm.offset"),order:t.$objGet(e,"dataForm.order"),protocol:t.$objGet(e,"dataForm.protocol"),operatetype:t.$objGet(e,"dataForm.operatetype"),originaltype:t.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,isread:e.accessMode,isshow:e.isshow,identifier:e.identifier,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy}}else"struct"==e.dataType.type?a={name:e.name,devicetype:e.devicetype,ico:e.ico,type:e.dataType.type,struct:e.dataType.specs,startnumber:t.$objGet(e,"dataType.specs.min"),step:t.$objGet(e,"dataType.specs.step"),unit:t.$objGet(e,"dataType.specs.unit"),round:t.$objGet(e,"dataForm.round"),dinumber:t.$objGet(e,"dataForm.data"),rate:t.$objGet(e,"dataForm.rate"),offset:t.$objGet(e,"dataForm.offset"),order:t.$objGet(e,"dataForm.order"),protocol:t.$objGet(e,"dataForm.protocol"),operatetype:t.$objGet(e,"dataForm.operatetype"),originaltype:t.$objGet(e,"dataForm.originaltype"),slaveid:t.$objGet(e,"dataForm.slaveid"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,isread:e.accessMode,isshow:e.isshow,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,identifier:void 0==e.dataForm?"":e.identifier,strategy:void 0==e.dataForm?"":e.dataForm.strategy}:"text"==e.dataType.type?a={name:e.name,devicetype:e.devicetype,ico:e.ico,type:e.dataType.type,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,string:e.dataType.size,startnumber:this.$objGet(e,"dataType.specs.min"),step:t.$objGet(e,"dataType.specs.step"),unit:t.$objGet(e,"dataType.specs.unit"),round:t.$objGet(e,"dataForm.round"),dinumber:t.$objGet(e,"dataForm.data"),rate:t.$objGet(e,"dataForm.rate"),offset:t.$objGet(e,"dataForm.offset"),order:t.$objGet(e,"dataForm.order"),protocol:t.$objGet(e,"dataForm.protocol"),operatetype:t.$objGet(e,"dataForm.operatetype"),originaltype:t.$objGet(e,"dataForm.originaltype"),slaveid:t.$objGet(e,"dataForm.slaveid"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,isread:e.accessMode,isshow:e.isshow,identifier:e.identifier,strategy:void 0==e.dataForm?"":e.dataForm.strategy}:"date"==e.dataType.type||"file"==e.dataType.type||"url"==e.dataType.type?a={name:e.name,devicetype:e.devicetype,ico:e.ico,type:e.dataType.type,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,startnumber:t.$objGet(e,"dataType.specs.min"),step:t.$objGet(e,"dataType.specs.step"),unit:t.$objGet(e,"dataType.specs.unit"),round:t.$objGet(e,"dataForm.round"),dinumber:t.$objGet(e,"dataForm.data"),rate:t.$objGet(e,"dataForm.rate"),offset:t.$objGet(e,"dataForm.offset"),order:t.$objGet(e,"dataForm.order"),protocol:t.$objGet(e,"dataForm.protocol"),operatetype:t.$objGet(e,"dataForm.operatetype"),originaltype:t.$objGet(e,"dataForm.originaltype"),slaveid:t.$objGet(e,"dataForm.slaveid"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,isread:e.accessMode,isshow:e.isshow,identifier:e.identifier}:"geopoint"==e.dataType.type&&(a={name:e.name,devicetype:e.devicetype,ico:e.ico,type:e.dataType.type,gpstype:e.dataType.gpstype,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,startnumber:t.$objGet(e,"dataType.specs.min"),step:t.$objGet(e,"dataType.specs.step"),unit:t.$objGet(e,"dataType.specs.unit"),round:t.$objGet(e,"dataForm.round"),dinumber:t.$objGet(e,"dataForm.data"),rate:t.$objGet(e,"dataForm.rate"),offset:t.$objGet(e,"dataForm.offset"),order:t.$objGet(e,"dataForm.order"),protocol:t.$objGet(e,"dataForm.protocol"),operatetype:t.$objGet(e,"dataForm.operatetype"),originaltype:t.$objGet(e,"dataForm.originaltype"),slaveid:t.$objGet(e,"dataForm.slaveid"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,isread:e.accessMode,isshow:e.isshow,identifier:e.identifier});a.nobound=this.sizeForm.nobound,a.dis=e.dataForm.address,a.isdis=this.sizeForm.isdis,t.setSizeForm(a)},wmxCurrentChange:function(e){this.wmxstart=e},wmxSizeChange:function(e){this.wmxstart=1,this.wmxPageSize=e},getAllunit:function(){var e=this;return Object(l["a"])(s.a.mark((function t(){var a,r;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.allunit=[],t.next=3,Object(d["getAllunit"])("unit",200);case 3:a=t.sent,r=a.results,e.allunit=r.concat([]),e.allunit.unshift({data:{Name:"无",Symbol:""}});case 7:case"end":return t.stop()}}),t)})))()},removeDomain:function(e){this.$emit("removeDomain",e)},addDomain:function(){this.$emit("addDomain")},wmxhandleClose:function(){this.$emit("wmxhandleClose")},changeValue:function(e){this.$refs[e].validateField("startnumber",(function(e){if(e)return!1}))},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.$emit("submitForm",t.sizeForm)}))}})},m=p,f=a("bdd7"),b=Object(f["a"])(m,r,i,!1,null,null,null);t["default"]=b.exports},bd11:function(e,t,a){e.exports={"menu-color":"rgba(255,255,255,.95)","menu-color-active":"rgba(255,255,255,.95)","menu-background":"#282c34","column-second-menu-background":"#fff"}},c2d2:function(e,t,a){},c83a:function(e,t,a){"use strict";a("ad37")},cb6c:function(e,t,a){"use strict";a("5a4c")},cd14:function(e,t,a){"use strict";a("39b8")},d815:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"ProfileDict"},[e.dictVisible?a("a-drawer",{staticStyle:{"z-index":"999"},attrs:{"append-to-body":!0,"close-on-click-modal":!1,title:e.titleTempDialog,visible:e.dictVisible,width:"60%"},on:{close:function(t){e.$parent.dictVisible=!e.dictVisible}}},[a("el-form",{ref:"dictTempForm",attrs:{model:e.dictTempForm,rules:e.rules,size:"mini"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"字典模板名称","label-width":e.formLabelWidth,prop:"name"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.dictTempForm.name,callback:function(t){e.$set(e.dictTempForm,"name",t)},expression:"dictTempForm.name"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"字典模板类型","label-width":e.formLabelWidth,prop:"cType"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.dictTempForm.cType,callback:function(t){e.$set(e.dictTempForm,"cType",t)},expression:"dictTempForm.cType"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"字典模板状态","label-width":e.formLabelWidth,prop:"enable"}},[a("el-radio",{attrs:{border:"",label:"1"},model:{value:e.dictTempForm.enable,callback:function(t){e.$set(e.dictTempForm,"enable",t)},expression:"dictTempForm.enable"}},[e._v(" 启用 ")]),a("el-radio",{attrs:{border:"",label:"0"},model:{value:e.dictTempForm.enable,callback:function(t){e.$set(e.dictTempForm,"enable",t)},expression:"dictTempForm.enable"}},[e._v(" 禁用 ")])],1)],1)],1),a("el-form-item",{attrs:{label:"字典模板数据","label-width":e.formLabelWidth}},[a("el-tabs",{model:{value:e.elactiveName,callback:function(t){e.elactiveName=t},expression:"elactiveName"}},[a("el-tab-pane",{attrs:{label:"Table",name:"Table"}},[a("el-button",{staticClass:"mt-3",attrs:{icon:"el-icon-plus",size:"small",type:"primary"},nativeOn:{click:function(t){return e.$parent.addRow(e.dictTempForm.params)}}},[e._v(" 新 增 ")]),a("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{data:e.dictTempForm.params,height:"300"}},[a("el-table-column",{attrs:{label:"序号",prop:"order"}}),a("el-table-column",{attrs:{label:"标识符",prop:"identifier"}}),a("el-table-column",{attrs:{label:"功能名称",prop:"name"}}),a("el-table-column",{attrs:{label:"数据类型",prop:"type"}}),a("el-table-column",{attrs:{label:"数据地址",prop:"address"}}),a("el-table-column",{attrs:{label:"数据长度",prop:"bytes"}}),a("el-table-column",{attrs:{label:"是否必填",prop:"required"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[r.required?a("span",[e._v("是")]):a("span",[e._v("否")])]}}],null,!1,2053984958)}),a("el-table-column",{attrs:{align:"center",label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{plain:"",size:"mini",title:"删除",type:"danger"},nativeOn:{click:function(t){return e.$parent.delRow(e.scope.$index,e.dictTempForm.params)}}},[e._v(" 删除 ")]),a("el-button",{attrs:{plain:"",size:"mini",title:"编辑",type:"info"},nativeOn:{click:function(t){return e.$parent.editRow(r.scope.$index,e.dictTempForm.params)}}},[e._v(" 编辑 ")])]}}],null,!1,340347090)})],1)],1),a("el-tab-pane",{attrs:{label:"Json",name:"Json"}},[a("vab-json-editor",{attrs:{lang:"zh",mode:"code"},on:{"has-error":e.$parent.onError},model:{value:e.dictTempForm.params,callback:function(t){e.$set(e.dictTempForm,"params",t)},expression:"dictTempForm.params"}})],1)],1)],1),a("el-form-item",{attrs:{label:"描述","label-width":e.formLabelWidth}},[a("el-input",{attrs:{autosize:{minRows:2,maxRows:4},placeholder:"请输入描述",type:"textarea"},model:{value:e.dictTempForm.description,callback:function(t){e.$set(e.dictTempForm,"description",t)},expression:"dictTempForm.description"}})],1),a("el-form-item",{staticStyle:{"text-align":"center"},attrs:{size:"mini"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$parent.onJsonSave("dictTempForm",e.dictTempForm)}}},[e._v(" 提交 ")]),a("el-button",{on:{click:function(t){e.$parent.dictVisible=!1}}},[e._v("取消")])],1)],1)],1):e._e(),a("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.$parent.closeDict,"close-on-click-modal":!1,title:e.titleDict,top:"5vh",visible:e.editFlag,width:"60%"},on:{"update:visible":function(t){e.editFlag=t},open:function(t){return e.$parent.opendialog("tempparams")}}},[a("el-form",{ref:"tempparams",attrs:{"label-position":"left","label-width":"100px",model:e.tempparams,size:"mini"}},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"序号",prop:"order"}},[a("el-input",{model:{value:e.tempparams.order,callback:function(t){e.$set(e.tempparams,"order",e._n(t))},expression:"tempparams.order"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.identifier"),prop:"identifier"}},[a("el-input",{model:{value:e.tempparams.identifier,callback:function(t){e.$set(e.tempparams,"identifier",t)},expression:"tempparams.identifier"}})],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.functionname"),prop:"name"}},[a("el-input",{model:{value:e.tempparams.name,callback:function(t){e.$set(e.tempparams,"name",t)},expression:"tempparams.name"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.datatype"),prop:"type"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:e.$parent.tempTypeChange},model:{value:e.tempparams.type,callback:function(t){e.$set(e.tempparams,"type",t)},expression:"tempparams.type"}},[a("el-option",{attrs:{label:e.$translateTitle("product.init"),value:"int"}}),a("el-option",{attrs:{label:e.$translateTitle("product.float"),value:"float"}}),a("el-option",{attrs:{label:e.$translateTitle("product.double"),value:"double"}}),a("el-option",{attrs:{label:e.$translateTitle("product.bool"),value:"bool"}}),a("el-option",{attrs:{label:e.$translateTitle("product.enum"),value:"enum"}}),a("el-option",{attrs:{label:e.$translateTitle("product.string"),value:"string"}}),a("el-option",{attrs:{label:"switch",value:"switch"}})],1)],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.unit")}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:e.$translateTitle("product.unit")},model:{value:e.tempparams.unit,callback:function(t){e.$set(e.tempparams,"unit",t)},expression:"tempparams.unit"}},e._l(e.allunit,(function(e,t){return a("el-option",{key:t,attrs:{label:e.data.Name+"/"+e.data.Symbol,value:e.data.Symbol}})})),1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"协议类型"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.tempparams.protocol,callback:function(t){e.$set(e.tempparams,"protocol",t)},expression:"tempparams.protocol"}},e._l(["normal","modbus","mingcheng","xinchuangwei","hex"],(function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1)],1)],1),a("el-row",{directives:[{name:"show",rawName:"v-show",value:"modbus"==e.tempparams.protocol,expression:"tempparams.protocol == 'modbus'"}],attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据格式"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.tempparams.originaltype,callback:function(t){e.$set(e.tempparams,"originaltype",t)},expression:"tempparams.originaltype"}},e._l([{value:"bit",label:"位"},{value:"short16_AB",label:"16位 有符号(AB)"},{value:"short16_BA",label:"16位 有符号(BA)"},{value:"ushort16_AB",label:"16位 无符号(AB)"},{value:"ushort16_BA",label:"16位 无符号(BA)"},{value:"long32_ABCD",label:"32位 有符号(ABCD)"},{value:"long32_CDAB",label:"32位 有符号(CDAB)"},{value:"ulong32_ABCD",label:"32位 无符号(ABCD)"},{value:"ulong32_CDAB",label:"32位 无符号(CDAB)"},{value:"float32_ABCD",label:"32位 浮点数(ABCD)"},{value:"float32_CDAB",label:"32位 浮点数(CDAB)"}],(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),a("el-table",{directives:[{name:"show",rawName:"v-show",value:"modbus"==e.tempparams.protocol,expression:"tempparams.protocol == 'modbus'"}],staticStyle:{width:"100%"},attrs:{border:"",data:e.dataList,size:"small"}},[a("el-table-column",{attrs:{align:"center",label:"从机地址(16进制加0X,例:0X10,否则是十进制)","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{model:{value:e.tempparams.slaveid,callback:function(t){e.$set(e.tempparams,"slaveid",t)},expression:"tempparams.slaveid"}}),a("span",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[e._v(e._s(r))])]}}])}),a("el-table-column",{attrs:{align:"center",label:"寄存器状态","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.tempparams.operatetype,callback:function(t){e.$set(e.tempparams,"operatetype",t)},expression:"tempparams.operatetype"}},e._l([{value:"readCoils",label:"0X01:读线圈寄存器"},{value:"readInputs",label:"0X02:读离散输入寄存器"},{value:"readHregs",label:"0X03:读保持寄存器"},{value:"readIregs",label:"0X04:读输入寄存器"},{value:"writeCoil",label:"0X05:写单个线圈寄存器"},{value:"writeHreg",label:"0X06:写单个保持寄存器"},{value:"writeCoils",label:"0X0f:写多个线圈寄存器"},{value:"writeHregs",label:"0X10:写多个保持寄存器"}],(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),a("span",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[e._v(e._s(r.slaveid))])]}}])}),a("el-table-column",{attrs:{align:"center",label:"数据地址(16进制加0X,例:0X10,否则是十进制)","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{model:{value:e.tempparams.address,callback:function(t){e.$set(e.tempparams,"address",t)},expression:"tempparams.address"}}),a("span",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[e._v(e._s(r.slaveid))])]}}])}),a("el-table-column",{attrs:{align:"center",label:"数据长度(字节)","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{model:{value:e.tempparams.bytes,callback:function(t){e.$set(e.tempparams,"bytes",t)},expression:"tempparams.bytes"}}),a("span",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[e._v(e._s(r.slaveid))])]}}])})],1),a("el-row",{directives:[{name:"show",rawName:"v-show",value:"modbus"!=e.tempparams.protocol,expression:"tempparams.protocol != 'modbus'"}],attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据地址"}},[a("el-input",{attrs:{placeholder:"数据地址"},model:{value:e.tempparams.address,callback:function(t){e.$set(e.tempparams,"address",t)},expression:"tempparams.address"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据长度"}},[a("el-input",{attrs:{placeholder:"数据长度（字节）"},model:{value:e.tempparams.bytes,callback:function(t){e.$set(e.tempparams,"bytes",e._n(t))},expression:"tempparams.bytes"}})],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-tooltip",{staticStyle:{float:"left"},attrs:{effect:"dark",placement:"right-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v(" 1. 采集值 设备上行数据经采集公式计算后显示 。 "),a("br"),e._v(" 公式中的%s为占位符，是固定字段。 "),a("br"),e._v(" 如： "),a("br"),e._v(" 加：%s+10 "),a("br"),e._v(" 减：%s-10 "),a("br"),e._v(" 乘：%s*10 "),a("br"),e._v(" 除：%s/10 "),a("br"),e._v(" 余数：%s%10 "),a("br")]),a("i",{staticClass:"el-icon-question"})]),a("el-form-item",{attrs:{label:"采集公式"}},[a("el-input",{staticStyle:{width:"100%"},attrs:{rows:1,type:"textarea"},model:{value:e.tempparams.collection,callback:function(t){e.$set(e.tempparams,"collection",t)},expression:"tempparams.collection"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-tooltip",{staticStyle:{float:"left"},attrs:{effect:"dark",placement:"right-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v(" 1. 设置值 平台下行数据经设置公式计算后设置 。 "),a("br"),e._v(" 公式中的%s为占位符，是固定字段。 "),a("br"),e._v(" 如： "),a("br"),e._v(" 加：%s+10 "),a("br"),e._v(" 减：%s-10 "),a("br"),e._v(" 乘：%s*10 "),a("br"),e._v(" 除：%s/10 "),a("br"),e._v(" 余数：%s%10 "),a("br")]),a("i",{staticClass:"el-icon-question"})]),a("el-form-item",{attrs:{label:"设置公式"}},[a("el-input",{attrs:{rows:1,type:"textarea"},model:{value:e.tempparams.setting,callback:function(t){e.$set(e.tempparams,"setting",t)},expression:"tempparams.setting"}})],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"必填"}},[a("el-radio",{attrs:{border:"",label:!0},model:{value:e.tempparams.required,callback:function(t){e.$set(e.tempparams,"required",t)},expression:"tempparams.required"}},[e._v(" 是 ")]),a("el-radio",{attrs:{border:"",label:!1},model:{value:e.tempparams.required,callback:function(t){e.$set(e.tempparams,"required",t)},expression:"tempparams.required"}},[e._v(" 否 ")])],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"只读"}},[a("el-radio",{attrs:{border:"",label:!0},model:{value:e.tempparams.readonly,callback:function(t){e.$set(e.tempparams,"readonly",t)},expression:"tempparams.readonly"}},[e._v(" 是 ")]),a("el-radio",{attrs:{border:"",label:!1},model:{value:e.tempparams.readonly,callback:function(t){e.$set(e.tempparams,"readonly",t)},expression:"tempparams.readonly"}},[e._v(" 否 ")])],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"列表显示"}},[a("el-radio",{attrs:{border:"",label:!0},model:{value:e.tempparams.isshow,callback:function(t){e.$set(e.tempparams,"isshow",t)},expression:"tempparams.isshow"}},[e._v(" 是 ")]),a("el-radio",{attrs:{border:"",label:!1},model:{value:e.tempparams.isshow,callback:function(t){e.$set(e.tempparams,"isshow",t)},expression:"tempparams.isshow"}},[e._v(" 否 ")])],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},["switch"==e.tempparams.type?a("el-form-item",{attrs:{label:"开"}},[a("el-input",{model:{value:e.tempparams.activevalue,callback:function(t){e.$set(e.tempparams,"activevalue",t)},expression:"tempparams.activevalue"}})],1):e._e()],1),a("el-col",{attrs:{span:12}},["switch"==e.tempparams.type?a("el-form-item",{attrs:{label:"关"}},[a("el-input",{model:{value:e.tempparams.inactivevalue,callback:function(t){e.$set(e.tempparams,"inactivevalue",t)},expression:"tempparams.inactivevalue"}})],1):e._e()],1)],1),"enum"!=e.tempparams.type&&"switch"!=e.tempparams.type?a("el-form-item",{attrs:{label:"默认值",prop:"default"}},["bool"==e.tempparams.type?a("el-select",{staticClass:"notauto",attrs:{readonly:""},model:{value:e.tempparams.default,callback:function(t){e.$set(e.tempparams,"default",t)},expression:"tempparams.default"}},[a("el-option",{attrs:{label:"是",value:!0}}),a("el-option",{attrs:{label:"否",value:!1}})],1):"int"==e.tempparams.type?a("el-input",{model:{value:e.tempparams.default,callback:function(t){e.$set(e.tempparams,"default",e._n(t))},expression:"tempparams.default"}}):a("el-input",{model:{value:e.tempparams.default,callback:function(t){e.$set(e.tempparams,"default",t)},expression:"tempparams.default"}})],1):e._e(),"enum"==e.tempparams.type?a("el-form-item",{attrs:{label:"Enum数据"}},[a("el-tabs",{model:{value:e.elactiveName1,callback:function(t){e.elactiveName1=t},expression:"elactiveName1"}},[a("el-tab-pane",{attrs:{label:"Table",name:"Table1"}},[a("el-button",{staticClass:"mt-3",attrs:{icon:"el-icon-plus",size:"mini",type:"primary"},nativeOn:{click:function(t){return e.$parent.addDomain.apply(null,arguments)}}},[e._v(" 新 增 ")]),a("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{data:e.tempparams.specs}},[a("el-table-column",{attrs:{align:"center",label:"属性"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{model:{value:r.attribute,callback:function(t){e.$set(r,"attribute",t)},expression:"row.attribute"}})]}}],null,!1,145805847)}),a("el-table-column",{attrs:{align:"center",label:"属性值"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{model:{value:r.attributevalue,callback:function(t){e.$set(r,"attributevalue",t)},expression:"row.attributevalue"}})]}}],null,!1,2139517436)}),a("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{plain:"",size:"mini",title:"删除",type:"danger"},nativeOn:{click:function(t){return e.$parent.removeDomain(r)}}},[e._v(" 删除 ")])]}}],null,!1,3615450766)})],1)],1)],1)],1):e._e(),a("el-form-item",[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.$parent.submitFormTempDict()}}},[e._v(" 提交 ")])],1)],1)],1)],1)},i=[],l={name:"ProfileDict",props:{titleDict:{required:!1,type:String,default:""},formLabelWidth:{required:!1,type:String,default:"120px"},rules:{required:!1,type:Object,default:function(){}},editFlag:{required:!1,type:Boolean,default:!1},dictVisible:{required:!1,type:Boolean,default:!1},titleTempDialog:{required:!1,type:String,default:""},parserTables:{required:!1,type:Array,default:function(){return[]}},tempparam:{required:!1,type:Object,default:function(){}},allunit:{required:!1,type:Array,default:function(){return[]}},dataList:{required:!1,type:Array,default:function(){return[{}]}}},data:function(){return{elactiveName:"Table",elactiveName1:"Table1",tempparams:{}}},created:function(){this.tempparams=this.tempparam},mounted:function(){},methods:{addParse:function(e){this.$parent.addParse(e)}}},o=l,n=a("bdd7"),s=Object(n["a"])(o,r,i,!1,null,null,null);t["default"]=s.exports},d8f1:function(e,t,a){},df9c:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"parserTable",attrs:{"append-to-body":!0,direction:"rtl",visible:e.parserTable,width:"60%"},on:{"update:visible":function(t){e.parserTable=t},close:function(t){e.$parent.parserTable=!e.parserTable}}},[a("div",{staticClass:"header-title",attrs:{slot:"title"},slot:"title"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return t.preventDefault(),e.addParse(e.parserTables)}}},[e._v(" "+e._s(e.$translateTitle("product.newlyadded"))+" ")]),a("el-button",{attrs:{type:"success"},nativeOn:{click:function(t){return t.preventDefault(),e.saveParse(e.parserTables)}}},[e._v(" "+e._s(e.$translateTitle("product.preservation"))+" ")])],1),a("el-table",{attrs:{data:e.parserTables,size:"mini"}},[a("el-table-column",{attrs:{align:"center",label:"uid",prop:"uid","show-overflow-tooltip":"",sortable:"",width:"100"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("product.chinesetitle"),prop:"name","show-overflow-tooltip":"",sortable:"",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-popover",{attrs:{placement:"top",trigger:"hover"}},[a("p",[e._v(" "+e._s(e.$translateTitle("product.englishtitle"))+": "+e._s(r.enname)+" ")]),a("p",[e._v(" "+e._s(e.$translateTitle("developer.describe"))+": "+e._s(r.description)+" ")]),a("p",[e._v(" "+e._s(e.$translateTitle("product.identifier"))+": "+e._s(r.identifier)+" ")]),a("p",[e._v(" "+e._s(e.$translateTitle("developer.describe"))+": "+e._s(r.description)+" ")]),a("p",[e._v(" "+e._s(e.$translateTitle("product.Table Name"))+": "+e._s(r.table)+" ")]),a("p",[e._v(" "+e._s(e.$translateTitle("product.class"))+": "+e._s(r.field)+" ")]),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("el-tag",{attrs:{size:"medium"}},[e._v(" "+e._s(r.name)+" ")])],1)])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("product.functionaltypes"),prop:"type","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("product.visible"),prop:"visible",sortable:"",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-switch",{attrs:{disabled:""},model:{value:r.visible,callback:function(t){e.$set(r,"visible",t)},expression:"row.visible"}})]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("developer.operation"),width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.editParse(r.$index,r)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.edit"))+" ")]),a("el-button",{attrs:{disabled:!r.config.order,type:"text"},on:{click:function(t){return e.previewParse(r.config)}}},[e._v(" "+e._s(e.$translateTitle("application.preview"))+" ")]),a("el-button",{attrs:{size:"small",type:"text"},nativeOn:{click:function(t){return t.preventDefault(),e.lockingParse(r.uid,e.scope.$index,e.parserTables)}}},[e._v(" "+e._s(e.$translateTitle("application.locking"))+" ")]),a("el-button",{attrs:{disabled:r.disable,size:"small",type:"text"},nativeOn:{click:function(t){return t.preventDefault(),e.deleteParse(r.uid,e.scope.$index,e.parserTables)}}},[e._v(" "+e._s(e.$translateTitle("task.Delete"))+" ")])]}}])})],1)],1)},i=[],l={name:"ProfileDrawer",props:{parserTable:{required:!0,type:Boolean,default:!1},parserTables:{required:!1,type:Array,default:function(){return[]}}},data:function(){return{}},created:function(){},mounted:function(){},methods:{addParse:function(e){this.$parent.addParse(e)},saveParse:function(e){this.$parent.saveParse(e)},editParse:function(e,t){this.$parent.editParse(e,t)},previewParse:function(e){this.$parent.previewParse(e)},lockingParse:function(e,t,a){this.$parent.lockingParse(e,t,a)},deleteParse:function(e,t,a){this.$parent.deleteParse(e,t,a)}}},o=l,n=a("bdd7"),s=Object(n["a"])(o,r,i,!1,null,null,null);t["default"]=s.exports},dfab:function(e,t,a){},e094:function(e,t,a){},e442:function(e,t,a){},e46b:function(e,t,a){"use strict";a("31fb")},edb3:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"devproduct"},[a("h3",[e._v(" "+e._s(e.$translateTitle("route.产品管理"))+" "),e.projectName?a("span",[e._v(e._s("(所属应用:"+e.projectName+")"))]):e._e()]),a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("product.myproduct")+"("+e.total+")",name:"first"}},[a("div",{staticClass:"prosecond"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline,size:"small"}},[a("el-form-item",[a("el-input",{attrs:{placeholder:e.$translateTitle("product.searchproductname")},model:{value:e.formInline.productname,callback:function(t){e.$set(e.formInline,"productname",t)},expression:"formInline.productname"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.searchProduct(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1),a("el-form-item",{staticStyle:{float:"right","text-align":"right"}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:""!=e.projectid,expression:"projectid != ''"}],attrs:{type:"primary"},on:{click:e.addproduct}},[e._v(" "+e._s(e.$translateTitle("product.createproduct"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.goTopoview.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("product.topoview"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.exportpro.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("product.exportpro"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){e.importDialogShow=!0}}},[e._v(" "+e._s(e.$translateTitle("product.importpro"))+" ")])],1)],1),a("div",{staticClass:"protable"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.proTableData}},[a("el-table-column",{attrs:{label:"ProductID",prop:"objectId"}}),a("el-table-column",{attrs:{label:e.$translateTitle("product.productname")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(r.name))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.productgrouping")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(r.devType))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.nodetype")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[0==r.nodeType?a("span",[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]):a("span",[e._v(e._s(e.$translateTitle("product.gateway")))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.classification")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(r.CategoryKey))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.addingtime")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(e.utc2beijing(r.createdAt)))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.operation"),width:"320"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-link",{attrs:{icon:"el-icon-view",type:"primary",underline:!1},on:{click:function(t){return e.deviceToDetail(r)}}},[e._v(" "+e._s(e.$translateTitle("product.config"))+" ")]),a("el-popover",{ref:"popover-"+e.scope.$index,attrs:{placement:"top",width:"300"}},[a("p",[e._v(" "+e._s(e.$translateTitle("product.qdsczg"))+e._s(r.name)+e._s(e.$translateTitle("equipment.cpm"))+" ")]),a("div",{staticStyle:{margin:"0","text-align":"right"}},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.scope._self.$refs["popover-"+e.scope.$index].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.makeSure(e.scope)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),a("el-link",{attrs:{slot:"reference",icon:"el-icon-delete",type:"danger",underline:!1},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1),a("el-link",{attrs:{icon:"el-icon-attract",type:"primary",underline:!1},on:{click:function(t){return e.GoTodevices(r)}}},[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]),a("el-link",{attrs:{icon:"el-icon-edit",type:"success",underline:!1},on:{click:function(t){return e.editorProduct(r)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.edit"))+" ")]),a("el-link",{attrs:{icon:"el-icon-s-promotion",type:"primary",underline:!1},on:{click:function(t){return e.proudctView(r)}}},[e._v(" "+e._s(e.$translateTitle("product.monitorconfiguration"))+" ")])]}}])})],1)],1),a("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[a("el-pagination",{attrs:{layout:"total, sizes, prev, pager, next, jumper","page-size":e.length,"page-sizes":[10,20,30,50],total:e.total},on:{"current-change":e.productCurrentChange,"size-change":e.productSizeChange}})],1)],1)])],1),a("div",{staticClass:"prodialog"},[a("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleClose,"close-on-click-modal":!1,title:e.$translateTitle("product.createproduct"),top:"5vh",visible:e.dialogFormVisible,width:"40%"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("div",{staticClass:"content"},[a("div",{staticClass:"contentone"},[a("div",{staticStyle:{display:"flex"}},[a("span",[e._v(e._s(e.$translateTitle("product.productinformation")))]),a("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"name"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.productgrouping"),prop:"devType"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.devType,callback:function(t){e.$set(e.form,"devType",t)},expression:"form.devType"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.classification")}},[a("el-cascader",{attrs:{options:e.categoryListOptions},model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("application.applicationtype"),rules:[{required:!0,message:e.$translateTitle("product.pleaseselectyourapp"),trigger:"blur"}]}},[a("el-select",{attrs:{disabled:""},on:{change:e.selectApp},model:{value:e.form.relationApp,callback:function(t){e.$set(e.form,"relationApp",t)},expression:"form.relationApp"}},e._l(e.allApps,(function(e,t){return a("el-option",{key:t,attrs:{label:e.title,value:e.title}})})),1)],1)],1)],1),a("div",{staticClass:"contenttwo",staticStyle:{"margin-top":"20px"}},[a("div",{staticStyle:{display:"flex"}},[a("span",[e._v(e._s(e.$translateTitle("product.nodetype")))]),a("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.nodetype"),prop:"nodeType"}},[a("el-radio-group",{on:{change:e.changeNode},model:{value:e.form.nodeType,callback:function(t){e.$set(e.form,"nodeType",t)},expression:"form.nodeType"}},[a("el-radio",{attrs:{label:0}},[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]),a("el-radio",{attrs:{label:1}},[e._v(" "+e._s(e.$translateTitle("product.gateway"))+" ")])],1)],1)],1)],1),a("div",{staticClass:"contentthird",staticStyle:{"margin-top":"20px"}},[a("div",{staticStyle:{display:"flex"}},[a("span",[e._v(" "+e._s(e.$translateTitle("product.networkinganddescription"))+" ")]),a("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.networking")+"(共"+e.channel.length+"项)",prop:"netType"}},[a("el-select",{attrs:{placeholder:e.$translateTitle("product.selectgateway")},model:{value:e.form.netType,callback:function(t){e.$set(e.form,"netType",t)},expression:"form.netType"}},e._l(e.channel,(function(e,t){return a("el-option",{key:t,attrs:{label:t+1+":"+e.label,title:"当前第"+(t+1)+"项",value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.productmodel")}},[e.imageUrl?a("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):a("i",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"el-icon-plus avatar-uploader-icon"}),a("form",{ref:"uploadform",staticStyle:{position:"absolute"},attrs:{enctype:"multipart/form-data",method:"POST"}},[a("input",{staticStyle:{position:"relative",top:"-100px","z-index":"5",width:"100px",height:"100px",cursor:"pointer",opacity:"0"},attrs:{type:"file"},on:{change:function(t){return e.upload(t)}}})]),e.imageUrl?a("el-button",{staticStyle:{"vertical-align":"text-bottom"},attrs:{size:"mini",type:"danger"},on:{click:e.deleteImgsrc}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")]):e._e()],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.describe"),prop:"desc"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1)],1)],1)]),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)])],1),a("div",{staticClass:"import-dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("product.importpro"),visible:e.importDialogShow,width:"25%"},on:{"update:visible":function(t){e.importDialogShow=t}}},[a("el-form",{ref:"uploadProForm",attrs:{model:e.formPro}},[a("el-upload",{ref:"fileUpload",staticClass:"upload-demo",attrs:{accept:".xls, .xlsx, .zip",action:e.uploadAction,"auto-upload":!1,data:e.uploadData,"file-list":e.fileList,headers:e.uploadHeaders,"on-change":e.handleChange,"on-error":e.handleUploadError,"on-success":e.handleUploadSuccess,"with-credentials":!0}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v(" "+e._s(e.$translateTitle("application.selectfiles"))+" ")])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"btn-left",attrs:{size:"small",type:"primary"},on:{click:e.submitUpload}},[e._v(" "+e._s(e.$translateTitle("application.upload"))+" ")]),a("el-button",{staticClass:"btn-right",attrs:{size:"small"},on:{click:function(t){e.importDialogShow=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)],1)],1)],1)},i=[],l=a("fb07"),o=(a("04d6"),a("a0e0"),a("3dec"),a("16b8"),a("1d17"),a("4c87"),a("b463"),a("a44e"),a("4ccb"),a("3559"),a("d06e"),a("b340"),a("6924"),a("472c"),a("256c"),a("de71"),a("7876"),a("37a7"),a("d2d8"),a("e2e1"),a("2c1e"),a("26c7"),a("ee7e"),a("f05b"),a("6a4de"),a("11de"),a("172c"),a("0c75"),a("69a3"),a("d30f"),a("3b7f"),a("aadd"),a("98da"),a("c4bc"),a("d6a4"),a("f1e1"),a("d0d7")),n=a.n(o),s=a("e0e9"),c=a("58dd"),d=a("1285"),u=a("7212"),p=a("926a"),m=a("e455"),f=a("be65"),b=a.n(f),v=a("5da95"),h=a("f43e").Base64,g={data:function(){return{length:10,total:0,start:0,activeName:"first",formInline:{productname:""},uploadHeaders:{sessionToken:b.a.get("access_token")},uploadAction:"",uploadData:{},fileList:[],productIdentifier:"",proTableData:[],formLabelWidth:"80px",dialogFormVisible:!1,importDialogShow:!1,form:{name:"",category:[],nodeType:0,desc:"",netType:"",devType:"",productSecret:"",roles:[],relationApp:""},formPro:{name:"",url:""},rules:{roles:[{required:!0,message:"请选择所属应用",trigger:"blur"}],name:[{required:!0,message:"请输入产品",trigger:"blur"}],devType:[{required:!0,message:"请输入产品标识，用于区分不同设备",trigger:"blur"}],category:[{required:!0,message:"请选择所属分类",trigger:"change"}],nodeType:[{required:!0,message:"请选择节点类型",trigger:"change"}],netType:[{required:!0,message:"请选择联网方式",trigger:"change"}],relationApp:[{required:!0,message:"请选择产品可见角色",trigger:"change"}]},option:[],ruleoptions:[],channel:[{label:"蜂窝(2G/3G/4G)(直连)",value:"CELLULAR"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"BLE(低功耗蓝牙)",value:"Bluetooth"},{label:"5G通道(直连)",value:"5G"},{label:"WIFI通道(直连)",value:"WIFI"},{label:"ZigBee通道",value:"ZigBee"},{label:"Modbus",value:"Modbus"},{label:"LoRa(WAN)(直连)",value:"LoRaWAN"},{label:"OPC UA",value:" OPC UA"},{label:"ZETA通道",value:"ZETA"},{label:"网线连接(直连)",value:"网线连接"},{label:"自定义",value:"OTHER"}],imageUrl:"",productid:"",loading:!1,allApps:[],categoryList:[],categoryListOptions:[],fileServer:"",access_token:"",projectid:"",projectName:"",allTableDate:[]}},computed:{},mounted:function(){this.Industry(),this.searchProduct(0)},beforeDestroy:function(){this.projectName=""},methods:{changeNode:function(e,t){0!=t&&(this.form.netType=""),this.channel=0==e?[{label:"蜂窝(2G/3G/4G)",value:"CELLULAR"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"BLE(低功耗蓝牙)",value:"Bluetooth"},{label:"5G通道",value:"5G"},{label:"WIFI通道",value:"WIFI"},{label:"ZigBee通道",value:"ZigBee"},{label:"LoRa(WAN)",value:"LoRaWAN"},{label:"Modbus",value:"Modbus"},{label:"OPC UA",value:" OPC UA"},{label:"ZETA通道",value:"ZETA"},{label:"网线连接",value:"网线连接"},{label:"自定义",value:"OTHER"}]:[{label:"蜂窝(2G/3G/4G)",value:"CELLULAR"},{label:"5G通道",value:"5G"},{label:"WIFI通道",value:"WIFI"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"LoRaWAN",value:"LoRaWAN"},{label:"网线连接",value:"网线连接"},{label:"自定义",value:"OTHER"}]},getRoles:function(){return Object(l["a"])(n.a.mark((function e(){return n.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(c["app_count"])({where:{}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))()},selectApp:function(e){var t=this;e&&Object(v["getServer"])(e).then((function(e){e&&(t.fileServer=e.file,t.access_token=e.access_token)}))},treeData:function(e){var t=JSON.parse(JSON.stringify(e));return t.filter((function(e){var a=t.filter((function(t){return e.id==t.parentid}));return a.length>0&&(e.children=a),0==e.parentid}))},deleteImgsrc:function(){event.stopPropagation(),this.imageUrl=""},upload:function(e){if(this.loading=!0,e){var t=e.target.files[0],a=t.name,r=e.target.files[0].type,i=(t.type.split("/")[0],"image/jpeg"===r||"image/JPEG"===r||"image/png"===r||"image/PNG"===r||"image/bpm"===r||"image/BPM"===r);if(!i)return this.$message({message:"请上传图片",type:"error"}),!1;var l=new FileReader;l.readAsDataURL(t);var o=this;l.onloadend=function(){var e=l.result,t=o.dataURItoBlob(e);o.uploadFile(t,a)}}},dataURItoBlob:function(e){for(var t=atob(e.split(",")[1]),a=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),i=new Uint8Array(r),l=0;l<t.length;l++)i[l]=t.charCodeAt(l);return new Blob([r],{type:a})},uploadFile:function(e,t){var a=this,r=new FormData;r.append("file",e,t),r.append("output","json"),r.append("path",this.form.relationApp),r.append("auth_token",this.access_token);this.$http.post(this.fileServer,r).then((function(e){e&&(a.imageUrl=e.body.url,a.loading=!1)})).catch((function(e){a.loading=!1,a.$message(e.bodyText)}))},submitUpload:function(){var e=this;this.uploadAction="/product",this.$nextTick((function(){e.uploadData.appid=b.a.get("appids"),e.$refs.fileUpload.submit()}))},handleUploadSuccess:function(e,t,a){this.$message({type:"success",message:"产品导入成功"}),this.importDialogShow=!1,this.$refs["uploadProForm"].resetFields(),this.searchProduct()},handleUploadError:function(e,t,a){this.$message({showClose:!0,message:e})},handleChange:function(e,t){t.length>0&&(this.fileList=[t[t.length-1]])},utc2beijing:function(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},getDict:function(e,t){var a=this;return Object(l["a"])(n.a.mark((function r(){var i,l;return n.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,a.$query_object("Dict",{limit:1e3,where:{type:{$in:t}}});case 2:i=r.sent,l=i.results,a.allTableDate=l,e.map((function(e){l.map((function(t){e.category==t.type&&(e.CategoryKey=t.data.CategoryName)}))})),a.proTableData=e;case 7:case"end":return r.stop()}}),r)})))()},searchProduct:function(e){var t=this;return Object(l["a"])(n.a.mark((function a(){var r,i,l,o,s;return n.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return 0==e&&(t.start=0),r=[],i={order:"-updatedAt",skip:t.start,limit:t.length,count:1,where:{devType:{$ne:"report"}}},""!=t.formInline.productname&&(i.where.name=t.formInline.productname),a.next=6,Object(u["queryProduct"])(i);case 6:l=a.sent,o=l.results,s=l.count,o.map((function(e,t){""!=e.category&&e.category&&r.push(e.category)})),t.getDict(o,r),t.total=s,t.getRoles().then((function(e){t.allApps=e.results})).catch((function(e){Object(p["returnLogin"])(e)}));case 13:case"end":return a.stop()}}),a)})))()},handleClose:function(){this.dialogFormVisible=!1},addproduct:function(){this.dialogFormVisible=!0},getParent:function(e,t,a){var r=this;return t.map((function(i){e==i.id?(a.unshift(i.value),r.getParent(i.parentid,t,a)):0==i.parentid&&i.id==e&&a.unshift(i.value)})),this.form.category=a,a},getIndustryParent:function(e,t){var a=this;t.map((function(r){r.value==e&&a.getParent(r.id,t,[])}))},editorProduct:function(e){for(var t in this.form.relationApp="",this.dialogFormVisible=!0,this.productid=e.objectId,this.getIndustryParent(e.category,this.categoryList),this.form.desc=e.desc,this.form.name=e.name,this.form.nodeType=e.nodeType,this.form.netType=e.netType,this.form.devType=e.devType,this.form.productSecret=e.productSecret,this.changeNode(e.nodeType,0),e.icon&&(this.imageUrl=e.icon),e.ACL)this.form.relationApp=t?t.substr(5):"";this.selectApp(this.form.relationApp)},Industry:function(){var e=this;return Object(l["a"])(n.a.mark((function t(){var a,r,i;return n.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.categoryList=[],a={limit:1e3,where:{"data.key":"category"}},t.next=4,Object(s["queryDict"])(a);case 4:r=t.sent,i=r.results,i.map((function(t){var a={};a.value=t.type,a.label=t.data.CategoryName,a.id=t.data.Id,a.parentid=t.data.SuperId,e.categoryList.push(a)})),e.categoryListOptions=e.treeData(e.categoryList);case 8:case"end":return t.stop()}}),t)})))()},addProduct:function(){this.$message("新增产品")},editProduct:function(e){var t=this;return Object(l["a"])(n.a.mark((function a(){var r,i;return n.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r={productSecret:t.form.productSecret,nodeType:t.form.nodeType,netType:t.form.netType,dynamicReg:!1,category:t.form.category[t.form.category.length-1],icon:t.imageUrl,name:t.form.name,devType:t.form.devType,desc:t.form.desc,topics:[]},a.next=3,Object(u["putProduct"])(e,r);case 3:i=a.sent,i&&(t.$message({type:"success",message:"编辑成功"}),t.dialogFormVisible=!1,t.$refs["ruleForm"].resetFields(),t.searchProduct(),t.productid="");case 5:case"end":return a.stop()}}),a)})))()},submitForm:function(e){var t=this;this.$Cookies.get("userId");this.$refs[e].validate((function(e){if(!e)return!1;var a=Math.ceil(25*Math.random());h.encode(String.fromCharCode(65+a)+Math.ceil(1e7*Math.random())+Number(new Date));""==t.productid?t.addProduct():t.editProduct(t.productid)}))},resetProductForm:function(){this.form={name:"",category:[],nodeType:0,desc:"",netType:"",devType:"",productSecret:"",roles:[],relationApp:""},this.imageUrl=""},deviceToDetail:function(e){this.$router.push({path:"/roles/detailproduct",query:{id:e.objectId}})},GoTodevices:function(e){this.$router.push({path:"/roles/thing",query:{productid:e.objectId}})},makeSure:function(e){var t=this,a={count:"objectId",skip:0,limit:1,where:{product:row.objectId}};Object(d["queryDevice"])(a).then((function(a){a.count>0?t.$message("请先删除该产品下设备"):Object(u["getProduct"])(row.objectId).then((function(a){Object(u["delProduct"])(row.objectId).then((function(a){a&&(t.$message({type:"success",message:"删除成功"}),e._self.$refs["popover-".concat(e.$index)].doClose(),t.searchProduct())})).catch((function(e){}))})).catch((function(e){}))})).catch((function(e){}))},productSizeChange:function(e){this.length=e,this.searchProduct()},productCurrentChange:function(e){this.start=(e-1)*this.length,this.searchProduct()},proudctView:function(e){var t=window.location.origin+"/spa",a="production";t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var r="".concat(t,"/#/views/").concat(e.objectId);window.open(r,"__blank")},goTopoview:function(){var e=window.location.origin+"/spa",t="production";e="development"==t?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var a="".concat(e,"/#/view");window.open(a,"__blank")},exportpro:function(){this.allTableDate?Object(m["export_txt_to_zip"])(JSON.stringify(this.allTableDate),"Dict","Dict"):this.$message({type:"warning",message:"数据为空,无法导出"})}}},y=g,w=(a("cb6c"),a("30d9"),a("bdd7")),$=Object(w["a"])(y,r,i,!1,null,"8da19fb2",null);t["default"]=$.exports},f8df:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"devproduct devproduct-container"},[a("input",{ref:"uploader",staticStyle:{display:"none"},attrs:{accept:"zip",type:"file"},on:{change:function(t){return e.doUpload(t)}}}),a("el-dialog",{staticStyle:{margin:"0 auto"},attrs:{"append-to-body":!0,visible:e.dialogVisible,top:"1vh",width:"90%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("VabParser",{attrs:{dict:e.parserDict,"form-config":e.formConfig,parserindex:e.editIndex,productid:e.productid},on:{ParserSave:e.saveParse}})],1),a("el-dialog",{attrs:{"append-to-body":!0,visible:e.parserView},on:{"update:visible":function(t){e.parserView=t}}},[a("f-render",{attrs:{config:e.formConfig,pure:""},model:{value:e.formConfig,callback:function(t){e.formConfig=t},expression:"formConfig"}})],1),a("el-dialog",{staticClass:"parserTable",attrs:{"append-to-body":!0,visible:e.parserTable},on:{"update:visible":function(t){e.parserTable=t}}},[a("div",{staticClass:"header-title parserTable",attrs:{slot:"title"},slot:"title"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return t.preventDefault(),e.addParse(e.parserTableList)}}},[e._v(" "+e._s(e.$translateTitle("product.newlyadded"))+" ")]),a("el-button",{attrs:{type:"success"},nativeOn:{click:function(t){return t.preventDefault(),e.saveParse(e.parserTableList)}}},[e._v(" "+e._s(e.$translateTitle("product.preservation"))+" ")])],1),a("el-table",{attrs:{data:e.parserTableList.parser,height:e.height}},[a("el-table-column",{attrs:{label:e.$translateTitle("product.chinesetitle"),align:"center",prop:"name",sortable:""}}),a("el-table-column",{attrs:{label:e.$translateTitle("product.englishtitle"),align:"center",prop:"enname",sortable:""}}),a("el-table-column",{attrs:{label:e.$translateTitle("leftbar.settings"),align:"center","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{plain:"",type:"primary"},on:{click:function(t){return e.editParse(r.$index,r)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.edit"))+" ")]),a("el-button",{attrs:{plain:"",type:"success"},on:{click:function(t){return e.previewParse(r.config)}}},[e._v(" "+e._s(e.$translateTitle("application.preview"))+" ")]),a("el-button",{attrs:{plain:"",size:"small",type:"danger"},nativeOn:{click:function(t){return t.preventDefault(),e.deleteParse(r.$index,e.parserTableList.parser)}}},[e._v(" "+e._s(e.$translateTitle("task.Delete"))+" ")])]}}])})],1)],1),a("vab-input",{ref:"uploadFinish",attrs:{params:e.inputParams},on:{fileInfo:e.fileInfo,files:e.files}}),a("div",{staticClass:"prosecond"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline,size:"small"}},[a("el-form-item",[a("el-input",{attrs:{placeholder:e.$translateTitle("product.searchproductname"),clearable:""},model:{value:e.formInline.productname,callback:function(t){e.$set(e.formInline,"productname",t)},expression:"formInline.productname"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.searchProduct(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1),a("el-form-item",{staticStyle:{float:"right","text-align":"right"}},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addproduct.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("product.createproduct"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.exportpro.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("product.exportpro"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.handleImport()}}},[e._v(" "+e._s(e.$translateTitle("product.importpro"))+" ")])],1)],1),a("div",{staticClass:"protable"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{"cell-style":{"text-align":"center"},data:e.proTableData,"header-cell-style":{"text-align":"center"},height:e.height,border:"",size:"mini"}},[a("el-table-column",{attrs:{label:"ProductID",prop:"objectId","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{label:e.$translateTitle("product.productname")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(r.name))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.nodetype")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[3==r.nodeType?a("span",[e._v(" "+e._s(e.$translateTitle("product.direct"))+" ")]):e._e(),1==r.nodeType?a("span",[e._v(" "+e._s(e.$translateTitle("product.gateway"))+" ")]):0==r.nodeType?a("span",[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]):e._e()]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.addingtime")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(e.utc2beijing(r.createdAt)))])]}}])}),a("el-table-column",{ref:"rightCol",attrs:{label:e.$translateTitle("developer.operation"),fixed:"right",width:"360"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{underline:!1,size:"mini",type:"primary"},on:{click:function(t){return e.deviceToDetail(r)}}},[e._v(" "+e._s(e.$translateTitle("product.config"))+" ")]),a("el-button",{attrs:{underline:!1,size:"mini",type:"warning"},on:{click:function(t){return e.editorDict(r.objectId)}}},[e._v(" "+e._s(e.$translateTitle("product.dict"))+" ")]),a("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.goKonva(r.objectId)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.konva"))+" ")]),a("el-button",{attrs:{underline:!1,size:"mini",type:"success"},on:{click:function(t){return e.editorProduct(r)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.edit"))+" ")]),a("el-popover",{ref:"popover-"+r.$index,staticStyle:{"margin-left":"10px"},attrs:{placement:"top",width:"300"}},[a("p",[e._v("确定删除这个"+e._s(r.name)+"产品吗？")]),a("div",{staticStyle:{margin:"0","text-align":"right"}},[a("el-button",{attrs:{size:"mini"},on:{click:function(e){r._self.$refs["popover-"+r.$index].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.makeSure(r)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),a("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)]}}])})],1)],1),a("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[a("el-pagination",{attrs:{"page-size":e.length,"page-sizes":[10,20,30,50],total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"current-change":e.productCurrentChange,"size-change":e.productSizeChange}})],1)],1),a("div",{staticClass:"devproduct-prodialog"},[a("el-drawer",{attrs:{"before-close":e.handleClose,"close-on-click-modal":!1,title:e.moduleTitle,visible:e.dialogFormVisible,"append-to-body":"",size:"60%",top:"5vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("div",{staticClass:"devproduct-prodialog-content"},[a("div",{staticClass:"contentone"},[a("div",{staticStyle:{display:"flex"}},[a("span",[e._v(" "+e._s(e.$translateTitle("product.productinformation"))+" ")]),a("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),a("el-form",{key:e.form.type,ref:"form",attrs:{"label-width":"产品名称"==e.$translateTitle("product.productname")?"120px":"160px",model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"name"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.device manufacturer"),prop:"devType"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.devType,callback:function(t){e.$set(e.form,"devType",t)},expression:"form.devType"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.classification"),prop:0==e.form.type?"":"categoryname"}},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:10}},[a("el-radio-group",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[a("el-radio",{attrs:{label:1}},[e._v(" "+e._s(e.$translateTitle("product.Standard category"))+" ")]),a("el-radio",{attrs:{label:0}},[e._v(" "+e._s(e.$translateTitle("product.Custom category"))+" ")])],1)],1),a("el-col",{staticStyle:{padding:"0"},attrs:{span:13}},[a("el-input",{attrs:{readonly:""},model:{value:e.form.categoryname,callback:function(t){e.$set(e.form,"categoryname",t)},expression:"form.categoryname"}},[a("el-icon",{staticClass:"el-icon-edit el-input__icon",attrs:{slot:"append",size:"mini"},nativeOn:{click:function(t){return e.handlecateClick.apply(null,arguments)}},slot:"append"})],1)],1)],1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.Storage channel"),prop:"tdchannel"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:"edit"==e.custom_status&&""!=e.form.tdchannel,placeholder:e.$translateTitle("task.Select")},model:{value:e.form.tdchannel,callback:function(t){e.$set(e.form,"tdchannel",t)},expression:"form.tdchannel"}},e._l(e.tdchannelList,(function(e){return a("el-option",{key:e.objectId,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.taskchannel"),prop:"taskchannel"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:"edit"==e.custom_status&&""!=e.form.taskchannel,placeholder:e.$translateTitle("task.Select")},model:{value:e.form.taskchannel,callback:function(t){e.$set(e.form,"taskchannel",t)},expression:"form.taskchannel"}},e._l(e.taskchannelList,(function(e){return a("el-option",{key:e.objectId,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.Acquisition channel"),prop:"otherchannel"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("task.Select"),multiple:"","value-key":"objectId"},model:{value:e.form.otherchannel,callback:function(t){e.$set(e.form,"otherchannel",t)},expression:"form.otherchannel"}},e._l(e.otherchannelList,(function(e){return a("el-option",{key:e.objectId,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.applicationtype"),prop:"relationApp"}},[a("el-input",{attrs:{disabled:"edit"==e.custom_status&&""!=e.form.relationApp,placeholder:e.$translateTitle("product.pleaseselectyourapp"),readonly:""},on:{focus:function(t){e.showTree=!e.showTree}},model:{value:e.form.relationApp,callback:function(t){e.$set(e.form,"relationApp",t)},expression:"form.relationApp"}}),e.showTree?a("div",[a("el-tree",{attrs:{data:e.allApps,props:e.defaultProps},on:{"node-click":e.handleNodeClick}})],1):e._e()],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.nodetype"),prop:"nodeType"}},[a("el-radio-group",{model:{value:e.form.nodeType,callback:function(t){e.$set(e.form,"nodeType",t)},expression:"form.nodeType"}},[a("el-radio",{attrs:{label:3}},[e._v(" "+e._s(e.$translateTitle("product.direct"))+" ")]),a("el-radio",{attrs:{label:1}},[e._v(" "+e._s(e.$translateTitle("product.gateway"))+" ")]),a("el-radio",{attrs:{label:0}},[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")])],1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.networking"),prop:"netType"}},[a("el-select",{attrs:{placeholder:e.$translateTitle("product.selectgateway")},model:{value:e.form.netType,callback:function(t){e.$set(e.form,"netType",t)},expression:"form.netType"}},e._l(e.channel,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("menu.icon"),prop:"icon"}},[e.imageUrl?a("div",[a("img",{staticClass:"avatar",attrs:{src:e.$FileServe+e.imageUrl}}),a("el-button",{staticStyle:{"vertical-align":"text-bottom"},attrs:{size:"mini",type:"danger"},on:{click:function(t){return t.stopPropagation(),e.deleteImgsrc.apply(null,arguments)}}},[e._v(" 删除 ")])],1):a("i",{staticClass:"el-icon-plus avatar-uploader-icon",on:{click:function(t){return e.uploadCkick("product_ico")}}}),a("form",{ref:"uploadform",staticStyle:{position:"absolute",visibility:"hidden"},attrs:{enctype:"multipart/form-data",method:"POST"}},[a("input",{staticStyle:{position:"relative","z-index":"5",width:"100px",height:"100px",cursor:"pointer",opacity:"0"},attrs:{type:"file"},on:{change:function(t){return e.upload(t)}}})]),a("br")]),a("el-form-item",{attrs:{label:e.$translateTitle("developer.describe"),prop:"desc"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1)],1)],1)]),a("div",{staticClass:"devproduct-prodialog-footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm()}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),a("el-button",{on:{click:function(t){return e.handleCloseDialogForm()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1),a("el-drawer",{attrs:{"append-to-body":!0,visible:e.cascaderDrawer,size:"40%"},on:{"update:visible":function(t){e.cascaderDrawer=t}}},[a("div",[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24}},[a("vab-query-form",[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"100px"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.classification")}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("task.Select")},on:{change:e.handleCateSearch},model:{value:e.queryForm.category,callback:function(t){e.$set(e.queryForm,"category",t)},expression:"queryForm.category"}},e._l(e.categoryList,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.Templatename")}},[a("el-input",{attrs:{clearable:"",placeholder:"请输入模板名称"},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),a("el-form-item",{attrs:{"label-width":"0"}},[a("el-button",{staticClass:"el-icon-search",attrs:{"native-type":"submit",type:"primary"},on:{click:function(t){return e.queryProdut({})}}})],1)],1)],1)],1)],1)],1),a("el-table",{staticStyle:{width:"100%"},attrs:{"cell-style":{"text-align":"center"},data:e.tableData,"header-cell-style":{"text-align":"center"},height:e.$baseTableHeight(0)+40,border:"",size:"mini"}},[a("el-table-column",{attrs:{label:e.$translateTitle("developer.Templatename"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[e._v(" "+e._s(r.name)+" "),a("el-popover",{attrs:{placement:"left",trigger:"click",width:"800"}},[a("dgiot-profile",{ref:"profile",attrs:{"is-product":!0}}),a("i",{staticClass:"el-icon-info",attrs:{slot:"reference"},on:{click:function(t){return e.referenceHandle(r)}},slot:"reference"})],1)]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("department.category"),prop:"categoryname"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.category.name)+" ")]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.operation"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.chooseTemplate(r)}}},[e._v(" "+e._s(e.$translateTitle("product.choose"))+" ")])]}}])})],1),a("vab-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.queryForm.total>0,expression:"queryForm.total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.queryForm.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.categorytree}})],1)])],1),a("el-dialog",{attrs:{"append-to-body":!0,visible:e.dialogProfile,top:"1vh"},on:{"update:visible":function(t){e.dialogProfile=t}}},[a("dgiot-profile",{ref:"dialogProfile",attrs:{"is-product":!0}})],1),e.dictVisible?a("a-drawer",{staticStyle:{"z-index":"999"},attrs:{"append-to-body":!0,"close-on-click-modal":!1,title:e.title_temp_dialog,visible:e.dictVisible,width:"60%"},on:{close:function(t){e.dictVisible=!e.dictVisible}}},[a("el-form",{ref:"dictTempForm",attrs:{model:e.dictTempForm,rules:e.rule,size:"mini"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{"label-width":e.formLabelWidth,label:"字典模板名称",prop:"name"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.dictTempForm.name,callback:function(t){e.$set(e.dictTempForm,"name",t)},expression:"dictTempForm.name"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{"label-width":e.formLabelWidth,label:"字典模板类型",prop:"cType"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.dictTempForm.cType,callback:function(t){e.$set(e.dictTempForm,"cType",t)},expression:"dictTempForm.cType"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{"label-width":e.formLabelWidth,label:"字典模板状态",prop:"enable"}},[a("el-radio",{attrs:{border:"",label:"1"},model:{value:e.dictTempForm.enable,callback:function(t){e.$set(e.dictTempForm,"enable",t)},expression:"dictTempForm.enable"}},[e._v(" 启用 ")]),a("el-radio",{attrs:{border:"",label:"0"},model:{value:e.dictTempForm.enable,callback:function(t){e.$set(e.dictTempForm,"enable",t)},expression:"dictTempForm.enable"}},[e._v(" 禁用 ")])],1)],1)],1),a("el-form-item",{attrs:{"label-width":e.formLabelWidth,label:"字典模板数据"}},[a("el-tabs",{model:{value:e.elactiveName,callback:function(t){e.elactiveName=t},expression:"elactiveName"}},[a("el-tab-pane",{attrs:{label:"Table",name:"Table"}},[a("el-button",{staticClass:"mt-3",attrs:{icon:"el-icon-plus",size:"small",type:"primary"},nativeOn:{click:function(t){return e.addRow(e.dictTempForm.params)}}},[e._v(" 新 增 ")]),a("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{data:e.dictTempForm.params,height:e.height}},[a("el-table-column",{attrs:{label:"序号",prop:"order"}}),a("el-table-column",{attrs:{label:"标识符",prop:"identifier"}}),a("el-table-column",{attrs:{label:"功能名称",prop:"name"}}),a("el-table-column",{attrs:{label:"数据类型",prop:"type"}}),a("el-table-column",{attrs:{label:"数据地址",prop:"address"}}),a("el-table-column",{attrs:{label:"数据长度",prop:"bytes"}}),a("el-table-column",{attrs:{label:"是否必填",prop:"required"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[r.required?a("span",[e._v("是")]):a("span",[e._v("否")])]}}],null,!1,2053984958)}),a("el-table-column",{attrs:{align:"center",label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{plain:"",size:"mini",title:"删除",type:"danger"},nativeOn:{click:function(t){return e.delRow(r.$index,e.dictTempForm.params)}}},[e._v(" 删除 ")]),a("el-button",{attrs:{plain:"",size:"mini",title:"编辑",type:"info"},nativeOn:{click:function(t){return e.editRow(r.$index,e.dictTempForm.params)}}},[e._v(" 编辑 ")])]}}],null,!1,173212022)})],1)],1),a("el-tab-pane",{attrs:{label:"Json",name:"Json"}},[a("vab-json-editor",{attrs:{mode:"code",lang:"zh"},on:{"has-error":e.onError},model:{value:e.dictTempForm.params,callback:function(t){e.$set(e.dictTempForm,"params",t)},expression:"dictTempForm.params"}})],1)],1)],1),a("el-form-item",{attrs:{"label-width":e.formLabelWidth,label:"描述"}},[a("el-input",{attrs:{autosize:{minRows:2,maxRows:4},placeholder:"请输入描述",type:"textarea"},model:{value:e.dictTempForm.description,callback:function(t){e.$set(e.dictTempForm,"description",t)},expression:"dictTempForm.description"}})],1),a("el-form-item",{staticStyle:{"text-align":"center"},attrs:{size:"mini"}},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.onJsonSave("dictTempForm")}}},[e._v(" 提交 ")]),a("el-button",{on:{click:function(t){e.dictVisible=!1}}},[e._v("取消")])],1)],1)],1):e._e(),a("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.closeDict,"close-on-click-modal":!1,title:e.title_dict_edit_dialog,visible:e.edit_dict_temp_dialog,top:"5vh",width:"60%"},on:{"update:visible":function(t){e.edit_dict_temp_dialog=t},open:function(t){return e.opendialog("tempparams")}}},[a("el-form",{ref:"tempparams",attrs:{model:e.tempparams,"label-position":"left","label-width":"100px",size:"mini"}},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"序号",prop:"order"}},[a("el-input",{model:{value:e.tempparams.order,callback:function(t){e.$set(e.tempparams,"order",e._n(t))},expression:"tempparams.order"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.identifier"),prop:"identifier"}},[a("el-input",{model:{value:e.tempparams.identifier,callback:function(t){e.$set(e.tempparams,"identifier",t)},expression:"tempparams.identifier"}})],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.functionname"),prop:"name"}},[a("el-input",{model:{value:e.tempparams.name,callback:function(t){e.$set(e.tempparams,"name",t)},expression:"tempparams.name"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.datatype"),prop:"type"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:e.tempTypeChange},model:{value:e.tempparams.type,callback:function(t){e.$set(e.tempparams,"type",t)},expression:"tempparams.type"}},[a("el-option",{attrs:{label:e.$translateTitle("product.init"),value:"int"}}),a("el-option",{attrs:{label:e.$translateTitle("product.float"),value:"float"}}),a("el-option",{attrs:{label:e.$translateTitle("product.double"),value:"double"}}),a("el-option",{attrs:{label:e.$translateTitle("product.bool"),value:"bool"}}),a("el-option",{attrs:{label:e.$translateTitle("product.enum"),value:"enum"}}),a("el-option",{attrs:{label:e.$translateTitle("product.string"),value:"string"}}),a("el-option",{attrs:{label:"switch",value:"switch"}})],1)],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.unit")}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("product.unit"),filterable:""},model:{value:e.tempparams.unit,callback:function(t){e.$set(e.tempparams,"unit",t)},expression:"tempparams.unit"}},e._l(e.allunit,(function(e,t){return a("el-option",{key:t,attrs:{label:e.data.Name+"/"+e.data.Symbol,value:e.data.Symbol}})})),1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"协议类型"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.tempparams.protocol,callback:function(t){e.$set(e.tempparams,"protocol",t)},expression:"tempparams.protocol"}},e._l(["normal","modbus","mingcheng","xinchuangwei","hex"],(function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1)],1)],1),a("el-row",{directives:[{name:"show",rawName:"v-show",value:"modbus"==e.tempparams.protocol,expression:"tempparams.protocol == 'modbus'"}],attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据格式"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.tempparams.originaltype,callback:function(t){e.$set(e.tempparams,"originaltype",t)},expression:"tempparams.originaltype"}},e._l([{value:"bit",label:"位"},{value:"short16_AB",label:"16位 有符号(AB)"},{value:"short16_BA",label:"16位 有符号(BA)"},{value:"ushort16_AB",label:"16位 无符号(AB)"},{value:"ushort16_BA",label:"16位 无符号(BA)"},{value:"long32_ABCD",label:"32位 有符号(ABCD)"},{value:"long32_CDAB",label:"32位 有符号(CDAB)"},{value:"ulong32_ABCD",label:"32位 无符号(ABCD)"},{value:"ulong32_CDAB",label:"32位 无符号(CDAB)"},{value:"float32_ABCD",label:"32位 浮点数(ABCD)"},{value:"float32_CDAB",label:"32位 浮点数(CDAB)"}],(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),a("el-table",{directives:[{name:"show",rawName:"v-show",value:"modbus"==e.tempparams.protocol,expression:"tempparams.protocol == 'modbus'"}],staticStyle:{width:"100%"},attrs:{data:e.dataList,height:e.height,border:"",size:"small"}},[a("el-table-column",{attrs:{align:"center",label:"从机地址(16进制加0X,例:0X10,否则是十进制)","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{model:{value:e.tempparams.slaveid,callback:function(t){e.$set(e.tempparams,"slaveid",t)},expression:"tempparams.slaveid"}}),a("span",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[e._v(e._s(r))])]}}])}),a("el-table-column",{attrs:{align:"center",label:"寄存器状态","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.tempparams.operatetype,callback:function(t){e.$set(e.tempparams,"operatetype",t)},expression:"tempparams.operatetype"}},e._l([{value:"writeCoil",label:"0X05:写单个线圈寄存器"},{value:"writeHreg",label:"0X06:写单个保持寄存器"},{value:"writeCoils",label:"0X0f:写多个线圈寄存器"},{value:"writeHregs",label:"0X10:写多个保持寄存器"}],(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),a("span",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[e._v(e._s(r.slaveid))])]}}])}),a("el-table-column",{attrs:{align:"center",label:"数据地址(16进制加0X,例:0X10,否则是十进制)","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{model:{value:e.tempparams.address,callback:function(t){e.$set(e.tempparams,"address",t)},expression:"tempparams.address"}}),a("span",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[e._v(e._s(r.slaveid))])]}}])}),"writeCoils"==e.tempparams.operatetype||"writeHregs"==e.tempparams.operatetype?a("el-table-column",{attrs:{align:"center",label:"寄存器个数","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{model:{value:e.tempparams.registersnumber,callback:function(t){e.$set(e.tempparams,"registersnumber",t)},expression:"tempparams.registersnumber"}}),a("span",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[e._v(e._s(r.slaveid))])]}}],null,!1,713879905)}):e._e(),a("el-table-column",{attrs:{align:"center",label:"写入字节数","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{model:{value:e.tempparams.bytes,callback:function(t){e.$set(e.tempparams,"bytes",t)},expression:"tempparams.bytes"}}),a("span",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[e._v(e._s(r.slaveid))])]}}])})],1),a("el-row",{directives:[{name:"show",rawName:"v-show",value:"modbus"!=e.tempparams.protocol,expression:"tempparams.protocol != 'modbus'"}],attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据地址"}},[a("el-input",{attrs:{placeholder:"数据地址"},model:{value:e.tempparams.address,callback:function(t){e.$set(e.tempparams,"address",t)},expression:"tempparams.address"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据长度"}},[a("el-input",{attrs:{placeholder:"数据长度（字节）"},model:{value:e.tempparams.bytes,callback:function(t){e.$set(e.tempparams,"bytes",e._n(t))},expression:"tempparams.bytes"}})],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-tooltip",{staticStyle:{float:"left"},attrs:{effect:"dark",placement:"right-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v(" 1. 采集值 设备上行数据经采集公式计算后显示 。 "),a("br"),e._v(" 公式中的%s为占位符，是固定字段。 "),a("br"),e._v(" 如： "),a("br"),e._v(" 加：%s+10 "),a("br"),e._v(" 减：%s-10 "),a("br"),e._v(" 乘：%s*10 "),a("br"),e._v(" 除：%s/10 "),a("br"),e._v(" 余数：%s%10 "),a("br")]),a("i",{staticClass:"el-icon-question"})]),a("el-form-item",{attrs:{label:"采集公式"}},[a("el-input",{staticStyle:{width:"100%"},attrs:{rows:1,type:"textarea"},model:{value:e.tempparams.collection,callback:function(t){e.$set(e.tempparams,"collection",t)},expression:"tempparams.collection"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-tooltip",{staticStyle:{float:"left"},attrs:{effect:"dark",placement:"right-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v(" 1. 设置值 平台下行数据经设置公式计算后设置 。 "),a("br"),e._v(" 公式中的%s为占位符，是固定字段。 "),a("br"),e._v(" 如： "),a("br"),e._v(" 加：%s+10 "),a("br"),e._v(" 减：%s-10 "),a("br"),e._v(" 乘：%s*10 "),a("br"),e._v(" 除：%s/10 "),a("br"),e._v(" 余数：%s%10 "),a("br")]),a("i",{staticClass:"el-icon-question"})]),a("el-form-item",{attrs:{label:"设置公式"}},[a("el-input",{attrs:{rows:1,type:"textarea"},model:{value:e.tempparams.setting,callback:function(t){e.$set(e.tempparams,"setting",t)},expression:"tempparams.setting"}})],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"必填"}},[a("el-radio",{attrs:{label:!0,border:""},model:{value:e.tempparams.required,callback:function(t){e.$set(e.tempparams,"required",t)},expression:"tempparams.required"}},[e._v(" 是 ")]),a("el-radio",{attrs:{label:!1,border:""},model:{value:e.tempparams.required,callback:function(t){e.$set(e.tempparams,"required",t)},expression:"tempparams.required"}},[e._v(" 否 ")])],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"只读"}},[a("el-radio",{attrs:{label:!0,border:""},model:{value:e.tempparams.readonly,callback:function(t){e.$set(e.tempparams,"readonly",t)},expression:"tempparams.readonly"}},[e._v(" 是 ")]),a("el-radio",{attrs:{label:!1,border:""},model:{value:e.tempparams.readonly,callback:function(t){e.$set(e.tempparams,"readonly",t)},expression:"tempparams.readonly"}},[e._v(" 否 ")])],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"列表显示"}},[a("el-radio",{attrs:{label:!0,border:""},model:{value:e.tempparams.isshow,callback:function(t){e.$set(e.tempparams,"isshow",t)},expression:"tempparams.isshow"}},[e._v(" 是 ")]),a("el-radio",{attrs:{label:!1,border:""},model:{value:e.tempparams.isshow,callback:function(t){e.$set(e.tempparams,"isshow",t)},expression:"tempparams.isshow"}},[e._v(" 否 ")])],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},["switch"==e.tempparams.type?a("el-form-item",{attrs:{label:"开"}},[a("el-input",{model:{value:e.tempparams.activevalue,callback:function(t){e.$set(e.tempparams,"activevalue",t)},expression:"tempparams.activevalue"}})],1):e._e()],1),a("el-col",{attrs:{span:12}},["switch"==e.tempparams.type?a("el-form-item",{attrs:{label:"关"}},[a("el-input",{model:{value:e.tempparams.inactivevalue,callback:function(t){e.$set(e.tempparams,"inactivevalue",t)},expression:"tempparams.inactivevalue"}})],1):e._e()],1)],1),"enum"!=e.tempparams.type&&"switch"!=e.tempparams.type?a("el-form-item",{attrs:{label:"默认值",prop:"default"}},["bool"==e.tempparams.type?a("el-select",{staticClass:"notauto",attrs:{readonly:""},model:{value:e.tempparams.default,callback:function(t){e.$set(e.tempparams,"default",t)},expression:"tempparams.default"}},[a("el-option",{attrs:{value:!0,label:"是"}}),a("el-option",{attrs:{value:!1,label:"否"}})],1):"int"==e.tempparams.type?a("el-input",{model:{value:e.tempparams.default,callback:function(t){e.$set(e.tempparams,"default",e._n(t))},expression:"tempparams.default"}}):a("el-input",{model:{value:e.tempparams.default,callback:function(t){e.$set(e.tempparams,"default",t)},expression:"tempparams.default"}})],1):e._e(),"enum"==e.tempparams.type?a("el-form-item",{attrs:{label:"Enum数据"}},[a("el-tabs",{model:{value:e.elactiveName1,callback:function(t){e.elactiveName1=t},expression:"elactiveName1"}},[a("el-tab-pane",{attrs:{label:"Table",name:"Table1"}},[a("el-button",{staticClass:"mt-3",attrs:{icon:"el-icon-plus",size:"mini",type:"primary"},nativeOn:{click:function(t){return e.addDomain.apply(null,arguments)}}},[e._v(" 新 增 ")]),a("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{data:e.tempparams.specs,height:e.height}},[a("el-table-column",{attrs:{align:"center",label:"属性"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{model:{value:r.attribute,callback:function(t){e.$set(r,"attribute",t)},expression:"row.attribute"}})]}}],null,!1,145805847)}),a("el-table-column",{attrs:{align:"center",label:"属性值"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{model:{value:r.attributevalue,callback:function(t){e.$set(r,"attributevalue",t)},expression:"row.attributevalue"}})]}}],null,!1,2139517436)}),a("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{plain:"",size:"mini",title:"删除",type:"danger"},nativeOn:{click:function(t){return e.removeDomain(r)}}},[e._v(" 删除 ")])]}}],null,!1,1667144408)})],1)],1)],1)],1):e._e(),a("el-form-item",[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitFormTempDict()}}},[e._v(" 提交 ")])],1)],1)],1)],1),a("div",{staticClass:"import-dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,visible:e.importDialogShow,title:"导入产品",width:"25%"},on:{"update:visible":function(t){e.importDialogShow=t}}},[a("el-form",{ref:"uploadProForm",attrs:{model:e.formPro}},[a("el-upload",{ref:"fileUpload",staticClass:"upload-demo",attrs:{action:e.uploadAction,"auto-upload":!1,data:e.uploadData,"file-list":e.fileList,headers:e.uploadHeaders,"on-change":e.handleChange,"on-error":e.handleUploadError,"on-success":e.handleUploadSuccess,"with-credentials":!0,accept:".xls, .xlsx, .zip"}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v(" 选泽文件 ")])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"btn-left",attrs:{size:"small",type:"primary"},on:{click:e.submitUpload}},[e._v(" 上 传 ")]),a("el-button",{staticClass:"btn-right",attrs:{size:"small"},on:{click:function(t){e.importDialogShow=!1}}},[e._v(" 取 消 ")])],1)],1)],1),a("VabRender",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{config:e.config,loading:!0}})],1)},i=[],l=a("fb07"),o=a("e97b"),n=a("d0d7"),s=a.n(n),c=(a("3dec"),a("9c6a"),a("79da"),a("1d17"),a("98da"),a("d6a4"),a("a0e0"),a("16b8"),a("f1e1"),a("c4bc"),a("e170"),a("04d6"),a("4c87"),a("b463"),a("a44e"),a("4ccb"),a("3559"),a("d06e"),a("b340"),a("6924"),a("472c"),a("256c"),a("de71"),a("7876"),a("37a7"),a("d2d8"),a("e2e1"),a("2c1e"),a("26c7"),a("ee7e"),a("f05b"),a("6a4de"),a("11de"),a("172c"),a("0c75"),a("69a3"),a("d30f"),a("3b7f"),a("aadd"),a("4656"),a("f764"),a("5662"),a("30b0")),d=a("ed08"),u=a("89e8"),p=a("5880"),m=a("7212"),f=a("e0e9"),b=a("1285"),v=a("5da95"),h=a("7497"),g=a("0af3"),y=a("ef68"),w=a("03b1"),T=a("6818"),k={};T.keys().forEach((function(e){var t=T(e);k[e.replace(/^\.\/(.*)\.\w+$/,"$1")]=t.default}));var x={components:Object(o["a"])({"dgiot-profile":c["default"]},k),data:function(){return{inputParams:{},storageArr:["默认-行式存储","默认-列式存储","InfluxDB-行式存储","InfluxDB-列式存储","TDEngine-列式存储"],channeltype:"2",channeldialog:!1,channelResource:[],selectedRow:{},tableData:[],allTemp:[],category:[],descriptions:{tableType:"things",things:[],productId:"",dictTableList:[],decoderTableList:{},productDetail:{decoder:{code:""},thing:{properties:[]},config:{parser:[],profile:[],basedate:{params:[]}}},parserTableList:[],tableLoading:!1},queryForm:{name:"",category:"",productId:"",productFlag:!1,pageNo:1,pageSize:20,searchDate:[],limt:10,skip:0,total:0,order:"-createdAt",keys:"count(*)"},cascaderDrawer:!1,drawerWidth:Number($(window).width())-240,height:this.$baseTableHeight(0),config:{},dataList:[{}],parserView:!1,parserTable:!1,parserTableList:{parser:[]},parserFromId:"",dialogVisible:!1,moduleTitle:this.$translateTitle("product.createproduct"),allunit:[],productInfo:{},edit_dict_temp_dialog:!1,title_dict_edit_dialog:"新增字典数据",tempparams:{name:"",identifier:"",type:"",order:0,address:"",bytes:"",registersnumber:"",default:0,required:!1,readonly:!0,specs:[{attribute:"",attributevalue:""}],struct:{},unit:"",inactivevalue:"",activevalue:""},elactiveName:"Table",elactiveName1:"Table1",editDictTempId:"",title_temp_dialog:"",dictTempForm:"",rule:[],dictVisible:!1,listLoading:!1,custom_row:{},custom_status:"add",hashkey:"",defaultProps:{children:"children",label:"label"},length:10,total:0,start:0,activeName:"first",formInline:{productname:""},uploadHeaders:{sessionToken:Cookies.get("access_token")},uploadAction:"",uploadData:{},fileList:[],productIdentifier:"",proTableData:[],formLabelWidth:"120px",dialogFormVisible:!1,importDialogShow:!1,cType:"",form:{type:1,storageStrategy:"",name:"",tdchannel:"7b290e5a0a",category:"",taskchannel:"6c48effac2",otherchannel:[],nodeType:3,desc:"",netType:"",devType:"",categoryid:"",producttempid:"",productSecret:"",roles:[],relationApp:""},taskchannelList:[],tdchannelList:[],otherchannelList:[],formPro:{name:"",url:""},rules:{name:[{required:!0,message:"请输入产品",trigger:"blur"}],tdchannel:[{required:!0,message:"请选择存储通道",trigger:"blur"}],storageStrategy:[{required:!0,message:"请选择存储策略",trigger:"blur"}],taskchannel:[{required:!0,message:"请选择任务通道",trigger:"blur"}],otherchannel:[{required:!0,message:"请选择采集通道",trigger:"blur"}],devType:[{required:!0,message:"请输入设备厂家",trigger:"blur"}],categoryname:[{required:!0,message:"请选择所属分类",trigger:"change"}],nodeType:[{required:!0,message:"请选择节点类型",trigger:"change"}],netType:[{required:!0,message:"请选择联网方式",trigger:"change"}],relationApp:[{required:!0,message:"请选择产品可见角色",trigger:"change"}]},option:[],ruleoptions:[],channel:[{label:"蜂窝(2G/3G/4G)",value:"CELLULAR"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"BLE(低功耗蓝牙)",value:"Bluetooth"},{label:"5G通道(直连)",value:"5G"},{label:"WIFI通道(直连)",value:"WIFI"},{label:"ZigBee通道",value:"ZigBee"},{label:"Modbus",value:"Modbus"},{label:"LoRa(WAN)(直连)",value:"LoRaWAN"},{label:"OPC UA",value:" OPC UA"},{label:"ZETA通道",value:"ZETA"},{label:"网线连接(直连)",value:"网线连接"},{label:"自定义",value:"OTHER"}],dialogProfile:!1,imageUrl:"",selectfromtype:"",productid:"",parserDict:[],formConfig:{},editIndex:0,Parserzh:"",parseren:"",loading:!1,allApps:[],categoryList:[],fileServer:"",access_token:"",projectid:"",projectName:"",allTableDate:[],showTree:!1,showcateTree:!1,multipleSelection:[]}},computed:Object(o["a"])({},Object(p["mapGetters"])({defaultKonva:"topo/defaultKonva",token:"user/token",roleTree:"user/roleTree"})),mounted:function(){var e=this.$route.query.project,t=void 0===e?"":e;this.formInline.productname=t,this.Get_Re_Channel(),this.queryProdut({}),this.searchProduct(0)},beforeDestroy:function(){this.projectName=""},methods:{handleIconClick:function(e){var t=this;return Object(l["a"])(s.a.mark((function e(){return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.dialogProfile=!t.dialogProfile,e.next=3,t.$refs.dialogProfile.StepsListRowClick(t.selectedRow);case 3:case"end":return e.stop()}}),e)})))()},handlecateClick:function(){this.categorytree(),this.cascaderDrawer=!0},handleSelectionChange:function(e){this.multipleSelection=e;var t=[];_.isObject(e)||e.forEach((function(e){t.push(e.objectId)})),"otherchannel"==this.selectfromtype?this.form[this.selectfromtype]=t:this.form[this.selectfromtype]=e.objectId},getResource:function(e,t,a){var r=this;return Object(l["a"])(s.a.mark((function i(){return s.a.wrap((function(i){while(1)switch(i.prev=i.next){case 0:r.cType=a,r.selectfromtype=e,r.channeltype=t;case 3:case"end":return i.stop()}}),i)})))()},getChannel:function(e,t,a){var r={};return r=""==a?e.filter((function(e){return e.type==t})):e.filter((function(e){return e.type==t&&e.cType==a})),r},Get_Re_Channel:function(){var e=this;return Object(l["a"])(s.a.mark((function t(){var a,r,i;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={count:"objectId",order:"-createdAt",keys:"count(*)",where:{}},t.next=3,Object(u["queryChannel"])(a);case 3:r=t.sent,i=r.results,e.channelResource=i,e.taskchannelList=e.getChannel(i,"2","INSTRUCT"),e.tdchannelList=e.getChannel(i,"2","TD"),e.otherchannelList=e.getChannel(i,"1","");case 9:case"end":return t.stop()}}),t)})))()},referenceHandle:function(e){var t=this;return Object(l["a"])(s.a.mark((function a(){return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$refs.profile.StepsListRowClick(e);case 2:case"end":return a.stop()}}),a)})))()},queryProdut:function(e){var t=this;return Object(l["a"])(s.a.mark((function a(){var r,i,l,o,n,c,d,u;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.categorys,i=t.$baseColorfullLoading(),e.limit||(e=t.queryForm),l={limit:e.limit,order:e.order,skip:e.skip,keys:e.keys,include:"category",where:{category:r?{$in:r}:{$ne:null},name:e.name?{$regex:e.name,$options:"i"}:{$ne:null}}},a.prev=4,a.next=7,Object(y["queryProductTemplet"])(l);case 7:o=a.sent,n=o.results,c=void 0===n?[]:n,d=o.count,u=void 0===d?0:d,i.close(),t.tableData=c,t.queryForm.total=u,a.next=21;break;case 17:a.prev=17,a.t0=a["catch"](4),i.close(),t.$message.error("".concat(a.t0));case 21:case"end":return a.stop()}}),a,null,[[4,17]])})))()},goKonva:function(e){this.$router.push({path:"/Topo?productid",query:{productid:e}})},uploadCkick:function(e){this.loading=!0,this.$refs["uploadFinish"].$refs.uploader.dispatchEvent(new MouseEvent("click")),this.inputParams={file:"",scene:"app",path:"product/ico/",filename:"".concat(this.productid,".").concat(e)}},fileInfo:function(e){this.imageUrl=e.path,this.loading=!1},files:function(e,t){this.inputParams.filename="".concat(this.productid,".").concat(t),this.inputParams.file=e},getAllunit:function(){var e=this;return Object(l["a"])(s.a.mark((function t(){var a,r;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.allunit=[],t.next=3,Object(f["getAllunit"])("unit",200);case 3:a=t.sent,r=a.results,e.allunit=r.concat([]);case 6:case"end":return t.stop()}}),t)})))()},submitEnum:function(){var e=this;"Enum"==this.tempparams.type&&this.tempparams.specs.map((function(t){var a=t["attribute"];e.tempparams.struct[a]=t["attributevalue"]}))},addDomain:function(){this.tempparams.specs.push({attribute:"",attributevalue:""})},removeDomain:function(e){var t=this.tempparams.specs.indexOf(e);-1!==t&&this.tempparams.specs.splice(t,1)},delRow:function(e,t){t.splice(e,1)},editRow:function(e,t,a){this.editIndexId=t,this.title_dict_edit_dialog="修改字典数据",this.edit_dict_temp_dialog=!0,this.tempparams=e},closeDict:function(){this.edit_dict_temp_dialog=!this.edit_dict_temp_dialog},onJsonSave:function(e){var t=this;this.$refs[e].validate((function(e){e&&t.put_Dict_temp(t.editDictTempId,t.dictTempForm)}))},put_Dict_temp:function(e,t){var a=this;return Object(l["a"])(s.a.mark((function r(){var i,l,o,n,c;return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return i=a.productInfo.config,l=void 0===i?{basedate:{}}:i,l.basedate=t,o={config:l},r.next=5,Object(m["putProduct"])(e,o);case 5:n=r.sent,c=n.updatedAt,void 0!=c?(a.dictVisible=!1,a.$message("字典数据更新成功")):a.$message("字典数据更新失败");case 8:case"end":return r.stop()}}),r)})))()},submitFormTempDict:function(){this.submitEnum(),this.edit_dict_temp_dialog=!1,void 0!=this.editIndexId?(this.dictTempForm.params[this.editIndexId]=this.tempparams,this.$message("编辑成功")):(this.dictTempForm.params.push(this.tempparams),this.$message("新增成功"))},opendialog:function(e){var t=this;this.$nextTick((function(){t.$refs[e].clearValidate()}))},tempTypeChange:function(e){"bool"==e?(this.tempparams.default=!0,this.tempparams.default=!0):this.tempparams.default="int"==e?0:void 0},addRow:function(e){this.editIndexId=void 0,this.title_dict_edit_dialog="新增字典数据",this.edit_dict_temp_dialog=!0,this.tempparams={name:"",identifier:"",type:"",order:0,address:"",bytes:"",registersnumber:"",default:0,required:!1,readonly:!0,specs:[{attribute:"",attributevalue:""}],struct:{},collection:"%s",setting:"%s",unit:""}},onError:function(){this.$message("非Json数据类型")},handleNodeClick:function(e){this.$set(this.form,"relationApp",e.name),this.showTree=!this.showTree},selectApp:function(e){var t=this;e&&Object(v["getServer"])(e).then((function(e){e&&(t.fileServer=e.file,t.access_token=e.access_token)}))},treeData:function(e){var t=JSON.parse(JSON.stringify(e));return t.filter((function(e){var a=t.filter((function(t){return e.objectId==t.parent.objectId}));return a.length>0&&(e.children=a),0==e.parent.objectId}))},deleteImgsrc:function(){this.imageUrl=""},dataURItoBlob:function(e){for(var t=atob(e.split(",")[1]),a=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),i=new Uint8Array(r),l=0;l<t.length;l++)i[l]=t.charCodeAt(l);return new Blob([r],{type:a})},submitUpload:function(){var e=this;this.uploadAction="/product",this.$nextTick((function(){e.uploadData.appid=Cookies.get("appids"),e.$refs.fileUpload.submit()}))},handleUploadSuccess:function(e,t,a){this.$message({type:"success",message:"产品导入成功"}),this.importDialogShow=!1,this.$refs["uploadProForm"].resetFields(),this.searchProduct()},handleUploadError:function(e,t,a){this.$message({showClose:!0,message:e})},handleChange:function(e,t){t.length>0&&(this.fileList=[t[t.length-1]])},utc2beijing:function(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},searchProduct:function(e){var t=this;return Object(l["a"])(s.a.mark((function a(){var r,i,l,o,n,c,d;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,t.listLoading=!0,0==e&&(t.start=0),r=[],i={count:"objectId",order:"-updatedAt",limit:t.length,skip:t.start,include:"category,producttemplet",where:{name:t.formInline.productname.length?{$regex:t.formInline.productname}:{$ne:null}}},a.next=7,t.$query_object("Product",i);case 7:l=a.sent,o=l.results,n=void 0===o?[]:o,c=l.count,d=void 0===c?0:c,n&&(n.map((function(e){""!=e.category&&e.category&&"report"!=e.devType&&r.push(e.category)})),t.listLoading=!1,t.proTableData=n,t.total=d),t.getApps(),a.next=20;break;case 16:a.prev=16,a.t0=a["catch"](0),t.listLoading=!1,t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 20:case"end":return a.stop()}}),a,null,[[0,16]])})))()},getApps:function(){this.allApps=this.roleTree},handleClose:function(){this.dialogFormVisible=!1},chooseTemplate:function(e){var t=this;return Object(l["a"])(s.a.mark((function a(){var r;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.getcategoryname(e.category);case 2:r=a.sent,t.selectedRow=e,t.$set(t.form,"categoryid",e.category.objectId),t.$set(t.form,"categoryname",r+"/"+e.name),t.$set(t.form,"producttempid",e.objectId),t.form.thing=e.thing?e.thing:{},t.cascaderDrawer=!t.cascaderDrawer;case 9:case"end":return a.stop()}}),a)})))()},getcategoryname:function(e){return Object(l["a"])(s.a.mark((function t(){var a,r,i;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(w["getCategory"])(e.parent.objectId);case 2:return a=t.sent,r=a.name,i="所有领域"==r?e.name:r+"/"+e.name,t.abrupt("return",i);case 6:case"end":return t.stop()}}),t)})))()},handleCloseDialogForm:function(){var e=this;this.dialogFormVisible=!1,this.$nextTick((function(){e.$refs["form"].resetFields()}))},properties:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"things";this.descriptions.tableLoading=!0,this.descriptions.things=e,this.descriptions.tableType=a,setTimeout((function(){return t.descriptions.tableLoading=!1}),1200)},addproduct:function(){this.custom_status="add",this.moduleTitle=this.$translateTitle("product.createproduct"),this.imageUrl="",this.handleNodeClick(this.allApps[0]),this.form={name:"",type:1,category:"",nodeType:3,desc:"",netType:" ",devType:"",productSecret:"",relationApp:this.allApps[0].name,roles:[],categoryname:""},this.productid=moment(new Date).valueOf().toString(),this.dialogFormVisible=!0},getParent:function(e,t,a){var r=this;return t.map((function(i){e==i.id?(a.unshift(i.value),r.getParent(i.parentid,t,a)):0==i.parentid&&i.id==e&&a.unshift(i.value)})),this.form.category=a[0],a},getIndustryParent:function(e,t){var a=this;t.map((function(r){r.value==e&&a.getParent(r.id,t,[])}))},editorParser:function(e){var t=this;return Object(l["a"])(s.a.mark((function a(){var r,i,l,o,n;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.parserFromId=e,a.prev=1,a.next=4,Object(m["getProduct"])(e);case 4:r=a.sent,i=r.config,l=void 0===i?{parser:[]}:i,o=r.thing,n=void 0===o?{}:o,t.parserTableList=l,t.parserDict=_.merge(n,l),a.next=16;break;case 13:a.prev=13,a.t0=a["catch"](1),t.parserTableList={parser:[]};case 16:t.parserTable=!0;case 17:case"end":return a.stop()}}),a,null,[[1,13]])})))()},editParse:function(e,t){this.formConfig=t,this.editIndex=e,this.dialogVisible=!0},saveParse:function(e){var t=arguments,a=this;return Object(l["a"])(s.a.mark((function r(){var i;return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return i=t.length>1&&void 0!==t[1]?t[1]:-1,i+2>0&&(a.parserTableList.parser[i]=_.merge({},e)),r.prev=2,r.next=5,Object(m["putProduct"])(a.parserFromId,{config:i+2>0?a.parserTableList:e});case 5:r.sent,a.$message.success(a.$translateTitle("user.Save the template successfully")),a.dialogVisible=!1,a.parserTable=!1,r.next=14;break;case 11:r.prev=11,r.t0=r["catch"](2),a.$message.error(a.$translateTitle("user.Save the template error")+"".concat(r.t0));case 14:case"end":return r.stop()}}),r,null,[[2,11]])})))()},previewParse:function(e){this.parserView=!0,this.formConfig=e},addParse:function(e){e["parser"].push({name:Object(d["uuid"])(6),enname:Object(d["uuid"])(6),config:{}})},deleteParse:function(e,t){t.splice(e,1)},editorDict:function(e){var t=this;return Object(l["a"])(s.a.mark((function a(){var r,i,l;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.getAllunit(),a.next=3,Object(m["getProduct"])(e);case 3:r=a.sent,i=r.config,l=void 0===i?{basedate:{}}:i,t.productInfo=r,t.editDictTempId=e,t.dictTempForm={name:"",cType:"",enable:"1",description:"",params:[]},t.title_temp_dialog="创建字典模板",l.basedate&&l.basedate.name&&(t.title_temp_dialog="修改字典模板",t.dictTempForm=l.basedate),t.rule={name:[{required:!0,message:"请输入字典模板名称",trigger:"blur"}],cType:[{required:!0,message:"请输入字典模板类型",trigger:"blur"}],enable:[{required:!0,message:"请选择状态",trigger:"change"}]},t.dictVisible=!0;case 12:case"end":return a.stop()}}),a)})))()},editorProduct:function(e){this.imageUrl="",this.moduleTitle=this.$translateTitle("product.editproduct"),this.custom_status="edit",this.custom_row=e,this.dialogFormVisible=!0,this.productid=e.objectId,this.form.desc=e.desc,this.form.category=e.category,this.form.producttemplet=e.producttemplet,this.form.config=e.config,this.form.name=e.name,this.form.nodeType=e.nodeType,this.$set(this.form,"type",e.channel?e.channel.type:""),this.$set(this.form,"tdchannel",e.channel?e.channel.tdchannel:""),this.$set(this.form,"taskchannel",e.channel?e.channel.taskchannel:""),this.$set(this.form,"otherchannel",e.channel?e.channel.otherchannel:[]),this.$set(this.form,"storageStrategy",e.channel?e.channel.storageStrategy:""),this.form.netType=e.netType,this.form.devType=e.devType,this.form.categoryname=e.category?e.category.name:"",this.form.productSecret=e.productSecret,this.form.nodeType=e.nodeType,e.icon&&(this.imageUrl=e.icon);var t=[];for(var a in e.ACL)t.push(a),a.includes("role")&&(this.form.relationApp=a?a.substr(5):"")},categorytree:function(){var e=this;return Object(l["a"])(s.a.mark((function t(){var a,r,i;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={order:"createdAt",keys:"count(*)",where:{level:{$in:[0,1]}}},t.next=3,Object(w["queryCategory"])(a);case 3:r=t.sent,i=r.results,e.categoryList=i;case 6:case"end":return t.stop()}}),t)})))()},handleCateSearch:function(e){var t=this;if(this.queryForm.category=e,this.showcateTree=!this.showcateTree,"a60a85475a"==e)this.queryProdut({});else{var a={keys:"objectId",where:{parent:{className:"Category",objectId:e,__type:"Pointer"}}};Object(w["queryCategory"])(a).then((function(a){var r=[];r.push(e),a.results.forEach((function(e){r.push(e.objectId)})),t.queryProdut({categorys:r})}))}},submitForm:function(){var e=this,t={name:this.form.name,nodeType:this.form.nodeType,netType:this.form.netType,icon:this.imageUrl,devType:this.form.devType,desc:this.form.desc,thing:this.form.thing?this.form.thing:{},category:{objectId:0==Number(this.form.type)?"5ca6049839":this.form.categoryid,__type:"Pointer",className:"Category"},producttemplet:{objectId:0==Number(this.form.type)?"0":this.form.producttempid,__type:"Pointer",className:"ProductTemplet"},channel:{type:this.form.type,tdchannel:this.form.tdchannel,taskchannel:this.form.taskchannel,otherchannel:this.form.otherchannel,storageStrategy:this.form.storageStrategy}};this.$refs.form.validate((function(a){if(a)if("add"===e.custom_status){var r=Math.ceil(25*Math.random()),i=Base64.encode(String.fromCharCode(65+r)+Math.ceil(1e7*Math.random())+Number(new Date)),l="role:"+e.form.relationApp,o={};o[l]={read:!0,write:!0},o["*"]={read:!0};var n={productSecret:i,ACL:o,topics:[],decoder:{},config:{konva:{Stage:e.defaultKonva}}},s=_.merge(t,n);e.createProduct(s)}else e.editProduct(t);else e.$message("必填项未填")}))},doUpload:function(e){var t=this;return Object(l["a"])(s.a.mark((function a(){var r,i;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.target.files[0],i=t.$baseColorfullLoading(3),a.prev=2,a.next=5,Object(g["ImportParse"])("Product",r);case 5:a.sent,i.close(),t.$message.success(""),a.next=14;break;case 10:a.prev=10,a.t0=a["catch"](2),i.close(),t.$message.error("".concat(a.t0));case 14:t.$baseEventBus.$emit("reload-router-view");case 15:case"end":return a.stop()}}),a,null,[[2,10]])})))()},createProduct:function(e){var t=this;return Object(l["a"])(s.a.mark((function a(){var r;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$create_object("Product",e);case 2:r=a.sent,r.objectId?t.initQuery("产品创建成功","success"):t.$message({type:"error",message:r.error});case 4:case"end":return a.stop()}}),a)})))()},editProduct:function(e){var t=this;return Object(l["a"])(s.a.mark((function a(){var r;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$update_object("Product",t.custom_row.objectId,e);case 2:r=a.sent,r.updatedAt?t.initQuery("产品修改成功","success"):t.$message({type:"error",message:r.error});case 4:case"end":return a.stop()}}),a)})))()},initQuery:function(e,t){this.$message({type:t||"info",message:e}),this.dialogFormVisible=!1,this.resetProductForm(),this.$refs["form"].resetFields(),this.searchProduct()},resetProductForm:function(){this.form={name:"",category:"",nodeType:3,desc:"",netType:"",devType:"",productSecret:"",roles:[],relationApp:""},this.imageUrl=""},deviceToDetail:function(e){this.$router.push({path:"/roles/detailproduct",query:{id:e.objectId}})},GoTodevices:function(e){this.$router.push({path:"/roles/thing",query:{productid:e.objectId}})},makeSure:function(e){var t=this,a={count:"objectId",skip:0,limit:1,where:{product:e.objectId}};Object(b["queryDevice"])(a).then((function(a){a.count>0?t.$message("请先删除该产品下设备"):Object(m["delProduct"])(e.objectId).then((function(a){a&&(t.$message({type:"success",message:"删除成功"}),e._self.$refs["popover-".concat(e.$index)].doClose(),t.searchProduct())}))}))},productSizeChange:function(e){this.length=e,this.searchProduct()},productCurrentChange:function(e){this.start=(e-1)*this.length,this.searchProduct()},blackDict:function(e,t){var a=this;return Object(l["a"])(s.a.mark((function r(){var i,l;return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return i={data:t,key:e,type:"Product"},r.next=3,Object(f["postDict"])(i);case 3:l=r.sent,l?a.$message({type:"success",message:"备份成功"}):a.$message({type:"error",message:"备份失败"});case 5:case"end":return r.stop()}}),r)})))()},CloneData:function(e){var t=this;return Object(l["a"])(s.a.mark((function a(){var r,i,l,o;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r={category:e.attributes.category,devType:e.attributes.devType,name:e.attributes.name,thing:e.attributes.thing},a.next=3,Object(h["getHashClass"])("Product",r);case 3:i=a.sent,l=i.objectId,o=i.code,200==o&&t.blackDict(l,r);case 7:case"end":return a.stop()}}),a)})))()},proudctClone:function(e){e.attributes.config.cloneState=!0,e.attributes.config.cloneState=!0;var t=e,a=Object(m["putProduct"])(e.id,t);a&&this.CloneData(e)},proudctEdit:function(e){var t=window.location.origin+"/spa",a="production";t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var r="".concat(t,"/#?drawProudctid=").concat(e.objectId,"&proudctid=").concat(e.objectId);localStorage.setItem("rowId",e.objectId),window.open(r,"__blank")},proudctView:function(e){var t=window.location.origin+"/spa",a="production";t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var r="".concat(t,"/#/views/").concat(e.objectId);window.open(r,"__blank")},goTopoview:function(){var e=window.location.origin+"/spa",t="production";e="development"==t?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var a="".concat(e,"/#/view");window.open(a,"__blank")},handleImport:function(){var e=this;return Object(l["a"])(s.a.mark((function t(){return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$refs.uploader.click();case 2:case"end":return t.stop()}}),t)})))()},exportpro:function(){var e=this;return Object(l["a"])(s.a.mark((function t(){var a,r;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.$baseColorfullLoading(2),t.prev=1,t.next=4,Object(g["ExportParse"])("Product",{});case 4:r=t.sent,a.close(),e.$convertRes2Blob(r),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),a.close(),e.$message.error("".concat(t.t0));case 13:case"end":return t.stop()}}),t,null,[[1,9]])})))()}}},F=x,D=(a("89bd"),a("a559"),a("bdd7")),j=Object(D["a"])(F,r,i,!1,null,"1e2b6026",null);t["default"]=j.exports}}]);