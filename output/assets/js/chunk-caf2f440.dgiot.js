/*!
 *  build: 杭州数蛙科技有限公司 
 *  copyright: dgiot-dashboard 
 *  author: h7ml(h7ml@qq.com) 
 *  time: Mon Nov 15 2021 12:23:21 GMT+0000 (Coordinated Universal Time)
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-caf2f440"],{"0daa":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"rulesengine dgiot-container"},[n("div",{staticClass:"engintable"},[n("div",{staticClass:"engineheader"},[n("el-button",{staticStyle:{float:"right"},attrs:{disabled:e.alarmsRuleId.length>0&&e.engineData.length>0,icon:"el-icon-plus",size:"small",type:"primary"},on:{click:e.addEngine}},[e._v(" "+e._s(e.$translateTitle("developer.add"))+" ")])],1),n("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{"cell-class-name":e.getRowindex,data:e.engineData,height:e.height}},[n("el-table-column",{attrs:{align:"center",label:"ID","show-overflow-tooltip":"",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("span",{on:{click:function(t){return e.detailRules(a.id)}}},[e._v(e._s(a.id))])]}}])}),n("el-table-column",{attrs:{align:"center",label:e.$translateTitle("leftbar.topics"),"show-overflow-tooltip":"",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("span",[e._v(e._s(a.for.join(",")))])]}}])}),n("el-table-column",{attrs:{align:"center",label:"SQL",prop:"rawsql","show-overflow-tooltip":"",width:"200"}}),n("el-table-column",{attrs:{align:"center",label:e.$translateTitle("rule.ResponseAction")},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return e._l(a.actions,(function(t,a){return n("p",{key:a},[e._v(" "+e._s(t.name)+" ")])}))}}])}),n("el-table-column",{attrs:{align:"center",label:e.$translateTitle("product.hit")},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("span",[e._v(e._s(e.matched(a.metrics)))])]}}])}),n("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.state")},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:function(t){return e.changeRule(a.id,a.enabled)}},model:{value:a.enabled,callback:function(t){e.$set(a,"enabled",t)},expression:"row.enabled"}})]}}])}),n("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("developer.operation"),width:"210"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.detailRules(a.id)}}},[e._v(" "+e._s(e.$translateTitle("equipment.see"))+" ")]),n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.editRule(a.id)}}},[e._v(" "+e._s(e.$translateTitle("task.Edit"))+" ")]),n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.deleteRule(a.id)}}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])]}}])})],1),n("div",{staticClass:"block"},[n("el-pagination",{attrs:{layout:"total, sizes, prev, pager, next, jumper","page-size":e.pagesize,"page-sizes":[10,20,30,50],total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)],1)])},l=[],r=n("fb07"),s=n("d0d7"),i=n.n(s),o=(n("f1e1"),n("c4bc"),n("16b8"),n("1c6f"),n("1b07")),c={data:function(){return{height:this.$baseTableHeight(0),engineData:[],pagesize:10,start:0,total:0,productid:this.$route.query.productid||"",ruleType:this.$route.query.type||"",uid:this.$route.query.uuid||"",alarmsRuleId:""}},mounted:function(){this.featchData({})},methods:{featchData:function(e){this.productid&&this.uid&&this.ruleType?(this.alarmsRuleId="rule:".concat(this.ruleType,"_").concat(this.productid,"_").concat(this.uid),this.getalarmsRule(this.alarmsRuleId)):this.orginRule()},getalarmsRule:function(e){var t=this;return Object(r["a"])(i.a.mark((function n(){var a,l;return i.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,Object(o["getRuleDetail"])(e);case 2:a=n.sent,l=[],l.push(a.data),t.engineData=l,t.total=t.engineData.length;case 7:case"end":return n.stop()}}),n)})))()},orginRule:function(){var e=this;Object(o["getRule"])({}).then((function(t){t&&(e.engineData=t.data,e.total=e.engineData.length)})).catch((function(t){e.$message(t.error)}))},handleSizeChange:function(e){},handleCurrentChange:function(e){},addEngine:function(){var e={title:"新增"};this.productid.length&&(e["productid"]=this.productid),this.uid.length&&(e["uid"]=this.uid),this.ruleType.length&&(e["type"]=this.ruleType),this.$router.push({path:"/rules_engine/addengine",query:e})},matched:function(e){for(var t=0,n=0;n<e.length;n++)t+=e[n].matched;return t},changeRule:function(e,t){var n=this;return Object(r["a"])(i.a.mark((function a(){var l;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return l={enabled:t},a.next=3,Object(o["put_rule_id"])(e,l);case 3:a.sent,n.$message("状态修改成功");case 5:case"end":return a.stop()}}),a)})))()},actions:function(e){return e.map((function(e){return e.name})),string.join(",")},getRowindex:function(e,t,n){if(0==e.columnIndex)return"firstcolumn"},detailRules:function(e){this.$router.push({path:"/rules_engine/checkengine",query:{id:e}})},editRule:function(e){this.$router.push({path:"/rules_engine/addengine",query:{id:e,title:"编辑"}})},deleteRule:function(e){var t=this;Object(o["ruleDelete"])(e).then((function(e){e&&(t.$message("删除成功"),t.orginRule())})).catch((function(e){t.$message(e.error)}))}}},d=c,u=(n("1bcd"),n("bdd7")),h=Object(u["a"])(d,a,l,!1,null,"51df1ef6",null);t["default"]=h.exports},"1bcd":function(e,t,n){"use strict";n("ee8c")},"572b":function(e,t,n){},"591a":function(e,t,n){e.exports={"menu-color":"rgba(255,255,255,.95)","menu-color-active":"rgba(255,255,255,.95)","menu-background":"#282c34","column-second-menu-background":"#fff"}},"6877e":function(e,t,n){"use strict";n("f238")},d982:function(e,t,n){"use strict";n("572b")},da86:function(e,t,n){"use strict";n.r(t);var a,l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"resourcechannel"},[n("h3",[e._v("通道管理")]),n("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[n("el-tab-pane",{attrs:{label:"通道管理("+e.total+")",name:"first"}},[n("div",{staticClass:"firsttable"},[n("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.channelformsearch,size:"small"}},[n("el-form-item",[n("el-input",{attrs:{placeholder:e.$translateTitle("resource.name")},model:{value:e.channelformsearch.name,callback:function(t){e.$set(e.channelformsearch,"name",t)},expression:"channelformsearch.name"}})],1),n("el-form-item",[n("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.Get_Re_Channel(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1),n("el-form-item",[n("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addchanneltype.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("developer.selectchannel"))+" ")])],1)],1),n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-class-name":e.getChannelEnable}},[n("el-table-column",{attrs:{label:e.$translateTitle("developer.channelnumber")},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("span",[e._v(e._s(a.objectId))])]}}])}),n("el-table-column",{attrs:{label:e.$translateTitle("developer.channelname")},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("span",[e._v(e._s(a.name))])]}}])}),n("el-table-column",{attrs:{label:e.$translateTitle("developer.channeltype")},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[1==a.type?n("span",[e._v(" "+e._s(e.$translateTitle("developer.collectionchannel"))+" ")]):2==a.type?n("span",[e._v(" "+e._s(e.$translateTitle("developer.resourcechannel"))+" ")]):n("span",[e._v("任务通道")])]}}])}),n("el-table-column",{attrs:{label:e.$translateTitle("developer.servicetype")},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("span",[e._v(e._s(a.cType))])]}}])}),n("el-table-column",{attrs:{label:e.$translateTitle("developer.channelstatus")},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return["ONLINE"==a.status?n("span",{staticStyle:{color:"green"}},[e._v(" 在线 ")]):n("span",{staticStyle:{color:"red"}},[e._v("离线")])]}}])}),n("el-table-column",{attrs:{label:e.$translateTitle("developer.channeladdr"),width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("span",[e._v(e._s("channel/"+a.objectId))])]}}])}),n("el-table-column",{attrs:{label:e.$translateTitle("developer.describe")},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("span",[e._v(e._s(a.desc))])]}}])}),n("el-table-column",{attrs:{label:e.$translateTitle("developer.operation"),width:"350"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("el-button",{attrs:{slot:"reference",size:"mini",type:"primary"},on:{click:function(t){return e.editorChannel(a)}},slot:"reference"},[e._v(" 编辑 ")]),0==a.isEnable?n("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.qyChannel(a,"enable")}}},[e._v(" "+e._s(e.$translateTitle("developer.enable"))+" ")]):n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.qyChannel(a,"disable")}}},[e._v(" "+e._s(e.$translateTitle("developer.prohibit"))+" ")]),n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.updateChannel(a)}}},[e._v(" 详情 ")]),n("el-popover",{ref:"popover-"+a.$index,attrs:{placement:"top",width:"300"}},[n("p",[e._v("确定删除这个"+e._s(a.name)+"通道吗？")]),n("div",{staticStyle:{margin:"0","text-align":"right"}},[n("el-button",{attrs:{size:"mini"},on:{click:function(t){e.scope._self.$refs["popover-"+e.scope.$index].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.deleteChannel(e.scope)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),n("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1),n("el-tooltip",{staticClass:"item",attrs:{content:"请先启用通道",disabled:"OFFLINE"!=a.status,effect:"dark",placement:"top"}},[n("el-button",{staticStyle:{position:"absolute",width:"100px",height:"10px",opacity:"0"},attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.subProTopic(a)}}})],1),n("el-button",{attrs:{disabled:"OFFLINE"==a.status,size:"mini",type:"primary"},on:{click:function(t){return e.subProTopic(a)}}},[e._v(" 订阅日志 ")])]}}])})],1),n("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[n("el-pagination",{attrs:{layout:"total, sizes, prev, pager, next, jumper","page-size":e.length,"page-sizes":[10,20,30,50],total:e.total},on:{"current-change":e.channelCurrentChange,"size-change":e.channelSizeChange}})],1)],1)]),n("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleClose,"close-on-click-modal":!1,title:e.channelupdated+"通道",top:"0",visible:e.channelForm,width:"50%"},on:{"update:visible":function(t){e.channelForm=t}}},[n("el-form",{ref:"addchannel",attrs:{"label-width":"120px",model:e.addchannel,rules:e.addrules}},[n("el-form-item",{attrs:{label:"通道类型",prop:"region"}},[n("el-select",{attrs:{disabled:"",placeholder:"通道类型"},on:{change:e.removeauto},model:{value:e.addchannel.region,callback:function(t){e.$set(e.addchannel,"region",t)},expression:"addchannel.region"}},e._l(e.channelregion,(function(e,t){return n("el-option",{key:t,attrs:{label:e.title.zh,value:e.cType}})})),1),n("el-row",{staticStyle:{width:"100%",height:"500px","overflow-x":"hidden","overflow-y":"scroll","line-height":"30px","text-align":"center"},attrs:{gutter:24}},e._l(e.channelregion,(function(t,a){return n("el-col",{key:a,staticStyle:{margin:"20px 0",cursor:"pointer"},attrs:{span:8}},[n("el-card",{staticClass:"box-card",style:{color:e.addchannel.region==t.cType?"#00bad0":"#c0c4cc"},attrs:{shadow:e.addchannel.region==t.cType?"always":"hover",size:"mini"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v(e._s(t.title.zh))]),n("el-button",{staticStyle:{float:"right"},attrs:{disabled:""!=e.resourceid,size:"mini",type:e.addchannel.region==t.cType?"success":"primary"},on:{click:function(n){return e.setCard(t.cType)}}},[e._v(" "+e._s(e.addchannel.region==t.cType?"已选择":"选择")+" ")])],1),n("div",{staticClass:"text item"},[n("el-row",{attrs:{gutter:24}},[n("el-col",{attrs:{span:12}},[n("img",{staticClass:"image",staticStyle:{width:"50px",height:"50px"},attrs:{src:"https://imgs.iotku.com/2020/2/21/23efecea9bfdbbf8a132089e251fc6e7.png"}})]),n("el-col",{attrs:{span:12}},[n("el-tag",[e._v(e._s(t.cType))])],1)],1)],1)])],1)})),1)],1),n("el-form-item",{attrs:{label:e.$translateTitle("developer.channelname"),prop:"name"}},[n("el-input",{attrs:{autocomplete:"off",placeholder:e.$translateTitle("developer.channelname")},model:{value:e.addchannel.name,callback:function(t){e.$set(e.addchannel,"name",t)},expression:"addchannel.name"}})],1),n("el-form-item",{attrs:{label:"所属应用",rules:[{required:!0,message:"请选择所属应用",trigger:"blur"}]}},[n("el-input",{attrs:{placeholder:"请选择所属应用"},model:{value:e.addchannel.applicationtText,callback:function(t){e.$set(e.addchannel,"applicationtText",t)},expression:"addchannel.applicationtText"}},[n("template",{slot:"append"},[n("i",{class:[e.showTree?"el-icon-arrow-up":"el-icon-arrow-down"],staticStyle:{cursor:"pointer"},on:{click:function(t){e.showTree=!e.showTree}}})])],2),e.showTree?n("div",[n("el-tree",{attrs:{data:e.allApps,props:e.defaultProps},on:{"node-click":e.handleNodeClick}})],1):e._e()],1),e._l(e.arrlist,(function(t,a){return n("el-col",{key:a,attrs:{span:12}},[n("el-form-item",{attrs:{label:t.title.zh,prop:t.showname,required:t.required}},["string"==t.type?n("el-input",{model:{value:e.addchannel[t.showname],callback:function(n){e.$set(e.addchannel,t.showname,n)},expression:"addchannel[item.showname]"}}):"integer"==t.type?n("el-input",{model:{value:e.addchannel[t.showname],callback:function(n){e.$set(e.addchannel,t.showname,e._n(n))},expression:"addchannel[item.showname]"}}):"boolean"==t.type?n("el-select",{staticClass:"notauto",attrs:{readonly:""},model:{value:e.addchannel[t.showname],callback:function(n){e.$set(e.addchannel,t.showname,n)},expression:"addchannel[item.showname]"}},[n("el-option",{attrs:{label:"是",value:!0}}),n("el-option",{attrs:{label:"否",value:!1}})],1):e._e()],1)],1)})),n("el-form-item",{attrs:{label:e.$translateTitle("developer.describe")}},[n("el-input",{attrs:{autocomplete:"off",placeholder:e.$translateTitle("developer.describe"),rows:3,type:"textarea"},on:{change:e.inputChange},model:{value:e.addchannel.desc,callback:function(t){e.$set(e.addchannel,"desc",t)},expression:"addchannel.desc"}})],1)],2),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.handleClose}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),n("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addchannelForm("addchannel")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)],1),n("el-dialog",{attrs:{"append-to-body":!0,title:"通道详情",visible:e.dialogVisible,width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("div",[n("el-row",[n("el-col",{attrs:{span:12}},[e._v("ID:")]),n("el-col",{attrs:{span:12}},[e._v(" "+e._s(e.resourceid)+" ")])],1),n("el-row",[n("el-col",{attrs:{span:12}},[e._v("Resource Type:")]),n("el-col",{attrs:{span:12}},[e._v(" "+e._s(e.resoucetype)+" ")])],1),n("el-row",[n("el-col",{attrs:{span:12}},[e._v("Description:")]),n("el-col",{attrs:{span:12}},[e._v(" "+e._s(e.description)+" ")])],1),e._l(e.detailchannel,(function(t,a){return n("el-row",{key:t},[n("el-col",{attrs:{span:12}},[e._v(" "+e._s(a)+" ")]),n("el-col",{attrs:{span:12}},[e._v(" "+e._s(t)+" ")])],1)}))],2),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){e.dialogVisible=!1}}},[e._v(" 确 定 ")])],1)]),n("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleCloseSubdialog,title:e.channelname+"日志",visible:e.subdialog,width:"85%"},on:{"update:visible":function(t){e.subdialog=t}}},[n("div",{staticStyle:{"margin-top":"20px"}},[n("pre",{staticClass:"ace_editor",staticStyle:{width:"100%","min-height":"300px"},attrs:{id:"subdialog"}},[e._v("                    "),n("textarea",{staticClass:"ace_text-input",staticStyle:{overflow:"scroll"}}),e._v("        ")])]),n("span",{staticClass:"dialog-footer",staticStyle:{height:"30px"},attrs:{slot:"footer"},slot:"footer"},[n("el-switch",{staticStyle:{display:"inline-block","margin-right":"10px"},attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","inactive-text":"自动刷新"},on:{change:e.stopsub},model:{value:e.value4,callback:function(t){e.value4=t},expression:"value4"}})],1)])],1)],1)},r=[],s=n("fb07"),i=n("e97b"),o=n("d0d7"),c=n.n(o),d=(n("1d17"),n("37c6"),n("16b8"),n("c4bc"),n("80ab"),n("a98c"),n("fc3d"),n("e472"),n("1ec3"),n("9f39"),n("4656"),n("04d6"),n("89e8")),u=n("5880"),h=n("bb22"),p=n("5da95"),g=n("1b07"),f=n("926a"),m=n("c620"),b={inject:["reload"],data:function(){return{dialogVisible:!1,isopen:"suo",pwdType:"password",tableData:[],channelForm:!1,channelupdated:"新增",activeName:"first",channelId:"",channelformsearch:{name:""},channelregion:[],addchannel:{region:"",desc:"",applicationtText:""},applicationList:[],addrules:{roles:[{required:!0,message:"请选择所属应用",trigger:"blur"}],name:[{required:!0,message:"请输入通道名称",trigger:"blur"}],region:[{required:!0,message:"请选择服务类型",trigger:"change"}]},length:10,start:0,total:0,selectregion:{},resourceid:"",resoucetype:"",description:"",detailchannel:"",subdialog:!1,value4:"",subdialogid:"",subdialogtimer:null,channelname:"",arrlist:[],channelrow:[],showTree:!1,allApps:[],defaultProps:{children:"children",label:"label"}}},computed:Object(i["a"])({},Object(u["mapGetters"])({roleTree:"user/roleTree"})),mounted:function(){this.Get_Re_Channel(0),this.dialogType(),this.getApplication()},methods:{setCard:function(e){this.removeauto(e)},inputChange:function(e){},validUrl:function(e,t,n){var a=/^[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/;a.test(t)?n():n(new Error("需要输入正确的url"))},validPort:function(e,t,n){var a=/^([0-9]|[1-9]\d|[1-9]\d{2}|[1-9]\d{3}|[1-5]\d{4}|6[0-4]\d{3}|65[0-4]\d{2}|655[0-2]\d|6553[0-5])$/;a.test(t)?n():n(new Error("需要输入正确的端口号"))},Get_Re_Channel:function(e){var t=this;0==e&&(this.start=0);var n={count:"objectId",order:"-createdAt",limit:this.length,skip:this.start,where:{}};""!=this.channelformsearch.name&&(n.where.name=this.channelformsearch.name),this.$query_object("Channel",n).then((function(e){e&&(t.total=e.count,t.tableData=e.results)})).catch((function(e){"209"==e.code?(t.$message({type:"warning",message:"登陆权限过期，请重新登录"}),t.$router.push({path:"/login"})):119==e.code&&t.$message({type:"error",message:"没有操作权限"})}))},getApplication:function(){var e=this;return Object(s["a"])(c.a.mark((function t(){var n,a,l;return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={limit:100},t.next=3,Object(p["queryRole"])(n);case 3:a=t.sent,l=a.results,l.map((function(t){var n={};n.id=t.id,n.name=t.desc,e.applicationList.push(n)}));case 6:case"end":return t.stop()}}),t)})))()},handleNodeClick:function(e){this.showTree=!this.showTree,this.addchannel.applicationtText=e.name},dialogType:function(){var e=this;return Object(s["a"])(c.a.mark((function t(){var n;return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.allApps=e.roleTree,t.next=3,Object(g["resourceTypes"])();case 3:n=t.sent,e.channelregion=n;case 5:case"end":return t.stop()}}),t)})))()},qyChannel:function(e,t){var n=this;Object(h["subupadte"])(e.objectId,t).then((function(e){e&&n.$message({type:"success",message:"".concat("enable"==t?"启用成功":"禁用成功")}),n.Get_Re_Channel(0)})).catch((function(e){n.$message(e.error)}))},updateChannel:function(e){this.dialogVisible=!0,this.resourceid=e.objectId,this.detailchannel=e.config,this.resoucetype=e.cType,this.description=e.desc},addchannelForm:function(e){var t=this;this.$refs[e].validate((function(e){if(e){var n={};for(var a in t.addchannel)n[a]=t.addchannel[a];delete n.region,delete n.desc,delete n.type,delete n.isEnable,delete n.name;var l="role:"+t.addchannel.applicationtText,r={};r[l]={read:!0,write:!0};var s={ACL:r,config:n,name:t.addchannel.name,cType:t.addchannel.region,desc:t.addchannel.desc};t.addchannelaxios(s)}}),(function(e){Object(f["returnLogin"])(e)}))},addchannelaxios:function(e){var t=this;return Object(s["a"])(c.a.mark((function n(){return c.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,Object(d["postChannel"])(e).then((function(e){e&&(t.$message({type:"success",message:"编辑"==t.channelupdated?"编辑成功":"创建成功"}),t.$refs["addchannel"].resetFields(),t.addchannel={},t.channelForm=!1,t.resourceid="",t.Get_Re_Channel(0))}));case 2:case"end":return n.stop()}}),n)})))()},deleteChannel:function(e){var t=this;Object(d["delChannel"])(row.objectId).then((function(n){t.$message({type:"success",message:"删除成功"}),e._self.$refs["popover-".concat(e.$index)].doClose(),t.Get_Re_Channel(0)})).catch((function(e){}))},addchanneltype:function(){this.channelForm=!0,this.channelupdated="新增"},handleClose:function(){this.addchannel={},this.channelForm=!1,this.$refs["addchannel"].resetFields(),this.resourceid=""},getChannelEnable:function(e,t){return 1==e.row.isEnable?"green_active":"red_active"},channelSizeChange:function(e){this.length=e,this.Get_Re_Channel()},channelCurrentChange:function(e){this.start=(e-1)*this.length,this.Get_Re_Channel()},arrSort:function(e,t){var n=e.order,a=t.order;return n<a?-1:n>a?1:0},orderObject:function(e){var t=[];for(var n in e)e[n].showname=n,t.push(e[n]);return t.sort(this.arrSort)},removeauto:function(e){var t=this,n={},a={name:[{required:!0,message:"请输入通道名称",trigger:"blur"}],region:[{required:!0,message:"请选择服务类型",trigger:"change"}]};if(""==this.resourceid?this.channelregion.map((function(l){l.cType==e&&(t.selectregion=l,t.arrlist=t.orderObject(t.selectregion.params),t.arrlist.map((function(e){e.default?n[e.showname]=e.default:n[e.showname]="",e.required&&("string"==e.type||"integer"==e.type?a[e.showname]=[{required:!0,trigger:"blur"}]:a[e.showname]=[{required:!0,trigger:"change"}])})),n.region=e,n.desc="",n.name="",n.type=t.selectregion.type,n.isEnable=!1)})):this.channelregion.map((function(l){l.cType==e&&(t.selectregion=l,t.arrlist=t.orderObject(t.selectregion.params),t.arrlist.map((function(l){for(var r in t.channelrow.config)l.showname==r&&(n[l.showname]=t.channelrow.config[r]),l.required&&("string"==l.type||"integer"==l.type?a[l.showname]=[{required:!0,trigger:"blur"}]:a[l.showname]=[{required:!0,trigger:"change"}]),n.region=e,n.desc=t.channelrow.desc,n.name=t.channelrow.name,n.type=t.selectregion.type,n.isEnable=t.channelrow.isEnable})))})),this.channelrow.length>0)for(var l in this.channelrow.ACL.permissionsById)n.applicationtText=l?l.substr(5):"";this.addchannel=n,this.addchannel.region=e,this.addrules=a},editorChannel:function(e){this.channelrow=e,this.resourceid=e.objectId,this.channelForm=!0,this.channelupdated="编辑",this.removeauto(e.cType)},nowtime:function(){var e=Date.parse(new Date),t=new Date(e),n=(t.getFullYear(),t.getMonth()+1<=10?t.getMonth():t.getMonth(),t.getDate()+1<=10?t.getDate():t.getDate(),(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":"),a=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",l=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return n+a+l+" "},subProTopic:function(e){this.subdialog=!0,this.subdialogid=e.objectId,this.channelname=e.objectId,setTimeout((function(){a=ace.edit("subdialog"),a.session.setMode("ace/mode/text"),a.setTheme("ace/theme/gob"),a.setReadOnly(!0),a.setOptions({enableBasicAutocompletion:!1,enableSnippets:!0,enableLiveAutocompletion:!0})}));var t={topic:"log/channel/"+e.objectId,qos:2},n=new RegExp("log/channel/"+e.objectId),l="",r=this;m["Websocket"].add_hook(n,(function(e){a.session.getLength()>=1e3?l="":l+=r.nowtime()+e+"\n",a.setValue(l),a.gotoLine(a.session.getLength())}));var s=JSON.stringify({action:"start_logger"});m["Websocket"].subscribe(t,(function(t){if(t.result){var n={topic:"channel/"+e.objectId,text:s,retained:!0,qos:2};m["Websocket"].sendMessage(n),r.subdialogtimer=window.setInterval((function(){m["Websocket"].sendMessage(n)}),6e5)}}))},stopsub:function(e){var t;t=0==e?JSON.stringify({action:"stop_logger"}):JSON.stringify({action:"start_logger"});var n={topic:"channel/"+this.subdialogid,text:t,retained:!0,qos:2};m["Websocket"].sendMessage(n)},handleCloseSubdialog:function(){var e=JSON.stringify({action:"stop_logger"}),t={topic:"channel/"+this.subdialogid,text:e,retained:!0,qos:2};m["Websocket"].sendMessage(t),this.subdialog=!1,window.clearInterval(this.subdialogtimer),this.subdialogtimer=null}}},v=b,w=(n("6877e"),n("bdd7")),y=Object(w["a"])(v,l,r,!1,null,"17c6ec8c",null);t["default"]=y.exports},edc4:function(e,t,n){"use strict";n("591a")},ee8c:function(e,t,n){},f238:function(e,t,n){},fcbb:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"resourcechannel resourcechannel-container"},[n("vab-input",{ref:"uploadFinish",on:{fileInfo:e.fileInfo}}),n("div",{staticClass:"firsttable"},[n("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.channelformsearch,size:"small"}},[n("el-form-item",[n("el-input",{attrs:{placeholder:e.$translateTitle("resource.name")},model:{value:e.channelformsearch.name,callback:function(t){e.$set(e.channelformsearch,"name",t)},expression:"channelformsearch.name"}})],1),n("el-form-item",[n("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.Get_Re_Channel(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1),n("el-form-item",[n("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addchanneltype.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("developer.selectchannel"))+" ")])],1)],1),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableRef",staticStyle:{width:"100%"},attrs:{"cell-style":{"text-align":"center"},data:e.tableData,"header-cell-style":{"text-align":"center"},height:e.height,"row-class-name":e.getChannelEnable,"row-key":"objectId"}},[n("el-table-column",{attrs:{label:e.$translateTitle("developer.channelnumber"),prop:"objectId","show-overflow-tooltip":"",sortable:"",width:"150"}}),n("el-table-column",{attrs:{label:e.$translateTitle("developer.channelname"),prop:"name","show-overflow-tooltip":"",sortable:"",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("span",[e._v(e._s(a.name))])]}}])}),n("el-table-column",{attrs:{label:e.$translateTitle("developer.channeltype"),prop:"type","show-overflow-tooltip":"",sortable:"",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[1==a.type?n("span",[e._v(" "+e._s(e.$translateTitle("developer.collectionchannel"))+" ")]):2==a.type?n("span",[e._v(" "+e._s(e.$translateTitle("developer.resourcechannel"))+" ")]):n("span",[e._v(" "+e._s(e.$translateTitle("developer.missionchannel"))+" ")])]}}])}),n("el-table-column",{attrs:{label:e.$translateTitle("websocket.port"),prop:"cType","show-overflow-tooltip":"",sortable:"",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("span",[e._v(e._s(a.config.port))])]}}])}),n("el-table-column",{attrs:{label:e.$translateTitle("developer.servicetype"),prop:"cType","show-overflow-tooltip":"",sortable:"",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("span",[e._v(e._s(a.cType))])]}}])}),n("el-table-column",{attrs:{label:e.$translateTitle("developer.channelstatus"),prop:"status","show-overflow-tooltip":"",sortable:"",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return["ONLINE"==a.status?n("span",{staticStyle:{color:"green"}},[e._v(" "+e._s(e.$translateTitle("product.online"))+" ")]):n("span",{staticStyle:{color:"red"}},[e._v(" "+e._s(e.$translateTitle("product.offline"))+" ")])]}}])}),n("el-table-column",{attrs:{label:e.$translateTitle("developer.enable")+"/"+e.$translateTitle("developer.disable"),prop:"isEnable","show-overflow-tooltip":"",sortable:"",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("el-tooltip",{attrs:{content:a.isEnable?e.$translateTitle("developer.enable"):e.$translateTitle("developer.disable"),placement:"top"}},[n("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:function(t){return e.switchEnable(a.objectId,a.isEnable)}},model:{value:a.isEnable,callback:function(t){e.$set(a,"isEnable",t)},expression:"row.isEnable"}})],1)]}}])}),n("el-table-column",{attrs:{label:e.$translateTitle("developer.describe"),prop:"desc","show-overflow-tooltip":"",sortable:""}}),n("el-table-column",{attrs:{fixed:"right",label:e.$translateTitle("developer.operation"),width:"240"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("el-button",{attrs:{disabled:"OFFLINE"==a.status,size:"mini",title:"ONLINE"==a.status?"":"请先启用通道",type:"success"},on:{click:function(t){return e.subProTopic(a)}}},[e._v(" "+e._s(e.$translateTitle("product.log"))+" ")]),n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.editorChannel(a)}}},[e._v(" "+e._s(e.$translateTitle("task.Edit"))+" ")]),n("el-popover",{ref:"popover-"+a.$index,staticStyle:{"margin-left":"10px"},attrs:{placement:"top",width:"300"}},[n("p",[e._v(" "+e._s(e.$translateTitle("product.qdsczg"))+e._s(a.name)+e._s(e.$translateTitle("equipment.channel"))+" ")]),n("div",[n("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){a._self.$refs["popover-"+a.$index].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),n("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.deleteChannel(a)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),n("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)]}}])})],1),n("div",{staticClass:"elpagination"},[n("el-pagination",{key:e.length+"key"+e.total,attrs:{layout:"total, sizes, prev, pager, next, jumper","page-size":e.length,"page-sizes":[5,10,20,30,50],total:e.total},on:{"current-change":e.channelCurrentChange,"size-change":e.channelSizeChange}})],1)],1),n("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleClose,title:e.channelupdated+"通道",top:"10vh",visible:e.channelForm,width:"50%"},on:{"update:visible":function(t){e.channelForm=t}}},[n("el-form",{ref:"addchannel",attrs:{"label-width":"auto",model:e.addchannel,rules:e.addrules}},[n("el-form-item",{attrs:{label:e.$translateTitle("developer.channeltype"),prop:"region"}},[n("el-select",{attrs:{disabled:"",placeholder:e.$translateTitle("developer.channeltype")},on:{change:e.removeauto},model:{value:e.addchannel.region,callback:function(t){e.$set(e.addchannel,"region",t)},expression:"addchannel.region"}},e._l(e.channelregion,(function(e,t){return n("el-option",{key:t,attrs:{label:e.title.zh,value:e.cType}})})),1),n("el-row",{staticStyle:{width:"100%","min-height":"0","max-height":"100px","margin-top":"20px","text-align":"center"},attrs:{gutter:24}},e._l(e.channelregion,(function(t,a){return n("el-col",{key:a,staticStyle:{cursor:"pointer"},attrs:{span:24}},[t.params.ico&&t.params.ico.default?n("el-card",{directives:[{name:"show",rawName:"v-show",value:e.addchannel.region==t.cType,expression:"addchannel.region == item.cType"}],staticClass:"box-card",style:{display:e.addchannel.region==t.cType?"block":"none",color:e.addchannel.region==t.cType?"#00bad0":"#c0c4cc"},attrs:{shadow:e.addchannel.region==t.cType?"always":"hover",size:"mini"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v(e._s(t.title.zh))]),n("el-button",{staticStyle:{float:"right"},attrs:{disabled:""!=e.resourceid,size:"mini",type:"success"},on:{click:function(n){return e.setCard(t.cType)}}},[e._v(" "+e._s(e.$translateTitle("product.selected"))+" ")])],1),n("div",{staticClass:"text item"},[n("el-row",{attrs:{gutter:24}},[n("el-col",{attrs:{span:12}},[n("img",{staticClass:"image",staticStyle:{width:"50px",height:"50px"},attrs:{src:t.params.ico.default?t.params.ico.default:""}})]),n("el-col",{attrs:{span:12}},[n("el-tag",[e._v(e._s(t.cType))])],1)],1)],1)]):e._e()],1)})),1)],1),n("el-form-item",{attrs:{label:e.$translateTitle("developer.channelname"),prop:"name"}},[n("el-input",{attrs:{autocomplete:"off",placeholder:e.$translateTitle("developer.channelname")},model:{value:e.addchannel.name,callback:function(t){e.$set(e.addchannel,"name",t)},expression:"addchannel.name"}})],1),n("el-form-item",{attrs:{label:e.$translateTitle("application.applicationtype"),prop:"applicationtText"}},[n("el-input",{attrs:{placeholder:e.$translateTitle("product.pleaseselectyourapp"),readonly:""},on:{focus:function(t){e.showTree=!e.showTree}},model:{value:e.addchannel.applicationtText,callback:function(t){e.$set(e.addchannel,"applicationtText",t)},expression:"addchannel.applicationtText"}}),e.showTree?n("div",[n("el-tree",{attrs:{data:e.allApps,props:e.defaultProps},on:{"node-click":e.handleNodeClick}})],1):e._e()],1),e._l(e.arrlist,(function(t,a){return n("el-col",{key:a,attrs:{span:12}},[n("el-form-item",{attrs:{label:t.title.zh,prop:t.showname,required:t.required}},[n("el-tooltip",{attrs:{effect:"dark",placement:"right-start"}},[n("div",{attrs:{slot:"content"},slot:"content"},[e._v(" "+e._s(t.description.zh)+" ")]),n("i",{staticClass:"el-icon-question",staticStyle:{float:"left"}})]),"string"==t.type?n("el-input",{directives:[{name:"show",rawName:"v-show",value:"通道ICO"!==t.title.zh,expression:"item.title.zh !== '通道ICO'"}],staticStyle:{width:"96%"},model:{value:e.addchannel[t.showname],callback:function(n){e.$set(e.addchannel,t.showname,n)},expression:"addchannel[item.showname]"}}):e._e(),"通道ICO"==t.title.zh?n("el-input",{directives:[{name:"show",rawName:"v-show",value:"通道ICO"==t.title.zh,expression:"item.title.zh == '通道ICO'"}],staticStyle:{width:"96%"},model:{value:e.addchannel[t.showname],callback:function(n){e.$set(e.addchannel,t.showname,e._n(n))},expression:"addchannel[item.showname]"}},[n("el-button",{attrs:{slot:"append",icon:"el-icon-upload"},on:{click:function(n){return e.uploadCkick(e.addchannel[t.showname],a,"arrlist")}},slot:"append"})],1):"integer"==t.type?n("el-input",{staticStyle:{width:"96%"},model:{value:e.addchannel[t.showname],callback:function(n){e.$set(e.addchannel,t.showname,e._n(n))},expression:"addchannel[item.showname]"}}):"boolean"==t.type?n("el-select",{staticClass:"notauto",staticStyle:{width:"96%"},model:{value:e.addchannel[t.showname],callback:function(n){e.$set(e.addchannel,t.showname,n)},expression:"addchannel[item.showname]"}},[n("el-option",{attrs:{label:e.$translateTitle("product.yes"),value:!0}}),n("el-option",{attrs:{label:e.$translateTitle("product.no"),value:!1}})],1):"enum"==t.type?n("el-select",{staticClass:"notauto",staticStyle:{width:"96%"},model:{value:e.addchannel[t.showname],callback:function(n){e.$set(e.addchannel,t.showname,n)},expression:"addchannel[item.showname]"}},e._l(t.enum,(function(e,a){return n("el-option",{key:a,attrs:{label:t.enum[a],value:t.enum[a]}})})),1):e._e()],1)],1)})),n("div",{staticClass:"row-bg"},[n("el-form-item",{attrs:{label:e.$translateTitle("developer.describe")}},[n("el-input",{attrs:{autocomplete:"off",placeholder:e.$translateTitle("developer.describe"),rows:3,type:"textarea"},on:{change:e.inputChange},model:{value:e.addchannel.desc,callback:function(t){e.$set(e.addchannel,"desc",t)},expression:"addchannel.desc"}})],1)],1)],2),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{staticStyle:{"margin-right":"20px"},on:{click:e.handleClose}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),n("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addchannelForm("addchannel")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)],1),n("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("equipment.channeldetails"),visible:e.dialogVisible,width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("div",[n("el-row",[n("el-col",{attrs:{span:12}},[e._v("ID:")]),n("el-col",{attrs:{span:12}},[e._v(" "+e._s(e.resourceid)+" ")])],1),n("el-row",[n("el-col",{attrs:{span:12}},[e._v("Resource Type:")]),n("el-col",{attrs:{span:12}},[e._v(" "+e._s(e.resoucetype)+" ")])],1),n("el-row",[n("el-col",{attrs:{span:12}},[e._v("Description:")]),n("el-col",{attrs:{span:12}},[e._v(" "+e._s(e.description)+" ")])],1),e._l(e.detailchannel,(function(t,a){return n("el-row",{key:t},[n("el-col",{attrs:{span:12}},[e._v(" "+e._s(a)+" ")]),n("el-col",{attrs:{span:12}},[e._v(" "+e._s(t)+" ")])],1)}))],2),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){e.dialogVisible=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)]),n("a-drawer",{attrs:{"append-to-body":!0,placement:"right",title:e.channelname+"日志",visible:e.subdialog,width:"80%"},on:{close:function(t){return e.handleCloseSubdialog(e.pubtopic)}}},[n("mqtt-log",{attrs:{"channel-id":e.channelname,list:e.msgList,msg:e.submessage,product:e.channelInfo,"refresh-key":e.refreshFlag}})],1),n("el-dialog",{attrs:{"custom-class":"dgiot_dialog","show-close":!1,visible:e.channelDialog,width:"50%"},on:{"update:visible":function(t){e.channelDialog=t}}},[n("vab-query-form",[n("vab-query-form-left-panel",{attrs:{span:12}},[n("el-button",{attrs:{disabled:!e.selectedData.length,type:"danger"},on:{click:function(t){return e.handleDelete(e.channelInfo)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.batch deletion"))+" ")])],1)],1),n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.channelInfo,height:"60vh",stripe:""},on:{"selection-change":e.handleSelectionChange}},[n("el-table-column",{attrs:{align:"center",type:"index"}}),n("el-table-column",{attrs:{type:"selection",width:"50"}}),n("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.channelname"),prop:"name","show-overflow-tooltip":"",sortable:""}}),n("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.servicetype"),prop:"devType","show-overflow-tooltip":"",sortable:""}}),n("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.describe"),prop:"desc","show-overflow-tooltip":"",sortable:""}}),n("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.operation"),prop:"objectId","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.deleteRelation(e.channelInfo,a.objectId)}}},[e._v(" "+e._s(e.$translateTitle("developer.remove"))+" ")])]}}])})],1),n("el-pagination",{attrs:{"current-page":e.pagination.currentPage,layout:e.pagination.layout,"page-size":e.pagination.size,"page-sizes":e.pagination.sizes,total:e.pagination.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)],1)},l=[],r=n("fb07"),s=n("e97b"),i=n("d0d7"),o=n.n(i),c=(n("3dec"),n("9c6a"),n("e170"),n("79da"),n("16b8"),n("4656"),n("1d17"),n("37c6"),n("c4bc"),n("80ab"),n("a98c"),n("fc3d"),n("04d6"),n("4c87"),n("0e9a")),d=n("89e8"),u=n("7212"),h=n("5da95"),p=n("bb22"),g=n("1b07"),f=n("5880"),m=n("67aa"),b=n.n(m),v=n("ca61"),w=Object(s["a"])(Object(s["a"])({components:Object(s["a"])({VabInput:v["default"]},Object(c["requireModule"])(n("d92d"))),data:function(){return{selectedData:[],pagination:{currentPage:4,sizes:[10,20,30,50,100],size:10,layout:"total, sizes, prev, pager, next, jumper",total:0,pageNo:1,pageSize:20,searchDate:[],limit:10,skip:0,order:"-createdAt",keys:"count(*)"},channelid:"",channelInfo:[],channelDialog:!1,router:"",topotopic:"",refreshFlag:"99",msgList:[],submessage:"",subtopic:"",pubtopic:"",channeindex:0,channeType:"",listLoading:!1,dialogVisible:!1,isopen:"suo",pwdType:"password",tableData:[],channelForm:!1,channelupdated:"新增",activeName:"first",channelformsearch:{name:""},height:this.$baseTableHeight(0),channelregion:[],addchannel:{region:"",desc:"",applicationtText:""},applicationList:[],addrules:{applicationtText:[{required:!0,message:"请选择所属应用",trigger:"change"}],roles:[{required:!0,message:"请选择所属应用",trigger:"blur"}],name:[{required:!0,message:"请输入通道名称",trigger:"blur"}],region:[{required:!0,message:"请选择服务类型",trigger:"change"}]},length:10,start:0,total:0,selectregion:{},resourceid:"",resoucetype:"",description:"",detailchannel:"",subdialog:!1,value4:"",subdialogid:"",subdialogtimer:null,channelname:"",arrlist:[],channelId:"",channelrow:[],showTree:!1,topicKey:"",allApps:[],defaultProps:{children:"children",label:"label"}}}},Object(f["mapGetters"])({roleTree:"user/roleTree"})),{},{watch:{topicKey:{handler:function(e,t){var n=this,a=this;e&&(this.$dgiotBus.$off(e),this.$dgiotBus.$on(e,(function(e){var t=e.payload;n.mqttMsg(t)}))),t&&(a.submessage="",a.msgList=[],a.logKey="99")},deep:!0,limit:!0}},mounted:function(){this.router=this.$dgiotBus.router(this.$route.fullPath),this.Get_Re_Channel(0),this.dialogType(),this.getApplication()},methods:{handleSelectionChange:function(e){this.selectedData=e},handleDelete:function(e){var t=this;this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,Object(r["a"])(o.a.mark((function n(){var a;return o.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:a=t.selectedData,a&&a.forEach((function(t,n){e.forEach((function(n,a){t===n&&e.splice(a,1)}))}));case 2:case"end":return n.stop()}}),n)}))))},deleteRelation:function(e,t){var n=this;return Object(r["a"])(o.a.mark((function e(){var a,l;return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,a={product:{__op:"RemoveRelation",objects:[{__type:"Pointer",className:"Product",objectId:t}]}},l=n.$baseColorfullLoading(),e.next=5,Object(d["saveChanne"])(n.channelid,a);case 5:e.sent,n.$baseMessage(n.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),l.close(),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](0),n.$baseMessage(n.$translateTitle("alert.Data request error")+"".concat(e.t0),"error","vab-hey-message-error");case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))()},handleSizeChange:function(){return Object(r["a"])(o.a.mark((function e(){return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},handleCurrentChange:function(){return Object(r["a"])(o.a.mark((function e(){return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},productinformation:function(e){var t=this;return Object(r["a"])(o.a.mark((function n(){var a,l,r,s,i,c,d;return o.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.channelid=e,a=t.$baseLoading(3),n.prev=2,l={limit:t.pagination.limit,order:t.pagination.order,skip:t.pagination.skip,keys:t.pagination.keys,where:{$relatedTo:{object:{__type:"Pointer",className:"Channel",objectId:e},key:"product"}}},n.next=6,Object(u["queryProduct"])(l);case 6:r=n.sent,s=r.results,i=void 0===s?[]:s,c=r.count,d=void 0===c?0:c,a.close(),t.pagination.total=d,t.channelInfo=i,n.next=20;break;case 16:n.prev=16,n.t0=n["catch"](2),a.close(),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(n.t0),"error","vab-hey-message-error");case 20:case"end":return n.stop()}}),n,null,[[2,16]])})))()},uploadCkick:function(e,t,n){this.channeindex=t,this.channeType=n,this.$refs["uploadFinish"].$refs.uploader.dispatchEvent(new MouseEvent("click"))},fileInfo:function(e){"arrlist"==this.channeType?this.arrlist[this.channeindex].default=e.url:this.channelregion[this.channeindex].params.ico.default=e.url},addchannelForm:function(e){var t=this;this.resourceid?this.editChannel(this.resourceid,e):this.$refs[e].validate((function(e){if(e&&t.addchannel.applicationtText){var n={};for(var a in t.addchannel)n[a]=t.addchannel[a];delete n.region,delete n.desc,delete n.type,delete n.isEnable,delete n.name;var l="role:"+t.addchannel.applicationtText,r={};r[l]={read:!0,write:!0};var s={ACL:r,config:n,name:t.addchannel.name,cType:t.addchannel.region,desc:t.addchannel.desc,isEnable:!1,status:"OFFLINE",type:t.addchannel.type.toString()};t.addchannelaxios(s)}else t.$message("有必填项未填")}))},addchannelaxios:function(e){var t=this;return Object(r["a"])(o.a.mark((function n(){return o.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,Object(d["postChannel"])(e).then((function(e){e&&(t.$message({type:"success",message:"编辑"==t.channelupdated?"编辑成功":"创建成功"}),t.$refs["addchannel"].resetFields(),t.addchannel={},t.channelForm=!1,t.resourceid="")}));case 2:case"end":return n.stop()}}),n)})))()},handleNodeClick:function(e){this.showTree=!this.showTree,this.$set(this.addchannel,"applicationtText",e.name)},inputChange:function(e){},validUrl:function(e,t,n){var a=/^[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/;a.test(t)?n():n(new Error("需要输入正确的url"))},validPort:function(e,t,n){var a=/^([0-9]|[1-9]\d|[1-9]\d{2}|[1-9]\d{3}|[1-5]\d{4}|6[0-4]\d{3}|65[0-4]\d{2}|655[0-2]\d|6553[0-5])$/;a.test(t)?n():n(new Error("需要输入正确的端口号"))},Get_Re_Channel:function(){var e=arguments,t=this;return Object(r["a"])(o.a.mark((function n(){var a,l,r,s,i;return o.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=e.length>0&&void 0!==e[0]?e[0]:0,t.listLoading=!0,t.tableData=[],0==a&&(t.start=0),l={count:"objectId",skip:t.start,limit:t.length,order:"-createdAt",keys:"count(*)",where:{name:t.channelformsearch.name.length?{$regex:t.channelformsearch.name}:{$ne:null}}},n.next=7,Object(d["queryChannel"])(l);case 7:r=n.sent,s=r.count,i=r.results,t.total=s,t.tableData=i,t.listLoading=!1;case 13:case"end":return n.stop()}}),n)})))()},getApplication:function(){var e=this;return Object(r["a"])(o.a.mark((function t(){var n,a,l;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={limit:100},t.next=3,Object(h["queryRole"])(n);case 3:a=t.sent,l=a.results,l.map((function(t){var n={};n.id=t.id,n.name=t.desc,e.applicationList.push(n)}));case 6:case"end":return t.stop()}}),t)})))()},dialogType:function(){var e=this;return Object(r["a"])(o.a.mark((function t(){var n;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.allApps=e.roleTree,t.next=3,Object(g["resourceTypes"])();case 3:n=t.sent,n.forEach((function(e){e.params.ico||(e.params.ico={title:{en:"channel ICO",zh:"通道ICO"},description:{en:"channel ICO",zh:"通道ICO"},default:b.a})})),e.channelregion=n;case 6:case"end":return t.stop()}}),t)})))()},switchEnable:function(e,t){var n=this;return Object(r["a"])(o.a.mark((function a(){var l,r;return o.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t=t?"enable":"disable",a.prev=1,a.next=4,Object(p["subupadte"])(e,t);case 4:l=a.sent,r=l.updatedAt,r&&(n.$message.success(n.$translateTitle("developer.".concat(t))+""+n.$translateTitle("node.success")),n.Get_Re_Channel(n.start)),a.next=12;break;case 9:a.prev=9,a.t0=a["catch"](1),n.$message.error("".concat(a.t0));case 12:case"end":return a.stop()}}),a,null,[[1,9]])})))()},updateChannel:function(e){this.dialogVisible=!0,this.resourceid=e.objectId,this.detailchannel=e.config,this.resoucetype=e.cType,this.description=e.desc},editChannel:function(e,t){var n=this;return Object(r["a"])(o.a.mark((function t(){var a,l,r,s;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(l in a={},n.addchannel)a[l]=n.addchannel[l];return delete a.region,delete a.desc,delete a.type,delete a.isEnable,delete a.name,r={config:a,name:n.addchannel.name,cType:n.addchannel.region,desc:n.addchannel.desc},t.next=10,Object(d["putChannel"])(e,r);case 10:s=t.sent,s.updatedAt&&(n.$message({type:"success",message:"编辑成功"}),n.$refs["addchannel"].resetFields(),n.addchannel={},n.channelForm=!1,n.resourceid="",n.Get_Re_Channel(n.start));case 12:case"end":return t.stop()}}),t)})))()},deleteChannel:function(e){this.delchannelaxios(e)},delchannelaxios:function(e){var t=this;Object(d["delChannel"])(e.objectId).then((function(n){t.$message({type:"success",message:"删除成功"}),e._self.$refs["popover-".concat(e.$index)].doClose(),t.Get_Re_Channel(t.start)})).catch((function(e){}))},addchanneltype:function(){this.$router.push({path:"/CreateResourcechannel",query:{type:"create"}})},handleClose:function(){this.addchannel={},this.channelForm=!1,this.$refs["addchannel"].resetFields(),this.resourceid=""},getChannelEnable:function(e,t){return 1==e.row.isEnable?"green_active":"red_active"},channelSizeChange:function(e){this.length=e,this.Get_Re_Channel(1)},channelCurrentChange:function(e){e<=1&&(this.total=0),this.start=(e-1)*this.length,this.Get_Re_Channel(1)},arrSort:function(e,t){var n=e.order,a=t.order;return n<a?-1:n>a?1:0},orderObject:function(e){var t=[];for(var n in e)e[n].showname=n,t.push(e[n]);return t.sort(this.arrSort)},setCard:function(e){this.removeauto(e)},removeauto:function(e){var t=this,n={},a={applicationtText:[{required:!0,message:"请选择所属应用",trigger:"change"}],roles:[{required:!0,message:"请选择所属应用",trigger:"blur"}],name:[{required:!0,message:"请输入通道名称",trigger:"blur"}],region:[{required:!0,message:"请选择服务类型",trigger:"change"}]};if(""==this.resourceid?this.channelregion.map((function(l){l.cType==e&&(t.$forceUpdate(),t.selectregion=l,t.arrlist=t.orderObject(t.selectregion.params),t.arrlist.map((function(e){e.default?n[e.showname]=e.default:n[e.showname]="",e.required&&("string"==e.type||"integer"==e.type?a[e.showname]=[{required:!0,trigger:"blur"}]:a[e.showname]=[{required:!0,trigger:"change"}])})),n.region=e,n.desc="",n.name="",n.type=t.selectregion.type,n.isEnable=!1)})):this.channelregion.map((function(l){l.cType==e&&(t.selectregion=l,t.$forceUpdate(),t.arrlist=t.orderObject(t.selectregion.params),t.arrlist.map((function(l){for(var r in t.channelrow.config)l.showname==r&&(n[l.showname]=t.channelrow.config[r]),l.required&&("string"==l.type||"integer"==l.type?a[l.showname]=[{required:!0,trigger:"blur"}]:a[l.showname]=[{required:!0,trigger:"change"}]),n.region=e,n.desc=t.channelrow.desc,n.name=t.channelrow.name,n.type=t.selectregion.type,n.isEnable=t.channelrow.isEnable})))})),this.channelrow)for(var l in this.channelrow.ACL)n.applicationtText=l?l.substr(5):"";this.addchannel=n,this.addchannel.region=e,this.addrules=a},editorChannel:function(e){this.channelrow=e,this.resourceid=e.objectId,this.channelForm=!0,this.channelupdated="编辑",this.removeauto(e.cType)},nowtime:function(){var e=Date.parse(new Date),t=new Date(e),n=(t.getFullYear(),t.getMonth()+1<=10?t.getMonth():t.getMonth(),t.getDate()+1<=10?t.getDate():t.getDate(),(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":"),a=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",l=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return n+a+l+" "},mqttMsg:function(e){this.msgList.push({timestamp:moment().format("x"),msg:e}),this.refreshFlag=moment().format("x"),this.submessage+=e+"\n"},subProTopic:function(e){var t=this;this.productinformation(e.objectId),this.subdialog=!0,this.subdialogid=e.objectId,this.channelname=e.objectId,this.subtopic="log/channel/"+e.objectId+"/#",this.submessage="",this.msgList=[];var n={router:this.router,topic:this.subtopic,qos:2,ttl:108e5};this.$dgiotBus.$emit("MqttSubscribe",n),this.topicKey=this.$dgiotBus.topicKey(this.router,this.subtopic),this.pubtopic="channel/"+e.objectId,setTimeout((function(){t.$dgiotBus.$emit("MqttPublish",t.pubtopic,JSON.stringify({action:"start_logger"}),0,!1),t.refreshFlag=t.subtopic.split("log")[1]}),500)},handleCloseSubdialog:function(e){this.$dgiotBus.$emit("MqttPublish",e,JSON.stringify({action:"stop_logger"}),0,!1),this.refreshFlag=moment().format("x"),this.submessage="",this.msgList=[],this.subdialog=!this.subdialog}}}),y=w,_=(n("edc4"),n("d982"),n("bdd7")),$=Object(_["a"])(y,a,l,!1,null,"2f373419",null);t["default"]=$.exports}}]);